Ext.ux.FileTreePanel=Ext.extend(Ext.tree.TreePanel,{tabPanelId:"center_panel",confirmText:"Confirm",containerScroll:true,deleteText:"Delete",enableDD:true,enableDelete:true,enableNewDir:true,enableOpen:true,enableProgress:true,enableRename:true,enableSort:true,enableUpload:true,errorText:"Error",existsText:"File <b>{0}</b> already exists",expandOnRender:true,fileCls:"file",fileText:"File",focusPopup:true,folderSort:true,hrefPrefix:"",hrefSuffix:"",layout:"fit",loadingText:"Loading",loadMask:false,maxFileSize:524288,maxMsgLen:2000,method:"post",newdirText:"New Folder",newfileText:"file.php",openMode:"_self",overwriteText:"Do you want to overwrite it?",popupFeatures:"width=800,height=600,dependent=1,scrollbars=1,resizable=1,toolbar=1",readOnly:false,reallyWantText:"Do you really want to",rootPath:"root",rootText:"Tree Root",rootVisible:true,selectOnEdit:true,singleUpload:false,topMenu:false,url:"filetree.php",initComponent:function(){Ext.apply(this,{root:new Ext.tree.AsyncTreeNode({text:this.rootText,path:this.rootPath,rootVisible:this.rootVisible,allowDrag:false}),treeEditor:!this.readOnly?new Ext.tree.TreeEditor(this,{allowBlank:false,cancelOnEsc:true,completeOnEnter:true,ignoreNoChange:true,selectOnFocus:this.selectOnEdit}):undefined,dropConfig:this.dropConfig?this.dropConfig:{ddGroup:this.ddGroup||"TreeDD",appendOnly:this.enableSort,expandDelay:3600000},treeSorter:this.enableSort?new Ext.tree.TreeSorter(this,{folderSort:this.folderSort}):undefined,keys:[{key:Ext.EventObject.ENTER,scope:this,fn:function(a,c){var d=this.getSelectionModel();var b=d.getSelectedNode();if(b&&0!==b.getDepth()&&b.isLeaf()){this.openNode(b)}}},{key:113,scope:this,fn:function(a,c){var d=this.getSelectionModel();var b=d.getSelectedNode();if(b&&0!==b.getDepth()&&this.enableRename&&this.readOnly!==true){this.treeEditor.triggerEdit(b)}}},{key:46,stopEvent:true,scope:this,fn:function(a,c){var d=this.getSelectionModel();var b=d.getSelectedNode();if(b&&0!==b.getDepth()&&this.enableDelete&&this.readOnly!==true){this.deleteNode(b)}}},{key:69,ctrl:true,stopEvent:true,scope:this,fn:function(a,c){var d=this.getSelectionModel();var b=d.getSelectedNode();if(b){b=b.isLeaf()?b.parentNode:b;d.select(b);b.reload()}}},{key:39,ctrl:true,stopEvent:true,scope:this,fn:function(a,c){var d=this.getSelectionModel();var b=d.getSelectedNode();if(b&&!b.isLeaf()){d.select(b);b.expand.defer(1,b,[true])}}},{key:37,ctrl:true,scope:this,stopEvent:true,fn:function(a,c){var d=this.getSelectionModel();var b=d.getSelectedNode();if(b&&!b.isLeaf()){d.select(b);b.collapse.defer(1,b,[true])}}},{key:78,ctrl:true,scope:this,stopEvent:true,fn:function(a,c){var d,b;d=this.getSelectionModel();b=d.getSelectedNode();if(b&&this.enableNewDir&&this.readOnly!==true){b=b.isLeaf()?b.parentNode:b;this.createNewDir(b)}}}]});if(!this.loader){this.loader=new Ext.tree.TreeLoader({url:this.url,baseParams:{cmd:"get"},listeners:{beforeload:{scope:this,fn:function(a,b){a.baseParams.path=this.getPath(b)}}}})}if(true===this.topMenu){this.tbar=[{text:this.fileText,disabled:true,scope:this,menu:this.getContextMenu()}]}Ext.ux.FileTreePanel.superclass.initComponent.apply(this,arguments);if(this.treeEditor){this.treeEditor.beforeNodeClick=function(a,b){return true};this.treeEditor.on({complete:{scope:this,fn:this.onEditComplete},beforecomplete:{scope:this,fn:this.onBeforeEditComplete}})}this.on({contextmenu:{scope:this,fn:this.onContextMenu,stopEvent:true},dblclick:{scope:this,fn:this.onDblClick},beforenodedrop:{scope:this,fn:this.onBeforeNodeDrop},nodedrop:{scope:this,fn:this.onNodeDrop},nodedragover:{scope:this,fn:this.onNodeDragOver},newfile:{scope:this,fn:this.onNewFileSuccess},"delete":{scope:this,fn:this.onDeleteSuccess}});this.addEvents("beforeopen","open","beforerename","rename","renamefailure","beforedelete","delete","deletefailure","beforenewdir","newdir","newdirfailure","beforenewfile","newfile","newfilefailure")},onRender:function(){Ext.ux.FileTreePanel.superclass.onRender.apply(this,arguments);if(true===this.topMenu){this.topMenu=Ext.getCmp(this.getTopToolbar().items.itemAt(0).id);this.getSelectionModel().on({scope:this,selectionchange:function(c,b){var a=b?false:true;a=a||this.readOnly;this.topMenu.setDisabled(a)}});Ext.apply(this.topMenu,{showMenu:function(){this.showContextMenu(false)}.createDelegate(this)})}if(this.expandOnRender){this.root.expand()}this.el.on({contextmenu:{fn:function(){return false},stopEvent:true}});if(true===this.loadMask){this.loader.on({scope:this.el,beforeload:this.el.mask.createDelegate(this.el,[this.loadingText+"..."]),load:this.el.unmask,loadexception:this.el.unmask})}},cmdCallback:function(b,h,a){var d,g,e;var f=true;if(true===h){try{g=Ext.decode(a.responseText)}catch(c){this.showError(a.responseText)}if(true===g.success){switch(b.params.cmd){case"delete":if(true!==this.eventsSuspended){this.fireEvent("delete",this,b.node)}b.node.parentNode.removeChild(b.node);break;case"newdir":if(true!==this.eventsSuspended){this.fireEvent("newdir",this,b.node)}break;case"newfile":if(true!==this.eventsSuspended){this.fireEvent("newfile",this,b.node)}break;case"rename":this.updateCls(b.node,b.params.oldname);if(true!==this.eventsSuspended){this.fireEvent("rename",this,b.node,b.params.newname,b.params.oldname)}break}}else{switch(b.params.cmd){case"rename":if(b.oldParent){b.oldParent.appendChild(b.node)}else{b.node.setText(b.oldName)}if(b.e){b.e.failure=true}if(true!==this.eventsSuspended){this.fireEvent("renamefailure",this,b.node,b.params.newname,b.params.oldname)}break;case"newdir":if(false!==this.eventsSuspended){this.fireEvent("newdirfailure",this,b.params.dir)}b.node.parentNode.removeChild(b.node);break;case"newfile":if(false!==this.eventsSuspended){this.fireEvent("newfilefailure",this,b.params.file)}b.node.parentNode.removeChild(b.node);break;case"delete":if(true!==this.eventsSuspended){this.fireEvent("deletefailure",this,b.node)}b.node.parentNode.reload.defer(1,b.node.parentNode);break;default:this.root.reload();break}this.showError(g.error||a.responseText)}}else{this.showError(a.responseText)}},confirmOverwrite:function(a,c,b){Ext.Msg.show({title:this.confirmText,msg:String.format(this.existsText,a)+". "+this.overwriteText,icon:Ext.Msg.QUESTION,buttons:Ext.Msg.YESNO,fn:c.createDelegate(b||this)})},createNewDir:function(d){if(true!==this.eventsSuspended&&false===this.fireEvent("beforenewdir",this,d)){return}var b=this.treeEditor;var a;var c=d.isLeaf()?d.parentNode:d;c.expand(false,false,function(e){a=e.appendChild(new Ext.tree.AsyncTreeNode({text:this.newdirText,iconCls:"folder"}));b.on({complete:{scope:this,single:true,fn:this.onNewDir}});b.creatingNewDir=true;(function(){b.triggerEdit(a)}.defer(10))}.createDelegate(this))},createNewFile:function(d){if(true!==this.eventsSuspended&&false===this.fireEvent("beforenewfile",this,d)){return}var b=this.treeEditor;var a;var c=d.isLeaf()?d.parentNode:d;c.expand(false,false,function(e){a=e.appendChild(new Ext.tree.AsyncTreeNode({text:this.newfileText,leaf:true}));b.on({complete:{scope:this,single:true,fn:this.onNewFile}});b.creatingNewFile=true;(function(){b.triggerEdit(a)}.defer(10))}.createDelegate(this))},deleteNode:function(a){if(true!==this.eventsSuspended&&false===this.fireEvent("beforedelete",this,a)){return}Ext.Msg.show({title:this.deleteText,msg:this.reallyWantText+" "+this.deleteText.toLowerCase()+" <b>"+a.text+"</b>?",icon:Ext.Msg.WARNING,buttons:Ext.Msg.YESNO,scope:this,fn:function(b){if("yes"!==b){this.getEl().dom.focus();return}var c={url:this.deleteUrl||this.url,method:this.method,scope:this,callback:this.cmdCallback,node:a,params:{cmd:"delete",file:this.getPath(a)}};Ext.Ajax.request(c)}})},downloadFile:function(c){var f=Ext.id();var d=document.createElement("iframe");d.id=f;d.name=f;d.className="x-hidden";if(Ext.isIE){d.src=Ext.SSL_SECURE_URL}document.body.appendChild(d);if(Ext.isIE){document.frames[f].name=f}var a=Ext.DomHelper.append(document.body,{tag:"form",method:"post",action:this.downloadUrl||this.url,target:f});document.body.appendChild(a);var b;b=document.createElement("input");b.type="hidden";b.name="cmd";b.value="download";a.appendChild(b);b=document.createElement("input");b.type="hidden";b.name="path";b.value=c;a.appendChild(b);var e=function(){Ext.EventManager.removeListener(d,"load",e,this);setTimeout(function(){document.body.removeChild(a)},100);setTimeout(function(){document.body.removeChild(d)},110)};Ext.EventManager.on(d,"load",e,this);a.submit()},openFile:function(c,o){var a=Ext.id();var h=Ext.getCmp(this.tabPanelId);var f=h.items.items;var e=this.getFileName(o);var n=h.find("path",o);if(n.length>0){var d=n[0];d.show()}else{var m=h.find("title","No file");var g=h.add(new Ext.ux.CodePress({title:e,closable:true,path:o,tabTip:o,file:o,tabPanel:h})).show();for(var b in m){h.remove(b)}}},getContextMenu:function(){if(!this.contextmenu){var a={singleUpload:this.singleUpload,maxFileSize:this.maxFileSize,enableProgress:this.enableProgress};if(this.baseParams){a.baseParams=this.baseParams}this.contextmenu=new Ext.ux.FileTreeMenu(a);this.contextmenu.on({click:{scope:this,fn:this.onContextClick}});this.uploadPanel=this.contextmenu.getItemByCmd("upload-panel").component;this.uploadPanel.on({beforeupload:{scope:this,fn:this.onBeforeUpload},allfinished:{scope:this,fn:this.onAllFinished}});this.uploadPanel.setUrl(this.uploadUrl||this.url)}return this.contextmenu},getFileCls:function(a){var b=a.split(".");if(1===b.length){return this.fileCls}else{return this.fileCls+"-"+b.pop().toLowerCase()}},getFileName:function(a){var b=a.split("/");return b[b.length-1]},getPath:function(c){var e,d,b;if(c!==this.root){d=c.parentNode;b=[c.text];while(d&&d!==this.root){b.unshift(d.text);d=d.parentNode}b.unshift(this.root.attributes.path||"");e=b.join(this.pathSeparator)}else{e=c.attributes.path||""}e=e.replace(/^[\/\.]*/,"");return e},hasChild:function(b,a){return(b.isLeaf()?b.parentNode:b).findChild("text",a)!==null},hideContextMenu:function(){if(this.contextmenu&&this.contextmenu.isVisible()){this.contextmenu.hide()}return this},onBeforeEditComplete:function(c,a,b){if(c.cancellingEdit){c.cancellingEdit=false;return}var e=this.getPath(c.editNode);var d=e.replace(/\/[^\\]+$/,"/"+a);if(false===this.fireEvent("beforerename",this,c.editNode,d,e)){c.cancellingEdit=true;c.cancelEdit();return false}},onBeforeNodeDrop:function(g){var f=g.dropNode;var h=g.target.leaf?g.target.parentNode:g.target;if(f.parentNode===h){return false}if(this.hasChild(h,f.text)&&undefined===g.confirmed){this.confirmOverwrite(f.text,function(d){g.confirmed="yes"===d;this.onBeforeNodeDrop(g)});return false}if(false===g.confirmed){return false}g.confirmed=undefined;g.oldParent=f.parentNode;var c=this.getPath(f);var a=this.getPath(h)+"/"+f.text;if(true!==this.eventsSuspended&&false===this.fireEvent("beforerename",this,f,a,c)){return false}var b={url:this.renameUrl||this.url,method:this.method,scope:this,callback:this.cmdCallback,node:f,oldParent:f.parentNode,e:g,params:{cmd:"rename",oldname:c,newname:a}};Ext.Ajax.request(b);return true},onBeforeUpload:function(c){var b=this.getContextMenu();var a=this.getPath(b.node);if(b.node.isLeaf()){a=a.replace(/\/[^\/]+$/,"",a)}c.setPath(a)},onAllFinished:function(a){var b=this.getContextMenu();(b.node.isLeaf()?b.node.parentNode:b.node).reload()},onContextClick:function(d,b,c){if(b.disabled){return}var a=d.node;if(!a){a=d.parentMenu.node}switch(b.cmd){case"reload":a.reload();break;case"expand":a.expand(true);break;case"collapse":a.collapse(true);break;case"open":this.openNode(a);break;case"open-self":this.openNode(a,"_self");break;case"open-popup":this.openNode(a,"popup");break;case"open-blank":this.openNode(a,"_blank");break;case"open-dwnld":this.openNode(a,"download");break;case"rename":this.treeEditor.triggerEdit(a);break;case"delete":this.deleteNode(a);break;case"newdir":this.createNewDir(a);break;case"newfile":this.createNewFile(a);break;default:break}},onContextMenu:function(a,b){if(this.readOnly){return false}this.showContextMenu(a);return false},onDblClick:function(a,b){this.openNode(a)},onDestroy:function(){if(this.contextmenu){this.contextmenu.purgeListeners();this.contextmenu.destroy();this.contextmenu=null}if(this.treeEditor){this.treeEditor.purgeListeners();this.treeEditor.destroy();this.treeEditor=null}if(this.treeSorter){this.treeSorter=null}Ext.ux.FileTreePanel.superclass.onDestroy.call(this)},onEditComplete:function(d,a,c){var e=d.editNode;if(a===c||d.creatingNewDir||d.creatingNewFile){d.creatingNewDir=false;d.creatingNewFile=false;return}var f=this.getPath(e.parentNode);var b={url:this.renameUrl||this.url,method:this.method,scope:this,callback:this.cmdCallback,node:e,oldName:c,params:{cmd:"rename",oldname:f+"/"+c,newname:f+"/"+a}};Ext.Ajax.request(b)},onNewDir:function(b){var c=this.getPath(b.editNode);var a={url:this.newdirUrl||this.url,method:this.method,scope:this,node:b.editNode,callback:this.cmdCallback,params:{cmd:"newdir",dir:c}};Ext.Ajax.request(a)},onNewFile:function(b){var c=this.getPath(b.editNode);var a={url:this.newfileUrl||this.url,method:this.method,scope:this,node:b.editNode,callback:this.cmdCallback,params:{cmd:"newfile",file:c}};Ext.Ajax.request(a)},onNewFileSuccess:function(a,b){this.openNode(b,"_self")},onDeleteSuccess:function(a,d){var f=Ext.getCmp(this.tabPanelId);var e=this.getPath(d);var b=f.find("path",e);if(b.length>0){for(var c in b){f.remove(c)}}},onNodeDragOver:function(a){a.cancel=a.target.disabled||a.dropNode.parentNode===a.target.parentNode&&a.target.isLeaf()},onNodeDrop:function(b){if(true===b.failure){b.oldParent.appendChild(b.dropNode);return}var a=b.dropNode.parentNode.findChild("text",b.dropNode.text);if(a&&a!==b.dropNode){a.parentNode.removeChild(a)}},openNode:function(b,d){if(!this.enableOpen){return}d=d||this.openMode;var a;var c;if(b.isLeaf()){c=this.getPath(b);a=this.hrefPrefix+c+this.hrefSuffix;if(true!==this.eventsSuspended&&false===this.fireEvent("beforeopen",this,b.text,a,d)){return}switch(d){case"popup":if(!this.popup||this.popup.closed){this.popup=window.open(a,this.hrefTarget,this.popupFeatures)}this.popup.location=a;if(this.focusPopup){this.popup.focus()}break;case"_self":this.openFile(b,c);break;case"_blank":window.open(a);break;case"download":this.downloadFile(c);break}if(true!==this.eventsSuspended){this.fireEvent("open",this,b.text,a,d)}}},setDeleteDisabled:function(a){a=!(!a);if(!this.enableDelete===a){return this}this.hideContextMenu();this.enableDelete=!a},setNewdirDisabled:function(a){a=!(!a);if(!this.enableNewDir===a){return this}this.hideContextMenu();this.enableNewDir=!a},setOpenDisabled:function(a){a=!(!a);if(!this.enableOpen===a){return this}this.hideContextMenu();this.enableOpen=!a;return this},setReadOnly:function(a){a=!(!a);if(this.readOnly===a){return this}this.hideContextMenu();if(this.dragZone){this.dragZone.locked=a}this.readOnly=a;return this},setRenameDisabled:function(a){a=!(!a);if(!this.enableRename===a){return this}this.hideContextMenu();if(this.dragZone){this.dragZone.locked=a}this.enableRename=!a;return this},setUploadDisabled:function(a){a=!(!a);if(!this.enableUpload===a){return this}this.hideContextMenu();this.enableUpload=!a;return this},showContextMenu:function(c){var a=false;var b=this.topMenu?this.topMenu.getEl():this.body;if(!c){c=this.getSelectionModel().getSelectedNode();a=true}else{b=c.getUI().getEl()}if(!c){return}var d=this.getContextMenu();d.node=c;d.getItemByCmd("nodename").setText(Ext.util.Format.ellipsis(c.text,22));d.setItemDisabled("open",!c.isLeaf());d.setItemDisabled("reload",c.isLeaf());d.setItemDisabled("expand",c.isLeaf());d.setItemDisabled("collapse",c.isLeaf());d.setItemDisabled("delete",c===this.root||c.disabled);d.setItemDisabled("rename",this.readOnly||c===this.root||c.disabled);d.setItemDisabled("newdir",this.readOnly||(c.isLeaf()?c.parentNode.disabled:c.disabled));d.setItemDisabled("newfile",this.readOnly||(c.isLeaf()?c.parentNode.disabled:c.disabled));d.setItemDisabled("upload",c.isLeaf()?c.parentNode.disabled:c.disabled);d.setItemDisabled("upload-panel",c.isLeaf()?c.parentNode.disabled:c.disabled);d.getItemByCmd("open").setVisible(this.enableOpen);d.getItemByCmd("delete").setVisible(this.enableDelete);d.getItemByCmd("newdir").setVisible(this.enableNewDir);d.getItemByCmd("rename").setVisible(this.enableRename);d.getItemByCmd("upload").setVisible(this.enableUpload);d.getItemByCmd("upload-panel").setVisible(this.enableUpload);d.getItemByCmd("sep-upload").setVisible(this.enableUpload);d.getItemByCmd("sep-collapse").setVisible(this.enableNewDir||this.enableDelete||this.enableRename);c.select();if(a){d.showAt(d.getEl().getAlignToXY(b,"tl-bl?"))}else{d.showAt(d.getEl().getAlignToXY(b,"tl-tl?",[0,18]))}},showError:function(b,a){Ext.Msg.show({title:a||this.errorText,msg:Ext.util.Format.ellipsis(b,this.maxMsgLen),fixCursor:true,icon:Ext.Msg.ERROR,buttons:Ext.Msg.OK,minWidth:1200>String(b).length?360:600})},updateCls:function(b,a){if(b.isLeaf()){Ext.fly(b.getUI().iconNode).removeClass(this.getFileCls(a));Ext.fly(b.getUI().iconNode).addClass(this.getFileCls(b.text))}}});Ext.reg("filetreepanel",Ext.ux.FileTreePanel);Ext.ux.FileTreeMenu=function(b){b=b||{};var a={contextmenu:this,buttonsAt:b.buttonsAt||"tbar",singleUpload:b.singleUpload||false,maxFileSize:b.maxFileSize,enableProgress:b.enableProgress};if(b.baseParams){b.baseParams.cmd=b.baseParams.cmd||"upload";b.baseParams.dir=b.baseParams.dir||".";a.baseParams=b.baseParams}Ext.apply(b,{items:[{text:"&#160",cls:"ux-ftm-nodename",disabledClass:"",disabled:true,cmd:"nodename"},{text:this.openText+" (Enter)",iconCls:this.openIconCls,cmd:"open",menu:{items:[{text:this.openSelfText,iconCls:this.openSelfIconCls,cmd:"open-self"}]}},new Ext.menu.Separator({cmd:"sep-open"}),{text:this.reloadText+" (Ctrl+E)",iconCls:this.reloadIconCls,cmd:"reload"},{text:this.expandText+" (Ctrl+&nbsp;&rarr;)",iconCls:this.expandIconCls,cmd:"expand"},{text:this.collapseText+" (Ctrl+&nbsp;&larr;)",iconCls:this.collapseIconCls,cmd:"collapse"},new Ext.menu.Separator({cmd:"sep-collapse"}),{text:this.renameText+" (F2)",iconCls:this.renameIconCls,cmd:"rename"},{text:this.deleteText+" ("+this.deleteKeyName+")",iconCls:this.deleteIconCls,cmd:"delete"},{text:this.newdirText+"... (Ctrl+N)",iconCls:this.newdirIconCls,cmd:"newdir"},{text:this.newfileText,iconCls:this.newfileIconCls,cmd:"newfile"},new Ext.menu.Separator({cmd:"sep-upload"}),{text:this.uploadFileText+" (Ctrl+U)",iconCls:this.uploadIconCls,hideOnClick:false,cmd:"upload"},new Ext.menu.Adapter(new Ext.ux.UploadPanel(a),{hideOnClick:false,cmd:"upload-panel"})]});Ext.ux.FileTreeMenu.superclass.constructor.call(this,b);this.relayEvents(this.getItemByCmd("open").menu,["click","itemclick"])};Ext.extend(Ext.ux.FileTreeMenu,Ext.menu.Menu,{collapseIconCls:"icon-collapse-all",collapseText:"Collapse all",deleteIconCls:"icon-cross",deleteKeyName:"Delete Key",deleteText:"Delete",expandIconCls:"icon-expand-all",expandText:"Expand all",newdirIconCls:"icon-folder-add",newdirText:"New folder",newfileIconCls:"icon-plus",newfileText:"New file",openBlankIconCls:"icon-open-blank",openBlankText:"Open in new window",openDwnldIconCls:"icon-open-download",openDwnldText:"Download",openIconCls:"icon-open",openPopupIconCls:"icon-open-popup",openPopupText:"Open in popup",openSelfIconCls:"icon-open-self",openSelfText:"Open in this window",openText:"Open",reloadIconCls:"icon-refresh",reloadText:'R<span style="text-decoration:underline">e</span>load',renameIconCls:"icon-pencil",renameText:"Rename",uploadFileText:'<span style="text-decoration:underline">U</span>pload file',uploadIconCls:"icon-upload",uploadText:"Upload",width:190,getItemByCmd:function(c){var a;var b=this.items.find(function(d){return c===d.cmd});if(!b){a=this.items.find(function(d){return"open"===d.cmd});if(!a){return null}b=a.menu.items.find(function(d){return c===d.cmd})}return b},setItemDisabled:function(c,a){var b=this.getItemByCmd(c);if(b){b.setDisabled(a)}},beforeDestroy:function(){var a=this.getItemByCmd("upload-panel");if(a&&a.component){a.component.purgeListeners();a.component.destroy();a.component=null}}});Ext.reg("filetreemenu",Ext.ux.FileTreeMenu);Ext.namespace("Ext.ux.form");Ext.ux.form.BrowseButton=Ext.extend(Ext.Button,{inputFileName:"file",debug:false,FLOAT_EL_WIDTH:60,FLOAT_EL_HEIGHT:18,buttonCt:null,clipEl:null,floatEl:null,inputFileEl:null,originalHandler:null,originalScope:null,initComponent:function(){Ext.ux.form.BrowseButton.superclass.initComponent.call(this);this.originalHandler=this.handler;this.originalScope=this.scope;this.handler=null;this.scope=null},onRender:function(d,b){Ext.ux.form.BrowseButton.superclass.onRender.call(this,d,b);this.buttonCt=this.el.child(".x-btn-center em");this.buttonCt.position("relative");var c={position:"absolute",overflow:"hidden",top:"0px",left:"0px"};if(Ext.isIE){Ext.apply(c,{left:"-3px",top:"-3px"})}else{if(Ext.isGecko){Ext.apply(c,{left:"-3px",top:"-3px"})}else{if(Ext.isSafari){Ext.apply(c,{left:"-4px",top:"-2px"})}}}this.clipEl=this.buttonCt.createChild({tag:"div",style:c});this.setClipSize();this.clipEl.on({"mousemove":this.onButtonMouseMove,"mouseover":this.onButtonMouseMove,scope:this});this.floatEl=this.clipEl.createChild({tag:"div",style:{position:"absolute",width:this.FLOAT_EL_WIDTH+"px",height:this.FLOAT_EL_HEIGHT+"px",overflow:"hidden"}});if(this.debug){this.clipEl.applyStyles({"background-color":"green"});this.floatEl.applyStyles({"background-color":"red"})}else{this.clipEl.setOpacity(0)}var a=this.el.child(this.buttonSelector);a.on("focus",this.onButtonFocus,this);if(Ext.isIE){this.el.on("keydown",this.onButtonKeyDown,this)}this.createInputFile()},setClipSize:function(){if(this.clipEl){var b=this.buttonCt.getWidth();var a=this.buttonCt.getHeight();if(b===0||a===0){this.setClipSize.defer(100,this)}else{if(Ext.isIE){b=b+5;a=a+5}else{if(Ext.isGecko){b=b+6;a=a+6}else{if(Ext.isSafari){b=b+6;a=a+6}}}this.clipEl.setSize(b,a)}}},createInputFile:function(){this.floatEl.select("em").each(function(a){a.remove()});this.inputFileEl=this.floatEl.createChild({tag:"input",type:"file",size:1,name:this.inputFileName||Ext.id(this.el),tabindex:this.tabIndex,style:{position:"absolute",cursor:"pointer",right:"0px",top:"0px"}});this.inputFileEl=this.inputFileEl.child("input")||this.inputFileEl;this.inputFileEl.on({"click":this.onInputFileClick,"change":this.onInputFileChange,"focus":this.onInputFileFocus,"select":this.onInputFileFocus,"blur":this.onInputFileBlur,scope:this});if(this.tooltip){if(typeof this.tooltip=="object"){Ext.QuickTips.register(Ext.apply({target:this.inputFileEl},this.tooltip))}else{this.inputFileEl.dom[this.tooltipType]=this.tooltip}}},onButtonFocus:function(a){if(this.inputFileEl){this.inputFileEl.focus();a.stopEvent()}},onButtonKeyDown:function(a){if(this.inputFileEl&&a.getKey()==Ext.EventObject.SPACE){this.inputFileEl.dom.click();a.stopEvent()}},onButtonMouseMove:function(b){var a=b.getXY();a[0]-=this.FLOAT_EL_WIDTH/2;a[1]-=this.FLOAT_EL_HEIGHT/2;this.floatEl.setXY(a)},onInputFileFocus:function(a){if(!this.isDisabled){this.el.addClass("x-btn-over")}},onInputFileBlur:function(a){this.el.removeClass("x-btn-over")},onInputFileClick:function(a){a.stopPropagation()},onInputFileChange:function(){if(this.originalHandler){this.originalHandler.call(this.originalScope,this)}},detachInputFile:function(b){var a=this.inputFileEl;if(typeof this.tooltip=="object"){Ext.QuickTips.unregister(this.inputFileEl)}else{this.inputFileEl.dom[this.tooltipType]=null}this.inputFileEl.removeAllListeners();this.inputFileEl=null;if(!b){this.createInputFile()}return a},getInputFile:function(){return this.inputFileEl},disable:function(){Ext.ux.form.BrowseButton.superclass.disable.call(this);this.inputFileEl.dom.disabled=true},enable:function(){Ext.ux.form.BrowseButton.superclass.enable.call(this);this.inputFileEl.dom.disabled=false}});Ext.reg("browsebutton",Ext.ux.form.BrowseButton);Ext.ux.FileUploader=function(a){Ext.apply(this,a);Ext.ux.FileUploader.superclass.constructor.apply(this,arguments);this.addEvents("beforeallstart","allfinished","beforefilestart","filefinished","progress")};Ext.extend(Ext.ux.FileUploader,Ext.util.Observable,{baseParams:{cmd:"upload",dir:"."},concurrent:true,enableProgress:true,jsonErrorText:"Cannot decode JSON object",maxFileSize:524288,progressIdName:"UPLOAD_IDENTIFIER",progressInterval:2000,progressUrl:"progress.php",progressMap:{bytes_total:"bytesTotal",bytes_uploaded:"bytesUploaded",est_sec:"estSec",files_uploaded:"filesUploaded",speed_average:"speedAverage",speed_last:"speedLast",time_last:"timeLast",time_start:"timeStart"},singleUpload:false,unknownErrorText:"Unknown error",upCount:0,createForm:function(a){var c=parseInt(Math.random()*10000000000,10);var b=Ext.getBody().createChild({tag:"form",action:this.url,method:"post",cls:"x-hidden",id:Ext.id(),cn:[{tag:"input",type:"hidden",name:"APC_UPLOAD_PROGRESS",value:c},{tag:"input",type:"hidden",name:this.progressIdName,value:c},{tag:"input",type:"hidden",name:"MAX_FILE_SIZE",value:this.maxFileSize}]});if(a){a.set("form",b);a.set("progressId",c)}else{this.progressId=c}return b},deleteForm:function(b,a){b.remove();if(a){a.set("form",null)}},fireFinishEvents:function(a){if(true!==this.eventsSuspended&&!this.singleUpload){this.fireEvent("filefinished",this,a&&a.record)}if(true!==this.eventsSuspended&&0===this.upCount){this.stopProgress();this.fireEvent("allfinished",this)}},getIframe:function(a){var b=null;var c=a.get("form");if(c&&c.dom&&c.dom.target){b=Ext.get(c.dom.target)}return b},getOptions:function(a,c){var b={url:this.url,method:"post",isUpload:true,scope:this,callback:this.uploadCallback,record:a,params:this.getParams(a,c)};return b},getParams:function(a,c){var b={path:this.path};Ext.apply(b,this.baseParams||{},c||{});return b},processSuccess:function(c,b,d){var a=false;if(this.singleUpload){this.store.each(function(e){e.set("state","done");e.set("error","");e.commit()})}else{a=c.record;a.set("state","done");a.set("error","");a.commit()}this.deleteForm(c.form,a)},processFailure:function(e,c,d){var a=e.record;var b;if(this.singleUpload){b=this.store.queryBy(function(f){var g=f.get("state");return"done"!==g&&"uploading"!==g});b.each(function(f){var g=d.errors?d.errors[f.id]:this.unknownErrorText;if(g){f.set("state","failed");f.set("error",g);Ext.getBody().appendChild(f.get("input"))}else{f.set("state","done");f.set("error","")}f.commit()},this);this.deleteForm(e.form)}else{if(d&&"object"===Ext.type(d)){a.set("error",d.errors&&d.errors[a.id]?d.errors[a.id]:this.unknownErrorText)}else{if(d){a.set("error",d)}else{if(c&&c.responseText){a.set("error",c.responseText)}else{a.set("error",this.unknownErrorText)}}}a.set("state","failed");a.commit()}},requestProgress:function(){var a,b;var c={url:this.progressUrl,method:"post",params:{},scope:this,callback:function(f,m,d){var h;if(true!==m){return}try{h=Ext.decode(d.responseText)}catch(g){return}if("object"!==Ext.type(h)||true!==h.success){return}if(this.singleUpload){this.progress={};for(b in h){if(this.progressMap[b]){this.progress[this.progressMap[b]]=parseInt(h[b],10)}}if(true!==this.eventsSuspended){this.fireEvent("progress",this,this.progress)}}else{for(b in h){if(this.progressMap[b]&&f.record){f.record.set(this.progressMap[b],parseInt(h[b],10))}}if(f.record){f.record.commit();if(true!==this.eventsSuspended){this.fireEvent("progress",this,f.record.data,f.record)}}}this.progressTask.delay(this.progressInterval)}};if(this.singleUpload){c.params[this.progressIdName]=this.progressId;c.params.APC_UPLOAD_PROGRESS=this.progressId;Ext.Ajax.request(c)}else{a=this.store.query("state","uploading");a.each(function(d){c.params[this.progressIdName]=d.get("progressId");c.params.APC_UPLOAD_PROGRESS=c.params[this.progressIdName];c.record=d;(function(){Ext.Ajax.request(c)}).defer(250)},this)}},setPath:function(a){this.path=a},setUrl:function(a){this.url=a},startProgress:function(){if(!this.progressTask){this.progressTask=new Ext.util.DelayedTask(this.requestProgress,this)}this.progressTask.delay.defer(this.progressInterval/2,this.progressTask,[this.progressInterval])},stopProgress:function(){if(this.progressTask){this.progressTask.cancel()}},stopAll:function(){var a=this.store.query("state","uploading");a.each(this.stopUpload,this)},stopUpload:function(a){var b=false;if(a){b=this.getIframe(a);this.stopIframe(b);this.upCount--;this.upCount=0>this.upCount?0:this.upCount;a.set("state","stopped");this.fireFinishEvents({record:a})}else{if(this.form){b=Ext.fly(this.form.dom.target);this.stopIframe(b);this.upCount=0;this.fireFinishEvents()}}},stopIframe:function(a){if(a){try{a.dom.contentWindow.stop();a.remove.defer(250,a)}catch(b){}}},upload:function(){var a=this.store.queryBy(function(b){return"done"!==b.get("state")});if(!a.getCount()){return}if(true!==this.eventsSuspended&&false===this.fireEvent("beforeallstart",this)){return}if(this.singleUpload){this.uploadSingle()}else{a.each(this.uploadFile,this)}if(true===this.enableProgress){this.startProgress()}},uploadCallback:function(b,f,a){var d;this.upCount--;this.form=false;if(true===f){try{d=Ext.decode(a.responseText)}catch(c){this.processFailure(b,a,this.jsonErrorText);this.fireFinishEvents(b);return}if(true===d.success){this.processSuccess(b,a,d)}else{this.processFailure(b,a,d)}}else{this.processFailure(b,a)}this.fireFinishEvents(b)},uploadFile:function(a,e){if(true!==this.eventsSuspended&&false===this.fireEvent("beforefilestart",this,a)){return}var c=this.createForm(a);var b=a.get("input");b.set({name:b.id});c.appendChild(b);var d=this.getOptions(a,e);d.form=c;a.set("state","uploading");a.set("pctComplete",0);this.upCount++;Ext.Ajax.request(d);this.getIframe.defer(100,this,[a])},uploadSingle:function(){var a=this.store.queryBy(function(d){return"done"!==d.get("state")});if(!a.getCount()){return}var b=this.createForm();a.each(function(d){var e=d.get("input");e.set({name:e.id});b.appendChild(e);d.set("state","uploading")},this);var c=this.getOptions();c.form=b;this.form=b;this.upCount++;Ext.Ajax.request(c)}});Ext.reg("fileuploader",Ext.ux.FileUploader);Ext.ux.UploadPanel=Ext.extend(Ext.Panel,{addIconCls:"icon-plus",addText:"Add",bodyStyle:"padding:2px",buttonsAt:"tbar",clickRemoveText:"Click to remove",clickStopText:"Click to stop",emptyText:"No files",enableProgress:true,errorText:"Error",fileCls:"file",fileQueuedText:"File <b>{0}</b> is queued for upload",fileDoneText:"File <b>{0}</b> has been successfully uploaded",fileFailedText:"File <b>{0}</b> failed to upload",fileStoppedText:"File <b>{0}</b> stopped by user",fileUploadingText:"Uploading file <b>{0}</b>",maxFileSize:524288,maxLength:18,removeAllIconCls:"icon-cross",removeAllText:"Remove All",removeIconCls:"icon-minus",removeText:"Remove",selectedClass:"ux-up-item-selected",singleUpload:false,stopAllText:"Stop All",stopIconCls:"icon-stop",uploadText:"Upload",uploadIconCls:"icon-upload",workingIconCls:"icon-working",initComponent:function(){var d={xtype:"browsebutton",text:this.addText+"...",iconCls:this.addIconCls,scope:this,handler:this.onAddFile};var b={xtype:"button",iconCls:this.uploadIconCls,text:this.uploadText,scope:this,handler:this.onUpload,disabled:true};var e={xtype:"button",iconCls:this.removeAllIconCls,tooltip:this.removeAllText,scope:this,handler:this.onRemoveAllClick,disabled:true};if("body"!==this.buttonsAt){this[this.buttonsAt]=[d,b,"->",e]}var a=[{name:"id",type:"text",system:true},{name:"shortName",type:"text",system:true},{name:"fileName",type:"text",system:true},{name:"filePath",type:"text",system:true},{name:"fileCls",type:"text",system:true},{name:"input",system:true},{name:"form",system:true},{name:"state",type:"text",system:true},{name:"error",type:"text",system:true},{name:"progressId",type:"int",system:true},{name:"bytesTotal",type:"int",system:true},{name:"bytesUploaded",type:"int",system:true},{name:"estSec",type:"int",system:true},{name:"filesUploaded",type:"int",system:true},{name:"speedAverage",type:"int",system:true},{name:"speedLast",type:"int",system:true},{name:"timeLast",type:"int",system:true},{name:"timeStart",type:"int",system:true},{name:"pctComplete",type:"int",system:true}];if(Ext.isArray(this.customFields)){a.push(this.customFields)}this.store=new Ext.data.SimpleStore({id:0,fields:a,data:[]});Ext.apply(this,{items:[{xtype:"dataview",itemSelector:"div.ux-up-item",store:this.store,selectedClass:this.selectedClass,singleSelect:true,emptyText:this.emptyText,tpl:this.tpl||new Ext.XTemplate('<tpl for=".">'+'<div class="ux-up-item">'+'<div class="ux-up-icon-file {fileCls}">&#160;</div>'+'<div class="ux-up-text x-unselectable" qtip="{fileName}">{shortName}</div>'+'<div id="remove-{[values.input.id]}" class="ux-up-icon-state ux-up-icon-{state}"'+'qtip="{[this.scope.getQtip(values)]}">&#160;</div>'+"</div>"+"</tpl>",{scope:this}),listeners:{click:{scope:this,fn:this.onViewClick}}}]});Ext.ux.UploadPanel.superclass.initComponent.apply(this,arguments);this.view=this.items.itemAt(0);this.addEvents("beforefileadd","fileadd","beforefileremove","fileremove","beforequeueclear","queueclear","beforeupload");this.relayEvents(this.view,["beforeclick","beforeselect","click","containerclick","contextmenu","dblclick","selectionchange"]);var c={store:this.store,singleUpload:this.singleUpload,maxFileSize:this.maxFileSize,enableProgress:this.enableProgress,url:this.url,path:this.path};if(this.baseParams){c.baseParams=this.baseParams}this.uploader=new Ext.ux.FileUploader(c);this.relayEvents(this.uploader,["beforeallstart","allfinished","progress"]);this.on({beforeallstart:{scope:this,fn:function(){this.uploading=true;this.updateButtons()}},allfinished:{scope:this,fn:function(){this.uploading=false;this.updateButtons()}},progress:{fn:this.onProgress.createDelegate(this)}})},onRender:function(){Ext.ux.UploadPanel.superclass.onRender.apply(this,arguments);var a="tbar"===this.buttonsAt?this.getTopToolbar():this.getBottomToolbar();this.addBtn=Ext.getCmp(a.items.first().id);this.uploadBtn=Ext.getCmp(a.items.itemAt(1).id);this.removeAllBtn=Ext.getCmp(a.items.last().id)},getQtip:function(a){var b="";switch(a.state){case"queued":b=String.format(this.fileQueuedText,a.fileName);b+="<br>"+this.clickRemoveText;break;case"uploading":b=String.format(this.fileUploadingText,a.fileName);b+="<br>"+a.pctComplete+"% done";b+="<br>"+this.clickStopText;break;case"done":b=String.format(this.fileDoneText,a.fileName);b+="<br>"+this.clickRemoveText;break;case"failed":b=String.format(this.fileFailedText,a.fileName);b+="<br>"+this.errorText+":"+a.error;b+="<br>"+this.clickRemoveText;break;case"stopped":b=String.format(this.fileStoppedText,a.fileName);b+="<br>"+this.clickRemoveText;break}return b},getFileName:function(a){return a.getValue().split(/[\/\\]/).pop()},getFilePath:function(a){return a.getValue().replace(/[^\/\\]+$/,"")},getFileCls:function(a){var b=a.split(".");if(1===b.length){return this.fileCls}else{return this.fileCls+"-"+b.pop().toLowerCase()}},onAddFile:function(c){if(true!==this.eventsSuspended&&false===this.fireEvent("beforefileadd",this,c.getInputFile())){return}var a=c.detachInputFile();a.addClass("x-hidden");var d=this.getFileName(a);var b=new this.store.recordType({input:a,fileName:d,filePath:this.getFilePath(a),shortName:Ext.util.Format.ellipsis(d,this.maxLength),fileCls:this.getFileCls(d),state:"queued"},a.id);b.commit();this.store.add(b);this.syncShadow();this.uploadBtn.enable();this.removeAllBtn.enable();if(true!==this.eventsSuspended){this.fireEvent("fileadd",this,this.store,b)}},onDestroy:function(){if(this.uploader){this.uploader.stopAll();this.uploader.purgeListeners();this.uploader=null}if(this.view){this.view.purgeListeners();this.view.destroy();this.view=null}if(this.store){this.store.purgeListeners();this.store.destroy();this.store=null}},onProgress:function(h,f,g){var e,d,m,a,n,o,b,c;if(g){a=g.get("state");e=g.get("bytesTotal")||1;d=g.get("bytesUploaded")||0;if("uploading"===a){m=Math.round(1000*d/e)/10}else{if("done"===a){m=100}else{m=0}}g.set("pctComplete",m);n=this.store.indexOf(g);o=Ext.get(this.view.getNode(n));if(o){b=o.getWidth();o.applyStyles({"background-position":b*m/100+"px"})}}},onRemoveFile:function(a){if(true!==this.eventsSuspended&&false===this.fireEvent("beforefileremove",this,this.store,a)){return}var d=a.get("input");var b=d.up("em");d.remove();if(b){b.remove()}this.store.remove(a);var c=this.store.getCount();this.uploadBtn.setDisabled(!c);this.removeAllBtn.setDisabled(!c);if(true!==this.eventsSuspended){this.fireEvent("fileremove",this,this.store);this.syncShadow()}},onRemoveAllClick:function(a){if(true===this.uploading){this.stopAll()}else{this.removeAll()}},stopAll:function(){this.uploader.stopAll()},onViewClick:function(a,b,d,f){var c=f.getTarget("div:any(.ux-up-icon-queued|.ux-up-icon-failed|.ux-up-icon-done|.ux-up-icon-stopped)");if(c){this.onRemoveFile(this.store.getAt(b))}c=f.getTarget("div.ux-up-icon-uploading");if(c){this.uploader.stopUpload(this.store.getAt(b))}},onUpload:function(){if(true!==this.eventsSuspended&&false===this.fireEvent("beforeupload",this)){return false}this.uploader.upload()},setUrl:function(a){this.url=a;this.uploader.setUrl(a)},setPath:function(a){this.uploader.setPath(a)},updateButtons:function(){if(true===this.uploading){this.addBtn.disable();this.uploadBtn.disable();this.removeAllBtn.setIconClass(this.stopIconCls);this.removeAllBtn.getEl().child(this.removeAllBtn.buttonSelector).dom[this.removeAllBtn.tooltipType]=this.stopAllText}else{this.addBtn.enable();this.uploadBtn.enable();this.removeAllBtn.setIconClass(this.removeAllIconCls);this.removeAllBtn.getEl().child(this.removeAllBtn.buttonSelector).dom[this.removeAllBtn.tooltipType]=this.removeAllText}},removeAll:function(){var a=this.eventsSuspended;if(false!==this.eventsSuspended&&false===this.fireEvent("beforequeueclear",this,this.store)){return false}this.suspendEvents();this.store.each(this.onRemoveFile,this);this.eventsSuspended=a;if(true!==this.eventsSuspended){this.fireEvent("queueclear",this,this.store)}this.syncShadow()},syncShadow:function(){if(this.contextmenu&&this.contextmenu.shadow){this.contextmenu.getEl().shadow.show(this.contextmenu.getEl())}}});Ext.reg("uploadpanel",Ext.ux.UploadPanel);Ext.namespace("Ext.ux.plugins");Ext.ns("Ext.ux.plugins");Ext.ux.plugins.RealtimeWidgetUpdate=function(a){Ext.apply(this,a)};Ext.extend(Ext.ux.plugins.RealtimeWidgetUpdate,Ext.util.Observable,{init:function(widget){var me=this;var numRequests=0;var autoReload;var stopTool={id:"stop-reload",hidden:this.startInitial?false:true,handler:function(){autoReload.stop();widget.tools["stop-reload"].setVisible(false);widget.tools["start-reload"].setVisible(true)},scope:widget,qtip:"Pause auto widget reload."};var startTool={id:"start-reload",hidden:this.startInitial?true:false,handler:function(){autoReload.started=true;widget.tools["start-reload"].setVisible(false);widget.tools["stop-reload"].setVisible(true);this.reloadNow()},scope:widget,qtip:"Start auto widget reload."};widget.tools=widget.tools||[];if(this.reloadToolVisible){for(var i=0,len=widget.tools.length;i<len;i++){if(widget.tools[i].id=="start-reload"){return}}widget.tools.reverse();widget.tools[widget.tools.length]=stopTool;widget.tools[widget.tools.length]=startTool;widget.tools.reverse()}autoReload={started:me.startInitial,ajaxId:undefined,stop:function(){autoReload.started=false;autoReload._abortAjax()},_abortAjax:function(){if(autoReload.ajaxId){numRequests-=1;Ext.Ajax.abort(autoReload.ajaxId);autoReload.ajaxId=undefined}},isEnabled:function(){return autoReload.started},task:new Ext.util.DelayedTask(function(){if(autoReload.isEnabled()){widget.reloadNow()}}),beforeLoad:function(){numRequests+=1;autoReload._abortAjax()},afterLoad:function(){autoReload.ajaxId=undefined;numRequests-=1;if(autoReload.isEnabled()){autoReload.task.delay(me.rate)}},afterFailure:function(){window.setTimeout(autoReload.afterLoad,10000)}};if(widget.getStore){widget.getStore().on("beforeload",autoReload.beforeLoad);widget.getStore().on("load",autoReload.afterLoad);widget.getStore().on("exception",autoReload.afterFailure)}Ext.apply(widget,{gridReload:function(){if(numRequests<=0){numRequests=0;widget.disableLoadMask=true;if(widget.loadMask&&widget.loadMask.disable){widget.loadMask.disable()}var store=widget.getStore();if(store.proxy.conn.disableCaching===false){store.proxy.conn.disableCaching=true}if(store.proxy.setUrl){var url=store.proxy.url;if(url.indexOf("?")>0){url=url+"&_wait=1"}else{url=url+"?_wait=1"}store.proxy.setUrl(url)}store.reload();autoReload.ajaxId=undefined;if(store.proxy.activeRequest){autoReload.ajaxId=store.proxy.activeRequest.read}}},htmlReload:function(){var owner=this;if(!autoReload.ajaxId){autoReload.ajaxId=Ext.Ajax.request({url:me.url,method:"POST",params:Ext.apply(me.requestParams,{reload:"true"}),success:owner.onSuccess,failure:function(){autoReload.afterFailure()}})}},reloadNow:function(){var owner=this;if(widget.getStore){owner.gridReload()}else{owner.htmlReload()}},onHide:function(){this.reloadNow()},onSuccess:function(r){autoReload.afterLoad();var rc=null;try{rc=new RegExp('^("(\\\\.|[^"\\\\\\n\\r])*?"|[,:{}\\[\\]0-9.\\-+Eaeflnr-u \\n\\r\\t])+?$')}catch(z){rc=/^(true|false|null|\[.*\]|\{.*\}|".*"|\d+|\d+\.\d+)$/}if(!rc.test(r.responseText)){return}var json=Ext.util.JSON.decode(r.responseText);if(json.html&&json.js){var html=json.html;var js=json.js;if(widget&&widget.items&&widget.items.items[0]&&widget.items.items[0].getEl()&&widget.items.items[0].getEl().dom){widget.items.items[0].getEl().dom.innerHTML=html;if(js){eval(js)}}}else{if(json.html){var html=json.html;if(widget&&widget.items&&widget.items.items[0]&&widget.items.items[0].getEl()&&widget.items.items[0].getEl().dom){var div=document.createElement("div");div.innerHTML=html;if(div.firstChild.onmouseover){if(widget.items.items[0].getEl().dom.firstChild){div.firstChild.style.height=widget.items.items[0].getEl().dom.firstChild.style.height;html=div.innerHTML}}widget.items.items[0].getEl().dom.innerHTML=html}else{if(widget&&widget.getEl()&&widget.getEl()){var el=widget.getEl().dom;if(el){var p=el.firstChild.childNodes[0];if(p){p.innerHTML=html}}}}}}}})}});Ext.namespace("Ext.ux.plugins");Ext.ux.plugins.HelpText={init:function(a){Ext.apply(a,{onRender:a.onRender.createSequence(function(f,b){if(typeof this.helpText=="string"){switch(this.helpType){case"comment":this.wrap=this.wrap||this.el.wrap();var d=this.el.dom;d=this.wrap.dom;Ext.DomHelper.append(d.parentNode,{tag:"div",cls:typeof this.helpTextClass!="undefined"?this.helpTextClass:"",style:typeof this.helpTextStyle!="undefined"?this.helpTextStyle:"clear: right; font-size: 11px; color: #888888;",html:this.helpText});break;case"inline":var h=this.getEl();var c=h.findParent(".x-form-item");if(c){var e=Ext.select("label",true,c);label=e.elements[0]}var g="padding-left:2px;";if(!label){break}switch(this.xtype){case"radio":label=e.elements[1];break;default:var g="padding-right:2px;float:left";break}this.helpText=(this.helpText+"").replace(/[\\"']/g,"'");Ext.DomHelper.insertFirst(label,{tag:"span",style:g,html:'<img src="/appFlowerPlugin/images/help.png" qtip="'+this.helpText+'">'});break}}}),findByClassName:function(d,c){var b;while(b=d.parentNode){if(b.className.match(c)){return b}d=b}return false}})}};Ext.ux.plugins.HelpText=Ext.extend(Ext.ux.plugins.HelpText,Ext.util.Observable);Ext.ns("Ext.ux.plugins");Ext.ux.plugins.DayTimeSelect=Ext.extend(Ext.form.Field,{border:true,width:250,dayTimeFieldWidth:60,fromFieldWidth:60,toFieldWidth:60,buttonWidth:50,listWidth:200,layout:"form",hidden:true,prepareValue:function(b,a){da=Array();j=0;for(i=0;i<a.length;i++){if(a[i]!=""&&a[i]!=null){da[j]=a[i];j++}}if(this.returnType=="json"){var c=Array();c[0]=b;c[1]=da;json=Ext.util.JSON.encode(c);this.setValue(json)}else{commaS="";for(i=0;i<a.length;i++){if(a[i]!=""&&a[i]!=null){commaS+=a[i];if(i!=(a.length-1)){commaS+=","}}}if(commaS!=""){commaS=b+","+commaS}this.setValue(commaS)}},resizeComponents:function(b){if(b=="auto"){var c=this.width-30;this.fromFieldWidth=Math.floor((25/100)*c);this.toFieldWidth=Math.floor((25/100)*c);this.buttonWidth=Math.floor((20/100)*c);var a=this.fromFieldWidth+this.toFieldWidth+this.buttonWidth+30;this.dayTimeFieldWidth=this.width-a;this.listWidth=this.width-this.buttonWidth-5}},initComponent:function(){var a={};Ext.apply(this,a);Ext.ux.plugins.DayTimeSelect.superclass.initComponent.apply(this,arguments)},onRender:function(d,b){this.resizeComponents("auto");Ext.ux.plugins.DayTimeSelect.superclass.onRender.apply(this,arguments);var e=Math.floor(Math.random()*10000000);var c="day";var a=Array();mainDiv=Ext.DomHelper.insertFirst(d,{tag:"div",style:"width:"+this.width+"px;float:left"});topRowDiv=Ext.DomHelper.append(mainDiv,{tag:"div",style:"width:inherit;float:left;"});dayTimeDiv=Ext.DomHelper.append(topRowDiv,{tag:"div",style:"width:"+this.dayTimeFieldWidth+"px;float:left; margin-right:15px;"});fromDiv=Ext.DomHelper.append(topRowDiv,{tag:"div",style:"float:left;width:"+this.fromFieldWidth+"px;"});hyphenDiv=Ext.DomHelper.append(topRowDiv,{tag:"div",style:"text-align:center;float:left;width:10px;",html:"-"});toDiv=Ext.DomHelper.append(topRowDiv,{tag:"div",style:"float:left;margin-right:5px;width:"+this.toFieldWidth+"px;"});okButtonDiv=Ext.DomHelper.append(topRowDiv,{tag:"div",style:"float:right;width:"+this.buttonWidth+"px;"});clearDiv=Ext.DomHelper.append(mainDiv,{tag:"div",style:"clear:both"});clearDiv.id="daytimeselect_"+e+"_cleardiv0_";dayStore=new Ext.data.SimpleStore({fields:["valueField","displayField"],data:[["1","1"],["2","2"],["3","3"],["4","4"],["5","5"],["6","6"],["7","7"],["8","8"],["9","9"],["10","10"],["11","11"],["12","12"],["13","13"],["14","14"],["15","15"],["16","16"],["17","17"],["18","18"],["19","19"],["20","20"],["21","21"],["22","22"],["23","23"],["24","24"],["25","25"],["26","26"],["27","27"],["28","28"],["29","29"],["30","30"],["31","31"]]});timeStore=new Ext.data.SimpleStore({fields:["valueField","displayField"],data:[["1","1"],["2","2"],["3","3"],["4","4"],["5","5"],["6","6"],["7","7"],["8","8"],["9","9"],["10","10"],["11","11"],["12","12"],["13","13"],["14","14"],["15","15"],["16","16"],["17","17"],["18","18"],["19","19"],["20","20"],["21","21"],["22","22"],["23","23"],["24","24"]]});dayTimeCombo=new Ext.form.ComboBox({typeAhead:true,id:"daytimeselect_daytimecombo_"+e,triggerAction:"all",width:this.dayTimeFieldWidth,lazyRender:true,mode:"local",store:new Ext.data.SimpleStore({fields:["valueField","displayField"],data:[["day","Daily"],["time","Hourly"]]}),listeners:{select:function(){if(this.getValue()=="time"){Ext.getCmp("daytimeselect_fromcombo_"+e).bindStore(timeStore);Ext.getCmp("daytimeselect_tocombo_"+e).bindStore(timeStore)}if(this.getValue()=="day"){Ext.getCmp("daytimeselect_fromcombo_"+e).bindStore(dayStore);Ext.getCmp("daytimeselect_tocombo_"+e).bindStore(dayStore)}if(!a.length){c=this.getValue()}}},valueField:"valueField",displayField:"displayField"});dayTimeCombo.setValue("day");dayTimeCombo.render(dayTimeDiv);fromCombo=new Ext.form.ComboBox({typeAhead:true,id:"daytimeselect_fromcombo_"+e,triggerAction:"all",width:this.fromFieldWidth,lazyRender:true,mode:"local",store:dayStore,valueField:"valueField",displayField:"displayField",emptyText:"From",});fromCombo.render(fromDiv);toCombo=new Ext.form.ComboBox({typeAhead:true,id:"daytimeselect_tocombo_"+e,triggerAction:"all",width:this.toFieldWidth,lazyRender:true,mode:"local",store:dayStore,valueField:"valueField",displayField:"displayField",emptyText:"To",});toCombo.render(toDiv);okButton=new Ext.Button({text:"Add",parent:this,width:this.buttonWidth,count:0,t_item:0,listeners:{click:function(){if(Ext.getCmp("daytimeselect_daytimecombo_"+e).getValue()==""||Ext.getCmp("daytimeselect_fromcombo_"+e).getValue()==""||Ext.getCmp("daytimeselect_tocombo_"+e).getValue()==""){Ext.Msg.show({title:"Error !",msg:"Invalid Selections",buttons:Ext.Msg.OK,icon:Ext.MessageBox.ERROR});return}if(this.t_item&&c!=Ext.getCmp("daytimeselect_daytimecombo_"+e).getValue()){Ext.Msg.show({title:"Error !",msg:"Invalid data type for this series",buttons:Ext.Msg.OK,icon:Ext.MessageBox.ERROR});return}text=Ext.getCmp("daytimeselect_fromcombo_"+e).getValue()+"-"+Ext.getCmp("daytimeselect_tocombo_"+e).getValue();var g=false;for(var f=0;f<a.length;f++){if(a[f]==text){g=true}}if(g){Ext.Msg.show({title:"Error !",msg:"Data already in list",buttons:Ext.Msg.OK,icon:Ext.MessageBox.ERROR});return}a[this.count]=Ext.getCmp("daytimeselect_fromcombo_"+e).getValue()+"-"+Ext.getCmp("daytimeselect_tocombo_"+e).getValue();this.t_item++;this.parent.prepareValue(c,a);clearDiv=Ext.DomHelper.append(mainDiv,{tag:"div",style:"width:inherit;clear:both;font-size:0px;height:3px"});clearDiv.id="daytimeselect_"+e+"_cleardiv_"+this.count;listRowDiv=Ext.DomHelper.append(mainDiv,{tag:"div",style:"width:inherit;float:left;"});listRowDiv.id="daytimeselect_"+e+"_listrowdiv_"+this.count;listDiv=Ext.DomHelper.append(listRowDiv,{tag:"div",style:"width:"+this.parent.listWidth+"px; margin-right:5px;float:left;"});listDiv.id="daytimeselect_"+e+"_listdiv_"+this.count;removeButtonDiv=Ext.DomHelper.append(listRowDiv,{tag:"div",style:"width:inherit;float:right; width:"+this.parent.buttonWidth+"px;"});removeButtonDiv.id="daytimeselect_"+e+"_removebuttondiv_"+this.count;clearDiv=Ext.DomHelper.append(mainDiv,{tag:"div",style:"width:inherit;clear:both;font-size:0px;height:3px"});clearDiv.id="daytimeselect_"+e+"_cleardiv_"+this.count;list=new Ext.form.TextField({bodyStyle:"background-color:#f5f5f5",height:20,width:this.parent.listWidth,readOnly:true});list.setValue(text);list.render(listDiv);removeButton=new Ext.Button({text:"DEL",id:"daytimeselect_"+e+"_removebutton_"+this.count,c:this.count,t_item:this.t_item,parent:this,listeners:{click:function(){a[this.c]="";Ext.DomHelper.applyStyles(Ext.get("daytimeselect_"+e+"_listrowdiv_"+this.c),"display:none");Ext.DomHelper.applyStyles(Ext.get("daytimeselect_"+e+"_cleardiv_"+this.c),"display:none");this.parent.t_item--;if(this.parent.t_item==0){a=new Array()}this.parent.parent.prepareValue(c,a)}}});removeButton.render(removeButtonDiv);this.count++}}});okButton.render(okButtonDiv);data=this.value;dataArr=data.split(",");c=dataArr[0];dayTimeCombo.setValue(c);for(i=1;i<dataArr.length;i++){valArr=dataArr[i].split("-");fromCombo.setValue(valArr[0]);toCombo.setValue(valArr[1]);okButton.fireEvent("click")}}});Ext.reg("daytimeselect",Ext.ux.plugins.DayTimeSelect);Ext.ux.ListField=Ext.extend(Ext.form.Field,{dataFields:[],data:[],width:100,height:200,displayField:"value",valueField:"key",allowBlank:true,minLength:0,maxLength:Number.MAX_VALUE,blankText:Ext.form.TextField.prototype.blankText,minLengthText:"Minimum {0} item(s) required",maxLengthText:"Maximum {0} item(s) allowed",delimiter:",",backupStore:null,defaultAutoCreate:{tag:"div"},initComponent:function(){Ext.ux.ListField.superclass.initComponent.call(this);this.addEvents({"dblclick":true,"click":true,"change":true,"drop":true})},onRender:function(c,b){Ext.ux.ListField.superclass.onRender.call(this,c,b);var m="ux-mselect";this.inputField=new Ext.form.TextField({hideLabel:true,width:120});this.inputField.on("specialkey",this.onAdd,this);var g=new Ext.Button({iconCls:"listfield-add-button"});g.on("click",this.onAdd,this);var a=new Ext.Button({text:"Clear"});a.on("click",this.onClear,this);var h=new Ext.Button({text:"Reset"});h.on("click",this.onReset,this);var d=new Ext.form.FieldSet({renderTo:this.el,title:this.legend,height:this.height,width:this.width,style:"padding:0;",tbar:[this.inputField,g,"->",a]});d.body.addClass(m);var e='<tpl for="."><div style="border-bottom:1px dashed #ddd" class="'+m+"-item";if(Ext.isIE||Ext.isIE7){e+='" unselectable=on'}else{e+=' x-unselectable"'}e+='><span class="listfield-remove-icon"><a class="listfield-remove-icon-a" href="#">&nbsp;</a></span>{'+this.displayField+"}</div></tpl>";if(!this.store){this.store=new Ext.data.SimpleStore({fields:this.dataFields,data:this.data})}this.view=new Ext.ux.DDView({store:this.store,selectedClass:m+"-selected",tpl:e,allowDup:this.allowDup,copy:this.copy,allowTrash:this.allowTrash,dragGroup:this.dragGroup,dropGroup:this.dropGroup,itemSelector:"."+m+"-item",isFormField:true,applyTo:d.body,appendOnly:this.appendOnly,sortField:this.sortField,sortDir:this.sortDir});d.add(this.view);this.view.on("click",this.onClick,this);this.hiddenName=this.name;var f={tag:"input",type:"hidden",value:"",name:this.name};if(this.isFormField){this.hiddenField=this.el.createChild(f)}else{this.hiddenField=Ext.get(document.body).createChild(f)}this.hiddenField.dom.value=this.getList();d.doLayout()},onAdd:function(a,c){var d=null;if(a instanceof Ext.Button){d=this.inputField.getValue()}else{if(!c){return}if(c.getKey()==c.ENTER&&a.getXType()=="textfield"){d=a.getValue()}else{return}}if(!d){return}if(this.ifExists(d)){Ext.Msg.alert("Error","Item already exists in list");return}var b=Ext.data.Record.create(["key","value"]);this.view.store.add(new b({key:d,value:d}));this.setList(this.getList());this.inputField.focus()},ifExists:function(b){for(var a=0;a<this.view.store.getCount();a++){if(this.view.store.getAt(a).data.value==b){return true}}return false},onClear:function(){this.view.store.removeAll();this.setList(this.getList());this.inputField.focus()},onReset:function(){this.view.bindStore=this.backupStore;this.inputField.focus()},getList:function(){var b=[];var d=this.view.store.getCount();for(var a=0;a<d;a++){b.push(this.store.getAt(a).get(this.valueField))}return b.join(this.delimiter)},onClick:function(c,a,b,d){if(d.target.className=="listfield-remove-icon-a"){this.view.store.remove(this.view.store.getAt(a))}this.setList(this.getList())},setList:function(){this.hiddenField.dom.value=this.getList()}});Ext.reg("listfield",Ext.ux.ListField);Ext.ux.ColorField=Ext.extend(Ext.form.TriggerField,{valueVisible:true,invalidText:"'{0}' is not a valid color - it must be in a the hex format (# followed by 3 or 6 letters/numbers 0-9 A-F)",triggerClass:"x-form-color-trigger",defaultAutoCreate:{tag:"input",type:"text",size:"10",maxlength:"7",autocomplete:"off"},maskRe:/[#a-f0-9]/i,initComponent:function(){if(Ext.getBody().first(".x-color-picker")){return}if(!this.picker){elem=new Ext.Element(document.createElement("div"));elem.setXY([-500,-500]);Ext.getBody().appendChild(elem);this.picker=new Ext.ux.color.ColorPickerPanel({applyTo:elem,hex:"ffffff",mode:"hue"});Ext.getBody().first(".x-color-picker").setStyle({display:"none"});this.picker=null}},validateValue:function(b){if(!Ext.ux.ColorField.superclass.validateValue.call(this,b)){return false}if(b.length<1){this.setColor("");return true}var a=this.parseColor(b);if(!b||(a==false)){this.markInvalid(String.format(this.invalidText,b));return false}this.setColor(b);return true},setColor:function(a){if(a==""||a==undefined){if(this.emptyText!=""&&this.parseColor(this.emptyText)){a=this.emptyText}else{a="transparent"}}if(this.trigger){if(this.valueVisible){this.trigger.setStyle({"background-color":a})}else{this.getEl().dom.style.backgroundColor=a}this.getEl().setStyle({"background-color":a})}else{this.on("render",function(){this.setColor(a)},this)}},validateBlur:function(){},getValue:function(){return Ext.ux.ColorField.superclass.getValue.call(this)||""},setValue:function(a){Ext.ux.ColorField.superclass.setValue.call(this,this.formatColor(a));this.setColor(this.formatColor(a))},parseColor:function(a){return(!a||(a.substring(0,1)!="#"))?false:(a.length==4||a.length==7)},formatColor:function(a){if(!a||this.parseColor(a)){return a}if(a.length==3||a.length==6){return"#"+a}return""},menuListeners:{select:function(a,b){this.setValue(b)},show:function(){this.onFocus()},hide:function(){this.focus.defer(10,this);var a=this.menuListeners;this.menu.un("select",a.select,this);this.menu.un("show",a.show,this);this.menu.un("hide",a.hide,this)}},onTriggerClick:function(g){g.stopEvent();var f=g.getPageY(),b=g.getPageX();f=this.getBox().y;b=this.getBox().x;if(this.disabled){return}var d=this.wrap.dom.id;if(this.picker==null){var a=document.body.clientWidth;var c=document.body.clientHeight;var n=this.getBox().height;if(f>c-310){f=f-285;n=-n}if(b>a-400){b=b-400+this.getBox().width}f+=n;var m=this.getValue();this.pickerdiv=Ext.DomHelper.append(Ext.getBody(),{tag:"div",style:{position:"absolute",top:f+"px",left:b+"px",width:"400px",height:"310px"}});this.pickerdiv.style.zIndex="10000";this.picker=new Ext.ux.color.ColorPickerPanel({applyTo:this.pickerdiv,hex:m.replace("#",""),mode:"hue"});this.picker.okButton.on("click",function(){this.setValue(this.picker.hex.getValue());this.pickerdiv.style.display="none";this.picker=null},this)}else{this.pickerdiv.style.display="none";this.picker=null}Ext.getBody().un("mousedown");Ext.getBody().on("mousedown",function(){if(g.getPageY()>=f&&g.getPageY()<=f+310&&g.getPageX()>=b&&g.getPageX()<=b+400){return}if(this.picker){this.pickerdiv.style.display="none";this.picker=null}},this)}});Ext.reg("colorfield",Ext.ux.ColorField);Ext.namespace("Ext.ux.color");Ext.ux.color.Color=function(a){Ext.apply(this,this.defaultValues);Ext.apply(this,a)};Ext.ux.color.Color.prototype={setRgb:function(a){this.set("red",a);this.set("green",a);this.set("blue",a);this.rgbToHsv();this.produceHex()},setHsv:function(a){this.set("hue",a);this.set("saturation",a);this.set("brightness",a);this.hsvToRgb();this.produceHex()},setHex:function(c){var b,a;c=this.validateHex(c);a=this.splitHex(c);for(b in a){c=a[b];switch(b){case"red":this.setRed(parseInt(c,16));break;case"green":this.setGreen(parseInt(c,16));break;case"blue":this.setBlue(parseInt(c,16));break}}this.rgbToHsv();this.produceHex()},version:{major:0,minor:1,tiny:0,toString:function(){return[this.major,this.minor,this.tiny].join(".")}},defaultValues:{red:0,green:0,blue:0,hue:0,saturation:0,brightness:0,hex:"000000"},produceHex:function(){this.hex=this.intToHex(this.red)+this.intToHex(this.green)+this.intToHex(this.blue)},intToHex:function(b){var a=(parseInt(b,10).toString(16));if(a.length==1){a=("0"+a)}return a.toUpperCase()},constrainWithWarnings:function(d,c,b,a){if(isNaN(d)){d=b}else{if(d<b){d=b}else{if(d>a){d=a}}}return d},constrainRgb:function(b,a){b=this.constrainWithWarnings(b,a,0,255);if(a.match(/^(red|blue|green)$/)!==null){this[a]=b}},rgbToHsv:function(){var c,g,m,e,d,f,a,b,h;a=this.red/255;b=this.green/255;h=this.blue/255;g=Math.max(a,b,h);c=Math.min(a,b,h);m=g-c;f=g;d=(g)?((g-c)/g):0;if(!d){e=0}else{if(a===g){e=(b-h)/m}else{if(b===g){e=2+(h-a)/m}else{e=4+(a-b)/m}}e=e*60;if(e<0){e+=360}}this.setHue(parseInt(e,10));this.setSaturation(parseInt(d*100));this.setBrightness(parseInt(f*100))},hsvToRgb:function(){var c,e,g,b,a,o,h,m=this.brightness/100,d=this.saturation/100;if(this.saturation===0){var n=m*255;this.setRed(n);this.setGreen(n);this.setBlue(n)}e=this.hue/60;c=parseInt(e,10);g=e-c;b=m*(1-d);a=m*(1-d*g);o=m*(1-d*(1-g));h=[[m,o,b],[a,m,b],[b,m,o],[b,a,m],[o,b,m],[m,b,a]][c];this.setRed(h[0]*255);this.setGreen(h[1]*255);this.setBlue(h[2]*255)},validateHex:function(b){var a=b||this.hex;a=a.toUpperCase();if(a.charAt[0]==="#"){a=a.slice(1)}a=a.replace(/[^A-F0-9]/g,"0");if(a.length>6){a=a.substring(0,6)}return a},capitalize:function(a){return a.charAt(0).toUpperCase()+a.slice(1).toLowerCase()},set:function(b,a){if(a[b]){this["set"+this.capitalize(b)](a[b])}},splitHex:function(a){return{red:a.slice(0,2),green:a.slice(2,4),blue:a.slice(4,6)}},setRed:function(a){this.constrainRgb(a,"red")},setGreen:function(a){this.constrainRgb(a,"green")},setBlue:function(a){this.constrainRgb(a,"blue")},setHue:function(a){a=this.constrainWithWarnings(a,"hue",0,359);this.hue=a},setSaturation:function(a){a=this.constrainWithWarnings(a,"saturation",0,100);this.saturation=a},setBrightness:function(a){a=this.constrainWithWarnings(a,"brightness",0,100);this.brightness=a}};Ext.ux.Radio={groups:{},callbacks:{},registerGroup:function(a){if(!a.radioGroupId){a.radioGroupId=Ext.id()}if(!this.groups[a.radioGroupId]){this.groups[a.radioGroupId]={dialed:null,members:[]}}},registerMember:function(a,c,b){this.registerGroup(a);if(!c.radioGroupMemberId){c.radioGroupMemberId=Ext.id()}if(this.groups[a.radioGroupId].members.indexOf(c.radioGroupMemberId)===-1){this.groups[a.radioGroupId].members.push(c.radioGroupMemberId);this.callbacks[c.radioGroupMemberId]=b}},unregisterMember:function(b,c){var a=this.groups[b.radioGroupId].members;Ext.each(a,function(e,d){if(e===e.radioGroupMember.id){a=a.splice(d,1)}})},dial:function(a,b){this.groups[a.radioGroupId].dialed=b.radioGroupMemberId;Ext.each(this.groups[a.radioGroupId].members,function(c){this.callbacks[c].un()},this);this.callbacks[b.radioGroupMemberId].dial()},dialed:function(a,b){return(this.groups[a.radioGroupId].dialed===b.radioGroupMemberId)}};Ext.ux.color.ColorPickerPanel=function(){this.modeFields={};this.preloads=[];Ext.ux.color.ColorPickerPanel.superclass.constructor.apply(this,arguments)};Ext.extend(Ext.ux.color.ColorPickerPanel,Ext.Panel,{width:400,height:305,hex:"FF0000",mode:"saturation",baseCls:"x-color-picker x-panel",iconCls:"x-color-wheel",imagePath:"/appFlowerPlugin/extjs-3/plugins/form/adv-color-picker/images/",images:["bar-blue-bl","bar-blue-br","bar-blue-tl","bar-blue-tr","bar-brightness","bar-green-bl","bar-green-br","bar-green-tl","bar-green-tr","bar-hue","bar-red-bl","bar-red-br","bar-red-tl","bar-red-tr","bar-saturation","map-blue-max","map-blue-min","map-brightness","map-green-max","map-green-min","map-hue","map-red-max","map-saturation","map-saturation-overlay"],modes:{red:{name:"red",abbr:"R",min:0,max:255},green:{name:"green",abbr:"G",min:0,max:255},blue:{name:"blue",abbr:"B",min:0,max:255},hue:{name:"hue",abbr:"H",min:0,max:359,unit:""},saturation:{name:"saturation",abbr:"S",min:0,max:100,unit:"%"},brightness:{name:"brightness",abbr:"B",min:0,max:100,unit:"%"}},write:function(d,a){var b=this.modeFields[d.name],c=parseInt(a,10);c=c.constrain(d.min,d.max);b.setRawValue(c.toString().replace(new RegExp(d.unit||""),"")+(d.unit||""))},isRgb:function(a){return !("red green blue rgb".indexOf(a.name)===-1)},isHsv:function(a){return !("hue saturation brightness hsv".indexOf(a.name)===-1)},setFromConsole:function(a){if(this.isRgb({name:a})){this.color.setRgb({red:this.modeFields.red.getValue(),green:this.modeFields.green.getValue(),blue:this.modeFields.blue.getValue()});this.writeToConsole("Hsv")}else{this.color.setHsv({hue:this.modeFields.hue.getValue(),saturation:this.modeFields.saturation.getValue(),brightness:this.modeFields.brightness.getValue()});this.writeToConsole("Rgb")}},setFromTrack:function(a){switch(this.mode){case"hue":this.write(this.modes.hue,360-(a/255)*360);break;case"saturation":this.write(this.modes.saturation,100-(a/255)*100);break;case"brightness":this.write(this.modes.brightness,100-(a/255)*100);break;case"red":this.write(this.modes.red,255-(a/255)*255);break;case"green":this.write(this.modes.green,255-(a/255)*255);break;case"blue":this.write(this.modes.blue,255-(a/255)*255);break}switch(this.mode){case"hue":case"saturation":case"brightness":this.setFromConsole("hsv");break;case"red":case"green":case"blue":this.setFromConsole("rgb");break}this.paint()},setFromMap:function(a,b){switch(this.mode){case"hue":this.write(this.modes.saturation,(a/255)*100);this.write(this.modes.brightness,100-((b/255)*100));break;case"saturation":this.write(this.modes.hue,(a/255)*360);this.write(this.modes.brightness,100-((b/255)*100));break;case"brightness":this.write(this.modes.hue,(a/255)*360);this.write(this.modes.saturation,100-((b/255)*100));break;case"red":this.write(this.modes.blue,a);this.write(this.modes.green,255-b);break;case"green":this.write(this.modes.blue,a);this.write(this.modes.red,255-b);break;case"blue":this.write(this.modes.red,a);this.write(this.modes.green,255-b);break}switch(this.mode){case"hue":case"saturation":case"brightness":this.setFromConsole("hsv");break;case"red":case"green":case"blue":this.setFromConsole("rgb");break}this.paint()},writeToConsole:function(a){var c,b;for(c in this.modes){b=this.modes[c];if((a&&this["is"+a](b))||!a){this.write(b,this.color[b.name])}}this.hex.setValue(this.color.hex)},setMode:function(a){this.mode=a;Ext.each(this.layers.map.concat(this.layers.track),function(b){this.setClass(b,"x-layer");this.setAlpha(b,100);this.setBackground(b,null)},this);this[this.mode+"Mode"]();this.paint();this.paintSliders()},hueMode:function(){this.setBackground(this.layers.map[0],this.color.hex);this.setClass(this.layers.map[1],"map-hue");this.setClass(this.layers.track[3],"bar-hue")},saturationMode:function(){this.setClass(this.layers.map[0],"map-saturation");this.setClass(this.layers.map[1],"map-saturation-overlay");this.setBackground(this.layers.track[2],this.color.hex);this.setClass(this.layers.track[3],"bar-saturation")},brightnessMode:function(){this.setBackground(this.layers.map[0],"000000");this.setClass(this.layers.map[1],"map-brightness");this.setBackground(this.layers.track[2],this.color.hex);this.setClass(this.layers.track[3],"bar-brightness")},redMode:function(){this.colorMode("red")},greenMode:function(){this.colorMode("green")},blueMode:function(){this.colorMode("blue")},colorMode:function(a){this.setClass(this.layers.map[1],"map-"+a+"-max");this.setClass(this.layers.map[0],"map-"+a+"-min");this.setClass(this.layers.track[3],"bar-"+a+"-tl");this.setClass(this.layers.track[2],"bar-"+a+"-tr");this.setClass(this.layers.track[1],"bar-"+a+"-br");this.setClass(this.layers.track[0],"bar-"+a+"-bl")},onRender:function(){if(this.el){Ext.ux.color.ColorPickerPanel.superclass.onRender.apply(this,arguments);this.initMarkup();this.initLayers();this.initConsole();this.initMap();this.initSlider();this.writeToConsole();this.setMode(this.mode)}},initComponent:function(){if(this.frame){this.width=410;this.height=310}this.preloadImages();Ext.ux.color.ColorPickerPanel.superclass.initComponent.apply(this,arguments);this.color=new Ext.ux.color.Color();this.color.setHex(this.hex)},initMarkup:function(){this.body.dom.innerHTML+=['<div class="x-map">','<div class="x-layer"></div>','<div class="x-layer"></div>','<div class="x-pointer"></div>',"</div>",'<div class="x-track">','<div class="x-layer"></div>','<div class="x-layer"></div>','<div class="x-layer"></div>','<div class="x-layer"></div>','<div class="x-slider"></div>',"</div>",'<ul class="x-console">','<li class="preview"></li>','<li class="hue"></li>','<li class="saturation"></li>','<li class="brightness"></li>','<li class="red"></li>','<li class="green"></li>','<li class="blue"></li>','<li class="hex"></li>','<li class="okButton" style="float:right"></li>',"</ul>"].join("")},initConsole:function(){var f=this.body.first(".x-console"),a,c=Ext.id(),e,d,b=this;this.preview=f.first(".preview");for(e in this.modes){(function(g){el=f.first("."+g.name);a=new Ext.Element(document.createElement("div"));a.addClass("x-radio");Ext.ux.Radio.registerMember(b,a.dom,{dial:function(){Ext.fly(this).addClass("x-dialed")}.createDelegate(a),un:function(){Ext.fly(this).removeClass("x-dialed")}.createDelegate(a)});g.radio=a;a.dom.mode=g.name;el.appendChild(a);l=document.createElement("div");l.innerHTML=g.abbr+": ";label=new Ext.Element(l);label.addClass("x-label");el.appendChild(label);if(b.mode===g.name){Ext.ux.Radio.dial(b,a.dom)}a.on({"click":function(m,h){b.setMode(h.mode);Ext.ux.Radio.dial(b,h)}});b.modeFields[g.name]=new Ext.form.NumberField({allowBlank:false,allowNegative:false,allowDecimals:false,fieldLabel:g.unit,minValue:g.min,maxValue:g.max,renderTo:el,validator:function(h){b.write(g,h);b.setFromConsole(g);b.paint();b.paintSliders();return true}});b.modeFields[g.name].el.on({"click":function(h){}})})(b.modes[e])}this.hex=new Ext.form.TextField({renderTo:f.first(".hex"),allowBlank:false,fieldLabel:"hex",label:true,validator:function(g){this.setRawValue("#"+Ext.ux.color.Color.prototype.validateHex(g.replace(/^#/,"")));return true}});l=document.createElement("div");l.innerHTML="Hex: ";label=new Ext.Element(l);label.addClass("x-hex-label");f.first(".hex").appendChild(label);this.okButton=new Ext.Button({renderTo:f.first(".okButton"),text:"Ok"})},initMap:function(){var a=this;var b=this.body.first(".x-map");b.dom.id=Ext.id();var c=b.first(".x-pointer");c.dom.id=Ext.id();this.map=new Ext.dd.DragDrop({id:b.dom.id});Ext.apply(this.map,{onMouseDown:function(d){this.onDrag(d)},onDrag:function(h,m){var g=c.getWidth()-2,f=c.getHeight()-2,o=(g/2),e=(f/2),d=h.xy[0]-b.getLeft()-o,n=h.xy[1]-b.getTop()-e;d=d.constrain(0-o,b.getWidth()-o);c.setLeft(d-1);n=n.constrain(0-e,b.getHeight()-e);c.setTop(n-1);if(!m){a.setFromMap(h.xy[0]-b.getLeft(),h.xy[1]-b.getTop())}},endDrag:function(){document.documentElement.style.cursor="default"}})},initSlider:function(){var c=this;var a=this.body.first(".x-track");a.dom.id=Ext.id();var b=a.first(".x-slider");b.dom.id=Ext.id();this.track=new Ext.dd.DragDrop({id:a.dom.id});Ext.apply(this.track,{onMouseDown:function(d){this.onDrag(d)},onDrag:function(f,g){var e=b.getHeight()-2,d=e/2,h=f.xy[1]-a.getTop()-d;h=h.constrain(0-d,a.getHeight()-d);b.setTop(h-1);if(!g){c.setFromTrack(f.xy[1]-a.getTop())}},endDrag:function(){document.documentElement.style.cursor="default"}})},setAlpha:function(a,b){Ext.fly(a).setOpacity(b/100)},setClass:function(b,a){b.className="x-layer "+a},setBackground:function(a,b){Ext.fly(a).setStyle({backgroundColor:(b==null?"transparent":"#"+b)})},initLayers:function(){this.layers={track:this.body.query(".x-track > .x-layer"),map:this.body.query(".x-map > .x-layer")}},preloadImages:function(){var a;Ext.each(this.images,function(b){a=new Image();a.src=this.imagePath+b+".png";this.preloads.push(a)},this)},paint:function(){this.paintMap();this.paintTrack();this.paintPreview()},paintMap:function(){switch(this.mode){case"hue":var a=new Ext.ux.color.Color();a.setHsv({hue:this.color.hue,saturation:100,brightness:100});this.setBackground(this.layers.map[0],a.hex);break;case"saturation":this.setAlpha(this.layers.map[1],100-this.color.saturation);break;case"brightness":this.setAlpha(this.layers.map[1],this.color.brightness);break;case"red":this.setAlpha(this.layers.map[1],(this.color.red/255)*100);break;case"green":this.setAlpha(this.layers.map[1],(this.color.green/255)*100);break;case"blue":this.setAlpha(this.layers.map[1],(this.color.blue/255)*100);break}},paintTrack:function(){switch(this.mode){case"hue":break;case"saturation":var a=new Ext.ux.color.Color();a.setHsv({hue:this.color.hue,saturation:100,brightness:this.color.brightness});this.setBackground(this.layers.track[2],a.hex);break;case"brightness":var d=new Ext.ux.color.Color();d.setHsv({hue:this.color.hue,saturation:this.color.saturation,brightness:100});this.setBackground(this.layers.track[2],d.hex);break;case"red":case"green":case"blue":var h=0;var c=0;switch(this.mode){case"red":h=this.modeFields.blue.getValue();c=this.modeFields.green.getValue();break;case"green":h=this.modeFields.blue.getValue();c=this.modeFields.red.getValue();break;case"blue":h=this.modeFields.red.getValue();c=this.modeFields.green.getValue()}var b=(h/255)*100;var e=(c/255)*100;var g=((255-h)/255)*100;var f=((255-c)/255)*100;this.setAlpha(this.layers.track[3],(e>g)?g:e);this.setAlpha(this.layers.track[2],(e>b)?b:e);this.setAlpha(this.layers.track[1],(f>b)?b:f);this.setAlpha(this.layers.track[0],(f>g)?g:f);break}},paintPreview:function(){this.setBackground(this.preview,this.color.hex)},paintSliders:function(){var d=0,b={hue:360,saturation:100,brightness:100,red:255,green:255,blue:255},c=b[this.mode];d=c-this.color[this.mode];this.track.onDrag({xy:[0,(255*(d/c))+Ext.fly(this.track.getEl()).getTop()]},true);var a=0,e=0;switch(this.mode){case"hue":e=this.color.saturation/100*255;a=(100-this.color.brightness)/100*255;break;case"saturation":e=this.color.hue/360*255;a=(100-this.color.brightness)/100*255;break;case"brightness":e=this.color.hue/360*255;a=(100-this.color.saturation)/100*255;break;case"red":e=this.color.blue;a=255-this.color.green;break;case"green":e=this.color.blue;a=255-this.color.red;break;case"blue":e=this.color.red;a=255-this.color.green;break}this.map.onDrag({xy:[e+Ext.fly(this.map.getEl()).getLeft(),a+Ext.fly(this.map.getEl()).getTop()]},true)}});Ext.ns("Ext.ux");Ext.ux.ColorPickerWin=function(a){confing=a||{};var b=new Ext.Window(Ext.apply({title:"Color Picker",width:500,height:500,closeAction:"hide",layout:"fit",items:new Ext.Panel({items:new Ext.ux.color.ColorPickerPanel({width:300,height:400})})},a));return b};Ext.ns("Ext.ux.form");Ext.ux.form.StaticTextField=function(a){this.name=a.name||a.id;Ext.ux.form.StaticTextField.superclass.constructor.call(this,a)};Ext.extend(Ext.ux.form.StaticTextField,Ext.BoxComponent,{defaultAutoCreate:{tag:"div",style:"padding-top:3px;"},isFormField:true,submitValue:false,value:undefined,dateFormat:undefined,disableReset:true,field:null,getName:function(){return this.name},onRender:function(c,a){Ext.ux.form.StaticTextField.superclass.onRender.call(this,c,a);if(!this.el){var b=this.getAutoCreate();this.el=c.createChild(b,a);if(this.submitValue){this.field=c.createChild({tag:"input",type:"hidden",name:this.getName(),id:""},a)}}this.el.addClass([this.fieldClass,this.cls,"ux-form-statictextfield"]);this.initValue()},afterRender:function(b,a){Ext.ux.form.StaticTextField.superclass.afterRender.call(this);this.initEvents()},initValue:function(){if(this.value!==undefined){this.setRawValue(this.value)}else{if(this.el.dom.innerHTML.length>0){this.setRawValue(this.el.dom.innerHTML)}}},isDirty:function(){return false},reset:function(a){if(!this.disableReset||a===true){this.setValue(this.originalValue)}},initEvents:function(){this.originalValue=this.getRawValue()},isValid:function(){return true},validate:function(){return true},processValue:function(a){return a},validateValue:function(a){return true},markInvalid:function(){return},clearInvalid:function(){return},getRawValue:function(){return(this.rendered)?this.value:null},getValue:function(){return this.getRawValue()},setRawValue:function(a){this.value=a;if(this.rendered){if(Ext.isDate(a)&&this.dateFormat){this.el.dom.innerHTML=a.format(this.dateFormat)}else{this.el.dom.innerHTML=a}if(this.field){this.field.dom.value=a}}},setValue:function(a){this.value=a;if(this.rendered){if(Ext.isDate(a)&&this.dateFormat){this.el.dom.innerHTML=Ext.util.Format.htmlEncode(a.format(this.dateFormat))}else{this.el.dom.innerHTML=Ext.util.Format.htmlEncode(a)}if(this.field){this.field.dom.value=a}}}});Ext.reg("statictextfield",Ext.ux.form.StaticTextField);Ext.namespace("Ext.ux");Ext.ux.CodePress=Ext.extend(Ext.form.Field,{engineUrl:"/appFlower/codepress",fileContentUrl:"/appFlower/filecontent",file:false,sourceEl:false,code:false,language:false,height:false,width:false,autoResize:false,trim:true,autoComplete:true,readOnly:false,lineNumbers:true,initialized:false,initComponent:function(){Ext.ux.CodePress.superclass.initComponent.call(this);if(this.sourceEl){Ext.get(this.sourceEl).hide()}this.addEvents({initialize:true,activate:true})},adjustSize:Ext.BoxComponent.prototype.adjustSize,listeners:{resize:{fn:function(){this.resize()}}},resize:function(){if(this.initialized){var b=(this.height||this.ownerCt.body.dom.clientHeight)+"px";var a=(this.width||this.ownerCt.body.dom.clientWidth)+"px";this.editor.body.style.width=a;this.iframe.setStyle("height",b);this.iframe.setStyle("width",a);this.textarea.setStyle("height",b);this.textarea.setStyle("width",a)}},onRender:function(b,a){Ext.ux.CodePress.superclass.onRender.call(this,b,a);this.el.dom.style.border="0 none";this.el.dom.setAttribute("tabIndex",-1);this.el.addClass("x-hidden");if(Ext.isIE){this.el.applyStyles("margin-top:-1px;margin-bottom:-1px;")}this.wrap=this.el.wrap({});this.iframe=Ext.get(document.createElement("iframe"));this.iframe.src=(Ext.SSL_SECURE_URL||"javascript:false");if(!this.sourceEl){this.textarea=Ext.get(document.createElement("textarea"))}else{this.textarea=Ext.get(this.sourceEl)}this.textarea.dom.disabled=true;this.textarea.dom.style.overflow="hidden";this.textarea.dom.style.display="none";this.textarea.dom.style.overflow="auto";this.iframe.dom.frameBorder=0;this.iframe.setStyle("visibility","hidden");this.iframe.setStyle("position","absolute");this.options=this.textarea.dom.className;this.wrap.dom.appendChild(this.textarea.dom);this.textarea.dom.parentNode.insertBefore(this.iframe.dom,this.textarea.dom);this.setLanguage();this.edit();this.height=(this.height||this.ownerCt.body.dom.clientHeight);this.width=(this.width||this.ownerCt.body.dom.clientWidth)},focus:function(){},initialize:function(){if(Ext.isIE){this.doc=this.iframe.dom.contentWindow.document;this.win=this.iframe.dom.contentWindow}else{this.doc=this.iframe.dom.contentDocument;this.win=this.iframe.dom.contentWindow}this.editor=this.win.CodePress;this.editor.body=this.doc.getElementsByTagName("body")[0];if(this.fileContentUrl){Ext.Ajax.request({url:this.fileContentUrl+"/?file="+this.file,method:"get",success:function(a,b){var d=Ext.decode(a.responseText);var c=d.response;this.code=c;this.editor.setCode(this.code);this.editor.syntaxHighlight("init")}.createDelegate(this),failure:function(){Ext.Msg.alert("","The server can't read '"+this.file+"' !")}.createDelegate(this)})}else{this.editor.setCode(this.code||this.textarea.dom.value)}this.setOptions();this.editor.syntaxHighlight("init");this.textarea.dom.style.display="none";this.iframe.dom.style.position="static";this.iframe.dom.style.visibility="visible";this.iframe.dom.style.display="inline";this.initialized=true;this.fireEvent("initialize",this);this.resize()},edit:function(a,b){if(a){this.textarea.dom.value=document.getElementById(a)?document.getElementById(a).value:a}if(!this.textarea.dom.disabled){return}this.language=b?b:this.getLanguage();this.iframe.dom.src=this.engineUrl+"/language/"+this.language+"/ts/"+(new Date).getTime();this.iframe.removeListener("load",this.initialize);this.iframe.on("load",this.initialize,this)},setLanguage:function(){if(this.file){var b=this.file.split(".");var a="";if(b[b.length-1]){a=b[b.length-1]}switch(a){case"php":case"inc":case"phtml":this.language="php";break;case"js":this.language="javascript";break;case"css":this.language="css";break;case"sql":this.language="sql";break;case"html":case"htm":this.language="html";break;default:this.language="generic";break}}},getLanguage:function(){if(this.language){return this.language}for(language in Ext.ux.CodePress.languages){if(this.options.match("\\b"+language+"\\b")){return Ext.ux.CodePress.languages[language]?language:"generic"}}},setOptions:function(){if(this.autoComplete===false||this.options.match("autocomplete-off")){this.toggleAutoComplete()}if(this.readOnly===true||this.options.match("readonly-on")){this.toggleReadOnly()}if(this.lineNumbers===false||this.options.match("linenumbers-off")){this.toggleLineNumbers()}},getCode:function(){var a;if(this.textarea&&this.editor){a=this.textarea.dom.disabled?this.editor.getCode():this.textarea.dom.value}else{a=this.code||""}a=this.trim?a.replace(/^s+|(s+$|n$|r$)/g,""):a;return a},setCode:function(a){if(this.textarea&&this.editor){this.textarea.dom.disabled?this.editor.setCode(a):this.textarea.dom.value=a;this.editor.syntaxHighlight("init")}else{this.code=a}},setValue:function(a){this.setCode(a)},getValue:function(){return this.getCode()},toggleAutoComplete:function(){if(this.editor){this.editor.autocomplete=(this.editor.autocomplete)?false:true}},toggleReadOnly:function(){this.textarea.dom.readOnly=(this.textarea.dom.readOnly)?false:true;if(this.iframe.dom.style.display!="none"&&this.editor){this.editor.readOnly(this.textarea.dom.readOnly?true:false)}},toggleLineNumbers:function(){if(!this.editor){return}var a=this.editor.body.className;this.editor.body.className=(a==""||a=="show-line-numbers")?"hide-line-numbers":"show-line-numbers"},toggleEditor:function(){if(this.textarea.dom.disabled){this.textarea.dom.value=this.getCode();this.textarea.dom.disabled=false;this.iframe.dom.style.display="none";this.textarea.dom.style.display="inline"}else{this.textarea.dom.disabled=true;this.setCode(this.textarea.dom.value);if(this.editor){this.editor.syntaxHighlight("init")}this.iframe.dom.style.display="inline";this.textarea.dom.style.display="none"}},toggleIframe:function(){if(this.iframe.dom.style.visibility=="hidden"){this.iframe.dom.style.visibility="visible";this.iframe.dom.style.position="static";this.iframe.dom.style.display="inline";this.resize();this.iframe.dom.style.width=this.width+"px";this.iframe.dom.style.height=this.height+"px"}else{this.iframe.dom.style.visibility="hidden";this.iframe.dom.style.width="0px";this.iframe.dom.style.height="0px"}}});Ext.reg("codepress",Ext.ux.CodePress);Ext.ux.CodePress.languages={csharp:"C#",css:"CSS",generic:"Generic",html:"HTML",java:"Java",javascript:"JavaScript",perl:"Perl",ruby:"Ruby",php:"PHP",text:"Text",sql:"SQL",vbscript:"VBScript"};Ext.ns("Ext.ux.form");Ext.ux.form.ComboBox=Ext.extend(Ext.form.ComboBox,{defaultAutoCreate:{tag:"input",type:"text",size:"24",autocomplete:"off"},listClass:"",selectedClass:"x-combo-selected",triggerClass:"x-form-arrow-trigger",shadow:"sides",listAlign:"tl-bl?",maxHeight:300,minHeight:90,triggerAction:"query",minChars:4,typeAhead:false,queryDelay:500,pageSize:0,selectOnFocus:false,queryParam:"query",loadingText:"Loading...",resizable:false,handleHeight:8,editable:true,allQuery:"",mode:"remote",minListWidth:70,forceSelection:false,typeAheadDelay:250,lazyInit:true,initComponent:function(){Ext.form.ComboBox.superclass.initComponent.call(this);this.addEvents("expand","collapse","beforeselect","select","beforequery");if(this.transform){this.allowDomMove=false;var c=Ext.getDom(this.transform);if(!this.hiddenName){this.hiddenName=c.name}if(!this.store){this.mode="local";var h=[],e=c.options;for(var b=0,a=e.length;b<a;b++){var g=e[b];var f=(Ext.isIE?g.getAttributeNode("value").specified:g.hasAttribute("value"))?g.value:g.text;if(g.selected){this.value=f}h.push([f,g.text])}this.store=new Ext.data.SimpleStore({"id":0,fields:["value","text"],data:h});this.valueField="value";this.displayField="text"}c.name=Ext.id();if(!this.lazyRender){this.target=true;this.el=Ext.DomHelper.insertBefore(c,this.autoCreate||this.defaultAutoCreate);Ext.removeNode(c);this.render(this.el.parentNode)}else{Ext.removeNode(c)}}else{if(Ext.isArray(this.store)){if(Ext.isArray(this.store[0])){this.store=new Ext.data.SimpleStore({fields:["value","text","color"],data:this.store});this.valueField="value"}else{this.store=new Ext.data.SimpleStore({fields:["text"],data:this.store,expandData:true});this.valueField="text"}this.displayField="text";this.mode="local"}}this.selectedIndex=-1;if(this.mode=="local"){if(this.initialConfig.queryDelay===undefined){this.queryDelay=10}if(this.initialConfig.minChars===undefined){this.minChars=0}}},onRender:function(b,a){Ext.form.ComboBox.superclass.onRender.call(this,b,a);if(this.hiddenName){this.hiddenField=this.el.insertSibling({tag:"input",type:"hidden",name:this.hiddenName,id:(this.hiddenId||this.hiddenName)},"before",true);this.el.dom.removeAttribute("name")}if(Ext.isGecko){this.el.dom.setAttribute("autocomplete","off")}if(!this.lazyInit){this.initList()}else{this.on("focus",this.initList,this,{single:true})}if(!this.editable){this.editable=true;this.setEditable(false)}},initValue:function(){Ext.form.ComboBox.superclass.initValue.call(this);if(this.hiddenField){this.hiddenField.value=this.hiddenValue!==undefined?this.hiddenValue:this.value!==undefined?this.value:""}},initList:function(){if(!this.list){var a="x-combo-list";this.list=new Ext.Layer({shadow:this.shadow,cls:[a,this.listClass].join(" "),constrain:false});var b=this.listWidth||Math.max(this.wrap.getWidth(),this.minListWidth);this.list.setWidth(b);this.list.swallowEvent("mousewheel");this.assetHeight=0;if(this.title){this.header=this.list.createChild({cls:a+"-hd",html:this.title});this.assetHeight+=this.header.getHeight()}this.innerList=this.list.createChild({cls:a+"-inner"});this.innerList.on("mouseover",this.onViewOver,this);this.innerList.on("mousemove",this.onViewMove,this);this.innerList.setWidth(b-this.list.getFrameWidth("lr"));if(this.pageSize){this.footer=this.list.createChild({cls:a+"-ft"});this.pageTb=new Ext.PagingToolbar({store:this.store,pageSize:this.pageSize,renderTo:this.footer});this.assetHeight+=this.footer.getHeight()}if(!this.tpl){this.tpl='<tpl for="."><div class="'+a+'-item" style="background-color:{color};" qtip="{'+this.displayField+'}">{'+this.displayField+"}</div></tpl>"}this.view=new Ext.DataView({applyTo:this.innerList,tpl:this.tpl,singleSelect:true,selectedClass:this.selectedClass,itemSelector:this.itemSelector||"."+a+"-item"});this.view.on("click",this.onViewClick,this);this.bindStore(this.store,true);if(this.resizable){this.resizer=new Ext.Resizable(this.list,{pinned:true,handles:"se"});this.resizer.on("resize",function(e,c,d){this.maxHeight=d-this.handleHeight-this.list.getFrameWidth("tb")-this.assetHeight;this.listWidth=c;this.innerList.setWidth(c-this.list.getFrameWidth("lr"));this.restrictHeight()},this);this[this.pageSize?"footer":"innerList"].setStyle("margin-bottom",this.handleHeight+"px")}}},bindStore:function(a,b){if(this.store&&!b){this.store.un("beforeload",this.onBeforeLoad,this);this.store.un("load",this.onLoad,this);this.store.un("loadexception",this.collapse,this);if(!a){this.store=null;if(this.view){this.view.setStore(null)}}}if(a){this.store=Ext.StoreMgr.lookup(a);this.store.on("beforeload",this.onBeforeLoad,this);this.store.on("load",this.onLoad,this);this.store.on("loadexception",this.collapse,this);if(this.view){this.view.setStore(a)}}},initEvents:function(){Ext.form.ComboBox.superclass.initEvents.call(this);this.keyNav=new Ext.KeyNav(this.el,{"up":function(a){this.inKeyMode=true;this.selectPrev()},"down":function(a){if(!this.isExpanded()){this.onTriggerClick()}else{this.inKeyMode=true;this.selectNext()}},"enter":function(a){this.onViewClick();this.delayedCheck=true;this.unsetDelayCheck.defer(10,this)},"esc":function(a){this.collapse()},"tab":function(a){this.onViewClick(false);return true},scope:this,doRelay:function(c,b,a){if(a=="down"||this.scope.isExpanded()){return Ext.KeyNav.prototype.doRelay.apply(this,arguments)}return true},forceKeyDown:true});this.queryDelay=Math.max(this.queryDelay||10,this.mode=="local"?10:250);this.dqTask=new Ext.util.DelayedTask(this.initQuery,this);if(this.typeAhead){this.taTask=new Ext.util.DelayedTask(this.onTypeAhead,this)}if(this.enableKeyUpEvent!==false&&this.editable!==false){this.el.on("keyup",this.onKeyUp,this)}if(this.forceSelection){this.on("blur",this.doForce,this)}},onDestroy:function(){if(this.view){this.view.el.removeAllListeners();this.view.el.remove();this.view.purgeListeners()}if(this.list){this.list.destroy()}this.bindStore(null);Ext.form.ComboBox.superclass.onDestroy.call(this)},unsetDelayCheck:function(){delete this.delayedCheck},fireKey:function(a){if(a.isNavKeyPress()&&!this.isExpanded()&&!this.delayedCheck){this.fireEvent("specialkey",this,a)}},onResize:function(a,b){Ext.form.ComboBox.superclass.onResize.apply(this,arguments);if(this.list&&this.listWidth===undefined){var c=Math.max(a,this.minListWidth);this.list.setWidth(c);this.innerList.setWidth(c-this.list.getFrameWidth("lr"))}},onEnable:function(){Ext.form.ComboBox.superclass.onEnable.apply(this,arguments);if(this.hiddenField){this.hiddenField.disabled=false}},onDisable:function(){Ext.form.ComboBox.superclass.onDisable.apply(this,arguments);if(this.hiddenField){this.hiddenField.disabled=true}},setEditable:function(a){if(a==this.editable){return}this.editable=a;if(!a){this.el.dom.setAttribute("readOnly",true);this.el.on("mousedown",this.onTriggerClick,this);this.el.addClass("x-combo-noedit")}else{this.el.dom.setAttribute("readOnly",false);this.el.un("mousedown",this.onTriggerClick,this);this.el.removeClass("x-combo-noedit")}},onBeforeLoad:function(){if(!this.hasFocus){return}this.innerList.update(this.loadingText?'<div class="loading-indicator">'+this.loadingText+"</div>":"");this.restrictHeight();this.selectedIndex=-1},onLoad:function(){if(!this.hasFocus){return}if(this.store.getCount()>0){this.expand();this.restrictHeight();if(this.lastQuery==this.allQuery){if(this.editable){this.el.dom.select()}if(!this.selectByValue(this.value,true)){this.select(0,true)}}else{this.selectNext();if(this.typeAhead&&this.lastKey!=Ext.EventObject.BACKSPACE&&this.lastKey!=Ext.EventObject.DELETE){this.taTask.delay(this.typeAheadDelay)}}}else{this.onEmptyResults()}},onTypeAhead:function(){if(this.store.getCount()>0){var b=this.store.getAt(0);var c=b.data[this.displayField];var a=c.length;var d=this.getRawValue().length;if(d!=a){this.setRawValue(c);this.selectText(d,c.length)}}},onSelect:function(a,b){if(this.fireEvent("beforeselect",this,a,b)!==false){this.setValue(a.data[this.valueField||this.displayField]);this.collapse();this.fireEvent("select",this,a,b)}},getValue:function(){if(this.valueField){return typeof this.value!="undefined"?this.value:""}else{return Ext.form.ComboBox.superclass.getValue.call(this)}},clearValue:function(){if(this.hiddenField){this.hiddenField.value=""}this.setRawValue("");this.lastSelectionText="";this.applyEmptyText();this.value=""},setValue:function(a){var c=a;if(this.valueField){var b=this.findRecord(this.valueField,a);if(b){c=b.data[this.displayField]}else{if(this.valueNotFoundText!==undefined){c=this.valueNotFoundText}}}this.lastSelectionText=c;if(this.hiddenField){this.hiddenField.value=a}Ext.form.ComboBox.superclass.setValue.call(this,c);this.value=a},findRecord:function(c,b){var a;if(this.store.getCount()>0){this.store.each(function(d){if(d.data[c]==b){a=d;return false}})}return a},onViewMove:function(b,a){this.inKeyMode=false},onViewOver:function(d,b){if(this.inKeyMode){return}var c=this.view.findItemFromChild(b);if(c){var a=this.view.indexOf(c);this.select(a,false)}},onViewClick:function(b){var a=this.view.getSelectedIndexes()[0];var c=this.store.getAt(a);if(c){this.onSelect(c,a)}if(b!==false){this.el.focus()}},restrictHeight:function(){this.innerList.dom.style.height="";var b=this.innerList.dom;var e=this.list.getFrameWidth("tb")+(this.resizable?this.handleHeight:0)+this.assetHeight;var c=Math.max(b.clientHeight,b.offsetHeight,b.scrollHeight);var a=this.getPosition()[1]-Ext.getBody().getScroll().top;var f=Ext.lib.Dom.getViewHeight()-a-this.getSize().height;var d=Math.max(a,f,this.minHeight||0)-this.list.shadowOffset-e-5;c=Math.min(c,d,this.maxHeight);this.innerList.setHeight(c);this.list.beginUpdate();this.list.setHeight(c+e);this.list.alignTo(this.wrap,this.listAlign);this.list.endUpdate()},onEmptyResults:function(){this.collapse()},isExpanded:function(){return this.list&&this.list.isVisible()},selectByValue:function(a,c){if(a!==undefined&&a!==null){var b=this.findRecord(this.valueField||this.displayField,a);if(b){this.select(this.store.indexOf(b),c);return true}}return false},select:function(a,c){this.selectedIndex=a;this.view.select(a);if(c!==false){var b=this.view.getNode(a);if(b){this.innerList.scrollChildIntoView(b,false)}}},selectNext:function(){var a=this.store.getCount();if(a>0){if(this.selectedIndex==-1){this.select(0)}else{if(this.selectedIndex<a-1){this.select(this.selectedIndex+1)}}}},selectPrev:function(){var a=this.store.getCount();if(a>0){if(this.selectedIndex==-1){this.select(0)}else{if(this.selectedIndex!=0){this.select(this.selectedIndex-1)}}}},onKeyUp:function(a){if(this.editable!==false&&!a.isSpecialKey()){this.lastKey=a.getKey();this.dqTask.delay(this.queryDelay)}},validateBlur:function(){return !this.list||!this.list.isVisible()},initQuery:function(){this.doQuery(this.getRawValue())},doForce:function(){if(this.el.dom.value.length>0){this.el.dom.value=this.lastSelectionText===undefined?"":this.lastSelectionText;this.applyEmptyText()}},doQuery:function(c,b){if(c===undefined||c===null){c=""}var a={query:c,forceAll:b,combo:this,cancel:false};if(this.fireEvent("beforequery",a)===false||a.cancel){return false}c=a.query;b=a.forceAll;if(b===true||(c.length>=this.minChars)){if(this.lastQuery!==c){this.lastQuery=c;if(this.mode=="local"){this.selectedIndex=-1;if(b){this.store.clearFilter()}else{this.store.filter(this.displayField,c)}this.onLoad()}else{this.store.baseParams[this.queryParam]=c;this.store.load({params:this.getParams(c)});this.expand()}}else{this.selectedIndex=-1;this.onLoad()}}},getParams:function(a){var b={};if(this.pageSize){b.start=0;b.limit=this.pageSize}return b},collapse:function(){if(!this.isExpanded()){return}this.list.hide();Ext.getDoc().un("mousewheel",this.collapseIf,this);Ext.getDoc().un("mousedown",this.collapseIf,this);this.fireEvent("collapse",this)},collapseIf:function(a){if(!a.within(this.wrap)&&!a.within(this.list)){this.collapse()}},expand:function(){if(this.isExpanded()||!this.hasFocus){return}this.list.alignTo(this.wrap,this.listAlign);this.list.show();this.innerList.setOverflow("auto");Ext.getDoc().on("mousewheel",this.collapseIf,this);Ext.getDoc().on("mousedown",this.collapseIf,this);this.fireEvent("expand",this)},onTriggerClick:function(){if(this.disabled){return}if(this.isExpanded()){this.collapse();this.el.focus()}else{this.onFocus({});if(this.triggerAction=="all"){this.doQuery(this.allQuery,true)}else{this.doQuery(this.getRawValue())}this.el.focus()}}});Ext.reg("combowcolors",Ext.ux.form.ComboBox);Ext.namespace("Ext.ux.plugins");Ext.ux.plugins.ExtendedComboBox={init:function(a){Ext.apply(a,{onRender:a.onRender.createSequence(function(c,b){var d=this;this.wrap.applyStyles({position:"relative"});this.el.applyStyles({border:"0px",backgroundColor:"transparent",textDecoration:"underline"});this.el.removeClass("x-form-text");this.el.removeClass("x-form-field");this.el.on("click",function(){d.expand()});this.trigger.removeClass("x-form-trigger");this.trigger.removeClass("x-form-arrow-trigger");this.trigger.applyStyles({backgroundImage:"none",border:"0px",width:"0px"});this.on("focus",function(e,f){d.expand()})})})}};Ext.ux.plugins.ExtendedComboBox=Ext.extend(Ext.ux.plugins.ExtendedComboBox,Ext.util.Observable);Ext.ux.RemoteComboAutoSuggest=Ext.extend(Ext.form.ComboBox,{initComponent:function(){Ext.ux.RemoteComboAutoSuggest.superclass.initComponent.call(this);this.addEvents({"keyup":true,"change":true});this.preValue=this.getValue();this.firstTime=true},onRender:function(c,a){Ext.ux.RemoteComboAutoSuggest.superclass.onRender.call(this,c,a);combo=this;combo.displayField="value";combo.valueField="key";store=new Ext.data.JsonStore({url:this.url,fields:["key","value"]});store.load({params:{id:this.preValue}});store.on("load",function(){combo.bindStore(store);if(this.firstTime){combo.setValue(this.preValue);this.firstTime=false}},this);var b=new Ext.util.DelayedTask(function(){keyword=combo.el.getValue();if(keyword!=combo.preValue){combo.store.load({params:{like:keyword}});combo.preValue=keyword}});onkeyup=function(){b.delay(1000)}}});Ext.reg("remotecomboautosuggest",Ext.ux.RemoteComboAutoSuggest);if("function"!==typeof RegExp.escape){RegExp.escape=function(a){if("string"!==typeof a){return a}return a.replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")}}Ext.ns("Ext.ux.form");Ext.ux.form.LovCombo=Ext.extend(Ext.form.ComboBox,{selectAllOn:"select-deselect-all",checkField:"checked",separator:",",displaySeparator:",",initComponent:function(){Ext.ux.form.LovCombo.superclass.initComponent.apply(this,arguments);if(!this.tpl){this.tpl='<tpl for=".">'+'<div class="x-combo-list-item">'+'<img src="'+Ext.BLANK_IMAGE_URL+'" '+'class="ux-lovcombo-icon ux-lovcombo-icon-'+"{[values."+this.checkField+'?"checked":"unchecked"'+']}">'+'<div class="ux-lovcombo-item-text">{'+(this.displayField||"text")+"}</div>"+"</div>"+"</tpl>"}this.on({scope:this,beforequery:this.onBeforeQuery});this.onRender=this.onRender.createSequence(function(){if(!this.getStore()){return}var MyRecordType=Ext.data.Record.create([this.valueField,this.displayField]);var json='({"'+this.valueField+'":"select-deselect-all","'+this.displayField+'":"<span style=\'display:block\'><b>Select/Deselect All</b></span>"})';myrec=new MyRecordType(eval(json));this.getStore().insert(0,myrec);if(this.selectAllCheck){var record=this.getStore().getAt(0);record.set(this.checkField,true);this.doQuery(this.allQuery)}});this.onLoad=this.onLoad.createSequence(function(){if(this.el){var v=this.el.dom.value;this.el.dom.value="";this.el.dom.value=v}});this.hideTask=new Ext.util.DelayedTask(this.hideList,this)},initEvents:function(){Ext.ux.form.LovCombo.superclass.initEvents.apply(this,arguments);this.keyNav.tab=false},clearValue:function(){this.value="";this.setRawValue(this.value);this.store.clearFilter();this.store.each(function(a){a.set(this.checkField,false)},this);if(this.hiddenField){this.hiddenField.value=""}this.applyEmptyText()},getCheckedDisplay:function(){var a=new RegExp(RegExp.escape(this.separator),"g");return this.getCheckedValue(this.displayField).replace(a,RegExp.escape(this.displaySeparator)+" ")},getCheckedValue:function(b){b=b||this.valueField;var d=[];var a=this.store.snapshot||this.store.data;a.each(function(c){if(c.get(this.checkField)&&c.data[this.valueField]!==this.selectAllOn){d.push(c.get(b))}},this);return d.join(this.separator)},selectAllCheck:function(){var a=this.store.snapshot||this.store.data;var b=true;a.each(function(c){if(c.data[this.valueField]!==this.selectAllOn&&!c.get(this.checkField)){b=false;return}},this);return b},onBeforeQuery:function(a){a.query=a.query.replace(new RegExp(this.getCheckedDisplay()+"[ "+RegExp.escape(this.separator)+"]*"),"")},beforeBlur:function(){this.list.hide();var d=this.getRawValue();var a=d.split(new RegExp(RegExp.escape(this.displaySeparator)+" *"));var c=[];var b=this.store.snapshot||this.store.data;Ext.each(a,function(e){b.each(function(f){if(e===f.get(this.displayField)){c.push(f.get(this.valueField))}},this)},this);this.store.clearFilter()},onSelect:function(a,b){if(this.fireEvent("beforeselect",this,a,b)!==false){a.set(this.checkField,!a.get(this.checkField));if(this.store.isFiltered()){this.doQuery(this.allQuery)}if(a.data[this.valueField]===this.selectAllOn){if(a.get(this.checkField)){this.selectAll()}else{this.deselectAll()}}else{this.setValue(this.getCheckedValue())}this.fireEvent("select",this,a,b)}this.hideTask.delay(3000)},hideList:function(){this.list.hide()},setValue:function(a){if(a){a=""+a;if(this.valueField){this.store.clearFilter();this.store.each(function(c){if(c.data[this.valueField]===this.selectAllOn&&this.selectAllCheck()){c.set(this.checkField,true)}else{if(c.data[this.valueField]===this.selectAllOn){c.set(this.checkField,null)}else{var b=!(!a.match("(^|"+RegExp.escape(this.separator)+")"+RegExp.escape(c.get(this.valueField))+"("+RegExp.escape(this.separator)+"|$)"));c.set(this.checkField,b)}}},this);this.value=this.getCheckedValue();this.setRawValue(this.getCheckedDisplay());if(this.hiddenField){this.hiddenField.value=this.value}}else{this.value=a;this.setRawValue(a);if(this.hiddenField){this.hiddenField.value=a}}if(this.el){this.el.removeClass(this.emptyClass)}}else{this.clearValue()}},selectAll:function(){this.store.each(function(a){a.set(this.checkField,true)},this);this.doQuery(this.allQuery);this.setValue(this.getCheckedValue())},deselectAll:function(){this.clearValue()}});Ext.reg("lovcombo",Ext.ux.form.LovCombo);Ext.ux.Captcha=Ext.extend(Ext.form.TextField,{initComponent:function(){Ext.ux.Captcha.superclass.initComponent.call(this)},onRender:function(b,a){Ext.ux.Captcha.superclass.onRender.call(this,b,a);randId="captcha_image_"+(Math.floor(Math.random()*10000000));src=this.src;captchaDiv=Ext.DomHelper.insertFirst(b,{tag:"div",style:"width:"+this.width+"px; margin:0px; margin-bottom:2px;float:left; padding:0px;clear:both;"});captchaImgDiv=Ext.DomHelper.insertFirst(captchaDiv,{tag:"div",style:"margin:0px;float:left; padding:0px"});reloadImgDiv=Ext.DomHelper.insertFirst(captchaDiv,{tag:"div",html:'<div style="color:#888; padding-bottom:2px;">Can\'t see image? <a href="#" onclick="document.getElementById(randId).src=document.getElementById(randId).src+\'#\'" style="color:#0000ff">Reload</a></div>',style:"margin:0px;float:right; padding:0px"});captchaImg=Ext.DomHelper.append(captchaImgDiv,{tag:"img",id:randId,src:this.src,width:this.width,style:this.imgStyle});if(!this.input){this.el.applyStyles({display:"none"})}}});Ext.reg("captcha",Ext.ux.Captcha);Ext.ux.ItemSelectorAutoSuggest=Ext.extend(Ext.form.Field,{msWidth:200,msHeight:300,hideNavIcons:false,imagePath:"",iconUp:"up2.gif",iconDown:"down2.gif",iconLeft:"left2.gif",iconRight:"right2.gif",iconTop:"top2.gif",iconBottom:"bottom2.gif",drawUpIcon:true,drawDownIcon:true,drawLeftIcon:true,drawRightIcon:true,drawTopIcon:true,drawBotIcon:true,url:null,fromStore:null,toStore:null,fromData:null,toData:null,displayField:0,valueField:1,switchToFrom:false,allowDup:false,focusClass:undefined,delimiter:",",readOnly:false,toLegend:null,fromLegend:null,toSortField:null,fromSortField:null,toSortDir:"ASC",fromSortDir:"ASC",toTBar:null,fromTBar:null,bodyStyle:null,border:false,loadOnChange:true,defaultAutoCreate:{tag:"div"},keyword:null,randN:Math.floor(Math.random()*10000000),fromMultiselect:null,initComponent:function(){Ext.ux.ItemSelectorAutoSuggest.superclass.initComponent.call(this);this.addEvents({"rowdblclick":true,"change":true})},onOkButtonClick:function(a,b){this.fromMultiselect.el.mask("Loading...");this.fromStore.load({params:{like:a,option:b}});ms=this.fromMultiselect;this.fromStore.on("load",function(){ms.el.unmask()})},onDataLoad:function(){ms=this.fromMultiselect;this.fromMultiselect.el.mask("Loading...");this.fromMultiselect.store.load();this.fromMultiselect.store.on("load",function(){ms.el.unmask()})},onRender:function(h,g){Ext.ux.ItemSelectorAutoSuggest.superclass.onRender.call(this,h,g);var c=new Ext.form.ComboBox({parent:this,name:this.id+"_optioncombo_"+this.randN,store:new Ext.data.SimpleStore({fields:["value","display"],data:[["start_with","Starts with"],["any","Match Any"]]}),listeners:{change:function(){if(a.getValue()!=a.originalValue&&a.getValue()!=""){this.parent.onOkButtonClick(a.getValue(),c.getValue())}}},width:80,displayField:"display",valueField:"value",triggerAction:"all",mode:"local",lazyRender:true});c.setValue("any");this.fromStore=new Ext.data.JsonStore({url:this.url,fields:[this.valueField,this.displayField]});var o=new Ext.Button({name:this.id+"_okbutton_"+this.randN,text:"Go",parent:this,listeners:{click:function(){this.parent.onOkButtonClick(a.getValue(),c.getValue())}}});var m=new Ext.Button({name:this.id+"_listallbutton_"+this.randN,text:"List All",parent:this,listeners:{click:function(){this.parent.onOkButtonClick("%%","")}}});if(this.loadOnChange){var a=new Ext.form.TextField({name:this.id+"_keyword_"+this.randN,id:this.id+"_keyword_"+this.randN,emptyText:"Filter...",parent:this,width:100,enableKeyEvents:true,listeners:{keyup:function(){this.parent.onOkButtonClick(a.getValue(),c.getValue())}}});var b=new Ext.Toolbar({items:[c,a,m]})}else{var a=new Ext.form.TextField({name:this.id+"_keyword_"+this.randN,id:this.id+"_keyword_"+this.randN,emptyText:"Filter...",width:100});var b=new Ext.Toolbar({items:[c,a,o,m]})}this.fromTBar=b;this.fromMultiselect=new Ext.ux.Multiselect({legend:this.fromLegend,delimiter:this.delimiter,allowDup:this.allowDup,copy:this.allowDup,allowTrash:this.allowDup,dragGroup:this.readOnly?null:"drop2-"+this.el.dom.id,dropGroup:this.readOnly?null:"drop1-"+this.el.dom.id,width:this.msWidth,height:this.msHeight,dataFields:this.dataFields,data:this.fromData,displayField:this.displayField,valueField:this.valueField,store:this.fromStore,isFormField:false,tbar:this.fromTBar,appendOnly:true,sortField:this.fromSortField,sortDir:this.fromSortDir,id:this.id+"_from_multi_select_"+this.randN});this.fromMultiselect.on("dblclick",this.onRowDblClick,this);if(!this.toStore){this.toStore=new Ext.data.SimpleStore({fields:this.dataFields,data:this.toData})}this.toStore.on("add",this.valueChanged,this);this.toStore.on("remove",this.valueChanged,this);this.toStore.on("load",this.valueChanged,this);this.toMultiselect=new Ext.ux.Multiselect({legend:this.toLegend,delimiter:this.delimiter,allowDup:this.allowDup,dragGroup:this.readOnly?null:"drop1-"+this.el.dom.id,dropGroup:this.readOnly?null:"drop2-"+this.el.dom.id+",drop1-"+this.el.dom.id,width:this.msWidth,height:this.msHeight,displayField:this.displayField,valueField:this.valueField,store:this.toStore,isFormField:false,tbar:this.toTBar,sortField:this.toSortField,sortDir:this.toSortDir});this.toMultiselect.on("dblclick",this.onRowDblClick,this);var d=new Ext.Panel({bodyStyle:this.bodyStyle,border:this.border,layout:"table",layoutConfig:{columns:3},width:530});d.add(this.switchToFrom?this.toMultiselect:this.fromMultiselect);var q=new Ext.Panel({header:false});d.add(q);d.add(this.switchToFrom?this.fromMultiselect:this.toMultiselect);d.render(this.el);q.el.down("."+q.bwrapCls).remove();if(this.imagePath!=""&&this.imagePath.charAt(this.imagePath.length-1)!="/"){this.imagePath+="/"}this.iconUp=this.imagePath+(this.iconUp||"up2.gif");this.iconDown=this.imagePath+(this.iconDown||"down2.gif");this.iconLeft=this.imagePath+(this.iconLeft||"left2.gif");this.iconRight=this.imagePath+(this.iconRight||"right2.gif");this.iconTop=this.imagePath+(this.iconTop||"top2.gif");this.iconBottom=this.imagePath+(this.iconBottom||"bottom2.gif");var e=q.getEl();if(!this.toSortField){this.toTopIcon=e.createChild({tag:"img",src:this.iconTop,style:{cursor:"pointer",margin:"2px"}});e.createChild({tag:"br"});this.upIcon=e.createChild({tag:"img",src:this.iconUp,style:{cursor:"pointer",margin:"2px"}});e.createChild({tag:"br"})}this.addIcon=e.createChild({tag:"img",src:this.switchToFrom?this.iconLeft:this.iconRight,style:{cursor:"pointer",margin:"2px"}});e.createChild({tag:"br"});this.removeIcon=e.createChild({tag:"img",src:this.switchToFrom?this.iconRight:this.iconLeft,style:{cursor:"pointer",margin:"2px"}});e.createChild({tag:"br"});if(!this.toSortField){this.downIcon=e.createChild({tag:"img",src:this.iconDown,style:{cursor:"pointer",margin:"2px"}});e.createChild({tag:"br"});this.toBottomIcon=e.createChild({tag:"img",src:this.iconBottom,style:{cursor:"pointer",margin:"2px"}})}if(!this.readOnly){if(!this.toSortField){this.toTopIcon.on("click",this.toTop,this);this.upIcon.on("click",this.up,this);this.downIcon.on("click",this.down,this);this.toBottomIcon.on("click",this.toBottom,this)}this.addIcon.on("click",this.fromTo,this);this.removeIcon.on("click",this.toFrom,this)}if(!this.drawUpIcon||this.hideNavIcons){this.upIcon.dom.style.display="none"}if(!this.drawDownIcon||this.hideNavIcons){this.downIcon.dom.style.display="none"}if(!this.drawLeftIcon||this.hideNavIcons){this.addIcon.dom.style.display="none"}if(!this.drawRightIcon||this.hideNavIcons){this.removeIcon.dom.style.display="none"}if(!this.drawTopIcon||this.hideNavIcons){this.toTopIcon.dom.style.display="none"}if(!this.drawBotIcon||this.hideNavIcons){this.toBottomIcon.dom.style.display="none"}var f=d.body.first();this.el.setWidth(d.body.first().getWidth());d.body.removeClass();this.hiddenName=this.name;var n={tag:"input",type:"hidden",value:"",name:this.name};this.hiddenField=this.el.createChild(n);this.valueChanged(this.toStore)},initValue:Ext.emptyFn,toTop:function(){var c=this.toMultiselect.view.getSelectedIndexes();var a=[];if(c.length>0){c.sort();for(var b=0;b<c.length;b++){record=this.toMultiselect.view.store.getAt(c[b]);a.push(record)}c=[];for(var b=a.length-1;b>-1;b--){record=a[b];this.toMultiselect.view.store.remove(record);this.toMultiselect.view.store.insert(0,record);c.push(((a.length-1)-b))}}this.toMultiselect.view.refresh();this.toMultiselect.view.select(c)},toBottom:function(){var c=this.toMultiselect.view.getSelectedIndexes();var a=[];if(c.length>0){c.sort();for(var b=0;b<c.length;b++){record=this.toMultiselect.view.store.getAt(c[b]);a.push(record)}c=[];for(var b=0;b<a.length;b++){record=a[b];this.toMultiselect.view.store.remove(record);this.toMultiselect.view.store.add(record);c.push((this.toMultiselect.view.store.getCount())-(a.length-b))}}this.toMultiselect.view.refresh();this.toMultiselect.view.select(c)},up:function(){var a=null;var c=this.toMultiselect.view.getSelectedIndexes();c.sort();var d=[];if(c.length>0){for(var b=0;b<c.length;b++){a=this.toMultiselect.view.store.getAt(c[b]);if((c[b]-1)>=0){this.toMultiselect.view.store.remove(a);this.toMultiselect.view.store.insert(c[b]-1,a);d.push(c[b]-1)}}this.toMultiselect.view.refresh();this.toMultiselect.view.select(d)}},down:function(){var a=null;var c=this.toMultiselect.view.getSelectedIndexes();c.sort();c.reverse();var d=[];if(c.length>0){for(var b=0;b<c.length;b++){a=this.toMultiselect.view.store.getAt(c[b]);if((c[b]+1)<this.toMultiselect.view.store.getCount()){this.toMultiselect.view.store.remove(a);this.toMultiselect.view.store.insert(c[b]+1,a);d.push(c[b]+1)}}this.toMultiselect.view.refresh();this.toMultiselect.view.select(d)}},fromTo:function(){var d=this.fromMultiselect.view.getSelectedIndexes();var b=[];if(d.length>0){for(var c=0;c<d.length;c++){record=this.fromMultiselect.view.store.getAt(d[c]);b.push(record)}if(!this.allowDup){d=[]}for(var c=0;c<b.length;c++){record=b[c];if(this.allowDup){var a=new Ext.data.Record();record.id=a.id;delete a;this.toMultiselect.view.store.add(record)}else{this.fromMultiselect.view.store.remove(record);this.toMultiselect.view.store.add(record);d.push((this.toMultiselect.view.store.getCount()-1))}}}this.toMultiselect.view.refresh();this.fromMultiselect.view.refresh();if(this.toSortField){this.toMultiselect.store.sort(this.toSortField,this.toSortDir)}if(this.allowDup){this.fromMultiselect.view.select(d)}else{this.toMultiselect.view.select(d)}},toFrom:function(){var c=this.toMultiselect.view.getSelectedIndexes();var a=[];if(c.length>0){for(var b=0;b<c.length;b++){record=this.toMultiselect.view.store.getAt(c[b]);a.push(record)}c=[];for(var b=0;b<a.length;b++){record=a[b];this.toMultiselect.view.store.remove(record);if(!this.allowDup){this.fromMultiselect.view.store.add(record);c.push((this.fromMultiselect.view.store.getCount()-1))}}}this.fromMultiselect.view.refresh();this.toMultiselect.view.refresh();if(this.fromSortField){this.fromMultiselect.store.sort(this.fromSortField,this.fromSortDir)}this.fromMultiselect.view.select(c)},valueChanged:function(c){var a=null;var b=[];for(var d=0;d<c.getCount();d++){a=c.getAt(d);b.push(a.get(this.valueField))}this.hiddenField.dom.value=b.join(this.delimiter);this.fireEvent("change",this,this.getValue(),this.hiddenField.dom.value)},getValue:function(){return this.hiddenField.dom.value},onRowDblClick:function(c,a,b,d){return this.fireEvent("rowdblclick",c,a,b,d)},reset:function(){range=this.toMultiselect.store.getRange();this.toMultiselect.store.removeAll();if(!this.allowDup){this.fromMultiselect.store.add(range);this.fromMultiselect.store.sort(this.displayField,"ASC")}this.valueChanged(this.toMultiselect.store)}});Ext.reg("itemselectorautosuggest",Ext.ux.ItemSelectorAutoSuggest);Ext.ns("Ext.ux.plugins");Ext.ux.plugins.ExtendedDayTimeSelect=Ext.extend(Ext.form.Field,{border:true,width:250,dayTimeFieldWidth:60,weekdayMonthdayWidth:50,fromFieldWidth:60,toFieldWidth:60,buttonWidth:50,listWidth:200,layout:"form",hidden:true,prepareValue:function(b,a){da=Array();j=0;for(i=0;i<a.length;i++){if(a[i]!=""&&a[i]!=null){da[j]=a[i];j++}}if(this.returnType=="json"){var c=Array();c[0]=b;c[1]=da;json=Ext.util.JSON.encode(c);this.setValue(json)}else{commaS="";for(i=0;i<a.length;i++){if(a[i]!=""&&a[i]!=null){commaS+=a[i];if(i!=(a.length-1)){commaS+=","}}}if(commaS!=""){commaS=b+","+commaS}this.setValue(commaS)}},resizeComponents:function(a){if(a=="auto"){var b=this.width-10;this.dayTimeFieldWidth=Math.floor((80/100)*b);this.listWidth=Math.floor((80/100)*b);this.weekdayMonthdayWidth=Math.floor((20/100)*b);this.fromFieldWidth=Math.floor((50/100)*(this.dayTimeFieldWidth-10));this.toFieldWidth=Math.floor((50/100)*(this.dayTimeFieldWidth-10));this.buttonWidth=Math.floor((20/100)*b)}},initComponent:function(){var a={};Ext.apply(this,a);Ext.ux.plugins.ExtendedDayTimeSelect.superclass.initComponent.apply(this,arguments)},onRender:function(e,b){this.resizeComponents("auto");Ext.ux.plugins.ExtendedDayTimeSelect.superclass.onRender.apply(this,arguments);var f=Math.floor(Math.random()*10000000);var d="day";var a=Array();mainDiv=Ext.DomHelper.insertFirst(e,{tag:"div",style:"width:"+this.width+"px; margin:0px; padding:0px"});topRowDiv=Ext.DomHelper.append(mainDiv,{tag:"div",style:"width:inherit;float:left;"});dayTimeDiv=Ext.DomHelper.append(topRowDiv,{tag:"div",style:"width:"+this.dayTimeFieldWidth+"px;float:left; margin-right:10px;"});weekdayMonthdayDiv=Ext.DomHelper.append(topRowDiv,{tag:"div",style:"width:"+this.weekdayMonthdayWidth+"px;float:left; margin-right:0px;"});clearDiv=Ext.DomHelper.append(topRowDiv,{tag:"div",style:"clear:both; height:2px; width:float:left"+this.width+"px"});fromDiv=Ext.DomHelper.append(topRowDiv,{tag:"div",style:"float:left;width:"+this.fromFieldWidth+"px;"});hyphenDiv=Ext.DomHelper.append(topRowDiv,{tag:"div",style:"text-align:center;float:left;width:10px;",html:"-"});toDiv=Ext.DomHelper.append(topRowDiv,{tag:"div",style:"float:left;margin-right:10px;width:"+this.toFieldWidth+"px;"});okButtonDiv=Ext.DomHelper.append(topRowDiv,{tag:"div",style:"float:left; width:"+this.buttonWidth+"px;"});clearDiv=Ext.DomHelper.append(mainDiv,{tag:"div",style:"clear:both; "});clearDiv.id="daytimeselect_"+f+"_cleardiv0_";dayStore=new Ext.data.SimpleStore({fields:["valueField","displayField"],data:[["1","1"],["2","2"],["3","3"],["4","4"],["5","5"],["6","6"],["7","7"],["8","8"],["9","9"],["10","10"],["11","11"],["12","12"],["13","13"],["14","14"],["15","15"],["16","16"],["17","17"],["18","18"],["19","19"],["20","20"],["21","21"],["22","22"],["23","23"],["24","24"],["25","25"],["26","26"],["27","27"],["28","28"],["29","29"],["30","30"],["31","31"]]});timeStore=new Ext.data.SimpleStore({fields:["valueField","displayField"],data:[["1","1"],["2","2"],["3","3"],["4","4"],["5","5"],["6","6"],["7","7"],["8","8"],["9","9"],["10","10"],["11","11"],["12","12"],["13","13"],["14","14"],["15","15"],["16","16"],["17","17"],["18","18"],["19","19"],["20","20"],["21","21"],["22","22"],["23","23"],["24","24"]]});weekStore=new Ext.data.SimpleStore({fields:["valueField","displayField"],data:[["sunday","Sun"],["monday","Mon"],["tuesday","Tue"],["wednesday","Wed"],["thursday","Thur"],["friday","Fri"],["saturday","Sat"]]});dayTimeCombo=new Ext.form.ComboBox({typeAhead:true,id:"daytimeselect_daytimecombo_"+f,triggerAction:"all",width:this.dayTimeFieldWidth,lazyRender:true,mode:"local",parent:this,store:new Ext.data.SimpleStore({fields:["valueField","displayField"],data:[["24x7","24x7"],["daily","Daily"],["weekly","Weekly"],["monthly","Monthly"]]}),listeners:{select:function(){weeklyMonthlyCombo.enable();fromCombo.enable();toCombo.enable();okButton.enable();if(this.getValue()=="24x7"){dayTimeCombo.enable();weeklyMonthlyCombo.disable();fromCombo.disable();toCombo.disable();okButton.disable();this.parent.setValue("24x7")}if(this.getValue()=="daily"){weeklyMonthlyCombo.setValue("daily");weeklyMonthlyCombo.disable()}if(this.getValue()=="weekly"){Ext.getCmp("daytimeselect_weeklymonthlycombo_"+f).bindStore(weekStore);Ext.getCmp("daytimeselect_weeklymonthlycombo_"+f).setValue("sunday")}if(this.getValue()=="monthly"){Ext.getCmp("daytimeselect_weeklymonthlycombo_"+f).bindStore(dayStore);Ext.getCmp("daytimeselect_weeklymonthlycombo_"+f).setValue("1")}if(!a.length){d=this.getValue()}}},valueField:"valueField",displayField:"displayField",emptyText:"Select time frame"});dayTimeCombo.setValue("weekly");dayTimeCombo.render(dayTimeDiv);weeklyMonthlyCombo=new Ext.form.ComboBox({typeAhead:true,id:"daytimeselect_weeklymonthlycombo_"+f,triggerAction:"all",width:this.weekdayMonthdayWidth,lazyRender:true,mode:"local",store:weekStore,valueField:"valueField",displayField:"displayField"});weeklyMonthlyCombo.setValue("sunday");weeklyMonthlyCombo.render(weekdayMonthdayDiv);fromCombo=new Ext.form.ComboBox({typeAhead:true,id:"daytimeselect_fromcombo_"+f,triggerAction:"all",width:this.fromFieldWidth,lazyRender:true,mode:"local",store:timeStore,valueField:"valueField",displayField:"displayField",emptyText:"Hour From",listeners:{change:function(){if(parseInt(toCombo.getValue())){if(parseInt(fromCombo.getValue())>parseInt(toCombo.getValue())){fromCombo.setValue("");Ext.Msg.alert("Error","Please select a lower/equal value than Hour To")}}}}});fromCombo.render(fromDiv);toCombo=new Ext.form.ComboBox({typeAhead:true,id:"daytimeselect_tocombo_"+f,triggerAction:"all",width:this.toFieldWidth,lazyRender:true,mode:"local",store:timeStore,valueField:"valueField",displayField:"displayField",emptyText:"Hour To",listeners:{change:function(){if(parseInt(fromCombo.getValue())){if(parseInt(fromCombo.getValue())>parseInt(toCombo.getValue())){toCombo.setValue("");Ext.Msg.alert("Error","Please select a greater/equal value than Hour From")}}}}});toCombo.render(toDiv);okButton=new Ext.Button({parent:this,style:"width:100%",count:0,iconCls:"icon-plus",t_item:0,listeners:{click:function(){if(!a.length){d=dayTimeCombo.getValue()}if(Ext.getCmp("daytimeselect_weeklymonthlycombo_"+f).getValue()=="daily"&&this.t_item>0){return}if(Ext.getCmp("daytimeselect_daytimecombo_"+f).getValue()==""||Ext.getCmp("daytimeselect_fromcombo_"+f).getValue()==""||Ext.getCmp("daytimeselect_tocombo_"+f).getValue()==""){Ext.Msg.show({title:"Error !",msg:"Invalid Selections",buttons:Ext.Msg.OK,icon:Ext.MessageBox.ERROR});return}if(this.t_item&&d!=Ext.getCmp("daytimeselect_daytimecombo_"+f).getValue()){Ext.Msg.show({title:"Error !",msg:"Invalid data type for this series",buttons:Ext.Msg.OK,icon:Ext.MessageBox.ERROR});return}text=Ext.getCmp("daytimeselect_weeklymonthlycombo_"+f).getValue()+"-"+Ext.getCmp("daytimeselect_fromcombo_"+f).getValue()+"-"+Ext.getCmp("daytimeselect_tocombo_"+f).getValue();var h=false;for(var g=0;g<a.length;g++){if(a[g]==text){h=true}}if(h){Ext.Msg.show({title:"Error !",msg:"Data already in list",buttons:Ext.Msg.OK,icon:Ext.MessageBox.ERROR});return}a[this.count]=Ext.getCmp("daytimeselect_weeklymonthlycombo_"+f).getValue()+"-"+Ext.getCmp("daytimeselect_fromcombo_"+f).getValue()+"-"+Ext.getCmp("daytimeselect_tocombo_"+f).getValue();this.t_item++;this.parent.prepareValue(d,a);clearDiv=Ext.DomHelper.append(mainDiv,{tag:"div",style:"width:inherit;clear:both;font-size:0px;height:3px"});clearDiv.id="daytimeselect_"+f+"_cleardiv_"+this.count;listRowDiv=Ext.DomHelper.append(mainDiv,{tag:"div",style:"width:inherit;"});listRowDiv.id="daytimeselect_"+f+"_listrowdiv_"+this.count;listDiv=Ext.DomHelper.append(listRowDiv,{tag:"div",style:"width:"+this.parent.listWidth+"px; margin-right:5px;float:left;"});listDiv.id="daytimeselect_"+f+"_listdiv_"+this.count;removeButtonDiv=Ext.DomHelper.append(listRowDiv,{tag:"div",style:"width:inherit;float:right; width:"+this.parent.buttonWidth+"px;"});removeButtonDiv.id="daytimeselect_"+f+"_removebuttondiv_"+this.count;list=new Ext.form.TextField({bodyStyle:"background-color:#f5f5f5",height:20,width:this.parent.listWidth,readOnly:true});list.setValue(text);list.render(listDiv);removeButton=new Ext.Button({id:"daytimeselect_"+f+"_removebutton_"+this.count,c:this.count,t_item:this.t_item,parent:this,width:this.buttonWidth,iconCls:"icon-delete",listeners:{click:function(){a[this.c]="";Ext.DomHelper.applyStyles(Ext.get("daytimeselect_"+f+"_listrowdiv_"+this.c),"display:none");Ext.DomHelper.applyStyles(Ext.get("daytimeselect_"+f+"_cleardiv_"+this.c),"display:none");this.parent.t_item--;if(this.parent.t_item==0){a=new Array();dayTimeCombo.enable()}this.parent.parent.prepareValue(d,a)}}});removeButton.render(removeButtonDiv);this.count++;if(a.length){dayTimeCombo.disable()}toCombo.setValue("");fromCombo.setValue("")}}});okButton.render(okButtonDiv);data=this.value;dataArr=data.split(",");d=dataArr[0];dayTimeCombo.setValue(d);if(d=="daily"){var c=dataArr[1];c=c.replace("sunday","daily");dataArr=new Array("daily",c)}if(d!="24x7"){for(i=1;i<dataArr.length;i++){valArr=dataArr[i].split("-");weeklyMonthlyCombo.setValue(valArr[0]);fromCombo.setValue(valArr[1]);toCombo.setValue(valArr[2]);okButton.fireEvent("click")}}else{dataArr=new Array()}if(dataArr.length>0&&data!=""&&data!="24x7"&&data!="daily"){dayTimeCombo.disable()}if(d=="24x7"){fromCombo.disable();toCombo.disable();okButton.disable();weeklyMonthlyCombo.disable()}if(d=="daily"){weeklyMonthlyCombo.setValue("daily");weeklyMonthlyCombo.disable()}}});Ext.reg("extendedDayTimeSelect",Ext.ux.plugins.ExtendedDayTimeSelect);Ext.ns("Ext.ux.form");Ext.ux.form.DateTime=Ext.extend(Ext.form.Field,{timeIncrement:60,timeActive:true,defaultAutoCreate:{tag:"input",type:"hidden"},timeWidth:100,dtSeparator:" ",hiddenFormat:"Y-m-d H:i:s",otherToNow:true,timePosition:"right",dateFormat:"d/m/Y",timeFormat:"H:i",initComponent:function(){Ext.ux.form.DateTime.superclass.initComponent.call(this);var b=Ext.apply({},{id:this.id+"-date",format:this.dateFormat||Ext.form.DateField.prototype.format,width:this.timeWidth,selectOnFocus:this.selectOnFocus,listeners:{blur:{scope:this,fn:this.onBlur},focus:{scope:this,fn:this.onFocus}}},this.dateConfig);this.df=new Ext.form.DateField(b);this.df.ownerCt=this;delete (this.dateFormat);var a=Ext.apply({},{id:this.id+"-time",format:this.timeFormat||Ext.form.TimeField.prototype.format,width:this.timeWidth,selectOnFocus:this.selectOnFocus,increment:this.timeIncrement,listeners:{blur:{scope:this,fn:this.onBlur},focus:{scope:this,fn:this.onFocus}}},this.timeConfig);this.tf=new Ext.form.TimeField(a);this.tf.ownerCt=this;delete (this.timeFormat);this.relayEvents(this.df,["focus","specialkey","invalid","valid"]);this.relayEvents(this.tf,["focus","specialkey","invalid","valid"])},onRender:function(c,a){if(this.isRendered){return}Ext.ux.form.DateTime.superclass.onRender.call(this,c,a);var b;if("below"===this.timePosition||"bellow"===this.timePosition){b=Ext.DomHelper.append(c,{tag:"table",style:"border-collapse:collapse",children:[{tag:"tr",children:[{tag:"td",style:"padding-bottom:1px",cls:"ux-datetime-date"}]},{tag:"tr",children:[{tag:"td",cls:"ux-datetime-time"}]}]},true)}else{b=Ext.DomHelper.append(c,{tag:"table",style:"border-collapse:collapse",children:[{tag:"tr",children:[{tag:"td",style:"padding-right:4px",cls:"ux-datetime-date"},{tag:"td",cls:"ux-datetime-time"}]}]},true)}this.tableEl=b;this.wrap=b.wrap();this.wrap.on("mousedown",this.onMouseDown,this,{delay:10});this.df.render(b.child("td.ux-datetime-date"));this.tf.render(b.child("td.ux-datetime-time"));if(Ext.isIE&&Ext.isStrict){b.select("input").applyStyles({top:0})}this.on("specialkey",this.onSpecialKey,this);this.df.el.swallowEvent(["keydown","keypress"]);this.tf.el.swallowEvent(["keydown","keypress"]);if("side"===this.msgTarget){var d=this.el.findParent(".x-form-element",10,true);this.errorIcon=d.createChild({cls:"x-form-invalid-icon"});this.df.errorIcon=this.errorIcon;this.tf.errorIcon=this.errorIcon}this.el.dom.name=this.hiddenName||this.name||this.id;this.df.el.dom.removeAttribute("name");this.tf.el.dom.removeAttribute("name");this.isRendered=true;this.updateHidden();this.setActive(this.tf,this.timeActive)},adjustSize:Ext.BoxComponent.prototype.adjustSize,alignErrorIcon:function(){this.errorIcon.alignTo(this.tableEl,"tl-tr",[2,0])},initDateValue:function(){this.dateValue=this.otherToNow?new Date():new Date(1970,0,1,0,0,0)},clearInvalid:function(){this.df.clearInvalid();this.tf.clearInvalid()},markInvalid:function(a){this.df.markInvalid(a);this.tf.markInvalid(a)},beforeDestroy:function(){if(this.isRendered){this.wrap.removeAllListeners();this.wrap.remove();this.tableEl.remove();this.df.destroy();this.tf.destroy()}},disable:function(){if(this.isRendered){this.df.disabled=this.disabled;this.df.onDisable();this.tf.onDisable()}this.disabled=true;this.df.disabled=true;this.tf.disabled=true;this.fireEvent("disable",this);return this},enable:function(){if(this.rendered){this.df.onEnable();this.tf.onEnable()}this.disabled=false;this.df.disabled=false;this.tf.disabled=false;this.fireEvent("enable",this);return this},focus:function(){this.df.focus()},getPositionEl:function(){return this.wrap},getResizeEl:function(){return this.wrap},getValue:function(){return this.dateValue?new Date(this.dateValue):""},isValid:function(){return this.df.isValid()&&this.tf.isValid()},isVisible:function(){return this.df.rendered&&this.df.getActionEl().isVisible()},onBlur:function(a){if(this.wrapClick){a.focus();this.wrapClick=false}if(a===this.df){this.updateDate()}else{this.updateTime()}this.updateHidden();(function(){if(!this.df.hasFocus&&!this.tf.hasFocus){var b=this.getValue();if(String(b)!==String(this.startValue)){this.fireEvent("change",this,b,this.startValue)}this.hasFocus=false;this.fireEvent("blur",this)}}).defer(100,this)},onFocus:function(){if(!this.hasFocus){this.hasFocus=true;this.startValue=this.getValue();this.fireEvent("focus",this)}},onMouseDown:function(a){if(!this.disabled){this.wrapClick="td"===a.target.nodeName.toLowerCase()}},onSpecialKey:function(b,c){var a=c.getKey();if(a===c.TAB){if(b===this.df&&!c.shiftKey){c.stopEvent();this.tf.focus()}if(b===this.tf&&c.shiftKey){c.stopEvent();this.df.focus()}}if(a===c.ENTER){this.updateValue()}},setDate:function(a){this.df.setValue(a)},setTime:function(a){this.tf.setValue(a)},setSize:function(a,b){if(!a){return}if("below"===this.timePosition){this.df.setSize(a,b);this.tf.setSize(a,b);if(Ext.isIE){this.df.el.up("td").setWidth(a);this.tf.el.up("td").setWidth(a)}}else{this.df.setSize(a-this.timeWidth-4,b);this.tf.setSize(this.timeWidth,b);if(Ext.isIE){this.df.el.up("td").setWidth(a-this.timeWidth-4);this.tf.el.up("td").setWidth(this.timeWidth)}}},setValue:function(c){if(!c&&true===this.emptyToNow){this.setValue(new Date());return}else{if(!c){this.setDate("");this.setTime("");this.updateValue();return}}if("number"===typeof c){c=new Date(c)}else{if("string"===typeof c&&this.hiddenFormat){c=Date.parseDate(c,this.hiddenFormat)}}c=c?c:new Date(1970,0,1,0,0,0);var a,b;if(c instanceof Date){this.setDate(c);this.setTime(c);this.dateValue=new Date(c)}else{a=c.split(this.dtSeparator);this.setDate(a[0]);if(a[1]){if(a[2]){a[1]+=a[2]}this.setTime(a[1])}}this.updateValue()},setVisible:function(a){if(a){this.df.show();this.tf.show()}else{this.df.hide();this.tf.hide()}return this},show:function(){return this.setVisible(true)},hide:function(){return this.setVisible(false)},setActive:function(a,b){if(b){a.show();this.hiddenFormat="Y-m-d H:i:s";this.updateValue();return this}else{a.hide();this.hiddenFormat="Y-m-d";this.updateValue();return this}},updateDate:function(){var a=this.df.getValue();if(a){if(!(this.dateValue instanceof Date)){this.initDateValue();if(!this.tf.getValue()){this.setTime(this.dateValue)}}this.dateValue.setMonth(0);this.dateValue.setFullYear(a.getFullYear());this.dateValue.setMonth(a.getMonth(),a.getDate())}else{this.dateValue="";this.setTime("")}},updateTime:function(){var a=this.tf.getValue();if(a&&!(a instanceof Date)){a=Date.parseDate(a,this.tf.format)}if(a&&!this.df.getValue()){this.initDateValue();this.setDate(this.dateValue)}if(this.dateValue instanceof Date){if(a){this.dateValue.setHours(a.getHours());this.dateValue.setMinutes(a.getMinutes());this.dateValue.setSeconds(a.getSeconds())}else{this.dateValue.setHours(0);this.dateValue.setMinutes(0);this.dateValue.setSeconds(0)}}},updateHidden:function(){if(this.isRendered){var a=this.dateValue instanceof Date?this.dateValue.format(this.hiddenFormat):"";this.el.dom.value=a}},updateValue:function(){this.updateDate();this.updateTime();this.updateHidden();return},validate:function(){return this.df.validate()&&this.tf.validate()},renderer:function(c){var b=c.editor.dateFormat||Ext.ux.form.DateTime.prototype.dateFormat;b+=" "+(c.editor.timeFormat||Ext.ux.form.DateTime.prototype.timeFormat);var a=function(e){var d=Ext.util.Format.date(e,b);return d};return a}});Ext.reg("xdatetime",Ext.ux.form.DateTime);Date.prototype.getFirstDateOfWeek=function(b){if(typeof b==="undefined"){b=(Ext.DatePicker?Ext.DatePicker.prototype.startDay:0)}var a=this.getDay()-b;if(a<0){a+=7}return this.add(Date.DAY,-a)};Array.prototype.sortDates=function(){return this.sort(function(d,c){return d.getTime()-c.getTime()})};if(!Ext.util.EasterDate){Ext.util.EasterDate=function(e,h){if(typeof e==="undefined"){e=new Date().getFullYear()}e=parseInt(e,10);if(typeof h==="undefined"){h=0}h=parseInt(h,10);var c=e%19;var f=(19*c+24)%30;var g=f+(2*(e%4)+4*(e%7)+6*f+5)%7;if((g==35)||((g==34)&&(f==28)&&(c>10))){g-=7}var b=new Date(e,2,22);b.setTime(b.getTime()+86400000*g+86400000*h);return b}}Ext.namespace("Ext.ux","Ext.ux.form");Ext.ux.DatePickerPlus=Ext.extend(Ext.DatePicker,{version:"1.4",noOfMonth:1,noOfMonthPerRow:3,fillupRows:true,eventDates:function(a){return[]},styleDisabledDates:false,eventDatesSelectable:true,defaultEventDatesText:"",defaultEventDatesCls:"x-datepickerplus-eventdates",setEventDates:function(c,d){if(typeof d==="undefined"){d=true}this.edArray=[];for(var b=0,a=c.length;b<a;++b){if(Ext.isDate(c[b])){this.edArray.push({date:c[b],text:this.defaultEventDatesText,cls:this.defaultEventDatesCls})}else{if(c[b].date){c[b].date=this.jsonDate(c[b].date);this.edArray.push(c[b])}}}this.eventDates=function(e){return this.edArray};if(this.rendered&&d){this.eventDatesNumbered=this.convertCSSDatesToNumbers(this.eventDates(this.activeDate.getFullYear()));this.update(this.activeDate)}},eventDatesRE:false,eventDatesRECls:"",eventDatesREText:"",showWeekNumber:true,weekName:"Wk.",selectWeekText:"Click to select all days of this week",selectMonthText:"Click to select all weeks of this month",multiSelection:false,multiSelectByCTRL:true,selectedDates:[],prevNextDaysView:"mark",preSelectedDates:[],lastSelectedDate:false,markNationalHolidays:true,nationalHolidaysCls:"x-datepickerplus-nationalholidays",nationalHolidays:function(d){d=(typeof d==="undefined"?(this.lastRenderedYear?this.lastRenderedYear:new Date().getFullYear()):parseInt(d,10));var f=new Date(d,0,1).getDay();var h=new Date(d,1,1).getDay();var b=new Date(d,4,1).getDay();var g=new Date(d,8,1).getDay();var e=new Date(d,9,1).getDay();var a=new Date(d,10,1).getDay();var c=[{text:"New Year's Day",date:new Date(d,0,1)},{text:"Martin Luther King Day",date:new Date(d,0,(f>1?16+7-f:16-f))},{text:"Washington's Birthday",date:new Date(d,1,(h>1?16+7-h:16-h))},{text:"Memorial Day",date:new Date(d,4,(b==6?31:30-b))},{text:"Independence Day",date:new Date(d,6,4)},{text:"Labor Day",date:new Date(d,8,(g>1?2+7-g:2-g))},{text:"Columbus Day",date:new Date(d,9,(e>1?9+7-e:9-e))},{text:"Veterans Day",date:new Date(d,10,11)},{text:"Thanksgiving Day",date:new Date(d,10,(a>4?26+7-a:26-a))},{text:"Christmas Day",date:new Date(d,11,25)}];return c},markWeekends:true,weekendCls:"x-datepickerplus-weekends",weekendText:"",weekendDays:[6,0],useQuickTips:true,pageKeyWarp:1,maxSelectionDays:false,maxSelectionDaysTitle:"Datepicker",maxSelectionDaysText:"You can only select a maximum amount of %0 days",undoText:"Undo",stayInAllowedRange:true,summarizeHeader:false,resizable:false,renderOkUndoButtons:true,renderTodayButton:true,disablePartialUnselect:true,allowedDates:false,allowedDatesText:"",strictRangeSelect:false,displayMask:3,displayMaskText:"Please wait...",renderPrevNextButtons:true,renderPrevNextYearButtons:false,disableMonthPicker:false,nextYearText:"Next Year (Control+Up)",prevYearText:"Previous Year (Control+Down)",showActiveDate:false,shiftSpaceSelect:true,disabledLetter:false,allowMouseWheel:true,focus:Ext.emptyFn,initComponent:function(){Ext.ux.DatePickerPlus.superclass.initComponent.call(this);this.noOfMonthPerRow=this.noOfMonthPerRow>this.noOfMonth?this.noOfMonth:this.noOfMonthPerRow;this.addEvents("beforeyearchange","afteryearchange","beforemonthchange","aftermonthchange","beforemonthclick","beforeweekclick","beforedateclick","aftermonthclick","afterweekclick","afterdateclick","undo","beforemousewheel","beforemaxdays")},activeDateKeyNav:function(e){if(this.showActiveDate){this.activeDate=this.activeDate.add("d",e);var d=this.activeDateCell.split("#");var c=parseInt(d[0],10);var b=parseInt(d[1],10);var a=Ext.get(this.cellsArray[c].elements[b]);if((b+e>41&&c+1>=this.cellsArray.length)||(b+e<0&&c-1<0)){this.update(this.activeDate)}else{a.removeClass("x-datepickerplus-activedate");b+=e;if(b>41){b-=42;c++}else{if(b<0){b+=42;c--}}a=Ext.get(this.cellsArray[c].elements[b]);a.addClass("x-datepickerplus-activedate");this.activeDateCell=c+"#"+b}}},handleMouseWheel:function(c){if(this.fireEvent("beforemousewheel",this,c)!==false){var a=(this.activeDate?this.activeDate.getMonth():99);var d=(this.activeDate?this.activeDate.getFullYear():0);Ext.ux.DatePickerPlus.superclass.handleMouseWheel.call(this,c);var f=(this.activeDate?this.activeDate.getMonth():999);var b=(this.activeDate?this.activeDate.getFullYear():9999);if(a!=f){this.fireEvent("aftermonthchange",this,a,f)}if(d!=b){this.fireEvent("afteryearchange",this,d,b)}}},doDisabled:function(a){this.keyNav.setDisabled(a);if(this.renderPrevNextButtons){this.leftClickRpt.setDisabled(a);this.rightClickRpt.setDisabled(a)}if(this.renderPrevNextYearButtons){this.leftYearClickRpt.setDisabled(a);this.rightYearClickRpt.setDisabled(a)}if(this.todayBtn){this.todayKeyListener.setDisabled(a);this.todayBtn.setDisabled(a)}},onRender:function(p,H){if(this.noOfMonthPerRow===0){this.noOfMonthPerRow=1}if(this.fillupRows&&this.noOfMonthPerRow>1&&this.noOfMonth%this.noOfMonthPerRow!==0){this.noOfMonth+=(this.noOfMonthPerRow-(this.noOfMonth%this.noOfMonthPerRow))}var a=(Ext.isIE?" x-datepickerplus-ie":"");var u=['<table cellspacing="0"',(this.multiSelection?' class="x-date-multiselect'+a+'" ':(a!==""?'class="'+a+'" ':"")),">"];u.push("<tr>");var F=(Ext.isIE?'<img src="'+Ext.BLANK_IMAGE_URL+'" />':"");var t=(this.multiSelection?(this.useQuickTips?' ext:qtip="'+this.selectWeekText+'" ':' title="'+this.selectWeekText+'" '):"");var h=(this.markWeekends&&this.weekendText!==""?(this.useQuickTips?' ext:qtip="'+this.weekendText+'" ':' title="'+this.weekendText+'" '):"");var C=["<thead><tr>"];if(this.showWeekNumber){C.push('<th class="x-date-weeknumber-header"><a href="#" hidefocus="on" class="x-date-weeknumber" tabIndex="1"><em><span ',(this.multiSelection?(this.useQuickTips?' ext:qtip="'+this.selectMonthText+'" ':' title="'+this.selectMonthText+'" '):""),">"+this.weekName+"</span></em></a></th>")}var w=this.dayNames;for(var z=0;z<7;++z){var E=this.startDay+z;if(E>6){E=E-7}C.push("<th><span>",w[E].substr(0,1),"</span></th>")}C.push("</tr></thead><tbody><tr>");if(this.showWeekNumber){C.push('<td class="x-date-weeknumber-cell"><a href="#" hidefocus="on" class="x-date-weeknumber" tabIndex="1"><em><span ',t,"></span></em></a></td>")}for(var y=0;y<42;++y){if(y%7===0&&y>0){if(this.showWeekNumber){C.push('</tr><tr><td class="x-date-weeknumber-cell"><a href="#" hidefocus="on" class="x-date-weeknumber" tabIndex="1"><em><span ',t,"></span></em></a></td>")}else{C.push("</tr><tr>")}}C.push('<td class="x-date-date-cell"><a href="#" hidefocus="on" class="x-date-date" tabIndex="1"><em><span ',(this.weekendDays.indexOf((y+this.startDay)%7)!=-1?h:""),"></span></em></a></td>")}C.push("</tr></tbody></table></td></tr></table></td>");var e=C.join("");if(this.summarizeHeader&&this.noOfMonth>1){u.push('<td align="center" id="',this.id,'-summarize" colspan="',this.noOfMonthPerRow,'" class="x-date-middle x-date-pickerplus-middle"></td></tr>');u.push("<tr>")}for(var o=0,s=this.noOfMonth;o<s;++o){u.push('<td><table class="x-date-pickerplus',(o%this.noOfMonthPerRow===0?"":" x-date-monthtable"),(!this.prevNextDaysView?" x-date-pickerplus-prevnexthide":""),'" cellspacing="0"><tr>');if(o===0){u.push('<td class="x-date-left">');if(this.renderPrevNextButtons){u.push('<a class="npm" href="#" ',(this.useQuickTips?' ext:qtip="'+this.prevText+'" ':' title="'+this.prevText+'" '),"></a>")}if(this.renderPrevNextYearButtons){u.push('<a class="npy" href="#" ',(this.useQuickTips?' ext:qtip="'+this.prevYearText+'" ':' title="'+this.prevYearText+'" '),"></a>")}u.push("</td>")}else{if(o==this.noOfMonthPerRow-1){if(this.renderPrevNextButtons){u.push('<td class="x-date-dummy x-date-middle">',F,"</td>")}}}u.push("<td class='x-date-middle x-date-pickerplus-middle",(o===0&&!this.disableMonthPicker?" x-date-firstMonth":""),"' align='center'>");if(o>0||this.disableMonthPicker){u.push('<span id="',this.id,"-monthLabel",o,'"></span>')}u.push("</td>");if(o==this.noOfMonthPerRow-1){u.push('<td class="x-date-right">');if(this.renderPrevNextButtons){u.push('<a class="npm" href="#" ',(this.useQuickTips?' ext:qtip="'+this.nextText+'" ':' title="'+this.nextText+'" '),"></a>")}if(this.renderPrevNextYearButtons){u.push('<a class="npy" href="#" ',(this.useQuickTips?' ext:qtip="'+this.nextYearText+'" ':' title="'+this.nextYearText+'" '),"></a>")}u.push("</td>")}else{if(o===0){if(this.renderPrevNextButtons){u.push('<td class="x-date-dummy x-date-middle">',F,"</td>")}}}u.push("</tr><tr><td",(o===0||o==this.noOfMonthPerRow-1?' colspan="3" ':""),'><table class="x-date-inner" id="',this.id,"-inner-date",o,'" cellspacing="0">');u.push(e);if((o+1)%this.noOfMonthPerRow===0){u.push("</tr><tr>")}}u.push("</tr>");u.push("<tr><td",(this.noOfMonthPerRow>1?' colspan="'+this.noOfMonthPerRow+'"':""),' class="x-date-bottom" align="center"><div><table width="100%" cellpadding="0" cellspacing="0"><tr><td align="right" class="x-date-multiokbtn">',F,'</td><td align="center" class="x-date-todaybtn">',F,'</td><td align="left" class="x-date-multiundobtn">',F,"</td></tr></table></div></td></tr>");u.push('</table><div class="x-date-mp"></div>');var b=document.createElement("div");b.className="x-date-picker";b.innerHTML=u.join("");p.dom.insertBefore(b,H);this.el=Ext.get(b);this.eventEl=Ext.get(b.firstChild);if(this.renderPrevNextButtons){this.leftClickRpt=new Ext.util.ClickRepeater(this.el.child("td.x-date-left a.npm"),{handler:this.showPrevMonth,scope:this,preventDefault:true,stopDefault:true});this.rightClickRpt=new Ext.util.ClickRepeater(this.el.child("td.x-date-right a.npm"),{handler:this.showNextMonth,scope:this,preventDefault:true,stopDefault:true})}if(this.renderPrevNextYearButtons){this.leftYearClickRpt=new Ext.util.ClickRepeater(this.el.child("td.x-date-left a.npy"),{handler:this.showPrevYear,scope:this,preventDefault:true,stopDefault:true});this.rightYearClickRpt=new Ext.util.ClickRepeater(this.el.child("td.x-date-right a.npy"),{handler:this.showNextYear,scope:this,preventDefault:true,stopDefault:true})}if(this.allowMouseWheel){this.eventEl.on("mousewheel",this.handleMouseWheel,this)}this.keyNav=new Ext.KeyNav(this.eventEl,{"left":function(d){(!this.disabled&&d.ctrlKey&&(!this.disableMonthPicker||this.renderPrevNextButtons)?this.showPrevMonth():this.activeDateKeyNav(-1))},"right":function(d){(!this.disabled&&d.ctrlKey&&(!this.disableMonthPicker||this.renderPrevNextButtons)?this.showNextMonth():this.activeDateKeyNav(1))},"up":function(d){(!this.disabled&&d.ctrlKey&&(!this.disableMonthPicker||this.renderPrevNextYearButtons)?this.showNextYear():this.activeDateKeyNav(-7))},"down":function(d){(!this.disabled&&d.ctrlKey&&(!this.disableMonthPicker||this.renderPrevNextYearButtons)?this.showPrevYear():this.activeDateKeyNav(7))},"pageUp":function(d){if(!this.disabled){this.update(this.activeDate.add("mo",this.pageKeyWarp*(-1)))}},"pageDown":function(d){if(!this.disabled){this.update(this.activeDate.add("mo",this.pageKeyWarp))}},"enter":function(d){d.stopPropagation();if(!this.disabled){if(this.multiSelection){this.okClicked()}else{this.finishDateSelection(this.activeDate)}}return true},scope:this});if(!this.disableSingleDateSelection){this.eventEl.on("click",this.handleDateClick,this,{delegate:"a.x-date-date"})}if(this.multiSelection&&this.showWeekNumber){this.eventEl.on("click",this.handleWeekClick,this,{delegate:"a.x-date-weeknumber"})}this.cellsArray=[];this.textNodesArray=[];this.weekNumberCellsArray=[];this.weekNumberTextElsArray=[];this.weekNumberHeaderCellsArray=[];var g,f,B,c,r;for(var n=0,G=this.noOfMonth;n<G;++n){g=Ext.get(this.id+"-inner-date"+n).select("tbody td.x-date-date-cell");f=Ext.get(this.id+"-inner-date"+n).query("tbody td.x-date-date-cell span");this.cellsArray[n]=g;this.textNodesArray[n]=f;if(this.showWeekNumber){B=Ext.get(this.id+"-inner-date"+n).select("tbody td.x-date-weeknumber-cell");c=Ext.get(this.id+"-inner-date"+n).select("tbody td.x-date-weeknumber-cell span");this.weekNumberCellsArray[n]=B;this.weekNumberTextElsArray[n]=c;r=Ext.get(this.id+"-inner-date"+n).select("th.x-date-weeknumber-header");this.weekNumberHeaderCellsArray[n]=r}}if(!this.disableMonthPicker){this.monthPicker=this.el.down("div.x-date-mp");this.monthPicker.enableDisplayMode("block");this.mbtn=new Ext.Button({text:"&#160;",tooltip:this.monthYearText,renderTo:this.el.child("td.x-date-firstMonth",true)});this.mbtn.on("click",this.showMonthPickerPlus,this);this.mbtn.el.child("em").addClass("x-btn-arrow")}if(this.renderTodayButton||this.showToday){this.todayKeyListener=this.eventEl.addKeyListener(Ext.EventObject.SPACE,this.spaceKeyPressed,this);var D=new Date().dateFormat(this.format);this.todayBtn=new Ext.Button({renderTo:this.el.child("td.x-date-bottom .x-date-todaybtn",true),text:String.format(this.todayText,D),tooltip:String.format(this.todayTip,D),handler:this.selectToday,scope:this})}if(this.multiSelection&&this.renderOkUndoButtons){this.OKBtn=new Ext.Button({renderTo:this.el.child("td.x-date-bottom .x-date-multiokbtn",true),text:this.okText,handler:this.okClicked,scope:this});this.undoBtn=new Ext.Button({renderTo:this.el.child("td.x-date-bottom .x-date-multiundobtn",true),text:this.undoText,handler:function(){if(!this.disabled){this.fireEvent("undo",this,this.preSelectedDates);this.preSelectedDates=[];for(var m=0,d=this.selectedDates.length;m<d;++m){this.preSelectedDates.push(this.selectedDates[m].clearTime().getTime())}this.update(this.activeDate)}},scope:this})}if(Ext.isIE){this.el.repaint()}this.preSelectedDates=[];for(var q=0,A=this.selectedDates.length;q<A;++q){this.preSelectedDates.push(this.selectedDates[q].clearTime().getTime())}this.update(this.value)},showMonthPickerPlus:function(){if(!this.disabled){this.showMonthPicker()}},convertCSSDatesToNumbers:function(c){var d=[[],[],[]];for(var b=0,a=c.length;b<a;++b){d[0][b]=c[b].date.clearTime().getTime();d[1][b]=(c[b].text?c[b].text:this.defaultEventDatesText);d[2][b]=(c[b].cls?c[b].cls:this.defaultEventDatesCls)}return d},clearSelectedDates:function(a){if(typeof a==="undefined"){a=true}this.selectedDates=[];this.preSelectedDates=[];if(this.rendered&&a){this.update(this.activeDate)}},jsonDate:function(c){if(!Ext.isArray(c)){if(typeof c==="string"){return Date.parseDate(c.replace(/T/," "),"Y-m-d H:i:s")}}else{for(var b=0,a=c.length;b<a;b++){if(typeof c[b]==="string"){c[b]=Date.parseDate(c[b].replace(/T/," "),"Y-m-d H:i:s")}}}return c},setSelectedDates:function(e,g){if(typeof g==="undefined"){g=true}e=this.jsonDate(e);if(!Ext.isArray(e)){e=[e]}var f,c;for(var b=0,a=e.length;b<a;++b){f=e[b];c=f.clearTime().getTime();if(this.preSelectedDates.indexOf(c)==-1){this.preSelectedDates.push(c);this.selectedDates.push(f)}}if(this.rendered&&g){this.update(this.activeDate)}},setAllowedDates:function(a,b){if(typeof b==="undefined"){b=true}this.allowedDates=this.jsonDate(a);if(this.rendered&&b){this.update(this.activeDate)}},setMinDate:function(a){this.minDate=this.jsonDate(a);this.update(this.value,true)},setMaxDate:function(a){this.maxDate=this.jsonDate(a);this.update(this.value,true)},setDateLimits:function(a,b){this.minDate=this.jsonDate(a);this.maxDate=this.jsonDate(b);this.update(this.value,true)},update:function(Z,c,C){if(typeof C==="undefined"){C=false}if(typeof c==="undefined"){c=false}if(c){var s=this.activeDate;this.activeDate=null;Z=s}var y=(this.displayMask&&(isNaN(this.displayMask)||this.noOfMonth>this.displayMask)?true:false);if(!C&&y){this.el.mask(this.displayMaskText);this.update.defer(10,this,[Z,false,true]);return false}if(this.stayInAllowedRange&&(this.minDate||this.maxDate)){if(this.minDate&&(this.minDate.getFullYear()>Z.getFullYear()||(this.minDate.getMonth()>Z.getMonth()&&this.minDate.getFullYear()==Z.getFullYear()))){Z=new Date(this.minDate.getTime())}else{if(this.maxDate&&(this.maxDate.getFullYear()<Z.getFullYear()||(this.maxDate.getMonth()<Z.getMonth()&&this.maxDate.getFullYear()==Z.getFullYear()))){Z=new Date(this.maxDate.getTime())}}}var J=Z.getMonth();var U=(this.activeDate?this.activeDate.getMonth():J);var S=Z.getFullYear();var B=(this.activeDate?this.activeDate.getFullYear():S);if(U!=J){this.fireEvent("beforemonthchange",this,U,J)}if(B!=S){this.fireEvent("beforeyearchange",this,B,S)}this.activeDate=Z.clearTime();this.preSelectedCells=[];this.lastSelectedDateCell="";this.activeDateCell="";var aa=(this.lastSelectedDate?this.lastSelectedDate:0);var u=new Date().clearTime().getTime();var af=this.minDate?this.minDate.clearTime().getTime():Number.NEGATIVE_INFINITY;var A=this.maxDate?this.maxDate.clearTime().getTime():Number.POSITIVE_INFINITY;var P=this.disabledDatesRE;var I=this.disabledDatesText;var N=this.disabledDays?this.disabledDays.join(""):false;var b=this.disabledDaysText;var Q=this.eventDatesRE;var p=this.eventDatesRECls;var o=this.eventDatesREText;var h=this.allowedDatesText;var E=this.format;var ab=this.activeDate.getTime();this.todayMonthCell=false;this.todayDayCell=false;if(this.allowedDates){this.allowedDatesT=[];for(var V=0,ae=this.allowedDates.length;V<ae;++V){this.allowedDatesT.push(this.allowedDates[V].clearTime().getTime())}}var H=function(e,am,ap,ak){var an,aj=Ext.get(am),al=Ext.get(ap),ao=ak.getTime(),x=false,w;am.title="";am.firstChild.dateValue=ao;var ai=ak.getFullYear();if(e.lastRenderedYear!==ai){e.lastRenderedYear=ai;if(e.markNationalHolidays){e.nationalHolidaysNumbered=e.convertCSSDatesToNumbers(e.nationalHolidays(ai))}e.eventDatesNumbered=e.convertCSSDatesToNumbers(e.eventDates(ai))}if(ao<af){am.className=" x-date-disabled";x=e.minText}if(ao>A){am.className=" x-date-disabled";x=e.maxText}if(N){if(N.indexOf(ak.getDay())!=-1){x=b;am.className=" x-date-disabled"}}if(P&&E){w=ak.dateFormat(E);if(P.test(w)){x=I.replace("%0",w);am.className=" x-date-disabled"}}if(e.allowedDates&&e.allowedDatesT.indexOf(ao)==-1){am.className=" x-date-disabled";x=h}if(e.markWeekends&&e.weekendDays.indexOf(ak.getDay())!=-1&&!aj.hasClass("x-date-disabled")){aj.addClass(e.weekendCls)}if(!aj.hasClass("x-date-disabled")||e.styleDisabledDates){if(e.eventDatesNumbered[0].length>0){an=e.eventDatesNumbered[0].indexOf(ao);if(an!=-1){if(e.eventDatesNumbered[2][an]!==""){aj.addClass(e.eventDatesNumbered[2][an]+(e.eventDatesSelectable?"":"-disabled"));x=(e.eventDatesNumbered[1][an]!==""?e.eventDatesNumbered[1][an]:false)}}}if(Q&&E){w=ak.dateFormat(E);if(Q.test(w)){x=o.replace("%0",w);am.className=p}}}if(!aj.hasClass("x-date-disabled")){if(e.markNationalHolidays&&e.nationalHolidaysNumbered[0].length>0){an=e.nationalHolidaysNumbered[0].indexOf(ao);if(an!=-1){aj.addClass(e.nationalHolidaysCls);x=(e.nationalHolidaysNumbered[1][an]!==""?e.nationalHolidaysNumbered[1][an]:false)}}if(e.preSelectedDates.indexOf(ao)!=-1){aj.addClass("x-date-selected");e.preSelectedCells.push(am.firstChild.monthCell+"#"+am.firstChild.dayCell)}if(ao==aa){e.lastSelectedDateCell=am.firstChild.monthCell+"#"+am.firstChild.dayCell}}else{if(e.disabledLetter){ap.innerHTML=e.disabledLetter}}if(ao==u){aj.addClass("x-date-today");x=e.todayText}if(e.showActiveDate&&ao==ab&&e.activeDateCell===""){aj.addClass("x-datepickerplus-activedate");e.activeDateCell=am.firstChild.monthCell+"#"+am.firstChild.dayCell}if(x){if(e.useQuickTips){Ext.QuickTips.register({target:al,text:x})}else{am.title=x}}};var z,O,m,r,D,t,a,ad,F,W,Y,q,T,R,n,f,g,M;var G=[];for(var L=0,K=this.noOfMonth;L<K;++L){if(this.summarizeHeader&&this.noOfMonth>1&&(L===0||L==this.noOfMonth-1)){G.push(this.monthNames[Z.getMonth()]," ",Z.getFullYear());if(L===0){G.push(" - ")}}z=this.cellsArray[L].elements;O=this.textNodesArray[L];if((this.markNationalHolidays||this.eventDates.length>0)&&this.useQuickTips){for(var ac=0,X=O.length;ac<X;++ac){Ext.QuickTips.unregister(O[ac])}}m=Z.getDaysInMonth();r=Z.getFirstDateOfMonth();D=r.getDay()-this.startDay;if(D<=this.startDay){D+=7}t=Z.add("mo",-1);a=t.getDaysInMonth()-D;m+=D;ad=new Date(t.getFullYear(),t.getMonth(),a).clearTime();W=0;if(this.showWeekNumber){q=this.weekNumberCellsArray[L].elements;T=this.weekNumberTextElsArray[L].elements;R=new Date(ad);R.setDate(R.getDate()+7);n=this.weekNumberHeaderCellsArray[L].elements;n[0].firstChild.monthValue=Z.getMonth();n[0].firstChild.dateValue=R.getTime();n[0].firstChild.monthCell=L;n[0].firstChild.dayCell=0;while(W<q.length){T[W].innerHTML=R.getWeekOfYear();q[W].firstChild.dateValue=R.getTime();q[W].firstChild.monthCell=L;q[W].firstChild.dayCell=(W*7);R.setDate(R.getDate()+7);W++}W=0}for(;W<D;++W){O[W].innerHTML=(++a);z[W].firstChild.monthCell=L;z[W].firstChild.dayCell=W;ad.setDate(ad.getDate()+1);z[W].className="x-date-prevday";H(this,z[W],O[W],ad)}for(;W<m;++W){Y=W-D+1;O[W].innerHTML=(Y);z[W].firstChild.monthCell=L;z[W].firstChild.dayCell=W;ad.setDate(ad.getDate()+1);z[W].className="x-date-active";H(this,z[W],O[W],ad);if(ad.getTime()==u){this.todayMonthCell=L;this.todayDayCell=W}}var ah=0;for(;W<42;++W){O[W].innerHTML=(++ah);z[W].firstChild.monthCell=L;z[W].firstChild.dayCell=W;ad.setDate(ad.getDate()+1);z[W].className="x-date-nextday";H(this,z[W],O[W],ad)}if(L===0&&!this.disableMonthPicker){this.mbtn.setText(this.monthNames[Z.getMonth()]+" "+Z.getFullYear())}else{f=Ext.get(this.id+"-monthLabel"+L);f.update(this.monthNames[Z.getMonth()]+" "+Z.getFullYear())}Z=Z.add("mo",1);if(!this.internalRender){g=this.el.dom.firstChild;M=g.offsetWidth;this.el.setWidth(M+this.el.getBorderWidth("lr"));Ext.fly(g).setWidth(M);this.internalRender=true}}if(this.summarizeHeader&&this.noOfMonth>1){var ag=Ext.get(this.id+"-summarize");ag.update(G.join(""))}this.el.unmask();if(U!=J){this.fireEvent("aftermonthchange",this,U,J)}if(B!=S){this.fireEvent("afteryearchange",this,B,S)}},beforeDestroy:function(){if(this.rendered){this.keyNav.disable();this.keyNav=null;if(this.renderPrevNextButtons){Ext.destroy(this.leftClickRpt,this.rightClickRpt)}if(this.renderPrevNextYearButtons){Ext.destroy(this.leftYearClickRpt,this.rightYearClickRpt)}if(!this.disableMonthPicker){Ext.destroy(this.monthPicker,this.mbtn)}if(this.todayBtn){this.todayBtn.destroy()}if(this.OKBtn){this.OKBtn.destroy()}if(this.undoBtn){this.undoBtn.destroy()}this.eventEl.remove()}},handleWeekClick:function(r,u){if(!this.disabled){r.stopEvent();var p=new Date(u.dateValue).getFirstDateOfWeek(this.startDay),o=0,a,h,b;var m=u.monthCell;var f=u.dayCell;switch(u.parentNode.tagName.toUpperCase()){case"TH":o=42;a=u.monthValue;break;case"TD":o=7;break}if((o==42&&this.fireEvent("beforemonthclick",this,a,this.lastStateWasSelected)!==false)||(o==7&&this.fireEvent("beforeweekclick",this,p,this.lastStateWasSelected)!==false)){if(!Ext.EventObject.ctrlKey&&this.multiSelectByCTRL){this.removeAllPreselectedClasses()}b=true;if(this.disablePartialUnselect){var d=p;for(var g=0;g<o;++g){h=d.getMonth();if((o==7||h===a)&&this.preSelectedDates.indexOf(d.clearTime().getTime())==-1){b=false;break}d=d.add(Date.DAY,1)}}var s=false;var q=1;if(this.strictRangeSelect&&((this.preSelectedDates.indexOf(p.add(Date.DAY,-1).clearTime().getTime())==-1&&!b)||(this.preSelectedDates.indexOf(p.add(Date.DAY,-1).clearTime().getTime())!=-1&&b))){s=true;p=p.add(Date.DAY,o-1);q=-1}this.maxNotified=false;for(var n=0,c;n<o;++n){h=p.getMonth();c=(s?o-1-n:n);if(o==7||h===a){this.markDateAsSelected(p.clearTime().getTime(),true,m,f+c,b)}p=p.add(Date.DAY,q)}if(o==42){this.fireEvent("aftermonthclick",this,a,this.lastStateWasSelected)}else{this.fireEvent("afterweekclick",this,new Date(u.dateValue).getFirstDateOfWeek(this.startDay),this.lastStateWasSelected)}}}},markDateAsSelected:function(f,e,d,b,c){var h=Ext.get(this.cellsArray[d].elements[b]);if((h.hasClass("x-date-prevday")||h.hasClass("x-date-nextday"))&&this.prevNextDaysView!=="mark"){return false}if(this.multiSelection&&(Ext.EventObject.ctrlKey||e)){var a=new Date(f).add(Date.DAY,-1).clearTime().getTime();var g=new Date(f).add(Date.DAY,1).clearTime().getTime();if(this.preSelectedDates.indexOf(f)==-1){if(this.maxSelectionDays===this.preSelectedDates.length){if(!this.maxNotified){if(this.fireEvent("beforemaxdays",this)!==false){Ext.Msg.alert(this.maxSelectionDaysTitle,this.maxSelectionDaysText.replace(/%0/,this.maxSelectionDays))}this.maxNotified=true}return false}if(h.hasClass("x-date-disabled")){return false}if(this.strictRangeSelect&&this.preSelectedDates.indexOf(g)==-1&&this.preSelectedDates.indexOf(a)==-1&&this.preSelectedDates.length>0){return false}this.preSelectedDates.push(f);this.markSingleDays(d,b,false);this.markGhostDatesAlso(d,b,false);this.lastStateWasSelected=true}else{if(c&&(!this.strictRangeSelect||(this.strictRangeSelect&&((this.preSelectedDates.indexOf(g)==-1&&this.preSelectedDates.indexOf(a)!=-1)||(this.preSelectedDates.indexOf(g)!=-1&&this.preSelectedDates.indexOf(a)==-1))))){this.preSelectedDates.remove(f);this.markSingleDays(d,b,true);this.markGhostDatesAlso(d,b,true);this.lastStateWasSelected=false}}}else{this.removeAllPreselectedClasses();this.preSelectedDates=[f];this.preSelectedCells=[];this.markSingleDays(d,b,false);this.markGhostDatesAlso(d,b,false);this.lastStateWasSelected=true}this.lastSelectedDate=f;this.lastSelectedDateCell=d+"#"+b;if(this.multiSelection&&!this.renderOkUndoButtons){this.copyPreToSelectedDays()}return true},markSingleDays:function(c,b,a){if(!a){Ext.get(this.cellsArray[c].elements[b]).addClass("x-date-selected");this.preSelectedCells.push((c)+"#"+(b))}else{Ext.get(this.cellsArray[c].elements[b]).removeClass("x-date-selected");this.preSelectedCells.remove((c)+"#"+(b))}},markGhostDatesAlso:function(c,b,a){if(this.prevNextDaysView=="mark"){var e=Ext.get(this.cellsArray[c].elements[b]),d;if(e.hasClass("x-date-prevday")&&c>0){d=(5-Math.floor(b/7))*7;if(Ext.get(this.cellsArray[c-1].elements[b+d]).hasClass("x-date-nextday")){d-=7}this.markSingleDays(c-1,b+d,a)}else{if(e.hasClass("x-date-nextday")&&c<this.cellsArray.length-1){d=28;if(this.cellsArray[c].elements[b].firstChild.firstChild.firstChild.innerHTML!=this.cellsArray[c+1].elements[b-d].firstChild.firstChild.firstChild.innerHTML){d=35}this.markSingleDays(c+1,b-d,a)}else{if(e.hasClass("x-date-active")&&((b<14&&c>0)||(b>27&&c<this.cellsArray.length-1))){if(b<14){d=28;if(!Ext.get(this.cellsArray[c-1].elements[b+d]).hasClass("x-date-nextday")){d=35}if(b+d<42&&this.cellsArray[c].elements[b].firstChild.firstChild.firstChild.innerHTML==this.cellsArray[c-1].elements[b+d].firstChild.firstChild.firstChild.innerHTML){this.markSingleDays(c-1,b+d,a)}}else{d=28;if(!Ext.get(this.cellsArray[c+1].elements[b-d]).hasClass("x-date-prevday")){d=35}if(b-d>=0&&this.cellsArray[c].elements[b].firstChild.firstChild.firstChild.innerHTML==this.cellsArray[c+1].elements[b-d].firstChild.firstChild.firstChild.innerHTML){this.markSingleDays(c+1,b-d,a)}}}}}}},removeAllPreselectedClasses:function(){for(var c=0,b=this.preSelectedCells.length;c<b;++c){var a=this.preSelectedCells[c].split("#");Ext.get(this.cellsArray[a[0]].elements[a[1]]).removeClass("x-date-selected")}this.preSelectedDates=[];this.preSelectedCells=[]},handleDateClick:function(J,w){J.stopEvent();var a=Ext.fly(w.parentNode);var b=new Date(w.dateValue).getFirstDateOfWeek(this.startDay);var p=new Date(w.dateValue).getFirstDateOfMonth();if(!this.disabled&&w.dateValue&&!a.hasClass("x-date-disabled")&&!a.hasClass("x-datepickerplus-eventdates-disabled")&&this.fireEvent("beforedateclick",this,w)!==false){if((!a.hasClass("x-date-prevday")&&!a.hasClass("x-date-nextday"))||this.prevNextDaysView=="mark"){var D=Ext.EventObject;if((!D.ctrlKey&&this.multiSelectByCTRL)||D.shiftKey||!this.multiSelection){this.removeAllPreselectedClasses()}var s=(((!D.ctrlKey&&!this.multiSelectByCTRL)||D.shiftKey)&&this.multiSelection?true:false);if(D.shiftKey&&this.multiSelection&&this.lastSelectedDate&&this.selectionType!="week"&&this.selectionType!="month"){var M=this.lastSelectedDate;var h=w.dateValue;var o=(M<h?1:-1);var B=this.lastSelectedDateCell.split("#");var E=parseInt(B[0],10);var H=parseInt(B[1],10);var r,q=0,n=0;this.maxNotified=false;var y=this.activeDate.getFirstDateOfMonth().clearTime().getTime();var u=this.activeDate.add(Date.MONTH,this.noOfMonth-1).getLastDateOfMonth().clearTime().getTime();if(M<y||M>u){var C=this.minDate?this.minDate.clearTime().getTime():Number.NEGATIVE_INFINITY;var G=this.maxDate?this.maxDate.clearTime().getTime():Number.POSITIVE_INFINITY;var O=this.disabledDays?this.disabledDays.join(""):"";var L=this.disabledDatesRE;var I=this.format;var A=this.allowedDates?this.allowedDatesT:false;var K,f,c;while(M<y||M>u){K=new Date(M);f=false;if(L){c=K.dateFormat(I);f=L.test(c)}if(!(M<C)&&!(M>G)&&O.indexOf(K.getDay())==-1&&!f&&(!A||A.indexOf(M)!=-1)){if(this.maxSelectionDays===this.preSelectedDates.length){if(this.fireEvent("beforemaxdays",this)!==false){Ext.Msg.alert(this.maxSelectionDaysTitle,this.maxSelectionDaysText.replace(/%0/,this.maxSelectionDays))}break}this.preSelectedDates.push(M)}M=new Date(M).add(Date.DAY,o).clearTime().getTime()}E=(o>0?0:this.cellsArray.length-1);H=(o>0?0:41);r=Ext.get(this.cellsArray[E].elements[H]);while(r.hasClass("x-date-prevday")||r.hasClass("x-date-nextday")){r.addClass("x-date-selected");this.preSelectedCells.push((E)+"#"+(H));H+=o;r=Ext.get(this.cellsArray[E].elements[H])}}while((h-M)*o>0&&E>=0&&E<this.cellsArray.length){this.markDateAsSelected(M,s,E,H,true);M=new Date(M).add(Date.DAY,o).clearTime().getTime();r=Ext.get(this.cellsArray[E].elements[H]);if(r.hasClass("x-date-active")){q=0}else{q++}H+=o;if(H==42){E++;H=(q>=7?14:7)}else{if(H<0){E--;H=34;r=Ext.get(this.cellsArray[E].elements[H]);if(r.hasClass("x-date-nextday")||q==7){H=27}}}}}if(this.selectionType!="week"&&this.selectionType!="month"){this.markDateAsSelected(w.dateValue,s,w.monthCell,w.dayCell,true)}else{if(this.selectionType=="week"){amount=7;var m=w.monthCell;var z=w.dayCell;var N=false;var g=1;var x=Math.floor(z/7)*7;this.removeAllPreselectedClasses();for(var F=0;F<amount;F++){this.markDateAsSelected(b.clearTime().getTime(),true,m,x+F,0);b=b.add(Date.DAY,g)}}else{if(this.selectionType=="month"){amount=42;var m=w.monthCell;var z=w.dayCell;var N=false;var g=1;this.removeAllPreselectedClasses();for(var F=0;F<amount;F++){r=Ext.get(this.cellsArray[m].elements[F]);if(r.hasClass("x-date-active")){this.markDateAsSelected(p.clearTime().getTime(),true,m,F,0);p=p.add(Date.DAY,g)}}}}}this.finishDateSelection(new Date(w.dateValue))}}},copyPreToSelectedDays:function(){this.selectedDates=[];for(var b=0,a=this.preSelectedDates.length;b<a;++b){this.selectedDates.push(new Date(this.preSelectedDates[b]))}},okClicked:function(){this.copyPreToSelectedDays();this.selectedDates=this.selectedDates.sortDates();this.fireEvent("select",this,this.selectedDates)},spaceKeyPressed:function(f){var d=(((!Ext.EventObject.ctrlKey&&!this.multiSelectByCTRL)||Ext.EventObject.shiftKey)&&this.multiSelection?true:false);if(!this.disabled&&this.shiftSpaceSelect==Ext.EventObject.shiftKey&&this.showActiveDate){var c=this.activeDateCell.split("#");var b=parseInt(c[0],10);var a=parseInt(c[1],10);this.markDateAsSelected(this.activeDate.getTime(),d,b,a,true);this.finishDateSelection(this.activeDate)}else{this.selectToday()}},finishDateSelection:function(a){this.setValue(a);if(this.multiSelection){this.fireEvent("afterdateclick",this,a,this.lastStateWasSelected)}else{this.fireEvent("afterdateclick",this,a,this.lastStateWasSelected);this.fireEvent("select",this,this.value)}},selectToday:function(){if(!this.disabled&&this.todayBtn&&!this.todayBtn.disabled){var a=new Date().clearTime();var b=a.getTime();if(typeof this.todayMonthCell==="number"){this.markDateAsSelected(b,false,this.todayMonthCell,this.todayDayCell,true)}else{if(this.multiSelection){this.update(a)}}this.finishDateSelection(a)}},setValue:function(a){if(Ext.isArray(a)){this.selectedDates=[];this.preSelectedDates=[];this.setSelectedDates(a,true);a=a[0]}this.value=a.clearTime(true);if(this.el&&!this.multiSelection&&this.noOfMonth==1){this.update(this.value)}},setSize:Ext.emptyFn});Ext.reg("datepickerplus",Ext.ux.DatePickerPlus);if(parseInt(Ext.version.substr(0,1),10)>2){Ext.menu.DateItem=Ext.ux.DatePickerPlus;Ext.override(Ext.menu.DateMenu,{initComponent:function(){this.on("beforeshow",this.onBeforeShow,this);if(this.strict=(Ext.isIE7&&Ext.isStrict)){this.on("show",this.onShow,this,{single:true,delay:20})}var a=(this.initialConfig.usePickerPlus?Ext.ux.DatePickerPlus:Ext.DatePicker);Ext.apply(this,{plain:true,showSeparator:false,items:this.picker=new a(Ext.apply({internalRender:this.strict||!Ext.isIE,ctCls:"x-menu-date-item"},this.initialConfig))});Ext.menu.DateMenu.superclass.initComponent.call(this);this.relayEvents(this.picker,["select"]);this.on("select",this.menuHide,this);if(this.handler){this.on("select",this.handler,this.scope||this)}}})}else{Ext.menu.DateItem=function(a){if(a&&a.usePickerPlus){Ext.menu.DateItem.superclass.constructor.call(this,new Ext.ux.DatePickerPlus(a),a)}else{Ext.menu.DateItem.superclass.constructor.call(this,new Ext.DatePicker(a),a)}this.picker=this.component;this.addEvents("select");this.picker.on("render",function(b){b.getEl().swallowEvent("click");b.container.addClass("x-menu-date-item")});this.picker.on("select",this.onSelect,this)};Ext.extend(Ext.menu.DateItem,Ext.menu.Adapter,{onSelect:function(b,a){this.fireEvent("select",this,a,b);Ext.menu.DateItem.superclass.handleClick.call(this)}})}if(Ext.form&&Ext.form.DateField){Ext.ux.form.DateFieldPlus=Ext.extend(Ext.form.DateField,{usePickerPlus:true,showWeekNumber:true,noOfMonth:1,noOfMonthPerRow:3,nationalHolidaysCls:"x-datepickerplus-nationalholidays",markNationalHolidays:true,eventDates:function(a){return[]},eventDatesRE:false,eventDatesRECls:"",eventDatesREText:"",multiSelection:false,multiSelectionDelimiter:",",multiSelectByCTRL:true,fillupRows:true,markWeekends:true,weekendText:"",weekendCls:"x-datepickerplus-weekends",weekendDays:[6,0],useQuickTips:true,pageKeyWarp:1,maxSelectionDays:false,resizable:false,renderTodayButton:true,renderOkUndoButtons:true,tooltipType:"qtip",allowedDates:false,allowedDatesText:"",renderPrevNextButtons:true,renderPrevNextYearButtons:false,disableMonthPicker:false,showActiveDate:false,shiftSpaceSelect:true,disabledLetter:false,allowMouseWheel:true,summarizeHeader:false,stayInAllowedRange:true,disableSingleDateSelection:false,eventDatesSelectable:false,styleDisabledDates:false,prevNextDaysView:"mark",selectionType:"day",allowOtherMenus:false,onBeforeYearChange:function(a,c,b){this.fireEvent("beforeyearchange",this,c,b,a)},onAfterYearChange:function(a,c,b){this.fireEvent("afteryearchange",this,c,b,a)},onBeforeMonthChange:function(a,b,c){this.fireEvent("beforemonthchange",this,b,c,a)},onAfterMonthChange:function(a,b,c){this.fireEvent("aftermonthchange",this,b,c,a)},onAfterMonthClick:function(a,c,b){this.fireEvent("aftermonthclick",this,c,b,a)},onAfterWeekClick:function(b,a,c){this.fireEvent("afterweekclick",this,a,c,b)},onAfterDateClick:function(b,a,c){this.fireEvent("afterdateclick",this,a,c,b)},onBeforeMonthClick:function(a,c,b){this.fireEvent("beforemonthclick",this,c,b,a)},onBeforeWeekClick:function(b,a,c){this.fireEvent("beforeweekclick",this,a,c,b)},onBeforeDateClick:function(b,a){this.fireEvent("beforedateclick",this,a)},onBeforeMouseWheel:function(a,b){this.fireEvent("beforemousewheel",this,b,a)},onBeforeMaxDays:function(a){this.fireEvent("beforemaxdays",this,a)},onUndo:function(b,a){this.fireEvent("undo",this,a,b)},onTriggerClick:function(){if(this.disabled){return}if(!this.menu){this.menu=new Ext.menu.DateMenu({allowOtherMenus:this.allowOtherMenus,usePickerPlus:this.usePickerPlus,noOfMonth:this.noOfMonth,noOfMonthPerRow:this.noOfMonthPerRow,listeners:{"beforeyearchange":{fn:this.onBeforeYearChange,scope:this},"afteryearchange":{fn:this.onAfterYearChange,scope:this},"beforemonthchange":{fn:this.onBeforeMonthChange,scope:this},"aftermonthchange":{fn:this.onAfterMonthChange,scope:this},"afterdateclick":{fn:this.onAfterDateClick,scope:this},"aftermonthclick":{fn:this.onAfterMonthClick,scope:this},"afterweekclick":{fn:this.onAfterWeekClick,scope:this},"beforedateclick":{fn:this.onBeforeDateClick,scope:this},"beforemonthclick":{fn:this.onBeforeMonthClick,scope:this},"beforeweekclick":{fn:this.onBeforeWeekClick,scope:this},"beforemousewheel":{fn:this.onBeforeMouseWheel,scope:this},"beforemaxdays":{fn:this.onBeforeMaxDays,scope:this},"undo":{fn:this.onUndo,scope:this}}});this.relayEvents(this.menu,["select"])}if(this.menu.isVisible()){this.menu.hide();return}if(this.disabledDatesRE){this.ddMatch=this.disabledDatesRE}if(typeof this.minDate=="string"){this.minDate=this.parseDate(this.minDate)}if(typeof this.maxDate=="string"){this.maxDate=this.parseDate(this.maxDate)}Ext.apply(this.menu.picker,{minDate:this.minValue||this.minDate,maxDate:this.maxValue||this.maxDate,disabledDatesRE:this.ddMatch,disabledDatesText:this.disabledDatesText,disabledDays:this.disabledDays,disabledDaysText:this.disabledDaysText,showToday:this.showToday,format:this.format,minText:String.format(this.minText,this.formatDate(this.minValue||this.minDate)),maxText:String.format(this.maxText,this.formatDate(this.maxValue||this.maxDate)),showWeekNumber:this.showWeekNumber,nationalHolidaysCls:this.nationalHolidaysCls,markNationalHolidays:this.markNationalHolidays,multiSelectByCTRL:this.multiSelectByCTRL,fillupRows:this.fillupRows,multiSelection:this.multiSelection,markWeekends:this.markWeekends,weekendText:this.weekendText,weekendCls:this.weekendCls,weekendDays:this.weekendDays,useQuickTips:this.useQuickTips,eventDates:this.eventDates,eventDatesRE:this.eventDatesRE,eventDatesRECls:this.eventDatesRECls,eventDatesREText:this.eventDatesREText,pageKeyWarp:this.pageKeyWarp,maxSelectionDays:this.maxSelectionDays,resizable:this.resizable,renderTodayButton:this.renderTodayButton,renderOkUndoButtons:this.renderOkUndoButtons,allowedDates:this.allowedDates,allowedDatesText:this.allowedDatesText,renderPrevNextButtons:this.renderPrevNextButtons,renderPrevNextYearButtons:this.renderPrevNextYearButtons,disableMonthPicker:this.disableMonthPicker,showActiveDate:this.showActiveDate,shiftSpaceSelect:this.shiftSpaceSelect,disabledLetter:this.disabledLetter,allowMouseWheel:this.allowMouseWheel,summarizeHeader:this.summarizeHeader,stayInAllowedRange:this.stayInAllowedRange,disableSingleDateSelection:this.disableSingleDateSelection,eventDatesSelectable:this.eventDatesSelectable,styleDisabledDates:this.styleDisabledDates,prevNextDaysView:this.prevNextDaysView,startDay:this.startDay,selectionType:this.selectionType});if(this.menuEvents){this.menuEvents("on")}else{this.menu.on(Ext.apply({},this.menuListeners,{scope:this}))}if(typeof this.defaultValue=="string"){this.defaultValue=Date.parseDate(this.defaultValue,this.format)}this.menu.picker.setValue(this.getValue()||this.defaultValue||new Date());this.menu.show(this.el,"tl-bl?");this.menu.focus()},setValue:function(a){var g=this;if(!Ext.isArray(a)&&a.toString().match(/,/)){a=a.toString().split(",")}if(Ext.isArray(a)){var d=[];for(var f=0,b=a.length;f<b;++f){d.push(g.formatDate(a[f]))}var c=d.join(this.multiSelectionDelimiter);Ext.form.DateField.superclass.setValue.call(this,c)}else{Ext.form.DateField.superclass.setValue.call(this,this.formatDate(this.parseDate(a)))}},validateValue:function(c){if(this.multiSelection){var g=this;var a=c.split(this.multiSelectionDelimiter);var f=true;for(var d=0,b=a.length;d<b;++d){if(!Ext.ux.form.DateFieldPlus.superclass.validateValue.call(g,a[d])){f=false}}return f}else{return Ext.ux.form.DateFieldPlus.superclass.validateValue.call(this,c)}},getValue:function(){if(this.multiSelection){var c=Ext.form.DateField.superclass.getValue.call(this);var g=this;var a=c.split(this.multiSelectionDelimiter);var f=[];for(var d=0,b=a.length;d<b;++d){var h=g.parseDate(a[d]);if(h){f.push(h)}}return(f.length>0?f:"")}else{return Ext.ux.form.DateFieldPlus.superclass.getValue.call(this)}},beforeBlur:function(){if(this.multiSelection){this.setValue(this.getRawValue().split(this.multiSelectionDelimiter))}else{var a=this.parseDate(this.getRawValue());if(a){this.setValue(a)}}},submitFormat:"d/m/Y",submitFormatAddon:"-format",onRender:function(){Ext.ux.form.DateFieldPlus.superclass.onRender.apply(this,arguments);var a=this.name||this.el.dom.name||(this.id+this.submitFormatAddon);if(a==this.id){a+=this.submitFormatAddon}this.hiddenField=this.el.insertSibling({tag:"input",type:"hidden",name:a,value:this.formatHiddenDate(this.parseDate(this.value))});this.hiddenName=a;this.el.dom.removeAttribute("name");this.el.on({keyup:{scope:this,fn:this.updateHidden},blur:{scope:this,fn:this.updateHidden}});this.setValue=this.setValue.createSequence(this.updateHidden);if(this.tooltip){if(typeof this.tooltip=="object"){Ext.QuickTips.register(Ext.apply({target:this.trigger},this.tooltip))}else{this.trigger.dom[this.tooltipType]=this.tooltip}}function b(c){var d=/([^?]*\?)(.*)/.exec(c);var e=Ext.urlDecode(d[2],true);return d[1]+Ext.urlEncode(e)}this.on("select",function(d,c){var f=this.hiddenField.dom.value;if(f&&f!="-"&&this.url){var e=Ext.urlAppend(document.location.href,this.url+f);document.location.href=b(e)}},this)},onDisable:function(){Ext.ux.form.DateFieldPlus.superclass.onDisable.apply(this,arguments);if(this.hiddenField){this.hiddenField.dom.setAttribute("disabled","disabled")}},onEnable:function(){Ext.ux.form.DateFieldPlus.superclass.onEnable.apply(this,arguments);if(this.hiddenField){this.hiddenField.dom.removeAttribute("disabled")}},formatHiddenDate:function(a){return Ext.isDate(a)?Ext.util.Format.date(a,this.submitFormat):a},formatMultiHiddenDate:function(a){var g=this,d=[],c;for(var f=0,b=a.length;f<b;++f){d.push(g.formatHiddenDate(a[f]))}if(this.selectionType=="day"){var c=d.join(this.multiSelectionDelimiter)}else{var c=d[0]+"-"+d[d.length-1]}this.hiddenField.dom.value=c},updateHidden:function(a){if(Ext.isArray(a)){this.formatMultiHiddenDate(a)}else{var b=this.getValue();if(Ext.isArray(b)){this.formatMultiHiddenDate(b)}else{this.hiddenField.dom.value=this.formatHiddenDate(b)}}}});Ext.reg("datefieldplus",Ext.ux.form.DateFieldPlus)}Ext.YearPicker=Ext.extend(Ext.Component,{okText:" OK ",todayTip:"{0} (Spacebar)",minText:"This date is before the minimum date",maxText:"This date is after the maximum date",format:"m/01/y",disabledDaysText:"Disabled",disabledDatesText:"Disabled",constrainToViewport:true,monthNames:Date.monthNames,dayNames:Date.dayNames,nextText:"Next Month (Control+Right)",prevText:"Previous Month (Control+Left)",monthYearText:"Choose a month (Control+Up/Down to move years)",initComponent:function(){Ext.YearPicker.superclass.initComponent.call(this);this.value=this.value?this.value.clearTime():new Date().clearTime();this.addEvents("select");if(this.handler){this.on("select",this.handler,this.scope||this)}},setMinDate:function(a){this.minDate=a;this.update(this.value,true)},setMaxDate:function(a){this.maxDate=a;this.update(this.value,true)},setValue:function(b){var a=this.value;this.value=b.clearTime(true);if(this.el){this.update(this.value)}},getValue:function(){return this.value},focus:function(){if(this.el){this.update(this.activeDate)}},onRender:function(c,b){var a=['<table class="x-month-mp" border="0" cellspacing="0">'];for(var d=0;d<6;d++){a.push(d==0?'<td class="x-date-mp-ybtn" align="center"><a class="x-date-mp-prev"></a></td><td class="x-date-mp-ybtn" align="center"><a class="x-date-mp-next"></a></td></tr>':'<td class="x-date-mp-year"><a href="#"></a></td><td class="x-date-mp-year"><a href="#"></a></td></tr>')}a.push('<tr><td class="x-date-bottom" colspan="4" style="text-align:center;"></td></tr></table>');var e=document.createElement("div");e.className="x-date-picker";e.innerHTML=a.join("");c.dom.insertBefore(e,b);this.el=Ext.get(e);this.yearPicker=this.el.down("table.x-month-mp");this.yearPicker.enableDisplayMode("block");this.mpMonths=this.yearPicker.select("td.x-date-mp-month");this.mpYears=this.yearPicker.select("td.x-date-mp-year");this.mpMonths.each(function(f,g,h){h+=1;if((h%2)==0){f.dom.xmonth=5+Math.round(h*0.5)}else{f.dom.xmonth=Math.round((h-1)*0.5)}});if(Ext.isIE){this.el.repaint()}this.yearPicker.on("click",this.onMonthClick,this);this.yearPicker.on("dblclick",this.onMonthDblClick,this);this.okBtn=new Ext.Button({renderTo:this.el.child("td.x-date-bottom",true),text:this.okText,handler:this.selectOk,scope:this});this.mpSelMonth=(this.activeDate||this.value).getMonth();this.mpSelYear=(this.activeDate||this.value).getFullYear();this.updateMPMonth();this.updateMPYear();this.update(this.value);this.on("select",function(g,f){var h=this.getValue();h=this.myFormatDate(h);if(h&&h!="-"&&this.url){document.location.href=this.url+h}},this)},updateMPYear:function(){this.mpyear=this.mpSelYear;var c=this.mpYears.elements;for(var b=1;b<=10;b++){var d=c[b-1],a;if((b%2)==0){a=this.mpSelYear+Math.round(b*0.5);d.firstChild.innerHTML=a;d.xyear=a}else{a=this.mpSelYear-(5-Math.round(b*0.5));d.firstChild.innerHTML=a;d.xyear=a}this.mpYears.item(b-1)[a==this.mpSelYear?"addClass":"removeClass"]("x-date-mp-sel");if((this.maxDate&&(this.maxDate.getFullYear()<a))||(this.minDate&&(this.minDate.getFullYear()>a))){Ext.get(c[b-1].firstChild).addClass("x-date-mp-disabled")}else{Ext.get(c[b-1].firstChild).removeClass("x-date-mp-disabled")}}},updateMPMonth:function(){var d=this.mpSelMonth;var c=this.mpSelYear;var b=this.maxDate;var a=this.minDate;this.mpMonths.each(function(e,f,g){e[e.dom.xmonth==d?"addClass":"removeClass"]("x-date-mp-sel");if((b&&(b.getFullYear()<c))||(b&&(b.getFullYear()==c)&&(b.getMonth()<e.dom.xmonth))||(a&&(a.getFullYear()>c))||(a&&(a.getFullYear()==c)&&(a.getMonth()>e.dom.xmonth))){Ext.get(e.dom.firstChild).addClass("x-date-mp-disabled")}else{Ext.get(e.dom.firstChild).removeClass("x-date-mp-disabled")}});if((b&&(b.getFullYear()<c))||(b&&(b.getFullYear()==c)&&(b.getMonth()<d))||(a&&(a.getFullYear()>c))||(a&&(a.getFullYear()==c)&&(a.getMonth()>d))){this.okBtn.disable()}else{this.okBtn.enable()}},onMonthClick:function(d,b){if(Ext.fly(b).hasClass("x-date-mp-disabled")){return}d.stopEvent();var c=new Ext.Element(b),a;if(a=c.up("td.x-date-mp-month",2)){this.mpMonths.removeClass("x-date-mp-sel");a.addClass("x-date-mp-sel");this.mpSelMonth=a.dom.xmonth;this.updateMPMonth()}else{if(a=c.up("td.x-date-mp-year",2)){this.mpYears.removeClass("x-date-mp-sel");a.addClass("x-date-mp-sel");this.mpSelYear=a.dom.xyear;this.updateMPMonth()}else{if(c.is("a.x-date-mp-prev")){this.mpSelYear=this.mpyear-10;this.mpYears.removeClass("x-date-mp-sel");this.updateMPYear();this.updateMPMonth()}else{if(c.is("a.x-date-mp-next")){this.mpSelYear=this.mpyear+10;this.mpYears.removeClass("x-date-mp-sel");this.updateMPYear();this.updateMPMonth()}}}}},onMonthDblClick:function(d,b){if(Ext.fly(b).hasClass("x-date-mp-disabled")){return}d.stopEvent();var c=new Ext.Element(b),a;if(a=c.up("td.x-date-mp-month",2)){this.mpSelMonth=a.dom.xmonth;this.selectOk()}else{if(a=c.up("td.x-date-mp-year",2)){this.mpSelYear=a.dom.xyear;this.selectOk()}}},selectOk:function(){var a=new Date(this.mpSelYear,this.mpSelMonth,1);if(a.getMonth()!=this.mpSelMonth){a=new Date(this.mpSelYear,this.mpSelMonth,1).getLastDateOfMonth()}this.update(a);this.setValue(a);this.fireEvent("select",this,this.value)},update:function(c){this.activeDate=c;if(!this.internalRender){var a=this.el.dom.firstChild;var b=a.offsetWidth;this.el.setWidth(b+this.el.getBorderWidth("lr"));Ext.fly(a).setWidth(b);this.internalRender=true;if(Ext.isOpera&&!this.secondPass){a.rows[0].cells[1].style.width=(b-(a.rows[0].cells[0].offsetWidth+a.rows[0].cells[2].offsetWidth))+"px";this.secondPass=true;this.update.defer(10,this,[c])}}},beforeDestroy:function(){if(this.rendered){Ext.destroy(this.mbtn,this.okBtn)}},myFormatDate:function(a){return Ext.isDate(a)?Ext.util.Format.date(a,"Y"):a}});Ext.reg("yearpicker",Ext.YearPicker);Ext.menu.YearMenu=function(a){Ext.menu.YearMenu.superclass.constructor.call(this,a);this.plain=true;var b=new Ext.menu.YearItem(a);this.add(b.picker);this.picker=b.picker;this.relayEvents(b,["select"])};Ext.extend(Ext.menu.YearMenu,Ext.menu.Menu,{cls:"x-date-menu",beforeDestroy:function(){this.picker.destroy()}});Ext.menu.YearItem=function(a){Ext.menu.YearItem.superclass.constructor.call(this,a);this.picker=new Ext.YearPicker(a);this.addEvents("select");this.picker.on("render",function(b){b.getEl().swallowEvent("click");b.container.addClass("x-menu-date-item")});this.picker.on("select",this.onSelect,this)};Ext.extend(Ext.menu.YearItem,Ext.menu.Item,{onSelect:function(b,a){this.fireEvent("select",this,a,b)}});Ext.form.YearField=Ext.extend(Ext.form.TriggerField,{format:"Y",altFormats:"m/Y|m-Y|mY|m/01/Y|m-01-Y|m01Y|m/d/Y|n/j/Y|n/j/y|m/j/y|n/d/y|m/j/Y|n/d/Y|m-d-y|m-d-Y|m/d|m-d|md|mdy|mdY|d|Y-m-d",disabledDaysText:"Disabled",disabledDatesText:"Disabled",minText:"The date in this field must be equal to or after {0}",maxText:"The date in this field must be equal to or before {0}",invalidText:"{0} is not a valid date - it must be in the format {1}",triggerClass:"x-form-date-trigger",defaultAutoCreate:{tag:"input",type:"text",size:"10",autocomplete:"off"},initComponent:function(){Ext.form.YearField.superclass.initComponent.call(this);if(typeof this.minValue=="string"){this.minValue=this.parseDate(this.minValue)}if(typeof this.maxValue=="string"){this.maxValue=this.parseDate(this.maxValue)}this.ddMatch=null},setMinValue:function(a){this.minValue=(typeof a=="string"?this.parseDate(a):a);if(this.menu){this.menu.picker.setMinDate(this.minValue)}},setMaxValue:function(a){this.maxValue=(typeof a=="string"?this.parseDate(a):a);if(this.menu){this.menu.picker.setMaxDate(this.maxValue)}},validateValue:function(e){e=this.formatDate(e);if(!Ext.form.YearField.superclass.validateValue.call(this,e)){return false}if(e.length<1){return true}var c=e;e=this.parseDate(e);if(!e){this.markInvalid(String.format(this.invalidText,c,this.format));return false}var f=e.getTime();if(this.minValue&&f<this.minValue.getTime()){this.markInvalid(String.format(this.minText,this.formatDate(this.minValue)));return false}if(this.maxValue&&f>this.maxValue.getTime()){this.markInvalid(String.format(this.maxText,this.formatDate(this.maxValue)));return false}if(this.disabledDays){var a=e.getDay();for(var b=0;b<this.disabledDays.length;b++){if(a===this.disabledDays[b]){this.markInvalid(this.disabledDaysText);return false}}}var d=this.formatDate(e);if(this.ddMatch&&this.ddMatch.test(d)){this.markInvalid(String.format(this.disabledDatesText,d));return false}return true},validateBlur:function(){return !this.menu||!this.menu.isVisible()},getValue:function(){return this.parseDate(Ext.form.YearField.superclass.getValue.call(this))||""},setValue:function(a){Ext.form.YearField.superclass.setValue.call(this,this.formatDate(this.parseDate(a)))},parseDate:function(d){if(!d||Ext.isDate(d)){return d}var b=Date.parseDate(d,this.format);if(!b&&this.altFormats){if(!this.altFormatsArray){this.altFormatsArray=this.altFormats.split("|")}for(var c=0,a=this.altFormatsArray.length;c<a&&!b;c++){b=Date.parseDate(d,this.altFormatsArray[c])}}return b},onDestroy:function(){if(this.menu){this.menu.destroy()}if(this.wrap){this.wrap.remove()}Ext.form.YearField.superclass.onDestroy.call(this)},formatDate:function(a){return Ext.isDate(a)?a.dateFormat(this.format):a},menuListeners:{select:function(a,b){this.setValue(b);this.fireEvent("select",this,b)},show:function(){this.onFocus()},hide:function(){this.focus.defer(10,this);var a=this.menuListeners;this.menu.un("select",a.select,this);this.menu.un("show",a.show,this);this.menu.un("hide",a.hide,this)}},onTriggerClick:function(){if(this.disabled){return}if(this.menu==null){this.menu=new Ext.menu.YearMenu()}Ext.apply(this.menu.picker,{minDate:this.minValue,maxDate:this.maxValue,disabledDatesRE:this.ddMatch,disabledDatesText:this.disabledDatesText,disabledDays:this.disabledDays,disabledDaysText:this.disabledDaysText,format:this.format,showToday:this.showToday,minText:String.format(this.minText,this.formatDate(this.minValue)),maxText:String.format(this.maxText,this.formatDate(this.maxValue)),url:this.url});this.menu.on(Ext.apply({},this.menuListeners,{scope:this}));this.menu.picker.setValue(this.getValue()||new Date());this.menu.show(this.el,"tl-bl?")},beforeBlur:function(){var a=this.parseDate(this.getRawValue());if(a){this.setValue(a)}}});Ext.reg("yearfield",Ext.form.YearField);Ext.ux.DDView=function(b){if(!b.itemSelector){var a=b.tpl;if(this.classRe.test(a)){b.tpl=a.replace(this.classRe,"class=$1x-combo-list-item $2$1")}else{b.tpl=a.replace(this.tagRe,'$1 class="x-combo-list-item" $2')}b.itemSelector=".x-combo-list-item"}Ext.ux.DDView.superclass.constructor.call(this,Ext.apply(b,{border:false}))};Ext.extend(Ext.ux.DDView,Ext.DataView,{sortDir:"ASC",isFormField:true,classRe:/class=(['"])(.*)\1/,tagRe:/(<\w*)(.*?>)/,reset:Ext.emptyFn,clearInvalid:Ext.form.Field.prototype.clearInvalid,afterRender:function(){Ext.ux.DDView.superclass.afterRender.call(this);if(this.dragGroup){this.setDraggable(this.dragGroup.split(","))}if(this.dropGroup){this.setDroppable(this.dropGroup.split(","))}if(this.deletable){this.setDeletable()}this.isDirtyFlag=false;this.addEvents("drop")},validate:function(){return true},destroy:function(){this.purgeListeners();this.getEl().removeAllListeners();this.getEl().remove();if(this.dragZone){if(this.dragZone.destroy){this.dragZone.destroy()}}if(this.dropZone){if(this.dropZone.destroy){this.dropZone.destroy()}}},getName:function(){return this.name},setValue:function(a){if(!this.store){throw"DDView.setValue(). DDView must be constructed with a valid Store"}var b={};b[this.store.reader.meta.root]=a?[].concat(a):[];this.store.proxy=new Ext.data.MemoryProxy(b);this.store.load()},getValue:function(){var a="(";this.store.each(function(b){a+=b.id+","});return a.substr(0,a.length-1)+")"},getIds:function(){var b=0,a=new Array(this.store.getCount());this.store.each(function(c){a[b++]=c.id});return a},isDirty:function(){return this.isDirtyFlag},getTargetFromEvent:function(b){var a=b.getTarget();while((a!==null)&&(a.parentNode!=this.el.dom)){a=a.parentNode}if(!a){a=this.el.dom.lastChild||this.el.dom}return a},getDragData:function(d){var c=this.findItemFromChild(d.getTarget());if(c){if(!this.isSelected(c)){delete this.ignoreNextClick;this.onItemClick(c,this.indexOf(c),d);this.ignoreNextClick=true}var b={sourceView:this,viewNodes:[],records:[],copy:this.copy||(this.allowCopy&&d.ctrlKey)};if(this.getSelectionCount()==1){var a=this.getSelectedIndexes()[0];var f=this.getNode(a);b.viewNodes.push(b.ddel=f);b.records.push(this.store.getAt(a));b.repairXY=Ext.fly(f).getXY()}else{b.ddel=document.createElement("div");b.ddel.className="multi-proxy";this.collectSelection(b)}return b}return false},getRepairXY:function(a){return this.dragData.repairXY},collectSelection:function(b){b.repairXY=Ext.fly(this.getSelectedNodes()[0]).getXY();if(this.preserveSelectionOrder===true){Ext.each(this.getSelectedIndexes(),function(c){var e=this.getNode(c);var d=e.cloneNode(true);d.id=Ext.id();b.ddel.appendChild(d);b.records.push(this.store.getAt(c));b.viewNodes.push(e)},this)}else{var a=0;this.store.each(function(d){if(this.isSelected(a)){var e=this.getNode(a);var c=e.cloneNode(true);c.id=Ext.id();b.ddel.appendChild(c);b.records.push(this.store.getAt(a));b.viewNodes.push(e)}a++},this)}},setDraggable:function(a){if(a instanceof Array){Ext.each(a,this.setDraggable,this);return}if(this.dragZone){this.dragZone.addToGroup(a)}else{this.dragZone=new Ext.dd.DragZone(this.getEl(),{containerScroll:true,ddGroup:a});if(!this.multiSelect){this.singleSelect=true}this.dragZone.getDragData=this.getDragData.createDelegate(this);this.dragZone.getRepairXY=this.getRepairXY;this.dragZone.onEndDrag=this.onEndDrag}},setDroppable:function(a){if(a instanceof Array){Ext.each(a,this.setDroppable,this);return}if(this.dropZone){this.dropZone.addToGroup(a)}else{this.dropZone=new Ext.dd.DropZone(this.getEl(),{owningView:this,containerScroll:true,ddGroup:a});this.dropZone.getTargetFromEvent=this.getTargetFromEvent.createDelegate(this);this.dropZone.onNodeEnter=this.onNodeEnter.createDelegate(this);this.dropZone.onNodeOver=this.onNodeOver.createDelegate(this);this.dropZone.onNodeOut=this.onNodeOut.createDelegate(this);this.dropZone.onNodeDrop=this.onNodeDrop.createDelegate(this)}},getDropPoint:function(g,o,d){if(o==this.el.dom){return"above"}var f=Ext.lib.Dom.getY(o),a=f+o.offsetHeight;var m=f+(a-f)/2;var h=Ext.lib.Event.getPageY(g);if(h<=m){return"above"}else{return"below"}},isValidDropPoint:function(b,e,a){if(!a.viewNodes||(a.viewNodes.length!=1)){return true}var c=a.viewNodes[0];if(c==e){return false}if((b=="below")&&(e.nextSibling==c)){return false}if((b=="above")&&(e.previousSibling==c)){return false}return true},onNodeEnter:function(d,a,c,b){if(this.highlightColor&&(b.sourceView!=this)){this.el.highlight(this.highlightColor)}return false},onNodeOver:function(h,a,g,d){var b=this.dropNotAllowed;var f=this.getDropPoint(g,h,a);if(this.isValidDropPoint(f,h,d)){if(this.appendOnly||this.sortField){return"x-tree-drop-ok-below"}if(f){var c;if(f=="above"){b=h.previousSibling?"x-tree-drop-ok-between":"x-tree-drop-ok-above";c="x-view-drag-insert-above"}else{b=h.nextSibling?"x-tree-drop-ok-between":"x-tree-drop-ok-below";c="x-view-drag-insert-below"}if(this.lastInsertClass!=c){Ext.fly(h).replaceClass(this.lastInsertClass,c);this.lastInsertClass=c}}}return b},onNodeOut:function(d,a,c,b){this.removeDropIndicators(d)},onNodeDrop:function(c,o,h,f){if(this.fireEvent("drop",this,c,o,h,f)===false){return false}var p=this.getDropPoint(h,c,o);var d=(this.appendOnly||(c==this.el.dom))?this.store.getCount():c.viewIndex;if(p=="below"){d++}if(f.sourceView==this){if(p=="below"){if(f.viewNodes[0]==c){f.viewNodes.shift()}}else{if(f.viewNodes[f.viewNodes.length-1]==c){f.viewNodes.pop()}}if(!f.viewNodes.length){return false}if(d>this.store.indexOf(f.records[0])){d--}}if(f.node instanceof Ext.tree.TreeNode){var a=f.node.getOwnerTree().recordFromNode(f.node);if(a){f.records=[a]}}if(!f.records){alert("Programming problem. Drag data contained no Records");return false}for(var g=0;g<f.records.length;g++){var a=f.records[g];var b=this.store.getById(a.id);if(b&&(o!=this.dragZone)){if(!this.allowDup&&!this.allowTrash){Ext.fly(this.getNode(this.store.indexOf(b))).frame("red",1);return true}var m=new Ext.data.Record();a.id=m.id;delete m}if(f.copy){this.store.insert(d++,a.copy())}else{if(f.sourceView){f.sourceView.isDirtyFlag=true;f.sourceView.store.remove(a)}if(!this.allowTrash){this.store.insert(d++,a)}}if(this.sortField){this.store.sort(this.sortField,this.sortDir)}this.isDirtyFlag=true}this.dragZone.cachedTarget=null;return true},onEndDrag:function(a,b){var c=Ext.get(this.dragData.ddel);if(c&&c.hasClass("multi-proxy")){c.remove()}},removeDropIndicators:function(a){if(a){Ext.fly(a).removeClass(["x-view-drag-insert-above","x-view-drag-insert-left","x-view-drag-insert-right","x-view-drag-insert-below"]);this.lastInsertClass="_noclass"}},setDeletable:function(a){if(!this.singleSelect&&!this.multiSelect){this.singleSelect=true}var b=this.getContextMenu();this.contextMenu.on("itemclick",function(c){switch(c.id){case"delete":this.remove(this.getSelectedIndexes());break}},this);this.contextMenu.add({icon:a||AU.resolveUrl("/images/delete.gif"),id:"delete",text:AU.getMessage("deleteItem")})},getContextMenu:function(){if(!this.contextMenu){this.contextMenu=new Ext.menu.Menu({id:this.id+"-contextmenu"});this.el.on("contextmenu",this.showContextMenu,this)}return this.contextMenu},disableContextMenu:function(){if(this.contextMenu){this.el.un("contextmenu",this.showContextMenu,this)}},showContextMenu:function(b,a){a=this.findItemFromChild(b.getTarget());if(a){b.stopEvent();this.select(this.getNode(a),this.multiSelect&&b.ctrlKey,true);this.contextMenu.showAt(b.getXY())}},remove:function(b){b=[].concat(b);for(var a=0;a<b.length;a++){var c=this.store.getAt(b[a]);this.store.remove(c)}},onDblClick:function(f){var d=this.findItemFromChild(f.getTarget());if(d){if(this.fireEvent("dblclick",this,this.indexOf(d),d,f)===false){return false}if(this.dragGroup){var a=Ext.dd.DragDropMgr.getRelated(this.dragZone,true);while(a.indexOf(this.dropZone)!==-1){a.remove(this.dropZone)}if((a.length==1)&&(a[0].owningView)){this.dragZone.cachedTarget=null;var b=Ext.get(a[0].getEl());var c=b.getBox(true);a[0].onNodeDrop(b.dom,{target:b.dom,xy:[c.x,c.y+c.height-1]},null,this.getDragData(f))}}}},onItemClick:function(b,a,c){if(this.ignoreNextClick){delete this.ignoreNextClick;return}if(this.fireEvent("beforeclick",this,a,b,c)===false){return false}if(this.multiSelect||this.singleSelect){if(this.multiSelect&&c.shiftKey&&this.lastSelection){this.select(this.getNodes(this.indexOf(this.lastSelection),a),false)}else{if(this.isSelected(b)&&c.ctrlKey){this.deselect(b)}else{this.deselect(b);this.select(b,this.multiSelect&&c.ctrlKey);this.lastSelection=b}}c.preventDefault()}return true}});Ext.ux.Multiselect=Ext.extend(Ext.form.Field,{appendOnly:false,dataFields:[],data:[],width:100,height:100,displayField:0,valueField:1,allowBlank:true,minLength:0,maxLength:Number.MAX_VALUE,blankText:Ext.form.TextField.prototype.blankText,minLengthText:"Minimum {0} item(s) required",maxLengthText:"Maximum {0} item(s) allowed",delimiter:",",copy:false,allowDup:false,allowTrash:false,focusClass:undefined,sortDir:"ASC",defaultAutoCreate:{tag:"div"},initComponent:function(){Ext.ux.Multiselect.superclass.initComponent.call(this);this.addEvents({"dblclick":true,"click":true,"change":true,"drop":true})},onRender:function(e,b){Ext.ux.Multiselect.superclass.onRender.call(this,e,b);var c="ux-mselect";var a=new Ext.form.FieldSet({renderTo:this.el,title:this.legend,height:this.height,width:this.width,style:"padding:0;",tbar:this.tbar});a.body.addClass(c);var d='<tpl for="."><div class="'+c+"-item";if(Ext.isIE||Ext.isIE7){d+='" unselectable=on'}else{d+=' x-unselectable"'}d+=">{"+this.displayField+"}</div></tpl>";if(!this.store){this.store=new Ext.data.SimpleStore({fields:this.dataFields,data:this.data})}this.view=new Ext.ux.DDView({multiSelect:true,store:this.store,selectedClass:c+"-selected",tpl:d,allowDup:this.allowDup,copy:this.copy,allowTrash:this.allowTrash,dragGroup:this.dragGroup,dropGroup:this.dropGroup,itemSelector:"."+c+"-item",isFormField:false,applyTo:a.body,appendOnly:this.appendOnly,sortField:this.sortField,sortDir:this.sortDir});a.add(this.view);this.view.on("click",this.onViewClick,this);this.view.on("beforeClick",this.onViewBeforeClick,this);this.view.on("dblclick",this.onViewDblClick,this);this.view.on("drop",function(h,p,g,o,m){return this.fireEvent("drop",h,p,g,o,m)},this);this.hiddenName=this.name;var f={tag:"input",type:"hidden",value:"",name:this.name};if(this.isFormField){this.hiddenField=this.el.createChild(f)}else{this.hiddenField=Ext.get(document.body).createChild(f)}a.doLayout();a.on("afterlayout",function(g,h){if(this.ownerCt&&this.ownerCt.container){this.ownerCt.container.dom.style.width=((this.width*2)+20)+"px"}},this)},initValue:Ext.emptyFn,onViewClick:function(d,b,c,f){var a=this.preClickSelections.indexOf(b);if(a!=-1){this.preClickSelections.splice(a,1);this.view.clearSelections(true);this.view.select(this.preClickSelections)}this.fireEvent("change",this,this.getValue(),this.hiddenField.dom.value);this.hiddenField.dom.value=this.getValue();this.fireEvent("click",this,f);this.validate()},onViewBeforeClick:function(c,a,b,d){this.preClickSelections=this.view.getSelectedIndexes();if(this.disabled){return false}},onViewDblClick:function(c,a,b,d){return this.fireEvent("dblclick",c,a,b,d)},getValue:function(a){var d=[];var c=this.view.getSelectedIndexes();if(c.length==0){return""}for(var b=0;b<c.length;b++){d.push(this.store.getAt(c[b]).get(((a!=null)?a:this.valueField)))}return d.join(this.delimiter)},setValue:function(a){var b;var d=[];this.view.clearSelections();this.hiddenField.dom.value="";if(!a||(a=="")){return}if(!(a instanceof Array)){a=a.split(this.delimiter)}for(var c=0;c<a.length;c++){b=this.view.store.indexOf(this.view.store.query(this.valueField,new RegExp("^"+a[c]+"$","i")).itemAt(0));d.push(b)}this.view.select(d);this.hiddenField.dom.value=this.getValue();this.validate()},reset:function(){this.setValue("")},getRawValue:function(a){var b=this.getValue(a);if(b.length){b=b.split(this.delimiter)}else{b=[]}return b},setRawValue:function(a){setValue(a)},validateValue:function(a){if(a.length<1){if(this.allowBlank){this.clearInvalid();return true}else{this.markInvalid(this.blankText);return false}}if(a.length<this.minLength){this.markInvalid(String.format(this.minLengthText,this.minLength));return false}if(a.length>this.maxLength){this.markInvalid(String.format(this.maxLengthText,this.maxLength));return false}return true}});Ext.reg("multiselect",Ext.ux.Multiselect);Ext.ux.ItemSelector=Ext.extend(Ext.form.Field,{msWidth:200,msHeight:300,hideNavIcons:false,imagePath:"",iconUp:"up2.gif",iconDown:"down2.gif",iconLeft:"left2.gif",iconRight:"right2.gif",iconTop:"top2.gif",iconBottom:"bottom2.gif",drawUpIcon:true,drawDownIcon:true,drawLeftIcon:true,drawRightIcon:true,drawTopIcon:true,drawBotIcon:true,fromStore:null,toStore:null,fromData:null,toData:null,displayField:0,valueField:1,switchToFrom:false,allowDup:false,focusClass:undefined,delimiter:",",readOnly:false,toLegend:null,fromLegend:null,toSortField:null,fromSortField:null,toSortDir:"ASC",fromSortDir:"ASC",toTBar:null,fromTBar:null,bodyStyle:null,border:false,defaultAutoCreate:{tag:"div"},initComponent:function(){Ext.ux.ItemSelector.superclass.initComponent.call(this);this.addEvents({"rowdblclick":true,"change":true})},onRender:function(d,a){Ext.ux.ItemSelector.superclass.onRender.call(this,d,a);this.fromMultiselect=new Ext.ux.Multiselect({legend:this.fromLegend,delimiter:this.delimiter,allowDup:this.allowDup,copy:this.allowDup,allowTrash:this.allowDup,dragGroup:this.readOnly?null:"drop2-"+this.el.dom.id,dropGroup:this.readOnly?null:"drop1-"+this.el.dom.id,width:this.msWidth,height:this.msHeight,dataFields:this.dataFields,data:this.fromData,displayField:this.displayField,valueField:this.valueField,store:this.fromStore,isFormField:false,tbar:this.fromTBar,appendOnly:true,sortField:this.fromSortField,sortDir:this.fromSortDir});this.fromMultiselect.on("dblclick",this.onRowDblClick,this);if(!this.toStore){this.toStore=new Ext.data.SimpleStore({fields:this.dataFields,data:this.toData})}this.toStore.on("add",this.valueChanged,this);this.toStore.on("remove",this.valueChanged,this);this.toStore.on("load",this.valueChanged,this);this.toMultiselect=new Ext.ux.Multiselect({legend:this.toLegend,delimiter:this.delimiter,allowDup:this.allowDup,dragGroup:this.readOnly?null:"drop1-"+this.el.dom.id,dropGroup:this.readOnly?null:"drop2-"+this.el.dom.id+",drop1-"+this.el.dom.id,width:this.msWidth,height:this.msHeight,displayField:this.displayField,valueField:this.valueField,store:this.toStore,isFormField:false,tbar:this.toTBar,sortField:this.toSortField,sortDir:this.toSortDir});this.toMultiselect.on("dblclick",this.onRowDblClick,this);var g=new Ext.Panel({bodyStyle:this.bodyStyle,border:this.border,layout:"table",layoutConfig:{columns:3}});g.add(this.switchToFrom?this.toMultiselect:this.fromMultiselect);var c=new Ext.Panel({header:false});g.add(c);g.add(this.switchToFrom?this.fromMultiselect:this.toMultiselect);g.render(this.el);c.el.down("."+c.bwrapCls).remove();if(this.imagePath!=""&&this.imagePath.charAt(this.imagePath.length-1)!="/"){this.imagePath+="/"}this.iconUp=this.imagePath+(this.iconUp||"up2.gif");this.iconDown=this.imagePath+(this.iconDown||"down2.gif");this.iconLeft=this.imagePath+(this.iconLeft||"left2.gif");this.iconRight=this.imagePath+(this.iconRight||"right2.gif");this.iconTop=this.imagePath+(this.iconTop||"top2.gif");this.iconBottom=this.imagePath+(this.iconBottom||"bottom2.gif");var f=c.getEl();if(!this.toSortField){this.toTopIcon=f.createChild({tag:"img",src:this.iconTop,style:{cursor:"pointer",margin:"2px"}});f.createChild({tag:"br"});this.upIcon=f.createChild({tag:"img",src:this.iconUp,style:{cursor:"pointer",margin:"2px"}});f.createChild({tag:"br"})}this.addIcon=f.createChild({tag:"img",src:this.switchToFrom?this.iconLeft:this.iconRight,style:{cursor:"pointer",margin:"2px"}});f.createChild({tag:"br"});this.removeIcon=f.createChild({tag:"img",src:this.switchToFrom?this.iconRight:this.iconLeft,style:{cursor:"pointer",margin:"2px"}});f.createChild({tag:"br"});if(!this.toSortField){this.downIcon=f.createChild({tag:"img",src:this.iconDown,style:{cursor:"pointer",margin:"2px"}});f.createChild({tag:"br"});this.toBottomIcon=f.createChild({tag:"img",src:this.iconBottom,style:{cursor:"pointer",margin:"2px"}})}if(!this.readOnly){if(!this.toSortField){this.toTopIcon.on("click",this.toTop,this);this.upIcon.on("click",this.up,this);this.downIcon.on("click",this.down,this);this.toBottomIcon.on("click",this.toBottom,this)}this.addIcon.on("click",this.fromTo,this);this.removeIcon.on("click",this.toFrom,this)}if(!this.drawUpIcon||this.hideNavIcons){this.upIcon.dom.style.display="none"}if(!this.drawDownIcon||this.hideNavIcons){this.downIcon.dom.style.display="none"}if(!this.drawLeftIcon||this.hideNavIcons){this.addIcon.dom.style.display="none"}if(!this.drawRightIcon||this.hideNavIcons){this.removeIcon.dom.style.display="none"}if(!this.drawTopIcon||this.hideNavIcons){this.toTopIcon.dom.style.display="none"}if(!this.drawBotIcon||this.hideNavIcons){this.toBottomIcon.dom.style.display="none"}var b=g.body.first();this.el.setWidth(g.body.first().getWidth());g.body.removeClass();this.hiddenName=this.name;var e={tag:"input",type:"hidden",value:"",name:this.name};this.hiddenField=this.el.createChild(e);this.valueChanged(this.toStore)},initValue:Ext.emptyFn,toTop:function(){var c=this.toMultiselect.view.getSelectedIndexes();var a=[];if(c.length>0){c.sort();for(var b=0;b<c.length;b++){record=this.toMultiselect.view.store.getAt(c[b]);a.push(record)}c=[];for(var b=a.length-1;b>-1;b--){record=a[b];this.toMultiselect.view.store.remove(record);this.toMultiselect.view.store.insert(0,record);c.push(((a.length-1)-b))}}this.toMultiselect.view.refresh();this.toMultiselect.view.select(c)},toBottom:function(){var c=this.toMultiselect.view.getSelectedIndexes();var a=[];if(c.length>0){c.sort();for(var b=0;b<c.length;b++){record=this.toMultiselect.view.store.getAt(c[b]);a.push(record)}c=[];for(var b=0;b<a.length;b++){record=a[b];this.toMultiselect.view.store.remove(record);this.toMultiselect.view.store.add(record);c.push((this.toMultiselect.view.store.getCount())-(a.length-b))}}this.toMultiselect.view.refresh();this.toMultiselect.view.select(c)},up:function(){var a=null;var c=this.toMultiselect.view.getSelectedIndexes();c.sort();var d=[];if(c.length>0){for(var b=0;b<c.length;b++){a=this.toMultiselect.view.store.getAt(c[b]);if((c[b]-1)>=0){this.toMultiselect.view.store.remove(a);this.toMultiselect.view.store.insert(c[b]-1,a);d.push(c[b]-1)}}this.toMultiselect.view.refresh();this.toMultiselect.view.select(d)}},down:function(){var a=null;var c=this.toMultiselect.view.getSelectedIndexes();c.sort();c.reverse();var d=[];if(c.length>0){for(var b=0;b<c.length;b++){a=this.toMultiselect.view.store.getAt(c[b]);if((c[b]+1)<this.toMultiselect.view.store.getCount()){this.toMultiselect.view.store.remove(a);this.toMultiselect.view.store.insert(c[b]+1,a);d.push(c[b]+1)}}this.toMultiselect.view.refresh();this.toMultiselect.view.select(d)}},fromTo:function(){var d=this.fromMultiselect.view.getSelectedIndexes();var b=[];if(d.length>0){for(var c=0;c<d.length;c++){record=this.fromMultiselect.view.store.getAt(d[c]);b.push(record)}if(!this.allowDup){d=[]}for(var c=0;c<b.length;c++){record=b[c];if(this.allowDup){var a=new Ext.data.Record();record.id=a.id;delete a;this.toMultiselect.view.store.add(record)}else{this.fromMultiselect.view.store.remove(record);this.toMultiselect.view.store.add(record);d.push((this.toMultiselect.view.store.getCount()-1))}}}this.toMultiselect.view.refresh();this.fromMultiselect.view.refresh();if(this.toSortField){this.toMultiselect.store.sort(this.toSortField,this.toSortDir)}if(this.allowDup){this.fromMultiselect.view.select(d)}else{this.toMultiselect.view.select(d)}},toFrom:function(){var c=this.toMultiselect.view.getSelectedIndexes();var a=[];if(c.length>0){for(var b=0;b<c.length;b++){record=this.toMultiselect.view.store.getAt(c[b]);a.push(record)}c=[];for(var b=0;b<a.length;b++){record=a[b];this.toMultiselect.view.store.remove(record);if(!this.allowDup){this.fromMultiselect.view.store.add(record);c.push((this.fromMultiselect.view.store.getCount()-1))}}}this.fromMultiselect.view.refresh();this.toMultiselect.view.refresh();if(this.fromSortField){this.fromMultiselect.store.sort(this.fromSortField,this.fromSortDir)}this.fromMultiselect.view.select(c)},valueChanged:function(c){var a=null;var b=[];for(var d=0;d<c.getCount();d++){a=c.getAt(d);b.push(a.get(this.valueField))}this.hiddenField.dom.value=b.join(this.delimiter);this.fireEvent("change",this,this.getValue(),this.hiddenField.dom.value)},getValue:function(){return this.hiddenField.dom.value},onRowDblClick:function(c,a,b,d){return this.fireEvent("rowdblclick",c,a,b,d)},reset:function(){range=this.toMultiselect.store.getRange();this.toMultiselect.store.removeAll();if(!this.allowDup){this.fromMultiselect.store.add(range);this.fromMultiselect.store.sort(this.displayField,"ASC")}this.valueChanged(this.toMultiselect.store)}});Ext.reg("itemselector",Ext.ux.ItemSelector);Ext.override(Ext.layout.TableLayout,{getNextCell:function(m){var a=this.getNextNonSpan(this.currentColumn,this.currentRow);var f=this.currentColumn=a[0],e=this.currentRow=a[1];for(var h=e;h<e+(m.rowspan||1);h++){if(!this.cells[h]){this.cells[h]=[]}for(var d=f;d<f+(m.colspan||1);d++){this.cells[h][d]=true}}var g=document.createElement("td");if(m.cellId){g.id=m.cellId}var b="x-table-layout-cell";if(m.cellCls){b+=" "+m.cellCls}g.className=b;if(m.cellStyle){Ext.DomHelper.applyStyles(g,m.cellStyle)}if(m.colspan){g.colSpan=m.colspan}if(m.rowspan){g.rowSpan=m.rowspan}this.getRow(e).appendChild(g);return g}});Ext.ux.JsonTreeNode=function(a){a=a||{};Ext.applyIf(a,{leaf:(a.children===null)});Ext.ux.JsonTreeNode.superclass.constructor.call(this,a);if(a.children){this.createChildren(a.children)}};Ext.extend(Ext.ux.JsonTreeNode,Ext.tree.TreeNode,{createChildren:function(b){this.on("click",function(){this.toggle()},this);for(var a=0;a<b.length;a++){this.appendChild(new Ext.ux.JsonTreeNode(b[a]))}},destroyChildren:function(){while(this.firstChild){var a=this.firstChild;this.removeChild(a);if(a.destroy){a.destroy()}}},appendChild:function(b){if(!b.render&&!Ext.isArray(b)){b=this.getLoader().createNode(b)}var a=Ext.ux.JsonTreeNode.superclass.appendChild.call(this,b);if(a&&this.childrenRendered){a.render()}this.ui.updateExpandIcon();return a},renderChildren:function(b){if(b!==false){this.fireEvent("beforechildrenrendered",this)}var d=this.childNodes;for(var c=0,a=d.length;c<a;c++){d[c].render(true)}this.childrenRendered=true}});Ext.ux.TreeItemSelector=Ext.extend(Ext.form.Field,{fromRootText:"Options",toRootText:"Selected",width:400,height:"auto",hideNavIcons:false,imagePath:"",iconLeft:"left2.gif",iconRight:"right2.gif",drawLeftIcon:true,drawRightIcon:true,switchToFrom:false,readOnly:false,bodyStyle:null,border:true,defaultAutoCreate:{tag:"div"},fromChildren:[],toChildren:[],initComponent:function(){Ext.ux.TreeItemSelector.superclass.initComponent.call(this);this.addEvents({"change":true})},onRender:function(d,a){Ext.ux.TreeItemSelector.superclass.onRender.call(this,d,a);this.fromTreeConfig=this.fromTreeConfig||{};Ext.applyIf(this.fromTreeConfig,{animate:true,autoScroll:true,enableDD:true,containerScroll:true,cellStyle:"vertical-align:top;"});this.toTreeConfig=this.toTreeConfig||{};Ext.applyIf(this.toTreeConfig,{animate:true,autoScroll:true,enableDD:true,containerScroll:true,dropConfig:{appendOnly:true},cellStyle:"vertical-align:top;"});this.fromTree=new Ext.tree.TreePanel(this.fromTreeConfig);this.fromTree.setRootNode(new Ext.ux.JsonTreeNode({text:this.fromRootText,draggable:false,id:"source",expanded:true,leaf:false,children:this.fromChildren}));this.toTree=new Ext.tree.TreePanel(this.toTreeConfig);this.toTree.setRootNode(new Ext.ux.JsonTreeNode({text:this.toRootText,draggable:false,id:"target",expanded:true,leaf:false,children:this.toChildren}));this.toTree.on({beforenodedrop:{scope:this,fn:this.onBeforeNodeDrop},click:{scope:this,fn:this.onClick}});this.fromTree.on({beforenodedrop:{scope:this,fn:this.onBeforeNodeDrop},click:{scope:this,fn:this.onClick}});new Ext.tree.TreeSorter(this.fromTree,{folderSort:true});new Ext.tree.TreeSorter(this.toTree,{folderSort:true});var g=new Ext.Panel({bodyStyle:this.bodyStyle,border:this.border,layout:"table",layoutConfig:{columns:3}});g.add(this.switchToFrom?this.toTree:this.fromTree);var c=new Ext.Panel({header:false,cellStyle:"vertical-align:middle;"});g.add(c);g.add(this.switchToFrom?this.fromTree:this.toTree);g.render(this.el);c.el.down("."+c.bwrapCls).remove();if(this.imagePath!=""&&this.imagePath.charAt(this.imagePath.length-1)!="/"){this.imagePath+="/"}this.iconLeft=this.imagePath+(this.iconLeft||"left2.gif");this.iconRight=this.imagePath+(this.iconRight||"right2.gif");var f=c.getEl();this.addIcon=f.createChild({tag:"img",src:this.switchToFrom?this.iconLeft:this.iconRight,style:{cursor:"pointer",margin:"2px"}});f.createChild({tag:"br"});this.removeIcon=f.createChild({tag:"img",src:this.switchToFrom?this.iconRight:this.iconLeft,style:{cursor:"pointer",margin:"2px"}});f.createChild({tag:"br"});if(!this.readOnly){this.addIcon.on("click",this.fromTo,this);this.removeIcon.on("click",this.toFrom,this)}if(!this.drawLeftIcon||this.hideNavIcons){this.addIcon.dom.style.display="none"}if(!this.drawRightIcon||this.hideNavIcons){this.removeIcon.dom.style.display="none"}var b=g.body.first();this.el.setWidth(g.body.getWidth());g.body.removeClass();this.hiddenName=this.name;var e={tag:"input",type:"hidden",value:"",name:this.name};this.hiddenField=this.el.createChild(e)},initValue:Ext.emptyFn,fromTo:function(){if(this.selectedNode&&this.selectedNode!=null){var a={target:this.toTree.root,dropNode:this.selectedNode};this.selectedNode=null;this.onBeforeNodeDrop(a)}},toFrom:function(){if(this.selectedNode&&this.selectedNode!=null){var a={target:this.fromTree.root,dropNode:this.selectedNode};this.selectedNode=null;this.onBeforeNodeDrop(a)}},onBeforeNodeDrop:function(g){if(this.disabled){return false}var c=g.dropNode;var h=g.target.leaf?g.target.parentNode:g.target;if(c.parentNode===h){return false}if(h.isRoot){if(c.parentNode.isRoot){if(this.hasChild(h,c.attributes.value)){c.expand();var f=this.getChild(h,c.attributes.value);for(var b=0,a=c.childNodes.length;b<a;b++){if(!this.hasChild(f,c.childNodes[b].attributes.value)){f.appendChild(this.createNode(c.childNodes[b]))}}h.expand();f.expand();c.parentNode.removeChild(c)}else{var f=h.appendChild(this.createNode(c));for(var b=0,a=c.childNodes.length;b<a;b++){f.appendChild(this.createNode(c.childNodes[b]))}h.expand();f.expand();c.parentNode.removeChild(c)}}else{if(this.hasChild(h,c.parentNode.attributes.value)){var f=this.getChild(h,c.parentNode.attributes.value);h.expand();f.appendChild(this.createNode(c));f.expand();c.parentNode.removeChild(c)}else{var f=h.appendChild(this.createNode(c.parentNode));f.appendChild(this.createNode(c));f.expand();c.parentNode.removeChild(c)}}}else{if(h.parentNode.isRoot){if(c.parentNode.isRoot&&c.attributes.value==h.attributes.value){for(var b=0,a=c.childNodes.length;b<a;b++){if(!this.hasChild(h,c.childNodes[b].attributes.value)){h.appendChild(this.createNode(c.childNodes[b]))}}c.parentNode.removeChild(c)}else{if(!c.parentNode.isRoot){h.appendChild(this.createNode(c));h.expand();c.parentNode.removeChild(c)}}}}this.valueChanged();g.target.ui.endDrop();return false},onClick:function(a){this.selectedNode=a},createNode:function(a){return new Ext.ux.JsonTreeNode({text:a.text,value:a.attributes.value,leaf:a.isLeaf(),iconCls:a.attributes.iconCls})},hasChild:function(b,a){return(b.isLeaf()?b.parentNode:b).findChild("value",a)!==null},getChild:function(b,a){return(b.isLeaf()?b.parentNode:b).findChild("value",a)},valueChanged:function(){var a=new Ext.tree.JsonTreeSerializer(this.toTree);this.hiddenField.dom.value=a.toString();this.fireEvent("change",this,this.getValue(),this.hiddenField.dom.value)},getValue:function(){return this.hiddenField.dom.value}});Ext.reg("treeitemselector",Ext.ux.TreeItemSelector);Ext.tree.TreeSerializer=function(a,b){if(typeof this.toString!=="function"){throw"Ext.tree.TreeSerializer implementation does not implement toString()"}this.tree=a;if(this.attributeFilter){this.attributeFilter=this.attributeFilter.createInterceptor(this.defaultAttributeFilter)}else{this.attributeFilter=this.defaultAttributeFilter}if(this.nodeFilter){this.nodeFilter=this.nodeFilter.createInterceptor(this.defaultNodeFilter)}else{this.nodeFilter=this.defaultNodeFilter}Ext.apply(this,b)};Ext.tree.TreeSerializer.prototype={includeRootNode:false,standardAttributes:["expanded","allowDrag","allowDrop","disabled","icon","cls","iconCls","href","hrefTarget","qtip","singleClickExpand","uiProvider","id","draggable"],defaultAttributeFilter:function(b,a){return(typeof a!="function")&&(this.standardAttributes.indexOf(b)==-1)},defaultNodeFilter:function(a){return true}};Ext.tree.XmlTreeSerializer=function(a,b){Ext.tree.XmlTreeSerializer.superclass.constructor.apply(this,arguments)};Ext.extend(Ext.tree.XmlTreeSerializer,Ext.tree.TreeSerializer,{toString:function(b,a){return'\u003C?xml version="1.0"?>\u003Ctree>'+nodeToString(this.tree.getRootNode())+"\u003C/tree>"},nodeToString:function(f){if(!this.nodeFilter(f)){return""}var b="\u003Cnode";if(this.attributeFilter("id",f.id)){b+=' id="'+f.id+'"'}for(var e in f.attributes){if(this.attributeFilter(e,f.attributes[e])){b+=" "+(this.attributeMap?(this.attributeMap[e]||e):e)+'="'+f.attributes[e]+'"'}}var d=f.childNodes;var a=d.length;if(a==0){b+="/>"}else{b+=">";for(var c=0;c<a;c++){b+=this.nodeToString(d[c])}b+="\u003C/node>"}return b}});Ext.tree.JsonTreeSerializer=function(a,b){Ext.tree.JsonTreeSerializer.superclass.constructor.apply(this,arguments)};Ext.extend(Ext.tree.JsonTreeSerializer,Ext.tree.TreeSerializer,{toString:function(){return this.nodeToString(this.tree.getRootNode())},nodeToString:function(h){if(!this.nodeFilter(h)){return""}var d=this.tree.getRootNode();if(h==d&&this.includeRootNode==false){var b="[";var g=h.childNodes;var a=g.length;if(a!=0){for(var f=0;f<a;f++){b+=((f>0)?",":"")+this.nodeToString(g[f])}}return b+"]"}else{var m=false,b="{";if(this.attributeFilter("id",h.id)){b+='"id":"'+h.id+'"';m=true}for(var e in h.attributes){if(this.attributeFilter(e,h.attributes[e])){if(m){b+=","}b+='"'+(this.attributeMap?(this.attributeMap[e]||e):e)+'":"'+h.attributes[e]+'"';m=true}}var g=h.childNodes;var a=g.length;if(a!=0){if(m){b+=","}b+='"children":[';for(var f=0;f<a;f++){if(f>0){b+=","}b+=this.nodeToString(g[f])}b+="]"}return b+"}"}}});Ext.ns("Ext.ux");Ext.ux.ClassicFormPanel=function(a){Ext.ux.ClassicFormPanel.superclass.constructor.call(this,a)};Ext.extend(Ext.ux.ClassicFormPanel,Ext.form.FormPanel,{onSubmit:Ext.emptyFn,submit:function(a){if(this.fileUpload){this.getForm().getEl().dom.enctype="multipart/form-data"}this.getForm().getEl().dom.action=a.url;this.getForm().getEl().dom.method=a.method;this.getForm().getEl().dom.submit()}});Ext.ns("Ext.ux.form");Ext.ux.form.ComboWButton=Ext.extend(Ext.form.Field,{readOnly:false,bodyStyle:null,border:true,oneLineLayout:true,defaultAutoCreate:{tag:"div"},initComponent:function(){Ext.ux.form.ComboWButton.superclass.initComponent.call(this)},onRender:function(d,a){Ext.ux.form.ComboWButton.superclass.onRender.call(this,d,a);this.comboConfig=this.comboConfig||{};Ext.applyIf(this.comboConfig,{forceSelection:this.forceSelection,disableKeyFilter:this.disableKeyFilter,mode:this.mode,triggerAction:this.triggerAction,width:this.width-30,store:this.store,value:this.value,hiddenName:this.hiddenName});this.button=new Ext.Button({iconCls:"icon-plus",tooltip:"Not in list? click to add one"});this.button.on({click:{scope:this,fn:this.onClick}});this.windowConfig=this.windowConfig||{};this.combo=new Ext.form.ComboBox(this.comboConfig);var f=new Ext.Panel({bodyStyle:this.bodyStyle,border:this.border,layout:"table",layoutConfig:{columns:3}});var c=Ext.DomHelper.insertFirst(d,{tag:"div",style:"width:"+this.width+"px; margin:0px; padding:0px"});var b=Ext.DomHelper.append(c,{tag:"div",style:"float:left;margin:0px; padding:0px"});var e=Ext.DomHelper.append(c,{tag:"div",style:"float:left; margin:0px; margin-left:8px; padding:0px"});Ext.DomHelper.append(c,{tag:"div",style:"clear:both;"});this.combo.render(b);this.button.render(e)},markInvalid:function(d){this.el=this.combo.getEl();if(this.rendered&&!this.preventMark){d=d||this.invalidText;var a=this.getMessageHandler();if(a){a.mark(this,d);var c=Ext.select(".x-form-invalid-icon",false,this.getErrorCt().dom);if(c&&c.elements&&c.elements[0]){c.elements[0].style.left=c.elements[0].offsetLeft+47+"px";c.elements[0].style.display="block";this.eI=c.elements[0]}}else{if(this.msgTarget){this.el.addClass(this.invalidClass);var b=Ext.getDom(this.msgTarget);if(b){b.innerHTML=d;b.style.display=this.msgDisplay}}}}this.setActiveError(d)},clearInvalid:function(){if(this.eI){this.eI.style.display="none"}this.el=this.combo.getEl();if(this.rendered&&!this.preventMark){this.el.removeClass(this.invalidClass);var a=this.getMessageHandler();if(a){a.clear(this);a.clear(this.combo)}else{if(this.msgTarget){this.el.removeClass(this.invalidClass);var b=Ext.getDom(this.msgTarget);if(b){b.innerHTML="";b.style.display="none"}}}}this.unsetActiveError()},initValue:Ext.emptyFn,onClick:function(a,b){afApp.widgetPopup(this.windowConfig.component,this.windowConfig.title?this.windowConfig.title:"Add combo option",this)},onHide:function(window){var combo=this.combo;if(this.windowConfig.className&&this.windowConfig.methodName){Ext.Ajax.request({url:"/appFlower/getComboOptions",method:"post",params:{"class":this.windowConfig.className,"method":this.windowConfig.methodName},success:function(response,options){response=Ext.decode(response.responseText);var s=eval(response.store);combo.bindStore(s);var last=s[s.length-1];if(last[1]){combo.setValue(last[0])}},failure:function(response,options){Ext.Msg.alert("Failure","Could not retrieve combo options !")},scope:this})}},getValue:function(){return this.combo.getValue()}});Ext.reg("combowbutton",Ext.ux.form.ComboWButton);Ext.ns("Ext.ux");Ext.ux.VerticalTabPanel=function(a){if(a.tabPosition=="left"||a.tabPosition=="right"){a.cls=a.cls||"";a.cls="ux-vertical-tabs "+a.cls;if(a.textAlign&&a.textAlign=="right"){a.cls="ux-vertical-tabs-alignright "+a.cls}a.cls=(a.tabPosition=="left"?"ux-vertical-tabs-left ":"ux-vertical-tabs-right ")+a.cls;this.intendedTabPosition=a.tabPosition;this.verticalTabs=true;a.tabPosition="top"}Ext.ux.VerticalTabPanel.superclass.constructor.call(this,a)};Ext.extend(Ext.ux.VerticalTabPanel,Ext.TabPanel,{tabWidth:150,afterRender:function(){Ext.ux.VerticalTabPanel.superclass.afterRender.call(this);if(this.verticalTabs){this.header.setWidth(this.tabWidth);this.header.setHeight(this.height||this.container.getHeight())}},adjustBodyWidth:function(a){if(this.verticalTabs){if(Ext.isIE6){this.bwrap.setWidth(a)}return a}else{return Ext.ux.VerticalTabPanel.superclass.adjustBodyWidth.call(this,a)}},adjustBodyHeight:function(a){if(this.verticalTabs){this.header.setHeight(a+(this.tbar?this.tbar.getHeight():0)+500)}return Ext.ux.VerticalTabPanel.superclass.adjustBodyHeight.call(this,a)},getFrameWidth:function(){return Ext.ux.VerticalTabPanel.superclass.getFrameWidth.call(this)+this.verticalTabs?this.tabWidth:0},getFrameHeight:function(){return Ext.ux.VerticalTabPanel.superclass.getFrameHeight.call(this)-(this.verticalTabs?this.header.getHeight():0)}});Ext.ns("Ext.ux");Ext.ux.Settings=function(b){var c=[];var a={width:600,height:400};b.windowConfig=Ext.apply(a,b.windowConfig||[]);Ext.apply(b.windowConfig,b.windowConfig||[]);Ext.apply(c,b,{windowTitle:"Settings",activeTab:0,tabPosition:"left",window:null,deferredRender:false,hideHeading:false});Ext.ux.Settings.superclass.constructor.call(this,c)};Ext.extend(Ext.ux.Settings,Ext.ux.VerticalTabPanel,{afterRender:function(){Ext.ux.Settings.superclass.afterRender.call(this);var b=this.getEl().dom;var a=Ext.DomHelper.insertFirst(b,{tag:"div"});if(!this.hideHeading){this.headPanel=new Ext.Panel({renderTo:a,frame:true,html:'<div float:left; width:100%><span style="font-size:15px;float:left;margin-bottom:5px;font-weight:bold">'+this.title+"</span>"+'<span style="float:right">'+(this.user?"User: "+this.user:"")+"</span></div>"+'<div style="clear:both; width:100%; padding-bottom:5px;">'+this.description+"</div>"})}}});Ext.reg("settings",Ext.ux.Settings);
/*
 * Ext JS Library 3.3.0
 * Copyright(c) 2006-2010 Ext JS, Inc.
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
Ext.ux.GMapPanel=Ext.extend(Ext.Panel,{initComponent:function(){var a={plain:true,zoomLevel:3,yaw:180,pitch:0,zoom:0,gmapType:"map",border:false};Ext.applyIf(this,a);Ext.ux.GMapPanel.superclass.initComponent.call(this)},afterRender:function(){var b=this.ownerCt.getSize();Ext.applyIf(this,b);Ext.ux.GMapPanel.superclass.afterRender.call(this);if(this.gmapType==="map"){this.gmap=new GMap2(this.body.dom)}if(this.gmapType==="panorama"){this.gmap=new GStreetviewPanorama(this.body.dom)}if(typeof this.addControl=="object"&&this.gmapType==="map"){this.gmap.addControl(this.addControl)}if(typeof this.setCenter==="object"){if(typeof this.setCenter.geoCodeAddr==="string"){this.geoCodeLookup(this.setCenter.geoCodeAddr)}else{if(this.gmapType==="map"){var a=new GLatLng(this.setCenter.lat,this.setCenter.lng);this.gmap.setCenter(a,this.zoomLevel)}if(typeof this.setCenter.marker==="object"&&typeof a==="object"){this.addMarker(a,this.setCenter.marker,this.setCenter.marker.clear)}}if(this.gmapType==="panorama"){this.gmap.setLocationAndPOV(new GLatLng(this.setCenter.lat,this.setCenter.lng),{yaw:this.yaw,pitch:this.pitch,zoom:this.zoom})}}GEvent.bind(this.gmap,"load",this,function(){this.onMapReady()})},onMapReady:function(){this.addMarkers(this.markers);this.addMapControls();this.addOptions()},onResize:function(a,b){if(typeof this.getMap()=="object"){this.gmap.checkResize()}Ext.ux.GMapPanel.superclass.onResize.call(this,a,b)},setSize:function(c,a,b){if(typeof this.getMap()=="object"){this.gmap.checkResize()}Ext.ux.GMapPanel.superclass.setSize.call(this,c,a,b)},getMap:function(){return this.gmap},getCenter:function(){return this.getMap().getCenter()},getCenterLatLng:function(){var a=this.getCenter();return{lat:a.lat(),lng:a.lng()}},addMarkers:function(c){if(Ext.isArray(c)){for(var b=0;b<c.length;b++){var a=new GLatLng(c[b].lat,c[b].lng);this.addMarker(a,c[b].marker,false,c[b].setCenter,c[b].listeners)}}},addMarker:function(c,d,b,a,e){Ext.applyIf(d,G_DEFAULT_ICON);if(b===true){this.getMap().clearOverlays()}if(a===true){this.getMap().setCenter(c,this.zoomLevel)}var f=new GMarker(c,d);if(typeof e==="object"){for(evt in e){GEvent.bind(f,evt,this,e[evt])}}this.getMap().addOverlay(f)},addMapControls:function(){if(this.gmapType==="map"){if(Ext.isArray(this.mapControls)){for(i=0;i<this.mapControls.length;i++){this.addMapControl(this.mapControls[i])}}else{if(typeof this.mapControls==="string"){this.addMapControl(this.mapControls)}else{if(typeof this.mapControls==="object"){this.getMap().addControl(this.mapControls)}}}}},addMapControl:function(b){var a=window[b];if(typeof a==="function"){this.getMap().addControl(new a())}},addOptions:function(){if(Ext.isArray(this.mapConfOpts)){var a;for(i=0;i<this.mapConfOpts.length;i++){this.addOption(this.mapConfOpts[i])}}else{if(typeof this.mapConfOpts==="string"){this.addOption(this.mapConfOpts)}}},addOption:function(b){var a=this.getMap()[b];if(typeof a==="function"){this.getMap()[b]()}},geoCodeLookup:function(a){this.geocoder=new GClientGeocoder();this.geocoder.getLocations(a,this.addAddressToMap.createDelegate(this))},addAddressToMap:function(a){if(!a||a.Status.code!=200){Ext.MessageBox.alert("Error","Code "+a.Status.code+" Error Returned")}else{place=a.Placemark[0];addressinfo=place.AddressDetails;accuracy=addressinfo.Accuracy;if(accuracy===0){Ext.MessageBox.alert("Unable to Locate Address","Unable to Locate the Address you provided")}else{if(accuracy<7){Ext.MessageBox.alert("Address Accuracy","The address provided has a low accuracy.<br><br>Level "+accuracy+" Accuracy (8 = Exact Match, 1 = Vague Match)")}else{point=new GLatLng(place.Point.coordinates[1],place.Point.coordinates[0]);if(typeof this.setCenter.marker==="object"&&typeof point==="object"){this.addMarker(point,this.setCenter.marker,this.setCenter.marker.clear,true,this.setCenter.listeners)}}}}}});Ext.reg("gmappanel",Ext.ux.GMapPanel);Ext.ns("afApp");function strstr(b,c,a){var d=0;b+="";d=b.indexOf(c);if(d==-1){return false}else{if(a){return b.substr(0,d)}else{return b.slice(d)}return true}}function in_array(e,d,c){var b="",a=!!c;if(a){for(b in d){if(strstr(d[b],e)){return true}}}else{for(b in d){if(strstr(d[b],e)){return true}}}return false}String.prototype.ucfirst=function(){return this.substr(0,1).toUpperCase()+this.substr(1)};Array.prototype.in_array=function(e,c){var b="",a=!!c,d=this;if(a){for(b in d){if(d[b]===e){return true}}}else{for(b in d){if(d[b]==e){return true}}}return false};afApp.createAddon=function(a,b,e){if(a.indexOf("http://")!=-1){a=afApp.urlPrefix+a}if(!b){var c=a.split(".");b=c[c.length-1]}if(b=="js"){var d=document.createElement("script");d.setAttribute("type","text/javascript");d.setAttribute("src",a);GLOBAL_JS_VAR.push(a)}else{if(b=="css"){var d=document.createElement("link");d.setAttribute("rel","stylesheet");d.setAttribute("type","text/css");d.setAttribute("href",a);GLOBAL_CSS_VAR.push(a)}}if(typeof d!="undefined"){document.getElementsByTagName("head")[0].appendChild(d)}if(b=="js"){d.onload=d.onreadystatechange=function(){if(!this.readyState||this.readyState=="loaded"||this.readyState=="complete"){e()}}}else{if(b=="css"){e()}}};afApp.hasDesktop=function(){var a=false;try{if(App&&App.desktop){a=true}}catch(b){a=false}return a};afApp.windows=new Ext.WindowGroup();afApp.activeWindow;afApp.minimizeWin=function(a){a.minimized=true;a.hide()};afApp.markActive=function(b){var a=b.id;if(afApp.activeWindow&&afApp.activeWindow!=b){afApp.markInactive(afApp.activeWindow)}if(afApp.hasDesktop()){App.desktop.taskbar.setActiveButton(b.taskButton);Ext.fly(b.taskButton.el).addClass("active-win");if(Ext.History.getToken()!=a){Ext.History.add(a)}}afApp.activeWindow=b;b.minimized=false};afApp.markInactive=function(b,a){if(b==afApp.activeWindow){afApp.activeWindow=null;if(afApp.hasDesktop()){Ext.fly(b.taskButton.el).removeClass("active-win")}}};afApp.removeWin=function(a){if(afApp.hasDesktop()){App.desktop.taskbar.removeTaskButton(a.taskButton);afApp.layout()}};afApp.layout=function(){if(afApp.hasDesktop()){var a=Ext.get("x-desktop");var b=Ext.get("ux-taskbar");a.setHeight(Ext.lib.Dom.getViewHeight()-b.getHeight())}};Ext.EventManager.onWindowResize(afApp.layout);afApp.getWindow=function(a){return afApp.windows.get(a)};afApp.pack=function(f,b,c){var b=b||{};c=c?c:App;var a;try{a=c.getViewport()}catch(d){a=Ext.getBody()}f.on("show",function(p){if(b.applyTo){return}var n=p.findBy(function(s,r){return true});if(n&&n[0]){var o=n[0];var h=a.getBox().width;var m=a.getBox().height;var g=o.getBox().width+35;var e=o.getBox().height+35;g=g>h?(0.7*h):g;e=e>m?(0.7*m):e;p.setSize(g,e);p.center()}var q=p.getPosition();if(q[1]<0){p.setPosition(q[0],0)}p.on("move",function(s,r,t){if(t<0){s.setPosition(r,0)}if(r<100-s.getWidth()){s.setPosition(100-s.getWidth(),t)}if(r>Ext.getBody().getWidth()-100){s.setPosition(Ext.getBody().getWidth()-100,t)}if(t>Ext.getBody().getHeight()-100){s.setPosition(r,Ext.getBody().getHeight()-100)}})})};afApp.executeAddons=function(addons,json,title,superClass,winConfig,Application,widget){Application=Application?Application:App;var maskEl;try{var viewport=Application.getViewport();maskEl=viewport.layout.center.panel.getEl()}catch(e){maskEl=Ext.getBody()}var counter=0,backup=new Array(),finish;var load=function(){if(counter>=addons.length){finish();return}afApp.loadingProgress(maskEl,(counter+1)/addons.length);var nextAddon=addons[counter++];afApp.createAddon(nextAddon,false,load)};finish=function(){var backendWinConfig={};eval(json.source);var center_panel=(function(){return eval(json.center_panel)})();if(center_panel_first_panel.winTools){winConfig.tools=center_panel_first_panel.winTools}if(center_panel_first_panel.winTitle){winConfig.title=center_panel_first_panel.winTitle}Ext.apply(center_panel,{frame:winConfig.applyTo?false:true,width:"auto"});if(afApp.hasDesktop()){var desktopEl=Ext.get("x-desktop");Ext.applyIf(winConfig,{renderTo:desktopEl,shim:false,animCollapse:false,constrainHeader:true,})}Ext.applyIf(winConfig,{id:widget,autoScroll:true,minimizable:true,maximizable:true,draggable:true,closeAction:"close",manager:afApp.windows,items:center_panel});if(winConfig.applyTo){winConfig=Ext.apply(winConfig,{frame:false});var win=new Ext.Panel(winConfig)}else{var win=new Ext.Window(winConfig)}if(title){win.setTitle(title)}if(win.resizer){win.resizer.widthIncrement=1;win.resizer.heightIncrement=1}if(afApp.hasDesktop()){win.taskButton=Application.desktop.taskbar.addTaskButton(win);win.animateTarget=win.taskButton.el}win.on({"activate":{fn:afApp.markActive},"beforeshow":{fn:afApp.markActive},"deactivate":{fn:afApp.markInactive},"minimize":{fn:afApp.minimizeWin},"close":{fn:afApp.removeWin},"resize":{fn:function(win,width,height){if(center_panel.items.items[0].getXType()=="grid"){var tt=center_panel.items.items[0].getTopToolbar();var bt=center_panel.items.items[0].getBottomToolbar();if(tt){tt.el.setWidth("auto");tt.el.parent().setWidth("auto")}if(bt){bt.el.setWidth("auto");bt.el.parent().setWidth("auto")}center_panel.items.items[0].getView().refresh()}}}});if(afApp.hasDesktop()){win.render(desktopEl)}if(win.show){win.show()}afApp.pack(win,winConfig,Application);win.on("render",function(win){eval(json.public_source)},null,{single:true});afApp.loadingProgress(maskEl,1);win.on("hide",function(){if(superClass){superClass.onHide(win)}});afApp.layout()};load()};afApp.widgetPopup=function(widget,title,superClass,winConfig,Application){Application=Application?Application:App;var maskEl;try{var viewport=Application.getViewport();maskEl=viewport.layout.center.panel.getEl()}catch(e){maskEl=Ext.getBody()}if(!winConfig){var winConfig={};winConfig.width=800;winConfig.height=500}else{winConfig=eval("({"+unescape(winConfig)+"});");winConfig.width=winConfig.width?winConfig.width:800;winConfig.height=winConfig.height?winConfig.height:500}var getWidgetText=function(widget){if(widget.length>45){return widget.substring(0,20)+"...."+widget.substring(widget.length-20,widget.length)}return widget};widget=widget.replace(document.location.protocol+"//"+document.location.host+afApp.urlPrefix,"");var uri=widget.split("#");uri[0]=uri[0]||"/";var futureTab=uri[1]?"#"+uri[1]:"";var futureHash=uri[0]+futureTab;afApp.currentWidget=uri[0];afApp.observable.fireEvent("beforeload",uri[0]);var win=afApp.getWindow(widget);if(win){win.show()}else{afApp.initLoadingProgress(maskEl);var ajax=Ext.Ajax.request({url:afApp.urlPrefix+uri[0],method:"GET",params:{widget_popup_request:true},success:function(r){var json=Ext.util.JSON.decode(r.responseText);if(json.success===false){Ext.Msg.alert("Failure",json.message);return}else{if(json.redirect&&json.message&&json.load){Ext.Msg.alert("Failure",json.message,function(){afApp.load(json.redirect,json.load)})}else{var total_addons=new Array();if(json.addons&&json.addons.js){for(var i=0;i<json.addons.js.length;i++){var addon=json.addons.js[i];if(!in_array(addon,GLOBAL_JS_VAR)&&addon!=null){total_addons.push(addon)}}}if(json.addons&&json.addons.css){for(var i=0;i<json.addons.css.length;i++){var addon=json.addons.css[i];if(!in_array(addon,GLOBAL_CSS_VAR)&&addon!=null){total_addons.push(addon)}}}Ext.Ajax.extraParams=Ext.Ajax.extraParams||{};Ext.Ajax.extraParams["af_referer"]=futureHash;afApp.executeAddons(total_addons,json,title,superClass,winConfig,Application,widget)}}}})}};afApp.attachHrefWidgetLoad=(function(){var a=function(d){d.stopEvent();var c=Ext.get(d.getTarget());var b=c.dom.href||c.dom.parentNode.href;afApp.load(b)};return function(){var b=Ext.select("a.widgetLoad");b.un("click",a);b.on("click",a)}})();afApp.initLoadingProgress=function(c){c.mask();var a=Ext.getCmp("progress-bar"),b=Ext.get("progress-bar-el");if(!b){b=Ext.DomHelper.append(c,{tag:"div",id:"progress-bar-el",style:"z-index:1000; position:absolute; top:40%; left:40%; width:20%"})}if(!a){a=new Ext.ProgressBar({id:"progress-bar",text:"Loading.... Please wait....."});a.render(b)}else{a.updateProgress(0,"Loading.... Please wait.....");a.show()}};afApp.loadingProgress=function(b,c){var a=Ext.getCmp("progress-bar");a.updateProgress(c,Math.ceil(c*100)+"% complete...");if(!a.isVisible()){a.show()}if(c>=1){b.unmask();setTimeout(function(){a.hide()},500)}};afApp.executeAddonsLoadCenterWidget=function(viewport,addons,json){var pb,counter=0,finish;var load=function(){if(counter>=addons.length){finish();return}if(!Ext.getCmp("progress-bar")){pb=new Ext.ProgressBar()}else{pb=Ext.getCmp("progress-bar")}afApp.loadingProgress(viewport.layout.center.panel.getEl(),(counter+1)/addons.length);var nextAddon=addons[counter++];afApp.createAddon(nextAddon,false,load)};finish=function(){eval(json.source);var panel=viewport.layout.center.panel;panel.add(eval(json.center_panel_first));var divs=Ext.query("div[id=center_panel_first]");if(divs[0]){Ext.fly(divs[0]).remove()}panel.doLayout();afApp.loadingProgress(viewport.layout.center.panel.getEl(),1)};load()};afApp.loadCenterWidget=function(widget){widget=widget.replace(document.location.protocol+"//"+document.location.host+afApp.urlPrefix,"");var uri=widget.split("#");uri[0]=uri[0]||"/";var futureTab=uri[1]?"#"+uri[1]:"";var futureHash=uri[0]+futureTab;afApp.currentWidget=uri[0];afApp.observable.fireEvent("beforeload",uri[0]);var viewport=App.getViewport();afApp.initLoadingProgress(viewport.layout.center.panel.getEl());var ajax=Ext.Ajax.request({url:afApp.urlPrefix+uri[0],method:"GET",params:{widget_load:true},success:function(r){var json=Ext.util.JSON.decode(r.responseText);json.load=json.load?json.load:"center";json.title=json.title?json.title:"...";if(json.success===false){Ext.Msg.alert("Failure",json.message);return}if(json.redirect){afApp.loadingProgress(viewport.layout.center.panel.getEl(),1);if(json.message){Ext.Msg.alert(json.title,json.message,function(){afApp.load(json.redirect,json.load)})}else{afApp.load(json.redirect,json.load)}}else{var total_addons=new Array();if(json.addons&&json.addons.js){for(var i=0;i<json.addons.js.length;i++){var addon=json.addons.js[i];if(!in_array(addon,GLOBAL_JS_VAR)){if(addon!=null){total_addons.push(addon)}}}}if(json.addons&&json.addons.css){for(var i=0;i<json.addons.css.length;i++){var addon=json.addons.css[i];if(!in_array(addon,GLOBAL_CSS_VAR)){if(addon!=null){total_addons.push(addon)}}}}Ext.Ajax.extraParams=Ext.Ajax.extraParams||{};Ext.Ajax.extraParams["af_referer"]=futureHash;afApp.executeAddonsLoadCenterWidget(viewport,total_addons,json)}if(json.executeAfter){eval(json.executeAfter)}},failure:function(response){var msg="Unable to load the content: "+response.status+" "+response.statusText;Ext.Msg.alert("Failure",msg)}})};afApp.logTime=function(n){var c=new Date();var b=c.getDate();var g=c.getMonth();var f=c.getFullYear();var e=c.getHours();var a=c.getMinutes();var d=c.getSeconds();if(console){console.log("[",n,"]",b,"/",g,"/",f," ",e,":",a,":",d," | ",c.getTime())}};afApp.reloadGridsData=function(g){var a=new Array();var m=Ext.getCmp("center_panel_first_portal");if(m){if(m.layoutType=="NORMAL"){a[0]=m}else{if(m.layoutType=="TABBED"){for(var d=0;d<m.items.items.length;d++){a[d]=m.items.items[d].items.items[0]}}}for(var d=0;d<a.length;d++){var b;for(var h=0;h<a[d].items.getCount();h++){b=a[d].items.get(h);if(b.items){for(var e=0;e<b.items.getCount();e++){var f=b.items.get(e);if(g.in_array(f.idxml)&&f.getEl()&&f.getXType().toLowerCase().indexOf("grid")!=-1){f.store.reload()}}}}}}};afApp.load=function(a,b,c,d){if(a=="/false"||!a){return false}b=b||"center";c=c||"_self";d=d||null;if(d&&d.isPopup&&!d.forceRedirect){return false}if(c!="_self"){b="page"}if(a!=""){switch(b){case"page":window.open(a,c,d);break;case"center":a=a.replace(document.location.protocol+"//"+document.location.host,"");if(Ext.History.getToken()!=a){Ext.History.add(a)}else{if(!afApp.hasDesktop()){afApp.loadCenterWidget(a)}else{afApp.widgetPopup(a)}}break}}};afApp.loadPopupHelp=function(d){var a=App.getViewport();var b=new Ext.LoadMask(a.layout.center.panel.getEl(),{msg:"<b>Loading help</b> <br>Please Wait...",removeMask:true});b.show();var c=Ext.Ajax.request({url:afApp.urlPrefix+"/appFlower/popupHelp?idXml="+d,method:"GET",success:function(f){var e=Ext.util.JSON.decode(f.responseText);if(e.redirect&&e.message){b.hide();Ext.Msg.alert("Failure",e.message,function(){window.location.href=e.redirect})}else{Ext.applyIf(e.winConfig,{autoScroll:true,maximizable:true,draggable:true,closeAction:"hide",html:e.html});var g=new Ext.Window(e.winConfig);g.on("show",function(h){var m=h.getPosition();if(m[1]<0){h.setPosition(m[0],0)}});g.doLayout();g.show();g.on("move",function(m,h,n){if(n<0){m.setPosition(h,0)}if(h<100-m.getWidth()){m.setPosition(100-m.getWidth(),n)}if(h>Ext.getBody().getWidth()-100){m.setPosition(Ext.getBody().getWidth()-100,n)}if(n>Ext.getBody().getHeight()-100){m.setPosition(h,Ext.getBody().getHeight()-100)}});b.hide()}}})};afApp.changeTabHash=function(a){var b=document.location.href.split("#");b[1]=b[1]||"/";b[2]=a.slug;var c=b[1]+"#"+b[2];if(Ext.History.getToken()!=c){Ext.History.add(c)}Ext.Ajax.extraParams=Ext.Ajax.extraParams||{};Ext.Ajax.extraParams["af_referer"]=c};afApp.loadFirst=function(b){b=b||false;var e=document.location.href.split("#");e[1]=e[1]||"/";e[2]=e[2]?"#"+e[2]:"";var d=e[1]+e[2];if(!b){var f=App.getNorth();var c=App.getToolbar();f.add(c);f.doLayout();afApp.loadCenterWidget(d)}else{afApp.widgetPopup(d)}if(Boolean(window.console&&window.console.firebug)){var a={title:"Firebug is on :(",message:'If you would like to have a better experience with our products, please disable <b style="color:red;">Firebug</b>. You can do this using this shortcut: <b>SHIFT+F12</b>.<br><br>Thank you,<br>AppFlower Team',type:"ERROR",duration:20};if(b){a.heightPlus=40}new Ext.ux.InstantNotification(a)}};Ext.onReady(function(){afApp.attachHrefWidgetLoad()});Ext.History.on("change",function(b){if(b){var c=b.split("#");if(!afApp.hasDesktop()){if(afApp.currentWidget!=c[0]){afApp.loadCenterWidget(b)}else{if(c[1]){var a=App.getViewport();var d=a.layout.center.panel.items.items[0].items.items[0];if(d.getXType()=="tabpanel"){new Portals().onTabChange(d,c)}}}}else{if(afApp.currentWidget!=c[0]){afApp.widgetPopup(b)}else{if(c[1]){var d=afApp.activeWindow.items.items[0].items.items[0];if(d.getXType()=="tabpanel"){new Portals().onTabChange(d,c)}}}}}});afApp.loadWestWidget=function(b){var d=App.getViewport();var f=d.layout.west.items;var c=d.layout.west.panel.items.items;for(var a=0;a<f.length;a++){if(f[a].id==b){var h=f[a];var e=c[a];if(h.loadClass&&h.loadMethod){var m=new Ext.LoadMask(e.getEl(),{msg:"<b>Loading</b> <br>Please Wait...",removeMask:true});m.show();var g=Ext.Ajax.request({url:afApp.urlPrefix+"/appFlower/loadWestContent",method:"POST",success:function(o){var n=Ext.util.JSON.decode(o.responseText);if(n.title){e.setTitle(n.title)}if(n.html){e.body.dom.innerHTML=n.html}m.hide()},params:{loadClass:h.loadClass,loadMethod:h.loadMethod}})}}}};var keymapX=new Ext.KeyMap(document,{ctrl:true,alt:true,key:Ext.EventObject.X,handler:function(a,b){b.stopEvent();afApp.activeWindow.close()}});afApp.currentWidget=false;afApp.observable=new Ext.util.Observable();Ext.override(Ext.layout.BorderLayout,{southTitleAdded:false,onLayout:function(d,M){var f;if(!this.rendered){M.position();M.addClass("x-border-layout-ct");var B=d.items.items;f=[];for(var F=0,G=B.length;F<G;F++){var J=B[F];var p=J.region;if(J.collapsed){f.push(J)}J.collapsed=false;if(!J.rendered){J.cls=J.cls?J.cls+" x-border-panel":"x-border-panel";J.render(M,F)}this[p]=p!="center"&&J.split?new Ext.layout.BorderLayout.SplitRegion(this,J.initialConfig,p):new Ext.layout.BorderLayout.Region(this,J.initialConfig,p);this[p].render(M,J)}this.rendered=true}var A=M.getViewSize();if(A.width<20||A.height<20){if(f){this.restoreCollapsed=f}return}else{if(this.restoreCollapsed){f=this.restoreCollapsed;delete this.restoreCollapsed}}var x=A.width,H=A.height;var t=x,E=H,q=0,r=0;var C=this.north,y=this.south,o=this.west,I=this.east,J=this.center;if(!J){throw"No center region defined in BorderLayout "+d.id}if(C&&C.isVisible()){var L=C.getSize();var D=C.getMargins();L.width=x-(D.left+D.right);L.x=D.left;L.y=D.top;q=L.height+L.y+D.bottom;E-=q;C.applyLayout(L)}if(y&&y.isVisible()){var L=y.getSize();var D=y.getMargins();L.width=x-(D.left+D.right);L.x=D.left;var K=(L.height+D.top+D.bottom);L.y=H-K+D.top;E-=K;y.applyLayout(L);if(typeof y.collapsedEl!="undefined"&&y.collapsedTitle&&this.southTitleAdded==false){this.southTitleAdded=true;var z=y.collapsedEl;var N=new Ext.Template('<div style="float: left;">{txt}</div>');var u=N.insertFirst(z,{txt:y.collapsedTitle});if(y.collapsedTitleStyle){z.applyStyles(y.collapsedTitleStyle)}if(y.collapsedTitleCls){Ext.get(u).addClass(y.collapsedTitleCls)}}}if(o&&o.isVisible()){var L=o.getSize();var D=o.getMargins();L.height=E-(D.top+D.bottom);L.x=D.left;L.y=q+D.top;var a=(L.width+D.left+D.right);r+=a;t-=a;o.applyLayout(L)}if(I&&I.isVisible()){var L=I.getSize();var D=I.getMargins();L.height=E-(D.top+D.bottom);var a=(L.width+D.left+D.right);L.x=x-a+D.left;L.y=q+D.top;t-=a;I.applyLayout(L)}var D=J.getMargins();var g={x:r+D.left,y:q+D.top,width:t-(D.left+D.right),height:E-(D.top+D.bottom)};J.applyLayout(g);if(f){for(var F=0,G=f.length;F<G;F++){f[F].collapse(false)}}if(Ext.isIE&&Ext.isStrict){M.repaint()}}});var gridUtil=function(b,a){a=Ext.decode(a);var c=function(){if(a.is_ajax){if(a.url=="#"){return}Ext.Ajax.request({url:a.url,params:a.params,success:function(d){if(a.onsuccess=="RELOAD"){b.getStore().reload();if(b.getSelectionModel){var e=b.getSelectionModel();e.clearSelections()}}if(a.onsuccess=="REDIRECT"){window.location.href=a.redirect}}})}else{window.location.href=a.url}};if(!b){alert("Component not found");return}if(a.confirmMsg){Ext.Msg.show({title:"Confirmation required.",msg:a.confirmMsg,buttons:Ext.Msg.YESNOCANCEL,fn:function(d,e){if(d=="yes"){c()}},icon:Ext.MessageBox.QUESTION})}else{c()}};var map=new Ext.KeyMap(document,{shift:true,key:Ext.EventObject.TAB,handler:function(g,m){m.stopEvent();var a=App.getViewport();var f=a.layout.center.panel.items.items[0].items.items[0];if(f.getXType()=="tabpanel"){var d=f.items.items;var b=f.getActiveTab();var c=d.length;for(i=0;i<d.length;i++){if(b.id==d[i].id){if(g==Ext.EventObject.LEFT){var h=(i-1);if(h<0){h=(c-1)}}else{var h=(i+1);if(h>=c){h=0}}f.setActiveTab(d[h].id);return}}}}});Ext.apply(Ext.data.SortTypes,{asText:function(a){return Ext.data.SortTypes.asUCText(a)},htmlAsInt:function(a){return Ext.data.SortTypes.asInt(Ext.data.SortTypes.asUCText(a))},htmlAsFloat:function(a){return Ext.data.SortTypes.asFloat(Ext.data.SortTypes.asUCText(a))},htmlAsText:function(b){var a=/<\S[^>]*>/gi;return String(b).replace(a,"")},asIp:function(e){var f=String(e).split(".");var c="";for(var d=0;d<f.length;d++){var a=3-f[d].length;for(var b=0;b<a;b++){c+="0"}c+=f[d]}return Ext.data.SortTypes.asText(c==""?e:c)},htmlAsIp:function(a){return Ext.data.SortTypes.asIp(Ext.data.SortTypes.asUCText(a))},asSize:function(e){e=e.toUpperCase();var f=e.match(/([a-zA-Z\s]+)/);if(f){f=f[0].replace(/^\s*/,"").replace(/\s*$/,"")}var c=1;var d=[[/^BYTE/,/^KILO/,/^MEGA/,/^GIGA/,/^TERA/,/^PETA/,/^EXA/,/^ZETTA/,/^YOTTA/],[/^B/,/^KB/,/^MB/,/^GB/,/^TB/,/^PB/,/^EB/,/^ZB/,/^YB/],[/^B/,/^K/,/^M/,/^G/,/^T/,/^P/,/^E/,/^Z/,/^Y/]];for(var b=0;b<d.length;b++){for(var a=0;a<d[b].length;a++){if(d[b][a].test(f)){c=1024;c=Math.pow(c,a);break}}}return parseFloat(e)*c},htmlAsSize:function(a){return Ext.data.SortTypes.asSize(Ext.data.SortTypes.asUCText(a))},maskAsIp:function(a){var b=/\b(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\b/;var c=a.match(b);if(!c){return}return Ext.data.SortTypes.htmlAsIp(c[0])}});Ext.override(Ext.form.Checkbox,{onFocus:function(){var a=this.wrap;if(!a){return}a.setStyle("float","left");a.setStyle("height","auto");a.setStyle("border","1px solid #7eadd9");Ext.DomHelper.insertAfter(a,{tag:"div",style:"clear:both"})},onBlur:function(){var a=this.wrap;if(!a){return}a.setStyle("border","0px solid #7eadd9")}});Ext.override(Ext.form.Radio,{onFocus:function(){},onBlur:function(){}});Ext.override(Ext.Button,{onFocus:function(){this.addClass("x-btn-over")},onBlur:function(){this.removeClass("x-btn-over")}});Ext.override(Ext.form.Field,{fireKeys:function(b){if(((Ext.isIE&&b.type=="keydown")||b.type=="keypress")&&b.isSpecialKey()){if(b.getKey()==b.ENTER){if(this.getXType()!="textarea"&&this.getXType()!="superboxselect"){var a=this.findParentByType("form");if(a){Ext.each(a.buttons,function(c){if(c.url&&c.url==a.url){c.handler.call(c.scope)}})}}}}},initEvents:function(){this.el.on("keydown",this.fireKeys,this);this.el.on("keypress",this.fireKeys,this);this.el.on("keyup",this.fireKeys,this);this.el.on("focus",this.onFocus,this);this.el.on("blur",this.onBlur,this)}});Ext.override(Ext.form.TextField,{initValue:function(){if(this.value){this.value=this.value.toString().trim()}if(this.value!==undefined){this.setValue(this.value)}else{if(!Ext.isEmpty(this.el.dom.value)&&this.el.dom.value!=this.emptyText){this.setValue(this.el.dom.value)}}this.originalValue=this.getValue()},preFocus:function(){var a=this.el,b;if(this.emptyText){if(a.dom.value==this.emptyText){this.setRawValue("");b=true}a.removeClass(this.emptyClass)}if(this.SelectOnFocus||b){a.dom.select()}if(this.PasswordFocus){a.dom.setAttribute("type","password")}},beforeBlur:function(){if(this.PasswordFocus&&this.getValue()==""){this.el.dom.setAttribute("type","text");this.reset()}}});Ext.override(Ext.form.HtmlEditor,{markInvalid:function(a){if(!this.rendered||this.preventMark){return}a=a||this.invalidText;switch(this.msgTarget){case"qtip":this.iframe.qtip=a;this.iframe.qclass="x-form-invalid-tip";Ext.get(this.iframe).addClass(this.invalidClass);break;case"side":Ext.get(this.iframe).addClass(this.invalidClass);this.errorDiv=Ext.DomHelper.append(this.wrap,{tag:"div",style:"top:0px;left:"+(this.wrap.getWidth()+85)+"px;z-index:1000;position:absolute;visibility:visible;",cls:"x-form-invalid-icon",qtip:a,qclass:"x-form-invalid-tip"});break}return Ext.form.TextArea.superclass.markInvalid.call(this,[a])},clearInvalid:function(){if(!this.rendered||this.preventMark){return}switch(this.msgTarget){case"qtip":this.iframe.qtip="";Ext.get(this.iframe).removeClass(this.invalidClass);break;case"side":if(this.errorDiv){Ext.get(this.errorDiv).remove()}Ext.get(this.iframe).removeClass(this.invalidClass);break}return Ext.form.TextArea.superclass.clearInvalid.call(this)}});Ext.lib.Event.resolveTextNode=Ext.isGecko?function(b){if(!b){return}var a=HTMLElement.prototype.toString.call(b);if(a=="[xpconnect wrapped native prototype]"||a=="[object XULElement]"){return}return b.nodeType==3?b.parentNode:b}:function(a){return a&&a.nodeType==3?a.parentNode:a};Ext.override(Ext.ToolTip,{onMouseMove:function(d){var a=d.getPageX(),f=d.getPageY();var b=this.delegate?d.getTarget(this.delegate):this.triggerElement=true;if(b){this.targetXY=d.getXY();if(b===this.triggerElement){if(!this.hidden&&this.trackMouse){var c=this.getBox();if(c.x+c.width>Ext.getBody().getWidth()){a=Ext.getBody().getWidth()-(c.width+10);this.targetXY=[a,f]}this.setPagePosition(this.getTargetXY())}}else{this.hide();this.lastActive=new Date(0);this.onTargetOver(d)}}else{if(!this.closable&&this.isVisible()){this.hide()}}}});Ext.override(Ext.Panel,{setIconClass:function(b){var a=this.iconCls;this.iconCls=b;if(this.rendered&&this.header){var d=this.header.dom;var c=d.firstChild&&String(d.firstChild.tagName).toLowerCase()=="img"?d.firstChild:null;if(c){Ext.fly(c).replaceClass(a,this.iconCls)}else{Ext.DomHelper.insertBefore(d.firstChild,{tag:"img",src:Ext.BLANK_IMAGE_URL,cls:"x-panel-inline-icon "+this.iconCls})}}}});Ext.override(Ext.TabPanel,{initTab:function(n,e){var f=new Ext.Template('<li class="{cls}" id="{id}" style="overflow:hidden">','<tpl if="closable">','<a class="x-tab-strip-close"></a>',"</tpl>",'<a class="x-tab-right" href="#" style="padding-left:6px">','<em class="x-tab-left">','<span class="x-tab-strip-inner">','<img src="'+Ext.BLANK_IMAGE_URL+'" style="float:left;margin:3px 3px 0 0">','<span  class="x-tab-strip-text {iconCls}">{text} {extra}</span>',"</span>","</em>","</a>","</li>");f.disableFormats=true;f.compile();Ext.TabPanel.prototype.itemTpl=f;var a=Ext.BLANK_IMAGE_URL;var h="";if(n.icon&&n.icon!=""){a=n.icon}if(n.iconCls&&n.iconCls!=""){h="{iconCls}"}if(n.icon||n.iconCls){var f=new Ext.Template('<li class="{cls}" id="{id}" style="overflow:hidden">','<tpl if="closable">','<a class="x-tab-strip-close"></a>',"</tpl>",'<a class="x-tab-right" href="#" style="padding-left:6px">','<em class="x-tab-left">','<span class="x-tab-strip-inner">','<img src="'+a+'" class="x-tab-strip-text '+h+'" width="16" height="16" style="padding:0px;float:left;margin-top:2px; margin-right:4px">','<span style="'+(n.icon?"margin-left:20px":"")+'" class="x-tab-strip-text ">{text} {extra}</span>',"</span>","</em>","</a>","</li>");f.disableFormats=true;f.compile();Ext.TabPanel.prototype.itemTpl=f}var g=this.strip.dom.childNodes[e],b=this.getTemplateArgs(n),c=g?this.itemTpl.insertBefore(g,b):this.itemTpl.append(this.strip,b),m="x-tab-strip-over",d=Ext.get(c);d.hover(function(){if(!n.disabled){d.addClass(m)}},function(){d.removeClass(m)});if(n.tabTip){d.child("span.x-tab-strip-text",true).qtip=n.tabTip}n.tabEl=c;d.select("a").on("click",function(o){if(!o.getPageX()){this.onStripMouseDown(o)}},this,{preventDefault:true});n.on({scope:this,disable:this.onItemDisabled,enable:this.onItemEnabled,titlechange:this.onItemTitleChanged,iconchange:this.onItemIconChanged,beforeshow:this.onBeforeShowItem})}});
/*
 * Ext JS Library 3.2.1
 * Copyright(c) 2006-2010 Ext JS, Inc.
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
Ext.Loader=Ext.apply({},{load:function(m,h,n,c){var n=n||this,f=document.getElementsByTagName("head")[0],b=document.createDocumentFragment(),a=m.length,g=0,e=this;var o=function(p){f.appendChild(e.buildScriptTag(m[p],d))};var d=function(){g++;if(a==g&&typeof h=="function"){h.call(n)}else{if(c===true){o(g)}}};if(c===true){o.call(this,0)}else{Ext.each(m,function(q,p){b.appendChild(this.buildScriptTag(q,d))},this);f.appendChild(b)}},buildScriptTag:function(b,c){var a=document.createElement("script");a.type="text/javascript";a.src=b;if(a.readyState){a.onreadystatechange=function(){if(a.readyState=="loaded"||a.readyState=="complete"){a.onreadystatechange=null;c()}}}else{a.onload=c}return a}});var pxMatch=/(\d+(?:\.\d+)?)px/;Ext.override(Ext.Element,{getViewSize:function(e){var q=document,g=this,c=g.dom,f=Ext.lib.Dom,m=(c==q||c==q.body),o,r,b,n=0,s=0,a=0,p=0;if(m){return{width:f.getViewWidth(),height:f.getViewHeight()}}o=g.isBorderBox();n=g.getBorderWidth("tb");s=g.getBorderWidth("lr");a=g.getPadding("tb");p=g.getPadding("lr");if(r=g.getStyle("width").match(pxMatch)){if((r=Math.round(r[1]))&&o){r-=(s+p)}if(!e){r+=p}c.clientWidth&&(c.clientWidth<r)&&(r=c.clientWidth)}else{if(!(r=c.clientWidth)&&(r=c.offsetWidth)){r-=s}if(r&&e){r-=p}}if(b=g.getStyle("height").match(pxMatch)){if((b=Math.round(b[1]))&&o){b-=(n+a)}if(!e){b+=a}c.clientHeight&&(c.clientHeight<b)&&(b=c.clientHeight)}else{if(!(b=c.clientHeight)&&(b=c.offsetHeight)){b-=n}if(b&&e){b-=a}}return{width:r,height:b}}});Ext.override(Ext.layout.ColumnLayout,{onLayout:function(e,m,a){var f=e.items.items,g=f.length,n,b;if(!this.innerCt){this.innerCt=m.createChild({cls:"x-column-inner"});this.innerCt.createChild({cls:"x-clear"})}this.renderAll(e,this.innerCt);var q=a||m.getViewSize(true);if(q.width<1&&q.height<1){return}var o=q.width-this.scrollOffset,d=q.height,p=o;this.innerCt.setWidth(o);for(b=0;b<g;b++){n=f[b];if(!n.columnWidth){p-=(n.getSize().width+n.getPositionEl().getMargins("lr"))}}p=p<0?0:p;for(b=0;b<g;b++){n=f[b];if(n.columnWidth){n.setSize(Math.floor(n.columnWidth*p)-n.getPositionEl().getMargins("lr"))}}if(!a&&((q=m.getViewSize(true)).width!=o)){this.onLayout(e,m,q)}}});Ext.isJsonString=function(a){var b=null;try{b=new RegExp('^("(\\\\.|[^"\\\\\\n\\r])*?"|[,:{}\\[\\]0-9.\\-+Eaeflnr-u \\n\\r\\t])+?$')}catch(c){b=/^(true|false|null|\[.*\]|\{.*\}|".*"|\d+|\d+\.\d+)$/}return b.test(a)};Ext.ux.NotificationMgr={positions:[],heights:[]};Ext.ux.Notification=function(a){this.config=Ext.apply({},a)};Ext.ux.Notification=Ext.extend(Ext.Window,{notificationType:"ERROR",heightPlus:0,initComponent:function(){Ext.apply(this,{autoHeight:true,closeAction:"close",plain:false,shadow:false,draggable:false,bodyStyle:"text-align:left;padding:10px;",resizable:false});if(this.autoDestroy){this.task=new Ext.util.DelayedTask(this.close,this)}else{this.closable=true}Ext.ux.Notification.superclass.initComponent.call(this)},setMessage:function(a){this.body.update(a)},onRender:function(b,a){Ext.ux.Notification.superclass.onRender.call(this,b,a)},onDestroy:function(){Ext.ux.NotificationMgr.positions.remove(this.pos);Ext.ux.Notification.superclass.onDestroy.call(this)},afterShow:function(){Ext.ux.Notification.superclass.afterShow.call(this);this.on("move",function(){Ext.ux.NotificationMgr.positions.remove(this.pos);if(this.autoDestroy){this.task.cancel()}},this);if(this.autoDestroy){this.task.delay(this.hideDelay||5000)}},animShow:function(){this.pos=0;var a=0;while(Ext.ux.NotificationMgr.positions.indexOf(this.pos)>-1){a+=Ext.ux.NotificationMgr.heights[this.pos];this.pos++}Ext.ux.NotificationMgr.positions.push(this.pos);Ext.ux.NotificationMgr.heights[this.pos]=this.getSize().height+10;a=a+this.heightPlus;this.el.alignTo(this.animateTarget||document,"br-tr",[-1,-1-(a)]);this.el.slideIn("b",{duration:0.7,callback:this.afterShow,scope:this})},animHide:function(){Ext.ux.NotificationMgr.positions.remove(this.pos);if(this.el){this.el.ghost("b",{duration:1,remove:false})}},start:function(a){new Ext.ux.Notification.start(a)}});Ext.ns("Ext.ux.Notification");Ext.ux.Notification.Base=function(){};Ext.ux.Notification.Base=Ext.extend(Ext.util.Observable,{showNotification:function(a){var b=new Ext.ux.Notification(Ext.apply({animateTarget:this.notificationEl,autoDestroy:false,notificationType:"ERROR"},a));if(b.notificationType=="ERROR"){b.iconCls="icon-notification-error";b.bodyStyle+="background-color:#fddcdc;"}if(b.notificationType=="WARNING"){b.iconCls="icon-notification-warning";b.bodyStyle+="background-color:#fefcc7;"}if(b.notificationType=="INFO"){b.iconCls="icon-notification-info";b.bodyStyle+="background-color:#fff;"}b.bodyStyle+="padding-bottom:20px;";b.show();return b},hideNotification:function(b,a){if(b){b.close.defer(a||3000,b)}},growl:function(d,a,f,b,c){var e=this.showNotification({width:300,notificationType:f,title:d,html:a,heightPlus:c});this.hideNotification(e,b*1000)}});Ext.ux.InstantNotification=Ext.extend(Ext.ux.Notification.Base,{constructor:function(a){Ext.ux.InstantNotification.superclass.constructor.call(this,a);this.notificationEl=Ext.get("growl-notification-el")?Ext.get("growl-notification-el"):Ext.DomHelper.append(Ext.getBody(),{tag:"div",id:"growl-notification-el",style:"width:300px;position:absolute;bottom:0;right:0"});a.type=a.type||"INFO";a.duration=a.duration||10;a.heightPlus=a.heightPlus||0;this.growl(a.title,a.message,a.type,a.duration,a.heightPlus)}});Ext.ux.Notification.start=function(a){Ext.onReady(function(){var b=Ext.get("growl-notification-el")?Ext.get("growl-notification-el"):Ext.DomHelper.append(Ext.getBody(),{tag:"div",id:"growl-notification-el",style:"width:300px;position:absolute;bottom:0;right:0"});this.showNotification=function(d){var e=new Ext.ux.Notification(Ext.apply({animateTarget:b,autoDestroy:false,notificationType:"ERROR"},d));if(e.notificationType=="ERROR"){e.iconCls="icon-notification-error";e.bodyStyle+="background-color:#fddcdc;"}if(e.notificationType=="WARNING"){e.iconCls="icon-notification-warning";e.bodyStyle+="background-color:#fefcc7;"}if(e.notificationType=="INFO"){e.iconCls="icon-notification-info";e.bodyStyle+="background-color:#fff;"}e.bodyStyle+="padding-bottom:20px;";e.show();return e};this.hideNotification=function(e,d){if(e){e.close.defer(d||3000,e)}};this.growl=function(f,d,h,e){var g=this.showNotification({width:300,notificationType:h,title:f,html:d});this.hideNotification(g,e*1000)};this.sendRequest={url:a,success:function(d){var f=Ext.decode(d.responseText);if(f){var e=0;var h=0;var g=500;Ext.each(f.data,function(n){e++;if(n.duration>h){h=n.duration}var m=[];m.push(n.title);m.push(n.message);m.push(n.type);m.push(n.duration);this.growl.defer(g*e,this,m)},this);new Ext.util.DelayedTask(function(){this.ajax.request(Ext.apply(this.sendRequest,{params:{limit:(3-Ext.ux.NotificationMgr.positions.length)}}))}).delay(e*g+10000)}}};this.ajax=Ext.Ajax;this.ajax.timeout=0;this.ajax.request(this.sendRequest);this.ajax.on("requestcomplete",function(d,e,f){},this);function c(){var d=document.title;var f="New Notification !! "+d;var e=setInterval(function(){document.title=document.title==f?" ":f},1000);window.onmousemove=function(){clearInterval(e);document.title=d;window.onmousemove=null}}})};Ext.override(Ext.Container,{render:function(){Ext.Container.superclass.render.apply(this,arguments);if(this.layout){if(typeof this.layout=="string"){this.layout=new Ext.Container.LAYOUTS[this.layout.toLowerCase()](this.layoutConfig)}this.setLayout(this.layout);if(this.activeItem!==undefined){var a=this.activeItem;delete this.activeItem;this.layout.setActiveItem(a)}}if(!this.ownerCt){this.doLayout()}if(this.monitorResize===true){Ext.EventManager.onWindowResize(this.doLayout,this,[false])}}});Ext.override(Ext.layout.Accordion,{setActiveItem:function(a){a=this.container.getComponent(a);if(this.activeItem!=a){if(a.rendered&&a.collapsed){a.expand()}else{this.activeItem=a}}},renderItem:function(a){if(this.animate===false){a.animCollapse=false}a.collapsible=true;if(this.autoWidth){a.autoWidth=true}if(this.titleCollapse){a.titleCollapse=true}if(this.hideCollapseTool){a.hideCollapseTool=true}if(this.collapseFirst!==undefined){a.collapseFirst=this.collapseFirst}if(!this.activeItem&&!a.collapsed){this.activeItem=a}else{if(this.activeItem){a.collapsed=this.activeItem!=a}}Ext.layout.Accordion.superclass.renderItem.apply(this,arguments);a.header.addClass("x-accordion-hd");a.on("beforeexpand",this.beforeExpand,this)}});Ext.ns("Ext.ux");Ext.ux.MaximizeTool=function(){this.init=function(m){var d={id:"maximize",handler:b,scope:m,qtip:"Maximize"};m.tools=m.tools||[];var n=m.tools.slice();m.tools=n;for(var h=0,c=m.tools.length;h<c;h++){if(m.tools[h].id=="maximize"){return}}var g;if(m.tools.length>0){for(var e in m.tools){if(m.tools[e].id=="close"){g=m.tools[e];m.tools.splice(e,1)}}}if(g){m.tools[m.tools.length]=g}if(m.tools.length>0){var f=m.tools[m.tools.length-1];if(f.id=="close"){m.tools[m.tools.length-1]=d;m.tools[m.tools.length]=f}else{m.tools[m.tools.length]=d}}else{m.tools[m.tools.length]=d}};function b(f,e,d){d.originalOwnerCt=d.ownerCt;d.originalPosition=d.ownerCt.items.indexOf(d);d.originalSize=d.getSize();if(!e.window){var c={id:(d.getId()+"-MAX"),width:(Ext.getBody().getSize().width-100),height:(Ext.getBody().getSize().height-100),resizable:true,draggable:true,closable:true,closeAction:"hide",hideBorders:true,plain:true,layout:"fit",autoScroll:true,border:false,bodyBorder:false,frame:true,pinned:true,maximizable:true,bodyStyle:"background-color: #ffffff;"};e.window=new Ext.Window(c);e.window.on("hide",a,d)}if(!d.dummyComponent){var g={title:d.title,width:d.getSize().width,height:d.getSize().height,html:'<div style="margin-top:20px;  text-align:center; font-family:verdana;font-size:10px"><b>'+d.title+"</b><br>This widget is maximized<br><br>Closing the maximized widget window will restore the widget in this area.</div>"};d.dummyComponent=new Ext.Panel(g)}e.window.add(d);if(d.tools["toggle"]){d.tools["toggle"].setVisible(false)}if(d.tools["close"]){d.tools["close"].setVisible(false)}d.tools["maximize"].setVisible(false);d.originalOwnerCt.insert(d.originalPosition,d.dummyComponent);d.originalOwnerCt.doLayout();d.dummyComponent.setSize(d.originalSize);d.dummyComponent.setVisible(true);e.window.show(this)}function a(c){this.dummyComponent.setVisible(false);this.originalOwnerCt.insert(this.originalPosition,this);this.originalOwnerCt.doLayout();this.setSize(this.originalSize);this.tools["maximize"].setVisible(true);if(this.tools["toggle"]){this.tools["toggle"].setVisible(true)}if(this.tools["close"]){this.tools["close"].setVisible(true)}}};
/*
 * Ext JS Library 3.0.0
 * Copyright(c) 2006-2009 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
Ext.ns("Ext.ux");Ext.ux.GroupTabPanel=Ext.extend(Ext.TabPanel,{tabPosition:"left",alternateColor:false,alternateCls:"x-grouptabs-panel-alt",defaultType:"grouptab",deferredRender:false,activeGroup:null,initComponent:function(){Ext.ux.GroupTabPanel.superclass.initComponent.call(this);this.addEvents("beforegroupchange","groupchange");this.elements="body,header";this.stripTarget="header";this.tabPosition=this.tabPosition=="right"?"right":"left";this.addClass("x-grouptabs-panel");if(this.tabStyle&&this.tabStyle!=""){this.addClass("x-grouptabs-panel-"+this.tabStyle)}if(this.alternateColor){this.addClass(this.alternateCls)}this.on("beforeadd",function(b,c,a){this.initGroup(c,a)})},initEvents:function(){this.mon(this.strip,"mousedown",this.onStripMouseDown,this)},onRender:function(c,a){Ext.TabPanel.superclass.onRender.call(this,c,a);if(this.plain){var f=this.tabPosition=="top"?"header":"footer";this[f].addClass("x-tab-panel-"+f+"-plain")}var b=this[this.stripTarget];this.stripWrap=b.createChild({cls:"x-tab-strip-wrap ",cn:{tag:"ul",cls:"x-grouptabs-strip x-grouptabs-tab-strip-"+this.tabPosition}});var e=(this.tabPosition=="bottom"?this.stripWrap:null);this.strip=new Ext.Element(this.stripWrap.dom.firstChild);this.header.addClass("x-grouptabs-panel-header");this.bwrap.addClass("x-grouptabs-bwrap");this.body.addClass("x-tab-panel-body-"+this.tabPosition+" x-grouptabs-panel-body");if(!this.itemTpl){var d=new Ext.Template('<li class="{cls}" id="{id}">','<a class="x-grouptabs-expand" onclick="return false;"></a>','<a class="x-grouptabs-text {iconCls}" href="#" onclick="return false;">',"<span>{text}</span></a>","</li>");d.disableFormats=true;d.compile();Ext.ux.GroupTabPanel.prototype.itemTpl=d}this.items.each(this.initGroup,this)},afterRender:function(){Ext.ux.GroupTabPanel.superclass.afterRender.call(this);this.tabJoint=Ext.fly(this.body.dom.parentNode).createChild({cls:"x-tab-joint"});this.addClass("x-tab-panel-"+this.tabPosition);this.header.setWidth(this.tabWidth);if(this.activeGroup!==undefined){var a=(typeof this.activeGroup=="object")?this.activeGroup:this.items.get(this.activeGroup);delete this.activeGroup;this.setActiveGroup(a);a.setActiveTab(a.getMainItem())}},getGroupEl:Ext.TabPanel.prototype.getTabEl,findTargets:function(c){var b=null;var a=c.getTarget("li",this.strip);if(a){b=this.findById(a.id.split(this.idDelimiter)[1]);if(b.disabled){return{expand:null,item:null,el:null}}}return{expand:c.getTarget(".x-grouptabs-expand",this.strip),isGroup:!c.getTarget("ul.x-grouptabs-sub",this.strip),item:b,el:a}},onStripMouseDown:function(b){if(b.button!=0){return}b.preventDefault();var a=this.findTargets(b);if(a.expand){this.toggleGroup(a.el)}else{if(a.item){if(a.isGroup){a.item.setActiveTab(a.item.getMainItem())}else{a.item.ownerCt.setActiveTab(a.item)}}}},expandGroup:function(a){if(a.isXType){a=this.getGroupEl(a)}Ext.fly(a).addClass("x-grouptabs-expanded")},toggleGroup:function(a){if(a.isXType){a=this.getGroupEl(a)}Ext.fly(a).toggleClass("x-grouptabs-expanded");this.syncTabJoint()},syncTabJoint:function(b){if(!this.tabJoint){return}b=b||this.getGroupEl(this.activeGroup);if(b){this.tabJoint.setHeight(Ext.fly(b).getHeight()-2);var a=Ext.isGecko2?0:1;if(this.tabPosition=="left"){this.tabJoint.alignTo(b,"tl-tr",[-2,a])}else{this.tabJoint.alignTo(b,"tr-tl",[1,a])}}else{this.tabJoint.hide()}},getActiveTab:function(){if(!this.activeGroup){return null}return this.activeGroup.getTabEl(this.activeGroup.activeTab)||null},onResize:function(){Ext.ux.GroupTabPanel.superclass.onResize.apply(this,arguments);this.syncTabJoint()},createCorner:function(a,b){return Ext.fly(a).createChild({cls:"x-grouptabs-corner x-grouptabs-corner-"+b})},initGroup:function(f,b){var d=this.strip.dom.childNodes[b];var e=this.getTemplateArgs(f);if(b===0){e.cls+=" x-tab-first"}e.cls+=" x-grouptabs-main";e.text=f.getMainItem().title;var c=d?this.itemTpl.insertBefore(d,e):this.itemTpl.append(this.strip,e);var a=this.createCorner(c,"top-"+this.tabPosition);var g=this.createCorner(c,"bottom-"+this.tabPosition);if(f.expanded){this.expandGroup(c)}if(Ext.isIE6||(Ext.isIE&&!Ext.isStrict)){g.setLeft("-10px");g.setBottom("-5px");a.setLeft("-10px");a.setTop("-5px")}this.mon(f,"changemainitem",this.onGroupChangeMainItem,this);this.mon(f,"beforetabchange",this.onGroupBeforeTabChange,this)},setActiveGroup:function(b){b=this.getComponent(b);if(!b||this.fireEvent("beforegroupchange",this,b,this.activeGroup)===false){return}if(!this.rendered){this.activeGroup=b;return}if(this.activeGroup!=b){if(this.activeGroup){var a=this.getGroupEl(this.activeGroup);if(a){Ext.fly(a).removeClass("x-grouptabs-strip-active")}this.activeGroup.fireEvent("deactivate",this.activeTab)}var c=this.getGroupEl(b);Ext.fly(c).addClass("x-grouptabs-strip-active");this.activeGroup=b;this.stack.add(b);this.layout.setActiveItem(b);this.syncTabJoint(c);b.fireEvent("activate",b);this.fireEvent("groupchange",this,b)}},onGroupBeforeTabChange:function(a,c,b){if(a!==this.activeGroup||c!==b){this.strip.select(".x-grouptabs-sub > li.x-grouptabs-strip-active",true).removeClass("x-grouptabs-strip-active")}this.expandGroup(this.getGroupEl(a));this.setActiveGroup(a)},getFrameHeight:function(){var a=this.el.getFrameWidth("tb");a+=(this.tbar?this.tbar.getHeight():0)+(this.bbar?this.bbar.getHeight():0);return a},adjustBodyWidth:function(a){return a-this.tabWidth}});Ext.reg("grouptabpanel",Ext.ux.GroupTabPanel);
/*
 * Ext JS Library 3.0.0
 * Copyright(c) 2006-2009 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
Ext.ux.GroupTab=Ext.extend(Ext.Container,{mainItem:0,expanded:true,deferredRender:true,activeTab:null,idDelimiter:"__",headerAsText:false,frame:false,hideBorders:true,initComponent:function(a){Ext.apply(this,a);this.frame=false;Ext.ux.GroupTab.superclass.initComponent.call(this);this.addEvents("activate","deactivate","changemainitem","beforetabchange","tabchange");this.setLayout(new Ext.layout.CardLayout({deferredRender:this.deferredRender}));if(!this.stack){this.stack=Ext.TabPanel.AccessStack()}this.initItems();this.on("beforerender",function(){this.groupEl=this.ownerCt.getGroupEl(this)},this);this.on("add",this.onAdd,this,{target:this});this.on("remove",this.onRemove,this,{target:this});if(this.mainItem!==undefined){var b=(typeof this.mainItem=="object")?this.mainItem:this.items.get(this.mainItem);delete this.mainItem;this.setMainItem(b)}},setActiveTab:function(c){c=this.getComponent(c);if(!c||this.fireEvent("beforetabchange",this,c,this.activeTab)===false){return}if(!this.rendered){this.activeTab=c;return}if(this.activeTab!=c){if(this.activeTab&&this.activeTab!=this.mainItem){var a=this.getTabEl(this.activeTab);if(a){Ext.fly(a).removeClass("x-grouptabs-strip-active")}this.activeTab.fireEvent("deactivate",this.activeTab)}var b=this.getTabEl(c);Ext.fly(b).addClass("x-grouptabs-strip-active");this.activeTab=c;this.stack.add(c);this.layout.setActiveItem(c);if(this.layoutOnTabChange&&c.doLayout){c.doLayout()}if(this.scrolling){this.scrollToTab(c,this.animScroll)}c.fireEvent("activate",c);this.fireEvent("tabchange",this,c)}},getTabEl:function(a){if(a==this.mainItem){return this.groupEl}return Ext.TabPanel.prototype.getTabEl.call(this,a)},onRender:function(b,a){Ext.ux.GroupTab.superclass.onRender.call(this,b,a);this.strip=Ext.fly(this.groupEl).createChild({tag:"ul",cls:"x-grouptabs-sub"});this.tooltip=new Ext.ToolTip({target:this.groupEl,delegate:"a.x-grouptabs-text",trackMouse:true,renderTo:document.body,listeners:{beforeshow:function(e){var d=(e.triggerElement.parentNode===this.mainItem.tabEl)?this.mainItem:this.findById(e.triggerElement.parentNode.id.split(this.idDelimiter)[1]);if(!d.tabTip){return false}e.body.dom.innerHTML=d.tabTip},scope:this}});if(!this.itemTpl){var c=new Ext.Template('<li class="{cls}" id="{id}">','<a onclick="return false;" class="x-grouptabs-text {iconCls}">{text}</a>',"</li>");c.disableFormats=true;c.compile();Ext.ux.GroupTab.prototype.itemTpl=c}this.items.each(this.initTab,this)},afterRender:function(){Ext.ux.GroupTab.superclass.afterRender.call(this);if(this.activeTab!==undefined){var a=(typeof this.activeTab=="object")?this.activeTab:this.items.get(this.activeTab);delete this.activeTab;this.setActiveTab(a)}},initTab:function(c,a){var d=this.strip.dom.childNodes[a];var e=Ext.TabPanel.prototype.getTemplateArgs.call(this,c);if(c===this.mainItem){c.tabEl=this.groupEl;e.cls+=" x-grouptabs-main-item"}var b=d?this.itemTpl.insertBefore(d,e):this.itemTpl.append(this.strip,e);c.tabEl=c.tabEl||b;c.on("disable",this.onItemDisabled,this);c.on("enable",this.onItemEnabled,this);c.on("titlechange",this.onItemTitleChanged,this);c.on("iconchange",this.onItemIconChanged,this);c.on("beforeshow",this.onBeforeShowItem,this)},setMainItem:function(a){a=this.getComponent(a);if(!a||this.fireEvent("changemainitem",this,a,this.mainItem)===false){return}this.mainItem=a},getMainItem:function(){return this.mainItem||null},onBeforeShowItem:function(a){if(a!=this.activeTab){this.setActiveTab(a);return false}},onAdd:function(a,c,b){if(this.rendered){this.initTab.call(this,c,b)}},onRemove:function(c,b){Ext.destroy(Ext.get(this.getTabEl(b)));this.stack.remove(b);b.un("disable",this.onItemDisabled,this);b.un("enable",this.onItemEnabled,this);b.un("titlechange",this.onItemTitleChanged,this);b.un("iconchange",this.onItemIconChanged,this);b.un("beforeshow",this.onBeforeShowItem,this);if(b==this.activeTab){var a=this.stack.next();if(a){this.setActiveTab(a)}else{if(this.items.getCount()>0){this.setActiveTab(0)}else{this.activeTab=null}}}},onBeforeAdd:function(b){var a=b.events?(this.items.containsKey(b.getItemId())?b:null):this.items.get(b);if(a){this.setActiveTab(b);return false}Ext.TabPanel.superclass.onBeforeAdd.apply(this,arguments);var c=b.elements;b.elements=c?c.replace(",header",""):c;b.border=(b.border===true)},onItemDisabled:Ext.TabPanel.prototype.onItemDisabled,onItemEnabled:Ext.TabPanel.prototype.onItemEnabled,onItemTitleChanged:function(b){var a=this.getTabEl(b);if(a){Ext.fly(a).child("a.x-grouptabs-text",true).innerHTML=b.title}},onItemIconChanged:function(d,a,c){var b=this.getTabEl(d);if(b){Ext.fly(b).child("a.x-grouptabs-text").replaceClass(c,a)}},beforeDestroy:function(){Ext.TabPanel.prototype.beforeDestroy.call(this);this.tooltip.destroy()}});Ext.reg("grouptab",Ext.ux.GroupTab);Ext.ux.Portal=Ext.extend(Ext.Panel,{layout:"column",autoScroll:false,bodyStyle:"overflow-x:hidden;overflow-y:scroll;padding-right:5px;",cls:"x-portal",defaultType:"portalcolumn",afterLayoutEvent:false,initComponent:function(){Ext.ux.Portal.superclass.initComponent.call(this);this.addEvents({validatedrop:true,beforedragover:true,dragover:true,beforedrop:true,drop:true,render:true});this.on("drop",this.onWidgetDrop,this);this.on("afterLayout",this.onPortalAfterLayout,this)},onPortalAfterLayout:function(p){if(!this.afterLayoutEvent){var b;for(var o=0;o<this.items.getCount();o++){b=this.items.get(o);if(b.items){for(var u=0;u<b.items.getCount();u++){var g=b.items.get(u);if(g.isXType("form")){var n=g.items.items;if(n.length>0){for(var e=0;e<n.length;e++){if(n[e].items&&n[e].items.items){var a=b.lastSize.width-46;var m=n[e].items.items;var r=a*0.3;var f=a*0.65;var h=a*0.9;r=(r>75)?75:r;f=(f<250)?f:250;input_padding_left=r;for(var d=0;d<m.length;d++){if(!m[d].isXType("htmleditor")&&!m[d].isXType("textarea")&&!m[d].isXType("statictextfield")){if(!m[d].isXType("itemselector")){m[d].setSize(f)}else{m[d].msWidth=f}}if(m[d].isXType("statictextfield")){m[d].setSize(h)}if(m[d].wrap){m[d].wrap.dom.parentNode.style.paddingLeft=input_padding_left+"px"}if(m[d].container&&m[d].container.dom.previousSibling){m[d].container.dom.previousSibling.style.width=r+"px";m[d].container.dom.previousSibling.style.height="10px"}}}else{var t=b.lastSize.width-24;var q=n[e];var r=t*0.3;var f=t*0.7;r=(r>75)?75:r;f=(f<250)?f:250;input_padding_left=r;if(!q.isXType("htmleditor")){if(!q.isXType("itemselector")){q.setSize(f)}else{q.msWidth=f}if(q.wrap){q.wrap.dom.parentNode.style.paddingLeft=input_padding_left+"px"}}}}}}}}}this.afterLayoutEvent=true}},initEvents:function(){Ext.ux.Portal.superclass.initEvents.call(this);this.dd=new Ext.ux.Portal.DropZone(this,this.dropConfig)},beforeDestroy:function(){if(this.dd){this.dd.unreg()}Ext.ux.Portal.superclass.beforeDestroy.call(this)},onWidgetDrop:function(a){var b=this.getConfig();Ext.Ajax.request({url:afApp.urlPrefix+"/appFlower/savePortalState",method:"post",params:{"config":b},success:function(c,d){},failure:function(c,d){if(c.message){Ext.Msg.alert("Failure",c.message)}}})},getPortalTitle:function(){switch(this.getLayoutType()){case"NORMAL":return this.title;case"TABBED":return this.ownerCt.ownerCt.getActiveTab().title}},getLayoutItem:function(){switch(this.getLayoutType()){case"NORMAL":return 0;case"TABBED":return this.ownerCt.ownerCt.items.indexOf(this.ownerCt.ownerCt.getActiveTab())}},getLayoutType:function(){if(this.layoutType){return this.layoutType}else{return this.ownerCt.ownerCt.layoutType}},getIdXml:function(){switch(this.getLayoutType()){case"NORMAL":return this.idxml;case"TABBED":return this.ownerCt.ownerCt.idxml}},getConfig:function(){var e={idXml:this.getIdXml(),layoutType:this.getLayoutType(),layoutItem:this.getLayoutItem(),content:{}};e.content.portalTitle=this.getPortalTitle();e.content.portalLayoutType=this.portalLayoutType;e.content.portalColumns=[[]];e.content.portalLayoutNewType=this.layoutNewType||false;var a;for(var f=0;f<this.items.getCount();f++){a=this.items.get(f);e.content.portalColumns[f]=[];if(a.items){for(var b=0;b<a.items.getCount();b++){e.content.portalColumns[f].push(a.items.get(b).getWidgetConfig())}}}var d=Ext.encode(e);return d},showWidgetSelector:function(a,b){if(this.widgetSelectorWindow){this.widgetSelectorWindow.show(a)}else{this.createWidgetSelector(b,a)}},retrieveWidgets:function(h){var f=this;var a=new Ext.data.JsonReader({fields:[{name:"title",sortType:"asText"},{name:"description",sortType:"asText"},{name:"image",sortType:"asText"},{name:"widget",sortType:"asText"},{name:"message"},{name:"redirect"},{name:"_id",type:"int"},{name:"_parent",type:"auto"},{name:"_is_leaf",type:"bool"},{name:"_color",type:"auto"},{name:"_cell_color",type:"auto"},{name:"_selected",type:"auto"}],id:"_id",totalProperty:"totalCount",root:"rows",properties:"properties"});var g=new Ext.ux.maximgb.tg.AdjacencyListStore({sortInfo:{field:"title",direction:"ASC"},reader:a,remoteSort:false,proxy:new Ext.data.HttpProxy({url:afApp.urlPrefix+"/appFlower/retrieveWidgetsInfo",method:"POST",disableCaching:false}),listeners:{beforeload:function(p,o){if(!Ext.isIE&&!b.disableLoadMask){b.getEl().mask("Loading, please Wait...","x-mask-loading")}},load:function(q,o,p){if(o.length>0&&o[0].json.redirect&&o[0].json.message){var r=o[0].json;Ext.Msg.alert("Failure",r.message,function(){window.location.href=r.redirect})}else{if(!Ext.isIE){b.getEl().unmask()}}},loadexception:function(){if(!Ext.isIE){b.getEl().unmask()}}}});var m=new Ext.ux.CheckboxSelectionModel();var b=new Ext.ux.maximgb.tg.GridPanel({loadMask:true,frame:false,bodyStyle:"border: 1px solid #8db2e3;",autoHeight:true,forceFit:true,select:true,listeners:{render:function(){this.store.load({params:{portalWidgets:Ext.encode(f.portalWidgets),config:f.getConfig()}});var o=b.getColumnModel();if(o.getColumnHeader(o.getColumnCount()-1)=='<div class="x-grid3-hd-checker" id="hd-checker">&#160;</div>'){o.moveColumn(o.getColumnCount()-1,0)}}},viewConfig:{forceFit:true},columns:[{dataIndex:"title",header:"Category > Title",sortable:true,hidden:false,hideable:false,align:"left",id:"title",width:20},{dataIndex:"description",header:"Description",sortable:true,hidden:false,hideable:false,align:"left",id:"description",width:50,renderer:function(q,p,o){var r=Ext.util.Format.htmlEncode(q);return'<span qtip="'+r+'">'+q+"</span>"}},{dataIndex:"image",header:"Image",sortable:true,hidden:false,hideable:true,align:"left",id:"image",width:30},m],master_column_id:"title",store:g,sm:m});var c=new Ext.FormPanel({width:"100%",bodyStyle:"border:0px;padding-left:5px",buttonAlign:"center"});var n=new Ext.form.Hidden({name:"config",value:this.getConfig()});c.add(n);var d=new Ext.form.Hidden({name:"portalWidgets",value:Ext.encode(this.portalWidgets)});c.add(d);c.add(b);var e=new Ext.Button({text:"Save & Refresh Page",icon:"/images/famfamfam/accept.png",cls:"x-btn-text-icon",handler:function(){c.getForm().submit({url:afApp.urlPrefix+"/appFlower/changePortalWidgets",method:"POST",params:{"selections":b.getSelectionModel().getSelectionsJSON(["widget"])},waitMsg:"loading...",failure:function(p,q){var o=function(){if(q.result&&q.result.redirect){window.location.href=q.result.redirect}};if(q.result){if(q.result.message){Ext.Msg.alert("Failure",q.result.message,o)}}else{Ext.Msg.alert("Failure","Some error appeared!",o)}},success:function(o,p){if(p.result.message){Ext.Msg.alert("Success",p.result.message,function(){if(p.result.redirect){window.location.href=p.result.redirect}})}else{if(p.result.redirect){window.location.href=p.result.redirect}}}})}});this.portal=new Ext.ux.Portal({region:"center",buttonAlign:"center",buttons:[e],items:[{columnWidth:1,style:"overflow-x:hidden;overflow-y:scroll;padding:5px;"}]});this.portal.items.items.push(c);this.widgetSelectorWindowConfig.items.push(this.portal);this.widgetSelectorWindow=new Ext.Window(this.widgetSelectorWindowConfig);this.widgetSelectorWindow.show(h);this.mask.hide()},createWidgetSelector:function(b,a){this.widgetSelectorWindowConfig=this.widgetSelectorWindowConfig||{};Ext.applyIf(this.widgetSelectorWindowConfig,{constrain:true,layout:"fit",width:"90%",height:500,maximizable:true,closeAction:"hide",plain:true,modal:true,items:[],title:b});this.mask=new Ext.LoadMask(Ext.getBody(),{msg:"<b>Opening Widget Selector</b> <br>Please Wait...",removeMask:true});this.mask.show();this.retrieveWidgets(a)},showLayoutSelector:function(a,c,b){if(this.layoutSelectorWindow){this.layoutSelectorWindow.show(a)}else{this.createLayoutSelector(c,b);this.layoutSelectorWindow.show(a)}},createLayoutSelector:function(e,d){this.layoutSelectorWindowConfig=this.layoutSelectorWindowConfig||{};Ext.applyIf(this.layoutSelectorWindowConfig,{constrain:true,layout:"fit",width:"60%",height:500,closeAction:"hide",plain:true,modal:true,items:[],title:e});this.portalLC=[];this.portalRC=[];for(var c=0;c<d.length;c++){var a=[];for(var b=0;b<d[c].length;b++){a[b]={};a[b].title=d[c][b]+"%";a[b].columnWidth=d[c][b]/100;if(b<(d[c].length-1)){a[b].style="border-right:1px solid #cc0000;"}}if(c%2==0){this.createLayoutSelectorColumn(this.portalLC,a,d[c])}else{this.createLayoutSelectorColumn(this.portalRC,a,d[c])}}this.portal=new Ext.ux.Portal({region:"center",items:[{columnWidth:0.5,style:"padding:10px 5px 10px 10px",items:this.portalLC},{columnWidth:0.5,style:"padding:10px 10px 10px 5px",items:this.portalRC}]});this.layoutSelectorWindowConfig.items.push(this.portal);this.layoutSelectorWindow=new Ext.Window(this.layoutSelectorWindowConfig)},createLayoutSelectorColumn:function(b,a,c){var e=this;var d=new Ext.Panel({layout:"column",hideBorders:true,style:"border:1px solid #cc0000;cursor:pointer;",items:a,clickEventInstalled:false});d.on("afterlayout",function(f){if(b[0].id!=f.id){d.el.setStyle("marginTop","20px")}for(var g=0;g<f.items.items.length;g++){f.items.items[g].header.setStyle("height","137px");f.items.items[g].header.setStyle("border","0");f.items.items[g].header.dom.firstChild.style.marginLeft="40%"}if(!f.clickEventInstalled){f.el.on("click",function(h,n){this.layoutNewType=Ext.encode(c);var m=this.getConfig();Ext.Ajax.request({url:afApp.urlPrefix+"/appFlower/savePortalState",method:"post",params:{"config":m},success:function(o,p){e.layoutSelectorWindow.hide();o=Ext.decode(o.responseText);if(o.redirect){afApp.load(o.redirect)}},failure:function(o,p){if(o.message){Ext.Msg.alert("Failure",o.message)}}})},this)}f.clickEventInstalled=true},this);b.push(d)}});Ext.reg("portal",Ext.ux.Portal);Ext.ux.Portal.DropZone=function(a,b){this.portal=a;Ext.dd.ScrollManager.register(a.body);Ext.ux.Portal.DropZone.superclass.constructor.call(this,a.bwrap.dom,b);a.body.ddScrollConfig=this.ddScrollConfig};Ext.extend(Ext.ux.Portal.DropZone,Ext.dd.DropTarget,{ddScrollConfig:{vthresh:50,hthresh:-1,animate:true,increment:200},createEvent:function(a,f,d,b,h,g){return{portal:this.portal,panel:d.panel,columnIndex:b,column:h,position:g,data:d,source:a,rawEvent:f,status:this.dropAllowed}},notifyOver:function(z,x,A){var f=x.getXY(),a=this.portal,r=z.proxy;if(!this.grid){this.grid=this.getGrid()}var b=a.body.dom.clientWidth;if(!this.lastCW){this.lastCW=b}else{if(this.lastCW!=b){this.lastCW=b;a.doLayout();this.grid=this.getGrid()}}var d=0,o=this.grid.columnX,q=false;for(var u=o.length;d<u;d++){if(f[0]<(o[d].x+o[d].w)){q=true;break}}if(!q){d--}var t,n=false,m=0,y=a.items.itemAt(d),s=y.items.items;for(var u=s.length;m<u;m++){t=s[m];var w=t.el.getHeight();if(w!==0&&(t.el.getY()+(w/2))>f[1]){n=true;break}}var g=this.createEvent(z,x,A,d,y,n&&t?m:y.items.getCount());if(a.fireEvent("validatedrop",g)!==false&&a.fireEvent("beforedragover",g)!==false){r.getProxy().setWidth("auto");if(t){r.moveProxy(t.el.dom.parentNode,n?t.el.dom:null)}else{r.moveProxy(y.el.dom,null)}this.lastPos={c:y,col:d,p:n&&t?m:false};this.scrollPos=a.body.getScroll();a.fireEvent("dragover",g);return g.status}else{return g.status}},notifyOut:function(){delete this.grid},notifyDrop:function(z,w,A){delete this.grid;if(!this.lastPos){return}var y=this.lastPos.c,g=this.lastPos.col,h=this.lastPos.p;var q=this.createEvent(z,w,A,g,y,h!==false?h:y.items.getCount());if(this.portal.fireEvent("validatedrop",q)!==false&&this.portal.fireEvent("beforedrop",q)!==false){z.proxy.getProxy().remove();z.panel.el.dom.parentNode.removeChild(z.panel.el.dom);if(h!==false){y.insert(h,z.panel)}else{y.add(z.panel)}var b=z.panel;b.el.resize(y.lastSize.width-10);if(b.getXType()=="grid"||b.getXType()=="ux-maximgb-treegrid"){b.store.reload();b.body.resize(y.lastSize.width-14)}else{if(b.getXType()=="form"){b.body.resize(y.lastSize.width-14);var p=b.items.items;for(var u=0;u<p.length;u++){if(p[u].items){p[u].setSize(y.lastSize.width-24);var m=y.lastSize.width-46;var a=p[u].items.items;var f=m*0.3;var s=m*0.65;f=(f>75)?75:f;s=(s<250)?s:250;input_padding_left=f;for(var t=0;t<a.length;t++){if(!a[t].isXType("htmleditor")){if(!a[t].isXType("itemselector")){a[t].setSize(s)}else{a[t].msWidth=s}if(a[t].wrap){a[t].wrap.dom.parentNode.style.paddingLeft=input_padding_left+"px"}if(a[t].container&&a[t].container.dom.previousSibling){a[t].container.dom.previousSibling.style.width=f+"px";a[t].container.dom.previousSibling.style.height="40px"}}}}else{var n=y.lastSize.width-24;var o=p[u];var f=n*0.3;var s=n*0.7;f=(f>75)?75:f;s=(s<250)?s:250;input_padding_left=f;if(!o.isXType("htmleditor")){if(!o.isXType("itemselector")){o.setSize(s)}else{o.msWidth=s}if(o.wrap){o.wrap.dom.parentNode.style.paddingLeft=input_padding_left+"px"}}}}}else{if(b.getXType()=="panel"){b.body.resize(y.lastSize.width-14)}}}y.doLayout();this.portal.fireEvent("drop",q);var r=this.scrollPos.top;if(r){var x=this.portal.body.dom;setTimeout(function(){x.scrollTop=r},10)}}delete this.lastPos},getGrid:function(){var a=this.portal.bwrap.getBox();a.columnX=[];this.portal.items.each(function(b){a.columnX.push({x:b.el.getX(),w:b.el.getWidth()})});return a},unreg:function(){Ext.ux.Portal.DropZone.superclass.unreg.call(this)}});Ext.ux.PortalColumn=Ext.extend(Ext.Container,{layout:"anchor",autoEl:"div",defaultType:"portlet",cls:"x-portal-column"});Ext.reg("portalcolumn",Ext.ux.PortalColumn);Ext.ux.Portlet=Ext.extend(Ext.Panel,{anchor:"100%",frame:true,collapsible:true,draggable:true,cls:"x-portlet"});Ext.reg("portlet",Ext.ux.Portlet);SampleGrid=function(h){function c(m){return"<i>"+m+"</i>"}function g(m){if(m>0){return'<span style="color:green;">'+m+"</span>"}else{if(m<0){return'<span style="color:red;">'+m+"</span>"}}return m}function b(m){if(m>0){return'<span style="color:green;">'+m+"%</span>"}else{if(m<0){return'<span style="color:red;">'+m+"%</span>"}}return m}var e=[{id:"company",header:"Company",width:160,sortable:true,dataIndex:"company"},{header:"Price",width:75,sortable:true,renderer:Ext.util.Format.usMoney,dataIndex:"price"},{header:"Change",width:75,sortable:true,renderer:g,dataIndex:"change"},{header:"% Change",width:75,sortable:true,renderer:b,dataIndex:"pctChange"},{header:"Last Updated",width:85,sortable:true,renderer:Ext.util.Format.dateRenderer("m/d/Y"),dataIndex:"lastChange"}];if(h){var f=[];for(var d=0,a=h.length;d<a;d++){f.push(e[h[d]])}e=f}SampleGrid.superclass.constructor.call(this,{store:new Ext.data.Store({reader:new Ext.data.ArrayReader({},[{name:"company"},{name:"price",type:"float"},{name:"change",type:"float"},{name:"pctChange",type:"float"},{name:"lastChange",type:"date",dateFormat:"n/j h:ia"}]),data:[["3m Co",71.72,0.02,0.03,"9/1 12:00am"],["Alcoa Inc",29.01,0.42,1.47,"9/1 12:00am"],["Altria Group Inc",83.81,0.28,0.34,"9/1 12:00am"],["American Express Company",52.55,0.01,0.02,"9/1 12:00am"],["American International Group, Inc.",64.13,0.31,0.49,"9/1 12:00am"],["AT&T Inc.",31.61,-0.48,-1.54,"9/1 12:00am"],["Boeing Co.",75.43,0.53,0.71,"9/1 12:00am"],["Caterpillar Inc.",67.27,0.92,1.39,"9/1 12:00am"],["Citigroup, Inc.",49.37,0.02,0.04,"9/1 12:00am"],["E.I. du Pont de Nemours and Company",40.48,0.51,1.28,"9/1 12:00am"],["Exxon Mobil Corp",68.1,-0.43,-0.64,"9/1 12:00am"],["General Electric Company",34.14,-0.08,-0.23,"9/1 12:00am"],["General Motors Corporation",30.27,1.09,3.74,"9/1 12:00am"],["Hewlett-Packard Co.",36.53,-0.03,-0.08,"9/1 12:00am"],["Honeywell Intl Inc",38.77,0.05,0.13,"9/1 12:00am"],["Intel Corporation",19.88,0.31,1.58,"9/1 12:00am"],["International Business Machines",81.41,0.44,0.54,"9/1 12:00am"],["Johnson & Johnson",64.72,0.06,0.09,"9/1 12:00am"],["JP Morgan & Chase & Co",45.73,0.07,0.15,"9/1 12:00am"],["McDonald's Corporation",36.76,0.86,2.4,"9/1 12:00am"],["Merck & Co., Inc.",40.96,0.41,1.01,"9/1 12:00am"],["Microsoft Corporation",25.84,0.14,0.54,"9/1 12:00am"],["Pfizer Inc",27.96,0.4,1.45,"9/1 12:00am"],["The Coca-Cola Company",45.07,0.26,0.58,"9/1 12:00am"],["The Home Depot, Inc.",34.64,0.35,1.02,"9/1 12:00am"],["The Procter & Gamble Company",61.91,0.01,0.02,"9/1 12:00am"],["United Technologies Corporation",63.26,0.55,0.88,"9/1 12:00am"],["Verizon Communications",35.57,0.39,1.11,"9/1 12:00am"],["Wal-Mart Stores, Inc.",45.45,0.73,1.63,"9/1 12:00am"]]}),columns:e,autoExpandColumn:"company",height:250,width:600})};Ext.extend(SampleGrid,Ext.grid.GridPanel);Ext.ux.TabMenu=function(){var a,c,b;this.init=function(e){a=e;a.on("contextmenu",d)};function d(h,g,m){if(!c){c=new Ext.menu.Menu([{id:a.id+"-save",text:"Save",handler:function(){Ext.Ajax.request({url:b.fileContentUrl,method:"post",params:{"file":b.file,"code":b.getCode()},success:function(e,o){Ext.Msg.alert("","The file '"+b.file+"' was saved !")},failure:function(){Ext.Msg.alert("","The server can't save '"+b.file+"' !")}})}},{id:a.id+"-close",text:"Close Tab",handler:function(){a.remove(b)}},{id:a.id+"-close-others",text:"Close Other Tabs",handler:function(){a.items.each(function(e){if(e.closable&&e!=b){a.remove(e)}})}}])}b=g;var f=c.items;f.get(a.id+"-close").setDisabled(!g.closable);var n=true;a.items.each(function(){if(this!=g&&this.closable){n=false;return false}});if(g.title=="No file"){f.get(a.id+"-save").setDisabled(true)}else{f.get(a.id+"-save").setDisabled(false)}f.get(a.id+"-close-others").setDisabled(n);c.showAt(m.getPoint())}};function Portals(){var a=this;this.input=false;this.window=false;this.createNewTab=function(e,b,d){var c=new Array();c.push({text:"Create now",handler:function(){if(a.input.getValue()!=""){var f=new Ext.ux.Portal({region:"center",portalLayoutType:"[100]",portalWidgets:d,bodyBorder:false,style:"padding-right:5px;",bodyStyle:"overflow-x:hidden;overflow-y:hidden;padding-right:5px;",items:[{columnWidth:1,style:"padding:10px 0 10px 10px;",items:[]}]});b.add({title:a.input.getValue(),items:[f]}).show();f.showWidgetSelector(e,"Widget Selector for "+a.input.getValue());a.window.hide()}}});c.push({text:"Cancel",handler:function(){a.window.hide()}});this.showInputWindow(c)};this.removeTab=function(f,d){var e=d.getActiveTab();var c=e.items.items[0].getConfig();var b=d.items.indexOf(e);if(b==0&&d.items.length==1){Ext.Msg.alert("Failure","You can't remove the only tab in this portal!")}else{Ext.Msg.confirm("Confirmation","Are you sure you would like to remove this tab?",function(g){if(g=="yes"){Ext.Ajax.request({url:"/appFlower/removePortalState",method:"post",params:{"config":c},success:function(h,m){d.remove(e,true);d.setActiveTab()},failure:function(h,m){if(h.message){Ext.Msg.alert("Failure",h.message)}}})}})}};this.reset=function(d,b){var c=b.getConfig();Ext.Msg.confirm("Confirmation","<b>Are you sure you would like to reset the page?</b><br>This will reset the content to the default one!",function(e){if(e=="yes"){Ext.Ajax.request({url:"/appFlower/resetPortalState",method:"post",params:{"config":c},success:function(f,g){window.location.reload()},failure:function(f,g){if(f.message){Ext.Msg.alert("Failure",f.message)}}})}})};this.changeTitle=function(e,b){var c=b.getActiveTab();var d=new Array();d.push({text:"Save",handler:function(){if(a.input.getValue()!=""&&a.input.getValue()!=c.title){c.setTitle(a.input.getValue());var f=c.items.items[0].getConfig();Ext.Ajax.request({url:"/appFlower/savePortalState",method:"post",params:{"config":f},success:function(g,h){},failure:function(g,h){if(g.message){Ext.Msg.alert("Failure",g.message)}}});a.window.hide()}}});d.push({text:"Cancel",handler:function(){a.window.hide()}});this.showInputWindow(d,c.title)};this.showInputWindow=function(c,b){if(!this.input){this.input=new Ext.form.TextField({width:150,height:50,style:"font-size:20px;"})}if(!this.window){this.window=new Ext.Window({layout:"fit",title:"Choose tab title",closeAction:"hide",width:200,height:100,plain:true,items:[a.input],buttons:c})}if(b){this.input.setValue(b)}this.window.show()};this.onTabChange=function(e,c){e.afterLayoutOnceEvent=true;if(c==null){c=document.location.href.split("#")}var b=0;for(var d=0;d<e.items.items.length;d++){if(e.items.items[d].slug==c[c.length-1]){b=d}}e.setActiveTab(b)}}if(Ext.version=="3.0"){Ext.override(Ext.grid.GridView,{ensureVisible:function(x,f,e){var u=this.resolveCell(x,f,e);if(!u||!u.row){return}var n=u.row,g=u.cell,r=this.scroller.dom,w=0,d=n,s=this.el.dom;var d=n,s=this.el.dom;while(d&&d!=s){w+=d.offsetTop;d=d.offsetParent}w-=this.mainHd.dom.offsetHeight;var t=w+n.offsetHeight;var a=r.clientHeight;var s=parseInt(r.scrollTop,10);var q=s+a;if(w<s){r.scrollTop=w}else{if(t>q){r.scrollTop=t-a}}if(e!==false){var o=parseInt(g.offsetLeft,10);var m=o+g.offsetWidth;var h=parseInt(r.scrollLeft,10);var b=h+r.clientWidth;if(o<h){r.scrollLeft=o}else{if(m>b){r.scrollLeft=m-r.clientWidth}}}return this.getResolvedXY(u)}})}Ext.namespace("Ext.ux.maximgb.tg");Ext.ux.maximgb.tg.AbstractTreeStore=Ext.extend(Ext.data.Store,{leaf_field_name:"_is_leaf",page_offset:0,active_node:null,constructor:function(a){Ext.ux.maximgb.tg.AbstractTreeStore.superclass.constructor.call(this,a);if(!this.paramNames.active_node){this.paramNames.active_node="anode"}this.addEvents("beforeexpandnode","expandnode","expandnodefailed","beforecollapsenode","collapsenode","beforeactivenodechange","activenodechange")},remove:function(a){if(a===this.active_node){this.setActiveNode(null)}this.removeNodeDescendants(a);Ext.ux.maximgb.tg.AbstractTreeStore.superclass.remove.call(this,a)},removeNodeDescendants:function(d){var c,a,b=this.getNodeChildren(d);for(c=0,a=b.length;c<a;c++){this.remove(b[c])}},load:function(a){if(a){if(a.params){if(a.params[this.paramNames.active_node]===undefined){a.params[this.paramNames.active_node]=this.active_node?this.active_node.id:null}}else{a.params={};a.params[this.paramNames.active_node]=this.active_node?this.active_node.id:null}}else{a={params:{}};a.params[this.paramNames.active_node]=this.active_node?this.active_node.id:null}if(a.params[this.paramNames.active_node]!==null){a.add=true}return Ext.ux.maximgb.tg.AbstractTreeStore.superclass.load.call(this,a)},loadRecords:function(b,u,m){if(!b||m===false){if(m!==false){this.fireEvent("load",this,[],u)}if(u.callback){u.callback.call(u.scope||this,[],u,false)}return}var a=b.records,s=b.totalRecords||a.length,n=this.getPageOffsetFromOptions(u),q=this.getLoadedNodeIdFromOptions(u),h,c,f,e,g,d,p=this;if(!u||u.add!==true){if(this.pruneModifiedRecords){this.modified=[]}for(var c=0,f=a.length;c<f;c++){a[c].join(this)}if(this.snapshot){this.data=this.snapshot;delete this.snapshot}this.data.clear();this.data.addAll(a);this.page_offset=n;this.totalLength=s;this.applySort();this.fireEvent("datachanged",this)}else{if(q){h=this.getById(q)}if(h){this.setNodeChildrenOffset(h,n);this.setNodeChildrenTotalCount(h,Math.max(s,a.length));this.removeNodeDescendants(h)}this.suspendEvents();d={};for(c=0,f=a.length;c<f;c++){e=a[c];g=this.indexOfId(e.id);if(g==-1){d[e.id]=false}else{d[e.id]=true;this.setNodeExpanded(e,this.isExpandedNode(this.getAt(g)))}this.add(e)}this.applySort();this.resumeEvents();a.sort(function(w,o){var x=p.data.indexOf(w),t=p.data.indexOf(o),y;if(x>t){y=1}else{y=-1}return y});for(c=0,f=a.length;c<f;c++){e=a[c];if(d[e.id]==true){this.fireEvent("update",this,e,Ext.data.Record.COMMIT)}else{this.fireEvent("add",this,[e],this.data.indexOf(e))}}}this.fireEvent("load",this,a,u);if(u.callback){u.callback.call(u.scope||this,a,u,true)}},sort:function(b,a){if(this.remoteSort){this.setActiveNode(null);if(this.lastOptions){this.lastOptions.add=false;if(this.lastOptions.params){this.lastOptions.params[this.paramNames.active_node]=null}}}return Ext.ux.maximgb.tg.AbstractTreeStore.superclass.sort.call(this,b,a)},applySort:function(){if(this.sortInfo&&!this.remoteSort){var a=this.sortInfo,b=a.field;this.sortData(b,a.direction)}else{this.applyTreeSort()}},sortData:function(c,d){d=d||"ASC";var a=this.fields.get(c).sortType;var b=function(f,e){var h=a(f.data[c]),g=a(e.data[c]);return h>g?1:(h<g?-1:0)};this.data.sort(d,b);if(this.snapshot&&this.snapshot!=this.data){this.snapshot.sort(d,b)}this.applyTreeSort()},applyTreeSort:function(){var e,a,d,f,c=[],b=this.getRootNodes();for(e=0,a=b.length;e<a;e++){f=b[e];c.push(f);this.collectNodeChildrenTreeSorted(c,f)}if(c.length>0){this.data.clear();this.data.addAll(c)}if(this.snapshot&&this.snapshot!==this.data){d=this.data;this.data=this.snapshot;this.snapshot=null;this.applyTreeSort();this.snapshot=this.data;this.data=d}},collectNodeChildrenTreeSorted:function(b,e){var d,a,f,c=this.getNodeChildren(e);for(d=0,a=c.length;d<a;d++){f=c[d];b.push(f);this.collectNodeChildrenTreeSorted(b,f)}},getActiveNode:function(){return this.active_node},setActiveNode:function(a){if(this.active_node!==a){if(a){if(this.data.indexOf(a)!=-1){if(this.fireEvent("beforeactivenodechange",this,this.active_node,a)!==false){this.active_node=a;this.fireEvent("activenodechange",this,this.active_node,a)}}else{throw"Given record is not from the store."}}else{if(this.fireEvent("beforeactivenodechange",this,this.active_node,a)!==false){this.active_node=a;this.fireEvent("activenodechange",this,this.active_node,a)}}}},isExpandedNode:function(a){return a.ux_maximgb_tg_expanded===true},setNodeExpanded:function(b,a){b.ux_maximgb_tg_expanded=a},isVisibleNode:function(e){var c,b,d=this.getNodeAncestors(e),a=true;for(c=0,b=d.length;c<b;c++){a=a&&this.isExpandedNode(d[c]);if(!a){break}}return a},isLeafNode:function(a){return a.get(this.leaf_field_name)==true},isLoadedNode:function(b){var a;if(b.ux_maximgb_tg_loaded!==undefined){a=b.ux_maximgb_tg_loaded}else{if(this.isLeafNode(b)||this.hasChildNodes(b)){a=true}else{a=false}}return a},setNodeLoaded:function(b,a){b.ux_maximgb_tg_loaded=a},getNodeChildrenOffset:function(a){return a.ux_maximgb_tg_offset||0},setNodeChildrenOffset:function(b,a){b.ux_maximgb_tg_offset=a},getNodeChildrenTotalCount:function(a){return a.ux_maximgb_tg_total||0},setNodeChildrenTotalCount:function(b,a){b.ux_maximgb_tg_total=a},collapseNode:function(a){if(this.isExpandedNode(a)&&this.fireEvent("beforecollapsenode",this,a)!==false){this.setNodeExpanded(a,false);this.fireEvent("collapsenode",this,a)}},expandNode:function(a){var b;if(!this.isExpandedNode(a)&&this.fireEvent("beforeexpandnode",this,a)!==false){if(this.isLoadedNode(a)){this.setNodeExpanded(a,true);this.fireEvent("expandnode",this,a)}else{b={};b[this.paramNames.active_node]=a.id;this.load({add:true,params:b,callback:this.expandNodeCallback,scope:this})}}},expandNodeCallback:function(b,a,d){var c=this.getById(a.params[this.paramNames.active_node]);if(d&&c){this.setNodeLoaded(c,true);this.setNodeExpanded(c,true);this.fireEvent("expandnode",this,c)}else{this.fireEvent("expandnodefailed",this,a.params[this.paramNames.active_node],c)}},expandAll:function(){var d,c,a,b=this.data.getRange();this.suspendEvents();for(c=0,a=b.length;c<a;c++){d=b[c];if(!this.isExpandedNode(d)){this.expandNode(d)}}this.resumeEvents();this.fireEvent("datachanged",this)},collapseAll:function(){var d,c,a,b=this.data.getRange();this.suspendEvents();for(c=0,a=b.length;c<a;c++){d=b[c];if(this.isExpandedNode(d)){this.collapseNode(d)}}this.resumeEvents();this.fireEvent("datachanged",this)},getLoadedNodeIdFromOptions:function(b){var a=null;if(b&&b.params&&b.params[this.paramNames.active_node]){a=b.params[this.paramNames.active_node]}return a},getPageOffsetFromOptions:function(b){var a=0;if(b&&b.params&&b.params[this.paramNames.start]){a=parseInt(b.params[this.paramNames.start],10);if(isNaN(a)){a=0}}return a},hasNextSiblingNode:function(a){return this.getNodeNextSibling(a)!==null},hasPrevSiblingNode:function(a){return this.getNodePrevSibling(a)!==null},hasChildNodes:function(a){return this.getNodeChildrenCount(a)>0},getNodeAncestors:function(c){var b=[],a;a=this.getNodeParent(c);while(a){b.push(a);a=this.getNodeParent(a)}return b},getNodeChildrenCount:function(a){return this.getNodeChildren(a).length},getNodeNextSibling:function(d){var e,c,b,a=null;c=this.getNodeParent(d);if(c){e=this.getNodeChildren(c)}else{e=this.getRootNodes()}b=e.indexOf(d);if(b<e.length-1){a=e[b+1]}return a},getNodePrevSibling:function(d){var e,c,b,a=null;c=this.getNodeParent(d);if(c){e=this.getNodeChildren(c)}else{e=this.getRootNodes()}b=e.indexOf(d);if(b>0){a=e[b-1]}return a},getRootNodes:function(){throw"Abstract method call"},getNodeDepth:function(a){throw"Abstract method call"},getNodeParent:function(a){throw"Abstract method call"},getNodeChildren:function(a){throw"Abstract method call"},addToNode:function(a,b){throw"Abstract method call"},removeFromNode:function(a,b){throw"Abstract method call"},getPageOffset:function(){return this.page_offset},getActiveNodePageOffset:function(){var a;if(this.active_node){a=this.getNodeChildrenOffset(this.active_node)}else{a=this.getPageOffset()}return a},getActiveNodeCount:function(){var a;if(this.active_node){a=this.getNodeChildrenCount(this.active_node)}else{a=this.getRootNodes().length}return a},getActiveNodeTotalCount:function(){var a;if(this.active_node){a=this.getNodeChildrenTotalCount(this.active_node)}else{a=this.getTotalCount()}return a}});Ext.ux.maximgb.tg.AdjacencyListStore=Ext.extend(Ext.ux.maximgb.tg.AbstractTreeStore,{parent_id_field_name:"_parent",color_field_name:"_color",buttonOnColumn_field_name:"_buttonOnColumn",buttonText_field_name:"_buttonText",buttonDescription_field_name:"_buttonDescription",selected_field_name:"_selected",getRootNodes:function(){var d,b,a=[],c=this.data.getRange();for(d=0,b=c.length;d<b;d++){if(c[d].get(this.parent_id_field_name)==null){a.push(c[d])}}return a},getNodeDepth:function(a){return this.getNodeAncestors(a).length},getNodeParent:function(a){return this.getById(a.get(this.parent_id_field_name))},getNodeChildren:function(e){var d,b,a=[],c=this.data.getRange();for(d=0,b=c.length;d<b;d++){if(c[d].get(this.parent_id_field_name)==e.id){a.push(c[d])}}return a},addToNode:function(a,b){b.set(this.parent_id_field_name,a.id);this.addSorted(b)},removeFromNode:function(a,b){this.remove(b)}});Ext.reg("Ext.ux.maximgb.tg.AdjacencyListStore",Ext.ux.maximgb.tg.AdjacencyListStore);Ext.ux.maximgb.tg.NestedSetStore=Ext.extend(Ext.ux.maximgb.tg.AbstractTreeStore,{left_field_name:"_lft",right_field_name:"_rgt",level_field_name:"_level",root_node_level:1,getRootNodes:function(){var d,b,a=[],c=this.data.getRange();for(d=0,b=c.length;d<b;d++){if(c[d].get(this.level_field_name)==this.root_node_level){a.push(c[d])}}return a},getNodeDepth:function(a){return a.get(this.level_field_name)-this.root_node_level},getNodeParent:function(a){var p=null,g,f=this.data.getRange(),h,m,o,e,n,d,c,b;o=a.get(this.left_field_name);n=a.get(this.right_field_name);c=a.get(this.level_field_name);for(h=0,m=f.length;h<m;h++){g=f[h];e=g.get(this.left_field_name);d=g.get(this.right_field_name);b=g.get(this.level_field_name);if(b==c-1&&e<o&&d>n){p=g;break}}return p},getNodeChildren:function(a){var m,e,h,d,b,c,f,g,n=[];f=this.data.getRange();m=a.get(this.left_field_name);h=a.get(this.right_field_name);b=a.get(this.level_field_name);for(i=0,len=f.length;i<len;i++){g=f[i];e=g.get(this.left_field_name);d=g.get(this.right_field_name);c=g.get(this.level_field_name);if(c==b+1&&e>m&&d<h){n.push(g)}}return n}});Ext.ux.maximgb.tg.GridView=Ext.extend(Ext.grid.GridView,{expanded_icon_class:"ux-maximgb-tg-elbow-minus",last_expanded_icon_class:"ux-maximgb-tg-elbow-end-minus",collapsed_icon_class:"ux-maximgb-tg-elbow-plus",last_collapsed_icon_class:"ux-maximgb-tg-elbow-end-plus",skip_width_update_class:"ux-maximgb-tg-skip-width-update",initTemplates:function(){var a=this.templates||{};if(!a.row){a.row=new Ext.Template('<div class="x-grid3-row ux-maximgb-tg-level-{level} {alt}" style="{tstyle} {display_style} {color}">','<table class="x-grid3-row-table" border="0" cellspacing="0" cellpadding="0" style="{tstyle}">',"<tbody>","<tr>{cells}</tr>",(this.enableRowBody?'<tr class="x-grid3-row-body-tr" style="{bodyStyle}">'+'<td colspan="{cols}" class="x-grid3-body-cell" tabIndex="0" hidefocus="on">'+'<div class="x-grid3-row-body">{body}</div>'+"</td>"+"</tr>":""),"</tbody>","</table>","</div>")}if(!a.mastercell){a.mastercell=new Ext.Template('<td class="x-grid3-col x-grid3-cell x-grid3-td-{id} {css}" style="{style}" tabIndex="0" {cellAttr}>','<div class="ux-maximgb-tg-mastercell-wrap">',"{treeui}",'<div class="x-grid3-cell-inner x-grid3-col-{id}" unselectable="on" {attr} style="{cell_color}"><span style="float:{value_align};">{value}</span> {button}</div>',"</div>","</td>")}if(!a.treeui){a.treeui=new Ext.Template('<div class="ux-maximgb-tg-uiwrap" style="width: {wrap_width}px">',"{elbow_line}",'<div style="left: {left}px" class="{cls}">&#160;</div>',"</div>")}if(!a.elbow_line){a.elbow_line=new Ext.Template('<div style="left: {left}px" class="{cls}">&#160;</div>')}this.templates=a;Ext.ux.maximgb.tg.GridView.superclass.initTemplates.call(this)},doRender:function(g,m,u,a,t,C){var b=this.templates,f=b.cell,h=b.row,n=t-1;var d="width:"+this.getTotalWidth()+";";var G=[],x,H,y={},o={tstyle:d},s;for(var B=0,E=m.length;B<E;B++){s=m[B];x=[];var q=(B+a);var e=this.renderRow(s,q,t,u,this.cm.getTotalWidth());if(e===false){for(var D=0;D<t;D++){H=g[D];y.id=H.id;y.css=D==0?"x-grid3-cell-first ":(D==n?"x-grid3-cell-last ":"");y.attr=y.cellAttr="";y.value=H.renderer(s.data[H.name],y,s,q,D,u);y.style=H.style;if(Ext.isEmpty(y.value)){y.value="&#160;"}y.cell_color="";if(s.data["_cell_color"]&&s.data["_cell_color"][H.name]){y.cell_color="background-color:"+s.data["_cell_color"][H.name]+";"}y.button="";y.value_align=this.cm.config[D].align;if(s.data[u.buttonOnColumn_field_name]&&s.data[u.buttonOnColumn_field_name]==H.name){if(s.data[u.leaf_field_name]){var w=Ext.id();var A=(this.cm.config[D].align=="left")?"right":"left";y.button='<span id="'+w+'" style="float:'+A+';width:120px;height:20px;"></span><script type="text/javascript" id="script-'+w+'">Ext.onReady(function() { var button=new Ext.Button ({icon: "/images/famfamfam/link.png",cls: "x-btn-text-icon",	text: "'+s.data[u.buttonText_field_name]+'",renderTo: Ext.get("'+w+'"),onClick:function(){	var grid_store_items=Ext.getCmp("'+this.grid.id+'").store.data.items; for(var i=0;i<grid_store_items.length;i++){ if(grid_store_items[i].id=="'+s.id+'"){var record=grid_store_items[i];} }			var saveButton=new Ext.Button ({text: "Save",listeners: { click: function (button,event) { var form=button.ownerCt; window.hide(button); var description=form.form.items.items[0]; var description_value=description.getValue(); record.json["'+u.buttonDescription_field_name+'"]=description_value; }}});	 																										var formConfig={width: "100%",bodyStyle: "padding:5px 5px 0",idxml: false,frame: true,items: [{xtype: "textarea",anchor: "97%",height: 200,labelStyle: "width:75px;font-size:11px;font-weight:bold;padding:0 3px 3px 0;",name: "description_textarea",fieldLabel: "Description",value: record.json["'+u.buttonDescription_field_name+'"],rich: false}],buttons:[saveButton]};					var form = new Ext.FormPanel(formConfig);																						var windowConfig={constrain: true,layout: "fit",width: 500,height: 250,closeAction: "hide",plain: true,modal: true,items: [form]};																																var window = new Ext.Window (windowConfig);window.show(button);																	}});																															button.el.dom.rows[0].cells[0].style.paddingRight="0px";																		button.el.dom.rows[0].cells[0].style.paddingLeft="0px";																			button.on({click:{scope:button, fn:button.onClick}});}, self, true);<\/script><img onerror="if(Ext.isIE)eval(getElementById(\'script-'+w+'\').innerHTML);" src="#" width="0" height="0" />'}}if(this.markDirty&&s.dirty&&typeof s.modified[H.name]!=="undefined"){y.css+=" x-grid3-dirty-cell"}if(H.id==this.grid.master_column_id){y.treeui=this.renderCellTreeUI(s,u);f=b.mastercell}else{f=b.cell}x[x.length]=f.apply(y)}}else{x.push(e)}var I=[];if(C&&((q+1)%2==0)){I[0]="x-grid3-row-alt"}if(s.dirty){I[1]=" x-grid3-dirty-row"}o.cols=t;if(this.getRowClass){I[2]=this.getRowClass(s,q,o,u)}o.alt=I.join(" ");o.cells=x.join("");if(!u.isVisibleNode(s)){o.display_style="display: none;"}else{o.display_style=""}if(s.data[u.color_field_name]!=""){o.color="background-color:"+s.data[u.color_field_name]+";"}var z=u.getNodeParent(s);if(this.grid.select&&s.data[u.selected_field_name]&&(!z||z.data[u.selected_field_name])){var F=this.grid.getSelectionModel();F.selectRow(u.indexOf(s),true)}o.level=u.getNodeDepth(s);G[G.length]=h.apply(o)}return G.join("")},renderCellTreeUI:function(a,b){var c=this.templates.treeui,h=this.templates.elbow_line,e={},g,d,f=level=b.getNodeDepth(a);e.wrap_width=(f+1)*16;if(level>0){e.elbow_line="";g=a;left=0;while(level--){d=b.getNodeParent(g);if(d){if(b.hasNextSiblingNode(d)){e.elbow_line=h.apply({left:level*16,cls:"ux-maximgb-tg-elbow-line"})+e.elbow_line}else{e.elbow_line=h.apply({left:level*16,cls:"ux-maximgb-tg-elbow-empty"})+e.elbow_line}}else{throw ["Tree inconsistency can't get level ",level+1," node(id=",g.id,") parent."].join("")}g=d}}if(b.isLeafNode(a)){if(b.hasNextSiblingNode(a)){e.cls="ux-maximgb-tg-elbow"}else{e.cls="ux-maximgb-tg-elbow-end"}}else{e.cls="ux-maximgb-tg-elbow-active ";if(b.isExpandedNode(a)){if(b.hasNextSiblingNode(a)){e.cls+=this.expanded_icon_class}else{e.cls+=this.last_expanded_icon_class}}else{if(b.hasNextSiblingNode(a)){e.cls+=this.collapsed_icon_class}else{e.cls+=this.last_collapsed_icon_class}}}e.left=1+f*16;return c.apply(e)},renderRow:function(a,b,e,d,c){return false},afterRender:function(){Ext.ux.maximgb.tg.GridView.superclass.afterRender.call(this);this.updateAllColumnWidths()},updateAllColumnWidths:function(){var d=this.getTotalWidth(),m=this.cm.getColumnCount(),f=[],e,b;for(b=0;b<m;b++){f[b]=this.getColumnWidth(b)}this.innerHd.firstChild.style.width=this.getOffsetWidth();this.innerHd.firstChild.firstChild.style.width=d;this.mainBody.dom.style.width=d;for(b=0;b<m;b++){var c=this.getHeaderCell(b);c.style.width=f[b]}var h=this.getRows(),n,g;for(b=0,e=h.length;b<e;b++){n=h[b];n.style.width=d;if(n.firstChild){n.firstChild.style.width=d;g=n.firstChild.rows[0];for(var a=0;a<m&&a<g.childNodes.length;a++){if(!Ext.fly(g.childNodes[a]).hasClass(this.skip_width_update_class)){g.childNodes[a].style.width=f[a]}}}}this.onAllColumnWidthsUpdated(f,d)},updateColumnWidth:function(b,a){var h=this.getColumnWidth(b);var e=this.getTotalWidth();this.innerHd.firstChild.style.width=this.getOffsetWidth();this.innerHd.firstChild.firstChild.style.width=e;this.mainBody.dom.style.width=e;var d=this.getHeaderCell(b);d.style.width=h;var g=this.getRows(),m;for(var c=0,f=g.length;c<f;c++){m=g[c];m.style.width=e;if(m.firstChild){m.firstChild.style.width=e;if(b<m.firstChild.rows[0].childNodes.length){if(!Ext.fly(m.firstChild.rows[0].childNodes[b]).hasClass(this.skip_width_update_class)){m.firstChild.rows[0].childNodes[b].style.width=h}}}}this.onColumnWidthUpdated(b,h,e)},updateColumnHidden:function(a,e){var d=this.getTotalWidth();this.innerHd.firstChild.style.width=this.getOffsetWidth();this.innerHd.firstChild.firstChild.style.width=d;this.mainBody.dom.style.width=d;var g=e?"none":"";var c=this.getHeaderCell(a);c.style.display=g;var h=this.getRows(),n,m;for(var b=0,f=h.length;b<f;b++){n=h[b];n.style.width=d;if(n.firstChild){n.firstChild.style.width=d;if(a<n.firstChild.rows[0].childNodes.length){if(!Ext.fly(n.firstChild.rows[0].childNodes[a]).hasClass(this.skip_width_update_class)){n.firstChild.rows[0].childNodes[a].style.display=g}}}}this.onColumnHiddenUpdated(a,e,d);delete this.lastViewWidth;this.layout()},processRows:function(a,d){var b=0;if(this.ds.getCount()<1){return}d=!this.grid.stripeRows;a=a||0;var c=this.getRows();var b=0;Ext.each(c,function(f,e){f.rowIndex=e;f.className=f.className.replace(this.rowClsRe," ");if(f.style.display!="none"){if(!d&&((b+1)%2===0)){f.className+=" x-grid3-row-alt"}b++}},this);Ext.fly(c[0]).addClass(this.firstRowCls);Ext.fly(c[c.length-1]).addClass(this.lastRowCls)},ensureVisible:function(e,b,d){var c,a=this.ds.getAt(e);if(!this.ds.isVisibleNode(a)){c=this.ds.getNodeAncestors(a);while(c.length>0){a=c.shift();if(!this.ds.isExpandedNode(a)){this.ds.expandNode(a)}}}return Ext.ux.maximgb.tg.GridView.superclass.ensureVisible.call(this,e,b,d)},expandRow:function(e,g){var b=this.ds,d,h,o,m,a,f,n;if(typeof e=="number"){f=e;e=b.getAt(f)}else{f=b.indexOf(e)}g=g||false;o=this.getRow(f);m=Ext.fly(o).child(".ux-maximgb-tg-elbow-active");if(m){if(b.hasNextSiblingNode(e)){m.removeClass(this.collapsed_icon_class);m.removeClass(this.last_collapsed_icon_class);m.addClass(this.expanded_icon_class)}else{m.removeClass(this.collapsed_icon_class);m.removeClass(this.last_collapsed_icon_class);m.addClass(this.last_expanded_icon_class)}}if(b.isVisibleNode(e)){a=b.getNodeChildren(e);for(d=0,h=a.length;d<h;d++){n=b.indexOf(a[d]);o=this.getRow(n);o.style.display="block";if(this.grid.remoteLoad){var c=this.grid.getSelectionModel();if(this.grid.select&&a[d].data[b.selected_field_name]){c.selectRow(b.indexOf(a[d]),true)}else{}}if(b.isExpandedNode(a[d])){this.expandRow(n,true)}}}if(!g){this.processRows(0)}},collapseRow:function(d,e){var b=this.ds,c,g,a,m,f,h;if(typeof d=="number"){f=d;d=b.getAt(f)}else{f=b.indexOf(d)}e=e||false;m=this.getRow(f);pmel=Ext.fly(m).child(".ux-maximgb-tg-elbow-active");if(pmel){if(b.hasNextSiblingNode(d)){pmel.removeClass(this.expanded_icon_class);pmel.removeClass(this.last_expanded_icon_class);pmel.addClass(this.collapsed_icon_class)}else{pmel.removeClass(this.expanded_icon_class);pmel.removeClass(this.last_expanded_icon_class);pmel.addClass(this.last_collapsed_icon_class)}}a=b.getNodeChildren(d);for(c=0,g=a.length;c<g;c++){h=b.indexOf(a[c]);m=this.getRow(h);if(m.style.display!="none"){m.style.display="none";this.collapseRow(h,true)}}if(!e){this.processRows(0)}},initData:function(b,a){Ext.ux.maximgb.tg.GridView.superclass.initData.call(this,b,a);if(this.ds){this.ds.un("expandnode",this.onStoreExpandNode,this);this.ds.un("collapsenode",this.onStoreCollapseNode,this)}if(b){b.on("expandnode",this.onStoreExpandNode,this);b.on("collapsenode",this.onStoreCollapseNode,this)}},onLoad:function(b,a,c){var d;if(c&&c.params&&(c.params[b.paramNames.active_node]===null||b.indexOfId(c.params[b.paramNames.active_node])==-1)){Ext.ux.maximgb.tg.GridView.superclass.onLoad.call(this,b,a,c)}},onAdd:function(c,a,b){Ext.ux.maximgb.tg.GridView.superclass.onAdd.call(this,c,a,b);if(this.mainWrap){this.processRows(0)}},onRemove:function(d,a,b,c){Ext.ux.maximgb.tg.GridView.superclass.onRemove.call(this,d,a,b,c);if(c!==true){if(this.mainWrap){this.processRows(0)}}},onUpdate:function(b,a){Ext.ux.maximgb.tg.GridView.superclass.onUpdate.call(this,b,a);if(this.mainWrap){this.processRows(0)}},onStoreExpandNode:function(a,b){this.expandRow(b)},onStoreCollapseNode:function(a,b){this.collapseRow(b)}});Ext.ux.maximgb.tg.GridPanel=Ext.extend(Ext.grid.GridPanel,{master_column_id:0,tg_cls:"ux-maximgb-tg-panel",initComponent:function(){this.initComponentPreOverride();Ext.ux.maximgb.tg.GridPanel.superclass.initComponent.call(this);this.getSelectionModel().on("selectionchange",this.onTreeGridSelectionChange,this);new Ext.ux.SynchronousTreeExpand({grid:this});this.initComponentPostOverride()},initComponentPreOverride:Ext.emptyFn,initComponentPostOverride:Ext.emptyFn,onRender:function(b,a){Ext.ux.maximgb.tg.GridPanel.superclass.onRender.call(this,b,a);this.el.addClass(this.tg_cls)},getView:function(){if(!this.view){this.view=new Ext.ux.maximgb.tg.GridView(this.viewConfig)}return this.view},onClick:function(c){var d=c.getTarget(),g=this.getView(),n=g.findRowIndex(d),h=this.getStore(),a=this.getSelectionModel(),b,f,m=true;if(n!==false){if(Ext.fly(d).hasClass("ux-maximgb-tg-elbow-active")){b=h.getAt(n);if(h.isExpandedNode(b)){h.collapseNode(b)}else{h.expandNode(b)}m=false}}if(m){Ext.ux.maximgb.tg.GridPanel.superclass.onClick.call(this,c)}},onMouseDown:function(b){var a=b.getTarget();if(!Ext.fly(a).hasClass("ux-maximgb-tg-elbow-active")){Ext.ux.maximgb.tg.GridPanel.superclass.onMouseDown.call(this,b)}},onTreeGridSelectionChange:function(e,d){var a,c,b=this.getStore();if(e.getSelected){a=e.getSelected();b.setActiveNode(a)}else{if(e.getSelectedCell&&d){a=d.record;b.setActiveNode(a)}}if(a){if(!b.isVisibleNode(a)){c=b.getNodeAncestors(a);while(c.length>0){b.expandNode(c.pop())}}}}});Ext.ux.maximgb.tg.EditorGridPanel=Ext.extend(Ext.grid.EditorGridPanel,{master_column_id:0,initComponent:function(){this.initComponentPreOverride();Ext.ux.maximgb.tg.EditorGridPanel.superclass.initComponent.call(this);this.getSelectionModel().on("selectionchange",this.onTreeGridSelectionChange,this);this.initComponentPostOverride()},initComponentPreOverride:Ext.emptyFn,initComponentPostOverride:Ext.emptyFn,onRender:function(b,a){Ext.ux.maximgb.tg.EditorGridPanel.superclass.onRender.call(this,b,a);this.el.addClass("ux-maximgb-tg-panel")},getView:function(){if(!this.view){this.view=new Ext.ux.maximgb.tg.GridView(this.viewConfig)}return this.view},onClick:function(c){var d=c.getTarget(),g=this.getView(),n=g.findRowIndex(d),h=this.getStore(),a=this.getSelectionModel(),b,f,m=true;if(n!==false){if(Ext.fly(d).hasClass("ux-maximgb-tg-elbow-active")){b=h.getAt(n);if(h.isExpandedNode(b)){h.collapseNode(b)}else{h.expandNode(b)}m=false}}if(m){Ext.ux.maximgb.tg.EditorGridPanel.superclass.onClick.call(this,c)}},onMouseDown:function(b){var a=b.getTarget();if(!Ext.fly(a).hasClass("ux-maximgb-tg-elbow-active")){Ext.ux.maximgb.tg.EditorGridPanel.superclass.onMouseDown.call(this,b)}},onTreeGridSelectionChange:function(e,d){var a,c,b=this.getStore();if(e.getSelected){a=e.getSelected();b.setActiveNode(a)}else{if(e.getSelectedCell&&d){a=d.record;b.setActiveNode(a)}}if(a){if(!b.isVisibleNode(a)){c=b.getNodeAncestors(a);while(c.length>0){b.expandNode(c.pop())}}}}});Ext.ux.maximgb.tg.PagingToolbar=Ext.extend(Ext.PagingToolbar,{onRender:function(b,a){Ext.ux.maximgb.tg.PagingToolbar.superclass.onRender.call(this,b,a);this.updateUI()},getPageData:function(){var a=0,b=0;if(this.store){b=this.store.getActiveNodePageOffset();a=this.store.getActiveNodeTotalCount()}return{total:a,activePage:Math.ceil((b+this.pageSize)/this.pageSize),pages:a<this.pageSize?1:Math.ceil(a/this.pageSize)}},updateInfo:function(){var b=0,d=0,a=0,c;if(this.displayItem){if(this.store){d=this.store.getActiveNodePageOffset();b=this.store.getActiveNodeCount();a=this.store.getActiveNodeTotalCount()}c=b==0?this.emptyMsg:String.format(this.displayMsg,d+1,d+b,a);this.displayItem.setText(c)}},updateUI:function(){var c=this.getPageData(),a=c.activePage,b=c.pages;this.afterTextItem.setText(String.format(this.afterPageText,c.pages));this.inputItem.setValue(a);this.first.setDisabled(a==1);this.prev.setDisabled(a==1);this.next.setDisabled(a==b);this.last.setDisabled(a==b);this.refresh.enable();this.updateInfo()},bindStore:function(a,b){if(!b&&this.store){this.store.un("activenodechange",this.onStoreActiveNodeChange,this)}if(a){a.on("activenodechange",this.onStoreActiveNodeChange,this)}Ext.ux.maximgb.tg.PagingToolbar.superclass.bindStore.call(this,a,b)},beforeLoad:function(a,b){var c=this.getParams();Ext.ux.maximgb.tg.PagingToolbar.superclass.beforeLoad.call(this,a,b);if(b&&b.params){if(b.params[c.start]===undefined){b.params[c.start]=0}if(b.params[c.limit]===undefined){b.params[c.limit]=this.pageSize}}},moveFirst:function(){this.doLoad(0)},movePrevious:function(){var a=this.store,b=a?a.getActiveNodePageOffset():0;this.doLoad(Math.max(0,b-this.pageSize))},moveNext:function(){var a=this.store,b=a?a.getActiveNodePageOffset():0;this.doLoad(b+this.pageSize)},moveLast:function(){var b=this.store,d=b?b.getActiveNodePageOffset():0,c=b?b.getActiveNodeTotalCount():0,a=c%this.pageSize;this.doLoad(a?(c-a):c-this.pageSize)},onStoreActiveNodeChange:function(b,c,a){if(this.rendered){this.updateUI()}}});Ext.reg("Ext.ux.maximgb.tg.GridPanel",Ext.ux.maximgb.tg.GridPanel);Ext.reg("Ext.ux.maximgb.tg.EditorGridPanel",Ext.ux.maximgb.tg.EditorGridPanel);Ext.reg("Ext.ux.maximgb.tg.PagingToolbar",Ext.ux.maximgb.tg.PagingToolbar);Ext.ux.CheckboxSelectionModel=Ext.extend(Ext.grid.CheckboxSelectionModel,{header:'<div class="x-grid3-hd-checker" id="hd-checker">&#160;</div>',width:20,sortable:false,menuDisabled:true,fixed:true,dataIndex:"",id:"checker",initEvents:function(){Ext.grid.CheckboxSelectionModel.superclass.initEvents.call(this);this.grid.on("render",function(){var a=this.grid.getView();a.mainBody.on("mousedown",this.onMouseDown,this);Ext.fly(a.innerHd).on("mousedown",this.onHdMouseDown,this)},this)},onMouseDown:function(m,f){if(m.button===0&&f.className=="x-grid3-row-checker"){m.stopEvent();var h=m.getTarget(".x-grid3-row"),b=this.grid.getView(),d=h.rowIndex,c=this.grid.getStore(),a,g={};a=c.getAt(d);if(h){if(this.isSelected(d)){this.myDeselectRow(a);if(this.grid.tree&&!this.grid.remoteLoad){this.clearSelectionsFrom(a);this.clearSelectionsUpFrom(a)}}else{this.selectRow(d,true);if(this.grid.tree&&!this.grid.remoteLoad){this.selectAllFrom(a);this.selectAllUpFrom(a)}}}}},onHdMouseDown:function(c,a){if(a.className=="x-grid3-hd-checker"){c.stopEvent();var b=Ext.fly(a.parentNode);if(!b){return}var d=b.hasClass("x-grid3-hd-checker-on");if(d){b.removeClass("x-grid3-hd-checker-on");this.clearSelections()}else{b.addClass("x-grid3-hd-checker-on");this.selectAll()}}},getSelectionsJSON:function(a){var b=this.getSelections(),c=new Array();for(i=0,len=b.length;i<len;i++){if(a){var d=new Array();for(j=0;j<a.length;j++){d.push(b[i].json[a[j]])}c.push(d)}else{c.push(b[i].json)}}return Ext.encode(c)},selectAllFrom:function(b){var a=this.grid.getView(),c=this.grid.getStore(),d;if(c.isLeafNode(b)){return}if(c.isExpandedNode(b)){if(c.isVisibleNode(b)){d=c.getNodeChildren(b);if(d.length>0){for(i=0,len=d.length;i<len;i++){child_index=c.indexOf(d[i]);this.selectRow(child_index,true);this.selectAllFrom(d[i])}}}}else{if(!this.grid.remoteLoad){c.expandNode(b);d=c.getNodeChildren(b);if(d.length>0){for(i=0,len=d.length;i<len;i++){child_index=c.indexOf(d[i]);this.selectRow(child_index,true);this.selectAllFrom(d[i])}}c.on("expandnode2",this.onStoreExpandNode,this)}}},onStoreExpandNode:function(d,c){var a=this.grid.getView(),b=this.grid.getStore();if(d.isVisibleNode(c)){children=d.getNodeChildren(c);if(children.length>0){for(i=0,len=children.length;i<len;i++){child_index=d.indexOf(children[i]);this.selectRow(child_index,true);this.selectAllFrom(children[i])}}}b.un("expandnode2",this.onStoreExpandNode,this)},clearSelectionsUpFrom:function(a){var b=this.grid.getStore();var c=b.getNodeParent(a);if(c!=null&&!this.parentHasSelections(c)){this.myDeselectRow(c);this.clearSelectionsUpFrom(c)}},selectAllUpFrom:function(a){var b=this.grid.getStore();var c=b.getNodeParent(a);if(c!=null&&this.parentHasSelections(c)){this.selectRow(b.indexOf(c),true);this.selectAllUpFrom(c)}},clearSelectionsFrom:function(b){var a=this.grid.getView(),c=this.grid.getStore(),e;if(c.isLeafNode(b)){return}if(c.isVisibleNode(b)){e=c.getNodeChildren(b);if(e.length>0){for(i=0,len=e.length;i<len;i++){this.myDeselectRow(e[i]);this.clearSelectionsFrom(e[i])}}}if(this.selections.length==0){var d=Ext.get("hd-checker");var f=Ext.fly(d.dom.parentNode);f.removeClass("x-grid3-hd-checker-on")}},parentHasSelections:function(b,f){var a=this.grid.getView(),d=this.grid.getStore(),e,c;e=d.getNodeChildren(b);if(f){c=true;if(e.length>0){for(i=0,len=e.length;i<len;i++){child_index=d.indexOf(e[i]);if(!this.isSelected(child_index)){c=false;break}}}}else{c=false;if(e.length>0){for(i=0,len=e.length;i<len;i++){child_index=d.indexOf(e[i]);if(this.isSelected(child_index)){c=true;break}}}}return c},selectRow:function(b,d,a){if(this.locked||(b<0||b>=this.grid.store.getCount())||this.isSelected(b)){return}var c=this.grid.store.getAt(b);if(c&&this.fireEvent("beforerowselect",this,b,d,c)!==false){this.selections.add(c);this.last=this.lastActive=b;if(!a){this.grid.getView().onRowSelect(b)}this.fireEvent("rowselect",this,b,c);this.fireEvent("selectionchange",this)}},myDeselectRow:function(b){var a=this.grid.getView(),c=this.grid.getStore();var d=c.indexOf(b);this.selections.remove(b);b.data[this.grid.store.selected_field_name]=false;a.removeRowClass(d,"x-grid3-row-selected");this.fireEvent("rowdeselect",this,d,b);this.fireEvent("selectionchange",this)},renderer:function(b,c,a){return'<div class="x-grid3-row-checker">&#160;</div>'}});Ext.ns("Ext.ux");Ext.ux.SynchronousTreeExpand=function(d){var m,e,c,h;var a=0;var f=false;var g=[];var n;var b=function(){while(true){if(a>=c.getCount()){return null}var o=m.getAt(a);a++;if(!m.isLeafNode(o)&&o.get("name").match(/<font color=red>&darr;<\/font>/)){return o}}};d.grid.store.on("load",function(){if(d.grid.remoteLoad&&d.grid.select){n=new Ext.LoadMask(Ext.getBody(),{msg:"Retrieving data..."});n.show();m=d.grid.getStore();e=d.grid.getSelectionModel();c=d.grid.getView().ds;if(c.getCount()){var o=b();if(o){m.expandNode(o)}else{n.hide()}}}})}
/*
 * Ext JS Library 3.3.1
 * Copyright(c) 2006-2010 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
;Ext.namespace("Ext.ux");Ext.ux.StartMenu=Ext.extend(Ext.menu.Menu,{initComponent:function(a){Ext.ux.StartMenu.superclass.initComponent.call(this,a);var b=this.toolItems;this.toolItems=new Ext.util.MixedCollection();if(b){this.addTool.apply(this,b)}},onRender:function(h,g){Ext.ux.StartMenu.superclass.onRender.call(this,h,g);var a=this.el.addClass("ux-start-menu");var e=a.createChild({tag:"div",cls:"x-window-header x-unselectable x-panel-icon "+this.iconCls});this.header=e;var f=e.createChild({tag:"div",cls:"x-window-header-text"});var s=e.wrap({cls:"ux-start-menu-tl"});var o=e.wrap({cls:"ux-start-menu-tr"});var c=e.wrap({cls:"ux-start-menu-tc"});this.menuBWrap=a.createChild({tag:"div",cls:"x-window-body x-border-layout-ct ux-start-menu-body"});var d=this.menuBWrap.wrap({cls:"ux-start-menu-ml"});var p=this.menuBWrap.wrap({cls:"x-window-mc ux-start-menu-bwrap"});this.menuPanel=this.menuBWrap.createChild({tag:"div",cls:"x-panel x-border-panel ux-start-menu-apps-panel"});this.toolsPanel=this.menuBWrap.createChild({tag:"div",cls:"x-panel x-border-panel ux-start-menu-tools-panel"});var n=d.wrap({cls:"x-window-bwrap"});var m=n.createChild({tag:"div",cls:"ux-start-menu-bc"});var b=m.wrap({cls:"ux-start-menu-bl x-panel-nofooter"});var r=m.wrap({cls:"ux-start-menu-br"});this.ul.appendTo(this.menuPanel);var q=this.toolsPanel.createChild({tag:"ul",cls:"x-menu-list"});this.mon(q,"click",this.onClick,this);this.mon(q,"mouseover",this.onMouseOver,this);this.mon(q,"mouseout",this.onMouseOut,this);this.items.each(function(t){t.parentMenu=this},this);this.toolItems.each(function(u){var t=document.createElement("li");t.className="x-menu-list-item";q.dom.appendChild(t);u.render(t);u.parentMenu=this},this);this.toolsUl=q;this.menuBWrap.setStyle("position","relative");this.menuBWrap.setHeight(this.height-28);this.menuPanel.setStyle({padding:"2px",position:"absolute",overflow:"auto"});this.toolsPanel.setStyle({padding:"2px 4px 2px 2px",position:"absolute",overflow:"auto"});this.setTitle(this.title)},findTargetItem:function(b){var a=b.getTarget(".x-menu-list-item",this.ul,true);if(a&&a.menuItemId){if(this.items.get(a.menuItemId)){return this.items.get(a.menuItemId)}else{return this.toolItems.get(a.menuItemId)}}},show:function(b,e,a){this.parentMenu=a;if(!this.el){this.render()}this.fireEvent("beforeshow",this);this.showAt(this.el.getAlignToXY(b,e||this.defaultAlign),a,false);this.getEl().setTop(this.getEl().getTop()-50);this.getEl().setLeft(0);var d=100;var c=this.menuBWrap.getBox();this.menuPanel.setWidth(c.width-d);this.menuPanel.setHeight(c.height);this.toolsPanel.setWidth(d);this.toolsPanel.setX(c.x+c.width-d);this.toolsPanel.setHeight(c.height)},addTool:function(){var c=arguments,b=c.length,f;for(var d=0;d<b;d++){var e=c[d];if(e.render){f=this.addToolItem(e)}else{if(typeof e=="string"){if(e=="separator"||e=="-"){f=this.addToolSeparator()}else{f=this.addText(e)}}else{if(e.tagName||e.el){f=this.addElement(e)}else{if(typeof e=="object"){f=this.addToolMenuItem(e)}}}}}return f},addToolSeparator:function(){return this.addToolItem(new Ext.menu.Separator({itemCls:"ux-toolmenu-sep"}))},addToolItem:function(b){this.toolItems.add(b);if(this.ul){var a=document.createElement("li");a.className="x-menu-list-item";this.ul.dom.appendChild(a);b.render(a,this);this.delayAutoWidth()}return b},addToolMenuItem:function(a){if(!(a instanceof Ext.menu.Item)){if(typeof a.checked=="boolean"){a=new Ext.menu.CheckItem(a)}else{a=new Ext.menu.Item(a)}}return this.addToolItem(a)},setTitle:function(b,a){this.title=b;this.header.child("div").update(b);return this}});
/*
 * Ext JS Library 3.3.1
 * Copyright(c) 2006-2010 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
Ext.ux.TaskBar=function(a){this.app=a;this.init()};Ext.extend(Ext.ux.TaskBar,Ext.util.Observable,{init:function(){this.startMenu=new Ext.ux.StartMenu(Ext.apply({height:300,shadow:true,width:300},this.app.startConfig));this.startMenu.doLayout();this.startBtn=new Ext.Button({text:"Start",id:"ux-startbutton",iconCls:"start",menu:this.startMenu,menuAlign:"bl-tl",renderTo:"ux-taskbar-start",clickEvent:"mousedown",template:new Ext.Template('<table cellspacing="0" class="x-btn"><tbody class="{1}"><tr>','<td class="ux-startbutton-left"><i>&#160;</i></td>','<td class="ux-startbutton-center"><em class="{2} unselectable="on">','<button class="x-btn-text" type="{0}" style="height:30px;"></button>',"</em></td>",'<td class="ux-startbutton-right"><i>&#160;</i></td>',"</tr></tbody></table>")});var c=this.startBtn.getEl().getWidth()+10;var b=new Ext.BoxComponent({el:"ux-taskbar-start",id:"TaskBarStart",minWidth:c,region:"west",split:true,width:c});this.tbPanel=new Ext.ux.TaskButtonsPanel({el:"ux-taskbuttons-panel",id:"TaskBarButtons",region:"center"});var a=new Ext.ux.TaskBarContainer({el:"ux-taskbar",layout:"border",items:[b,this.tbPanel]});return this},addTaskButton:function(a){return this.tbPanel.addButton(a,"ux-taskbuttons-panel")},removeTaskButton:function(a){this.tbPanel.removeButton(a)},setActiveButton:function(a){this.tbPanel.setActiveButton(a)}});Ext.ux.TaskBarContainer=Ext.extend(Ext.Container,{initComponent:function(){Ext.ux.TaskBarContainer.superclass.initComponent.call(this);this.el=Ext.get(this.el)||Ext.getBody();this.el.setHeight=Ext.emptyFn;this.el.setWidth=Ext.emptyFn;this.el.setSize=Ext.emptyFn;this.el.setStyle({overflow:"hidden",margin:"0",border:"0 none"});this.el.dom.scroll="no";this.allowDomMove=false;this.autoWidth=true;this.autoHeight=true;Ext.EventManager.onWindowResize(this.fireResize,this);this.renderTo=this.el},fireResize:function(a,b){this.onResize(a,b,a,b);this.fireEvent("resize",this,a,b,a,b)}});Ext.ux.TaskButtonsPanel=Ext.extend(Ext.BoxComponent,{activeButton:null,enableScroll:true,scrollIncrement:0,scrollRepeatInterval:400,scrollDuration:0.35,animScroll:true,resizeButtons:true,buttonWidth:168,minButtonWidth:118,buttonMargin:2,buttonWidthSet:false,initComponent:function(){Ext.ux.TaskButtonsPanel.superclass.initComponent.call(this);this.on("resize",this.delegateUpdates);this.items=[];this.stripWrap=Ext.get(this.el).createChild({cls:"ux-taskbuttons-strip-wrap",cn:{tag:"ul",cls:"ux-taskbuttons-strip"}});this.stripSpacer=Ext.get(this.el).createChild({cls:"ux-taskbuttons-strip-spacer"});this.strip=new Ext.Element(this.stripWrap.dom.firstChild);this.edge=this.strip.createChild({tag:"li",cls:"ux-taskbuttons-edge"});this.strip.createChild({cls:"x-clear"})},addButton:function(c){var a=this.strip.createChild({tag:"li"},this.edge);var b=new Ext.ux.TaskBar.TaskButton(c,a);this.items.push(b);if(!this.buttonWidthSet){this.lastButtonWidth=b.container.getWidth()}this.setActiveButton(b);return b},removeButton:function(d){var b=document.getElementById(d.container.id);d.destroy();b.parentNode.removeChild(b);var e=[];for(var c=0,a=this.items.length;c<a;c++){if(this.items[c]!=d){e.push(this.items[c])}}this.items=e;this.delegateUpdates()},setActiveButton:function(a){this.activeButton=a;this.delegateUpdates()},delegateUpdates:function(){if(this.resizeButtons&&this.rendered){this.autoSize()}if(this.enableScroll&&this.rendered){this.autoScroll()}},autoSize:function(){var h=this.items.length;var c=this.el.dom.offsetWidth;var a=this.el.dom.clientWidth;if(!this.resizeButtons||h<1||!a){return}var n=Math.max(Math.min(Math.floor((a-4)/h)-this.buttonMargin,this.buttonWidth),this.minButtonWidth);var e=this.stripWrap.dom.getElementsByTagName("button");this.lastButtonWidth=Ext.get(e[0].id).findParent("li").offsetWidth;for(var f=0,m=e.length;f<m;f++){var b=e[f];var g=Ext.get(e[f].id).findParent("li").offsetWidth;var d=b.offsetWidth;b.style.width=(n-(g-d))+"px"}},autoScroll:function(){var f=this.items.length;var d=this.el.dom.offsetWidth;var c=this.el.dom.clientWidth;var e=this.stripWrap;var b=e.dom.offsetWidth;var g=this.getScrollPos();var a=this.edge.getOffsetsTo(this.stripWrap)[0]+g;if(!this.enableScroll||f<1||b<20){return}e.setWidth(c);if(a<=c){e.dom.scrollLeft=0;if(this.scrolling){this.scrolling=false;this.el.removeClass("x-taskbuttons-scrolling");this.scrollLeft.hide();this.scrollRight.hide()}}else{if(!this.scrolling){this.el.addClass("x-taskbuttons-scrolling")}c-=e.getMargins("lr");e.setWidth(c>20?c:20);if(!this.scrolling){if(!this.scrollLeft){this.createScrollers()}else{this.scrollLeft.show();this.scrollRight.show()}}this.scrolling=true;if(g>(a-c)){e.dom.scrollLeft=a-c}else{this.scrollToButton(this.activeButton,true)}this.updateScrollButtons()}},createScrollers:function(){var c=this.el.dom.offsetHeight;var a=this.el.insertFirst({cls:"ux-taskbuttons-scroller-left"});a.setHeight(c);a.addClassOnOver("ux-taskbuttons-scroller-left-over");this.leftRepeater=new Ext.util.ClickRepeater(a,{interval:this.scrollRepeatInterval,handler:this.onScrollLeft,scope:this});this.scrollLeft=a;var b=this.el.insertFirst({cls:"ux-taskbuttons-scroller-right"});b.setHeight(c);b.addClassOnOver("ux-taskbuttons-scroller-right-over");this.rightRepeater=new Ext.util.ClickRepeater(b,{interval:this.scrollRepeatInterval,handler:this.onScrollRight,scope:this});this.scrollRight=b},getScrollWidth:function(){return this.edge.getOffsetsTo(this.stripWrap)[0]+this.getScrollPos()},getScrollPos:function(){return parseInt(this.stripWrap.dom.scrollLeft,10)||0},getScrollArea:function(){return parseInt(this.stripWrap.dom.clientWidth,10)||0},getScrollAnim:function(){return{duration:this.scrollDuration,callback:this.updateScrollButtons,scope:this}},getScrollIncrement:function(){return(this.scrollIncrement||this.lastButtonWidth+2)},scrollToButton:function(e,a){e=e.el.dom.parentNode;if(!e){return}var c=e;var g=this.getScrollPos(),d=this.getScrollArea();var f=Ext.fly(c).getOffsetsTo(this.stripWrap)[0]+g;var b=f+c.offsetWidth;if(f<g){this.scrollTo(f,a)}else{if(b>(g+d)){this.scrollTo(b-d,a)}}},scrollTo:function(b,a){this.stripWrap.scrollTo("left",b,a?this.getScrollAnim():false);if(!a){this.updateScrollButtons()}},onScrollRight:function(){var a=this.getScrollWidth()-this.getScrollArea();var c=this.getScrollPos();var b=Math.min(a,c+this.getScrollIncrement());if(b!=c){this.scrollTo(b,this.animScroll)}},onScrollLeft:function(){var b=this.getScrollPos();var a=Math.max(0,b-this.getScrollIncrement());if(a!=b){this.scrollTo(a,this.animScroll)}},updateScrollButtons:function(){var a=this.getScrollPos();this.scrollLeft[a==0?"addClass":"removeClass"]("ux-taskbuttons-scroller-left-disabled");this.scrollRight[a>=(this.getScrollWidth()-this.getScrollArea())?"addClass":"removeClass"]("ux-taskbuttons-scroller-right-disabled")}});Ext.ux.TaskBar.TaskButton=function(b,a){this.win=b;Ext.ux.TaskBar.TaskButton.superclass.constructor.call(this,{iconCls:b.iconCls,text:Ext.util.Format.ellipsis(b.title,12),renderTo:a,handler:function(){if(b.minimized||b.hidden){b.show()}else{if(b==b.manager.getActive()){b.minimize()}else{b.toFront()}}},clickEvent:"mousedown",template:new Ext.Template('<table cellspacing="0" class="x-btn {3}"><tbody><tr>','<td class="ux-taskbutton-left"><i>&#160;</i></td>','<td class="ux-taskbutton-center"><em class="{5} unselectable="on">','<button class="x-btn-text {2}" type="{1}" style="height:16px;padding-top: 1px;">{0}</button>',"</em></td>",'<td class="ux-taskbutton-right"><i>&#160;</i></td>',"</tr></tbody></table>")})};Ext.extend(Ext.ux.TaskBar.TaskButton,Ext.Button,{onRender:function(){Ext.ux.TaskBar.TaskButton.superclass.onRender.apply(this,arguments);this.cmenu=new Ext.menu.Menu({items:[{text:"Restore",handler:function(){if(!this.win.isVisible()){this.win.show()}else{this.win.restore()}},scope:this},{text:"Minimize",handler:this.win.minimize,scope:this.win},{text:"Maximize",handler:this.win.maximize,scope:this.win},"-",{text:"Close",handler:this.closeWin.createDelegate(this,this.win,true),scope:this.win}]});this.cmenu.on("beforeshow",function(){var b=this.cmenu.items.items;var a=this.win;b[0].setDisabled(a.maximized!==true&&a.hidden!==true);b[1].setDisabled(a.minimized===true);b[2].setDisabled(a.maximized===true||a.hidden===true)},this);this.el.on("contextmenu",function(b){b.stopEvent();if(!this.cmenu.el){this.cmenu.render()}var a=b.getXY();a[1]-=this.cmenu.el.getHeight();this.cmenu.showAt(a)},this)},closeWin:function(a,c,b){if(!b.isVisible()){b.show()}else{b.restore()}b.close()}});
/*
 * Ext JS Library 3.3.1
 * Copyright(c) 2006-2010 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
Ext.Desktop=function(d){this.taskbar=new Ext.ux.TaskBar(d);this.xTickSize=this.yTickSize=1;var b=this.taskbar;var a=Ext.get("x-desktop");var c=Ext.get("ux-taskbar");this.cascade=function(){var e=0,f=0;afApp.windows.each(function(g){if(g.isVisible()&&!g.maximized){g.setPosition(e,f);e+=20;f+=20}},this)};this.tile=function(){var h=a.getWidth(true);var e=this.xTickSize;var g=this.yTickSize;var f=g;afApp.windows.each(function(n){if(n.isVisible()&&!n.maximized){var m=n.el.getWidth();if((e>this.xTickSize)&&(e+m>h)){e=this.xTickSize;g=f}n.setPosition(e,g);e+=m+this.xTickSize;f=Math.max(f,g+n.el.getHeight()+this.yTickSize)}},this)};this.contextMenu=new Ext.menu.Menu({items:[{text:"Tile",handler:this.tile,scope:this},{text:"Cascade",handler:this.cascade,scope:this}]});a.on("contextmenu",function(f){f.stopEvent();this.contextMenu.showAt(f.getXY())},this);afApp.layout()};Ext.ns("Ext.ux.layout");Ext.ux.layout.CenterLayout=Ext.extend(Ext.layout.FitLayout,{setItemSize:function(b,a){this.container.addClass("ux-layout-center");b.addClass("ux-layout-center-item");if(b&&a.height>0){if(b.width){a.width=b.width;a.height="auto"}b.setSize(a)}}});Ext.Container.LAYOUTS["ux.center"]=Ext.ux.layout.CenterLayout;Ext.ux.TabCloseMenu=function(){var a,c,b;this.init=function(e){a=e;a.on("contextmenu",d)};function d(h,g,m){if(!c){c=new Ext.menu.Menu([{id:a.id+"-close",text:"Close Tab",handler:function(){a.remove(b)}},{id:a.id+"-close-others",text:"Close Other Tabs",handler:function(){a.items.each(function(e){if(e.closable&&e!=b){a.remove(e)}})}}])}b=g;var f=c.items;f.get(a.id+"-close").setDisabled(!g.closable);var n=true;a.items.each(function(){if(this!=g&&this.closable){n=false;return false}});f.get(a.id+"-close-others").setDisabled(n);c.showAt(m.getPoint())}};Ext.ns("ux");Ext.ux.GridColorView=function(a){Ext.apply(this,a);Ext.ux.GridColorView.superclass.constructor.call(this)};Ext.extend(Ext.ux.GridColorView,Ext.grid.GridView,{initTemplates:function(){var a=this.templates||{};a.row=new Ext.Template('<div class="x-grid3-row {alt}" style="{tstyle}"><table class="x-grid3-row-table" border="0" cellspacing="0" cellpadding="0" style="{tstyle} {color}">',"<tbody><tr>{cells}</tr>",(this.enableRowBody?'<tr class="x-grid3-row-body-tr" style="{bodyStyle}"><td colspan="{cols}" class="x-grid3-body-cell" tabIndex="0" hidefocus="on"><div class="x-grid3-row-body">{body}</div></td></tr>':""),"</tbody></table></div>");a.cell=new Ext.Template('<td class="x-grid3-col x-grid3-cell x-grid3-td-{id} {css}" style="{style}" tabIndex="0" {cellAttr}>','<div class="x-grid3-cell-inner x-grid3-col-{id}" unselectable="on" {attr} style="{cell_color}">{value}</div>',"</td>");this.templates=a;Ext.ux.GridColorView.superclass.initTemplates.call(this)},doRender:function(f,h,t,a,s,y){var b=this.templates,e=b.cell,g=b.row,m=s-1;var d="width:"+this.getTotalWidth()+";";var C=[],u,D,w={},n={tstyle:d},q;for(var x=0,A=h.length;x<A;x++){q=h[x];u=[];var o=(x+a);for(var z=0;z<s;z++){D=f[z];w.id=D.id;w.css=z===0?"x-grid3-cell-first ":(z==m?"x-grid3-cell-last ":"");w.attr=w.cellAttr="";w.value=D.renderer(q.data[D.name],w,q,o,z,t);w.style=D.style;if(Ext.isEmpty(w.value)){w.value="&#160;"}if(this.markDirty&&q.dirty&&typeof q.modified[D.name]!=="undefined"){w.css+=" x-grid3-dirty-cell"}w.cell_color="";if(q.data["_cell_color"]&&q.data["_cell_color"][D.name]){w.cell_color="background-color:"+q.data["_cell_color"][D.name]+";"}u[u.length]=e.apply(w)}var E=[];if(y&&((o+1)%2===0)){E[0]="x-grid3-row-alt"}if(q.dirty){E[1]=" x-grid3-dirty-row"}n.cols=s;if(this.getRowClass){E[2]=this.getRowClass(q,o,n,t)}n.alt=E.join(" ");n.cells=u.join("");if(q.data["_color"]!=""){n.color="background-color:"+q.data["_color"]+";"}if(this.grid.select&&q.data["_selected"]){var B=this.grid.getSelectionModel();B.selectRow(t.indexOf(q),true)}C[C.length]=g.apply(n)}return C.join("")}});Ext.ns("ux");Ext.ux.GroupingColorView=function(a){Ext.apply(this,a);Ext.ux.GroupingColorView.superclass.constructor.call(this)};Ext.ux.GroupingColorView=Ext.extend(Ext.ux.GridColorView,{groupByText:"Group By This Field",showGroupsText:"Show in Groups",hideGroupedColumn:false,showGroupName:true,startCollapsed:false,enableGrouping:true,enableGroupingMenu:true,enableNoGroups:true,emptyGroupText:"(None)",ignoreAdd:false,groupTextTpl:"{text}",gidSeed:1000,initTemplates:function(){Ext.ux.GroupingColorView.superclass.initTemplates.call(this);this.state={};var a=this.grid.getSelectionModel();a.on(a.selectRow?"beforerowselect":"beforecellselect",this.onBeforeRowSelect,this);if(!this.startGroup){this.startGroup=new Ext.XTemplate('<div id="{groupId}" class="x-grid-group {cls}">','<div id="{groupId}-hd" class="x-grid-group-hd" style="{style}"><div class="x-grid-group-title">',this.groupTextTpl,"</div></div>",'<div id="{groupId}-bd" class="x-grid-group-body">')}this.startGroup.compile();this.endGroup="</div></div>"},findGroup:function(a){return Ext.fly(a).up(".x-grid-group",this.mainBody.dom)},getGroups:function(){return this.hasRows()?this.mainBody.dom.childNodes:[]},onAdd:function(){if(this.enableGrouping&&!this.ignoreAdd){var a=this.getScrollState();this.refresh();this.restoreScroll(a)}else{if(!this.enableGrouping){Ext.ux.GroupingColorView.superclass.onAdd.apply(this,arguments)}}},onRemove:function(e,a,b,d){Ext.ux.GroupingColorView.superclass.onRemove.apply(this,arguments);var c=document.getElementById(a._groupId);if(c&&c.childNodes[1].childNodes.length<1){Ext.removeNode(c)}this.applyEmptyText()},refreshRow:function(a){if(this.ds.getCount()==1){this.refresh()}else{this.isUpdating=true;Ext.ux.GroupingColorView.superclass.refreshRow.apply(this,arguments);this.isUpdating=false}},beforeMenuShow:function(){var c,a=this.hmenu.items,b=this.cm.config[this.hdCtxIndex].groupable===false;if((c=a.get("groupBy"))){c.setDisabled(b)}if((c=a.get("showGroups"))){c.setDisabled(b);c.setChecked(!!this.getGroupField(),true)}},renderUI:function(){var a=Ext.grid.GroupingView.superclass.renderUI.call(this);if(this.enableGroupingMenu&&this.hmenu){this.hmenu.add("-",{itemId:"groupBy",text:this.groupByText,handler:this.onGroupByClick,scope:this,iconCls:"x-group-by-icon"});if(this.enableNoGroups){this.hmenu.add({itemId:"showGroups",text:this.showGroupsText,checked:true,checkHandler:this.onShowGroupsClick,scope:this})}this.hmenu.on("beforeshow",this.beforeMenuShow,this)}return a},onGroupByClick:function(){this.grid.store.groupBy(this.cm.getDataIndex(this.hdCtxIndex));this.beforeMenuShow()},onShowGroupsClick:function(a,b){if(b){this.onGroupByClick()}else{this.grid.store.clearGrouping()}},toggleGroup:function(c,b){this.grid.stopEditing(true);c=Ext.getDom(c);var a=Ext.fly(c);b=b!==undefined?b:a.hasClass("x-grid-group-collapsed");this.state[a.dom.id]=b;a[b?"removeClass":"addClass"]("x-grid-group-collapsed")},toggleAllGroups:function(c){var b=this.getGroups();for(var d=0,a=b.length;d<a;d++){this.toggleGroup(b[d],c)}},expandAllGroups:function(){this.toggleAllGroups(true)},collapseAllGroups:function(){this.toggleAllGroups(false)},interceptMouse:function(b){var a=b.getTarget(".x-grid-group-hd",this.mainBody);if(a){b.stopEvent();this.toggleGroup(a.parentNode)}},getGroup:function(a,d,f,h,b,e){var c=f?f(a,{},d,h,b,e):String(a);if(c===""){c=this.cm.config[b].emptyGroupText||this.emptyGroupText}return c},getGroupField:function(){return this.grid.store.getGroupState()},afterRender:function(){Ext.ux.GroupingColorView.superclass.afterRender.call(this);if(this.grid.deferRowRender){this.updateGroupWidths()}},renderRows:function(){var a=this.getGroupField();var d=!!a;if(this.hideGroupedColumn){var b=this.cm.findColumnIndex(a);if(!d&&this.lastGroupField!==undefined){this.mainBody.update("");this.cm.setHidden(this.cm.findColumnIndex(this.lastGroupField),false);delete this.lastGroupField}else{if(d&&this.lastGroupField===undefined){this.lastGroupField=a;this.cm.setHidden(b,true)}else{if(d&&this.lastGroupField!==undefined&&a!==this.lastGroupField){this.mainBody.update("");var c=this.cm.findColumnIndex(this.lastGroupField);this.cm.setHidden(c,false);this.lastGroupField=a;this.cm.setHidden(b,true)}}}}return Ext.ux.GroupingColorView.superclass.renderRows.apply(this,arguments)},doRender:function(d,h,w,a,u,y){if(h.length<1){return""}var F=this.getGroupField(),t=this.cm.findColumnIndex(F),C;this.enableGrouping=!!F;if(!this.enableGrouping||this.isUpdating){return Ext.ux.GroupingColorView.superclass.doRender.apply(this,arguments)}var m="width:"+this.getTotalWidth()+";";var x=this.grid.getGridEl().id;var f=this.cm.config[t];var b=f.groupRenderer||f.renderer;var z=this.showGroupName?(f.groupName||f.header)+": ":"";var E=[],p,A,B,s;for(A=0,B=h.length;A<B;A++){var o=a+A,q=h[A],e=q.data[F];C=this.getGroup(e,q,b,o,t,w);if(!p||p.group!=C){s=x+"-gp-"+F+"-"+Ext.util.Format.htmlEncode(C);var c=typeof this.state[s]!=="undefined"?!this.state[s]:this.startCollapsed;var n=c?"x-grid-group-collapsed":"";p={group:C,gvalue:e,text:z+C,groupId:s,startRow:o,rs:[q],cls:n,style:m};E.push(p)}else{p.rs.push(q)}q._groupId=s}var D=[];for(A=0,B=E.length;A<B;A++){C=E[A];this.doGroupStart(D,C,d,w,u);D[D.length]=Ext.ux.GroupingColorView.superclass.doRender.call(this,d,C.rs,w,C.startRow,u,y);this.doGroupEnd(D,C,d,w,u)}return D.join("")},getGroupId:function(f){var d=this.grid.getGridEl().id;var c=this.getGroupField();var e=this.cm.findColumnIndex(c);var b=this.cm.config[e];var g=b.groupRenderer||b.renderer;var a=this.getGroup(f,{data:{}},g,0,e,this.ds);return d+"-gp-"+c+"-"+Ext.util.Format.htmlEncode(f)},doGroupStart:function(a,d,b,e,c){a[a.length]=this.startGroup.apply(d)},doGroupEnd:function(a,d,b,e,c){a[a.length]=this.endGroup},getRows:function(){if(!this.enableGrouping){return Ext.ux.GroupingColorView.superclass.getRows.call(this)}var h=[];var f,c=this.getGroups();for(var e=0,a=c.length;e<a;e++){f=c[e].childNodes[1].childNodes;for(var d=0,b=f.length;d<b;d++){h[h.length]=f[d]}}return h},updateGroupWidths:function(){if(!this.enableGrouping||!this.hasRows()){return}var c=Math.max(this.cm.getTotalWidth(),this.el.dom.offsetWidth-this.scrollOffset)+"px";var b=this.getGroups();for(var d=0,a=b.length;d<a;d++){b[d].firstChild.style.width=c}},onColumnWidthUpdated:function(c,a,b){Ext.ux.GroupingColorView.superclass.onColumnWidthUpdated.call(this,c,a,b);this.updateGroupWidths()},onAllColumnWidthsUpdated:function(a,b){Ext.ux.GroupingColorView.superclass.onAllColumnWidthsUpdated.call(this,a,b);this.updateGroupWidths()},onColumnHiddenUpdated:function(b,c,a){Ext.ux.GroupingColorView.superclass.onColumnHiddenUpdated.call(this,b,c,a);this.updateGroupWidths()},onLayout:function(){this.updateGroupWidths()},onBeforeRowSelect:function(d,c){if(!this.enableGrouping){return}var b=this.getRow(c);if(b&&!b.offsetParent){var a=this.findGroup(b);this.toggleGroup(a,true)}}});Ext.ux.GroupingColorView.GROUP_ID=1000;Ext.override(Ext.data.GroupingStore,{applySort:function(){Ext.data.GroupingStore.superclass.applySort.call(this);if(!this.groupOnSort&&!this.remoteGroup){var a=this.getGroupState();var b=this.sortInfo||{};if(a&&a!=b.field){this.sortData(this.groupField)}}}});Ext.ns("Ext.ux");Ext.ux.ExportUI=function(b){var a={shadow:false,title:"Exports"};this.exportOptions=new Ext.form.FieldSet({columnWidth:0.5,height:120,xtype:"fieldset",bodyStyle:"padding:10px",style:"margin:5px",title:"Export options",items:[{html:"Please select an export format"}]});Ext.apply(a,b);Ext.apply(this,a);Ext.ux.ExportUI.superclass.constructor.call(this,a)};Ext.extend(Ext.ux.ExportUI,Ext.Window,{findLabel:function(b){var a=b;if(this.labels){Ext.iterate(this.labels,function(d,c){if(b==d){a=c}})}return a},formatHandler:function(a,c){this.exportOptions.removeAll();this.exportOptions.add(new Ext.form.RadioGroup({hideLabel:true,columns:1,defaults:{anchor:"95%"},items:this.findOptions(Ext.isObject(a)?a.getGroupValue():a)}));this.exportOptions.doLayout()},findOptions:function(b){var a=[];var c=null;if(this.exportConfig){Ext.iterate(this.exportConfig,function(e,d){if(e==b){c=d}},this)}if(c){Ext.iterate(c,function(e,d){a.push({boxLabel:this.findLabel(e),name:"option",inputValue:e})},this)}return a},findFormats:function(){var a=[];var b=false;if(this.exportConfig){Ext.iterate(this.exportConfig,function(c,d){a.push({boxLabel:this.findLabel(c),name:"format",inputValue:c,checked:b?false:true,listeners:{check:this.formatHandler.createDelegate(this)}});if(!b){this.formatHandler(c);b=true}},this)}return a},onRender:function(ct,position){Ext.ux.ExportUI.superclass.onRender.call(this,ct,position);var win=this;var hideWindow=function(button){win.hide()};var uiPanel=new Ext.FormPanel({frame:true,layout:"column",buttons:[{text:"Ok",handler:function(b){var form=uiPanel.getForm();var vals=form.getValues();if(!vals.format||!vals.option){Ext.Msg.alert("Error","Please select both export format and export option");return}eval("win."+vals.format+vals.option+"()")}},{text:"Cancel",handler:hideWindow}],items:[{columnWidth:0.5,height:120,bodyStyle:"padding:10px",style:"margin:5px",xtype:"fieldset",title:"Export formats",items:[{hideLabel:true,xtype:"radiogroup",columns:1,defaults:{anchor:"95%"},items:this.findFormats()}]},this.exportOptions]});this.add(uiPanel)}});Ext.ns("Ext.ux.grid");Ext.ux.grid.GridSummary=function(a){Ext.apply(this,a)};Ext.extend(Ext.ux.grid.GridSummary,Ext.util.Observable,{init:function(b){this.grid=b;this.cm=b.getColumnModel();this.view=b.getView();var a=this.view;a.onLayout=this.onLayout;a.afterMethod("render",this.refreshSummary,this);a.afterMethod("refresh",this.refreshSummary,this);a.afterMethod("syncScroll",this.syncSummaryScroll,this);a.afterMethod("onColumnWidthUpdated",this.doWidth,this);a.afterMethod("onAllColumnWidthsUpdated",this.doAllWidths,this);a.afterMethod("onColumnHiddenUpdated",this.doHidden,this);b.store.on({add:this.refreshSummary,remove:this.refreshSummary,clear:this.refreshSummary,update:this.refreshSummary,scope:this});if(!this.rowTpl){this.rowTpl=new Ext.Template('<div class="x-grid3-summary-row x-grid3-gridsummary-row-offset">','<table class="x-grid3-summary-table" border="0" cellspacing="0" cellpadding="0" style="{tstyle}">',"<tbody><tr>{cells}</tr></tbody>","</table>","</div>");this.rowTpl.disableFormats=true}this.rowTpl.compile();if(!this.cellTpl){this.cellTpl=new Ext.Template('<td class="x-grid3-col x-grid3-cell x-grid3-td-{id} {css}" style="{style}">','<div class="x-grid3-cell-inner x-grid3-col-{id}" unselectable="on" {attr}>{value}</div>',"</td>");this.cellTpl.disableFormats=true}this.cellTpl.compile()},calculate:function(c,n){var e={},h=n.config;for(var f=0,m=h.length;f<m;f++){var b=h[f],g=b.dataIndex;e[g]=0;if(b.summaryType){for(var d=0,o=c.length;d<o;d++){var a=c[d];e[g]=Ext.ux.grid.GridSummary.Calculations[b.summaryType](a.get(g),a,g,e,d)}}}return e},onLayout:function(a,b){if(Ext.type(b)!="number"){return}if(!this.grid.getGridEl().hasClass("x-grid-hide-gridsummary")){this.scroller.setHeight(b-this.summary.getHeight())}},syncSummaryScroll:function(){var a=this.view.scroller.dom;this.view.summaryWrap.dom.scrollLeft=a.scrollLeft;this.view.summaryWrap.dom.scrollLeft=a.scrollLeft},doWidth:function(c,a,b){var d=this.view.summary.dom;d.firstChild.style.width=b;d.firstChild.rows[0].childNodes[c].style.width=a},doAllWidths:function(a,b){var e=this.view.summary.dom,f=a.length;e.firstChild.style.width=b;var d=e.firstChild.rows[0].childNodes;for(var c=0;c<f;c++){d[c].style.width=a[c]}},doHidden:function(b,d,a){var c=this.view.summary.dom,e=d?"none":"";c.firstChild.style.width=a;c.firstChild.rows[0].childNodes[b].style.display=e},renderSummary:function(d,g,q){g=g||this.view.getColumnData();var h=q.config,e=[],r=g.length-1;for(var f=0,m=g.length;f<m;f++){var n=g[f],b=h[f],a={};a.id=n.id;a.style=n.style;a.css=f===0?"x-grid3-cell-first ":(f==r?"x-grid3-cell-last ":"");if(b.summaryType||b.summaryRenderer){a.value=(b.summaryRenderer||n.renderer)(d.data[n.name],a,d)}else{a.value=""}if(b.summaryType&&Ext.ux.grid.GridSummary.Calculations[b.summaryType+"Renderer"]){a.value=Ext.ux.grid.GridSummary.Calculations[b.summaryType+"Renderer"](d.data[n.name],a,d)}if(a.value===undefined||a.value===""){a.value="&#160;"}e[e.length]=this.cellTpl.apply(a)}return this.rowTpl.apply({tstyle:"width:"+this.view.getTotalWidth()+";",cells:e.join("")})},refreshSummary:function(){var e=this.grid,h=e.store,d=this.view.getColumnData(),a=this.cm,b=h.getRange(),f=this.calculate(b,a),c=this.renderSummary({data:f},d,a);if(!this.view.summaryWrap){this.view.summaryWrap=Ext.DomHelper.insertAfter(this.view.scroller,{tag:"div",cls:"x-grid3-gridsummary-row-inner"},true)}this.view.summary=this.view.summaryWrap.update(c).first()},toggleSummary:function(b){var a=this.grid.getGridEl();if(a){if(b===undefined){b=a.hasClass("x-grid-hide-gridsummary")}a[b?"removeClass":"addClass"]("x-grid-hide-gridsummary");this.view.layout()}},getSummaryNode:function(){return this.view.summary}});Ext.reg("gridsummary",Ext.ux.grid.GridSummary);Ext.ux.grid.GridSummary.stripTags=function(b){b=String(b).replace(/<div class="ux-grid-filter-hidden-value">[\S]+<\/div>/,"");var a=/<\S[^>]*>/gi;b=String(b).replace(a,"");if(isNaN(b)){return b}return Number(b)};Ext.ux.grid.GridSummary.Calculations={sum:function(b,a,c,e,d){return Ext.ux.grid.GridSummary.stripTags(e[c])+Ext.num(Ext.ux.grid.GridSummary.stripTags(b),0)},sumRenderer:function(a,c,b){c.attr='ext:qtip="Total sum: '+a+'"';return"Sum: "+a},count:function(b,a,c,e,d){return d+1},countRenderer:function(a,c,b){c.attr='ext:qtip="Total count: '+a+'"';return"Count: "+a},max:function(b,a,c,e,d){return Math.max(Ext.num(Ext.ux.grid.GridSummary.stripTags(b),0),Ext.ux.grid.GridSummary.stripTags(e[c]))},maxRenderer:function(a,c,b){c.attr='ext:qtip="Max: '+a+'"';return"Max: "+a},min:function(b,a,c,e,d){return Math.min(Ext.num(Ext.ux.grid.GridSummary.stripTags(b),0),Ext.ux.grid.GridSummary.stripTags(e[c]))},minRenderer:function(a,c,b){c.attr='ext:qtip="Min: '+a+'"';return"Min: "+a},average:function(b,a,d,g,f){var c=Ext.ux.grid.GridSummary.stripTags(g[d])+Ext.num(Ext.ux.grid.GridSummary.stripTags(b),0),e=a.store.getCount();return f==e-1?(c/e):c},averageRenderer:function(a,c,b){c.attr='ext:qtip="Average: '+a+'"';return"Average: "+a}};Ext.namespace("Ext.ux.plugins");Ext.ux.plugins.AddExpandListButton=function(a){Ext.apply(this,a);Ext.ux.plugins.AddExpandListButton.superclass.constructor.call(this)};Ext.extend(Ext.ux.plugins.AddExpandListButton,Ext.util.Observable,{init:function(a){Ext.apply(a,{expandedText:"Expanded View",listText:"List View",buttonState:"list",expandedIconCls:"icon-expanded-view",listIconCls:"icon-list-view",selectedIconCls:"icon-selected-view",onRender:a.onRender.createSequence(function(c,b){this.expandListButton=new Ext.Button({text:a.expandedText,handler:this.mainButtonHandler,iconCls:this.expandedIconCls,tooltip:"Click to toggle the view"});this.topToolbar=a.getTopToolbar();this.topToolbar.addFill();this.topToolbar.add(this.expandListButton);a.getView().on("refresh",this.reconfigureGrid)}),reconfigureGrid:function(b){a.isExpanded()?a.setExpanded():a.unsetExpanded()},setExpanded:function(){a.buttonState="expanded";a.expandListButton.setText(a.listText);a.expandListButton.setIconClass(a.listIconCls);a.getView().el.select(".x-grid3-cell-inner").setStyle({"white-space":"normal"})},unsetExpanded:function(){a.buttonState="list";a.expandListButton.setText(a.expandedText);a.expandListButton.setIconClass(a.expandedIconCls);a.getView().el.select(".x-grid3-cell-inner").setStyle({"white-space":"nowrap"})},isExpanded:function(){return this.buttonState=="list"?false:true},mainButtonHandler:function(b){a.isExpanded()?a.unsetExpanded():a.setExpanded()}})}});
/*
 * Ext JS Library 3.0.0
 * Copyright(c) 2006-2009 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
Ext.ns("Ext.ux.grid");Ext.ux.grid.RowExpander=Ext.extend(Ext.util.Observable,{expandOnEnter:true,expandOnDblClick:true,header:"",width:20,sortable:false,fixed:true,menuDisabled:true,dataIndex:"",id:"expander",lazyRender:true,enableCaching:true,constructor:function(a){Ext.apply(this,a);this.addEvents({beforeexpand:true,expand:true,beforecollapse:true,collapse:true});Ext.ux.grid.RowExpander.superclass.constructor.call(this);if(this.tpl){if(typeof this.tpl=="string"){this.tpl=new Ext.Template(this.tpl)}this.tpl.compile()}this.state={};this.bodyContent={}},getRowClass:function(a,e,d,c){d.cols=d.cols-1;var b=this.bodyContent[a.id];if(!b&&!this.lazyRender){b=this.getBodyContent(a,e)}if(b){d.body=b}return this.state[a.id]?"x-grid3-row-expanded":"x-grid3-row-collapsed"},init:function(b){this.grid=b;var a=b.getView();a.getRowClass=this.getRowClass.createDelegate(this);a.enableRowBody=true;b.on("render",this.onRender,this);b.on("destroy",this.onDestroy,this)},onRender:function(){var a=this.grid;var b=a.getView().mainBody;b.on("mousedown",this.onMouseDown,this,{delegate:".x-grid3-row-expander"});if(this.expandOnEnter){this.keyNav=new Ext.KeyNav(this.grid.getGridEl(),{"enter":this.onEnter,scope:this})}if(this.expandOnDblClick){a.on("rowdblclick",this.onRowDblClick,this)}},onDestroy:function(){this.keyNav.disable();delete this.keyNav;var a=this.grid.getView().mainBody;a.un("mousedown",this.onMouseDown,this)},onRowDblClick:function(a,b,c){this.toggleRow(b)},onEnter:function(h){var f=this.grid;var m=f.getSelectionModel();var b=m.getSelections();for(var c=0,a=b.length;c<a;c++){var d=f.getStore().indexOf(b[c]);this.toggleRow(d)}},getBodyContent:function(a,b){if(!this.enableCaching){return this.tpl.apply(a.data)}var c=this.bodyContent[a.id];if(!c){c=this.tpl.apply(a.data);this.bodyContent[a.id]=c}return c},onMouseDown:function(b,a){b.stopEvent();var c=b.getTarget(".x-grid3-row");this.toggleRow(c)},renderer:function(b,c,a){c.cellAttr='rowspan="2"';return'<div class="x-grid3-row-expander">&#160;</div>'},beforeExpand:function(b,a,c){if(this.fireEvent("beforeexpand",this,b,a,c)!==false){if(this.tpl&&this.lazyRender){a.innerHTML=this.getBodyContent(b,c)}return true}else{return false}},toggleRow:function(a){if(typeof a=="number"){a=this.grid.view.getRow(a)}this[Ext.fly(a).hasClass("x-grid3-row-collapsed")?"expandRow":"collapseRow"](a)},expandRow:function(c){if(typeof c=="number"){c=this.grid.view.getRow(c)}var b=this.grid.store.getAt(c.rowIndex);var a=Ext.DomQuery.selectNode("tr:nth(2) div.x-grid3-row-body",c);if(this.beforeExpand(b,a,c.rowIndex)){this.state[b.id]=true;Ext.fly(c).replaceClass("x-grid3-row-collapsed","x-grid3-row-expanded");this.fireEvent("expand",this,b,a,c.rowIndex)}},collapseRow:function(c){if(typeof c=="number"){c=this.grid.view.getRow(c)}var b=this.grid.store.getAt(c.rowIndex);var a=Ext.fly(c).child("tr:nth(1) div.x-grid3-row-body",true);if(this.fireEvent("beforecollapse",this,b,a,c.rowIndex)!==false){this.state[b.id]=false;Ext.fly(c).replaceClass("x-grid3-row-expanded","x-grid3-row-collapsed");this.fireEvent("collapse",this,b,a,c.rowIndex)}}});Ext.preg("rowexpander",Ext.ux.grid.RowExpander);Ext.grid.RowExpander=Ext.ux.grid.RowExpander;Ext.namespace("Ext.ux.menu");Ext.ux.menu.EditableItem=Ext.extend(Ext.menu.BaseItem,{itemCls:"x-menu-item",hideOnClick:false,initComponent:function(){this.addEvents({keyup:true});this.editor=this.editor||new Ext.form.TextField();if(this.text){this.editor.setValue(this.text)}},onRender:function(a){var b=a.createChild({cls:this.itemCls,html:'<img id="my" src="'+(Ext.BLANK_IMAGE_URL)+'" class="x-menu-item-icon'+(this.iconCls?" "+this.iconCls:"")+'" style="margin: 3px 7px 2px 2px;" />'});Ext.apply(this.config,{width:125});this.editor.render(b);this.el=b;this.relayEvents(this.editor.el,["keyup"]);if(Ext.isGecko){b.setStyle("overflow","auto")}a.dom.firstChild.className="x-menu-item-icon";if(this.iconCls&&this.iconCls=="ux-rangemenu-lt"){b.dom.firstChild.style.margin="28px 7px 2px 2px"}else{if(this.iconCls&&this.iconCls=="ux-rangemenu-eq"){b.dom.firstChild.style.margin="60px 7px 2px 2px"}else{if(this.iconCls&&this.iconCls=="ux-rangemenu-ne"){b.dom.firstChild.style.margin="83px 7px 2px 2px"}}}this.editor.el.setStyle("marginLeft","0px");Ext.ux.menu.EditableItem.superclass.onRender.apply(this,arguments)},getValue:function(){return this.editor.getValue()},setValue:function(a){this.editor.setValue(a)},isValid:function(a){return this.editor.isValid(a)}});Ext.namespace("Ext.ux.menu");Ext.ux.menu.ComboMenu=Ext.extend(Ext.menu.BaseItem,{itemCls:"x-menu-item",hideOnClick:false,tempValue:null,initComponent:function(){this.addEvents({keyup:true});var a;if(this.lovcombo){a=new Ext.ux.form.LovCombo({store:this.store,mode:"local",triggerAction:"all",emptyText:"Select an option...",selectOnFocus:true,resizable:true})}else{a=new Ext.form.ComboBox({store:this.store,typeAhead:true,mode:"local",triggerAction:"all",emptyText:"Select an option...",selectOnFocus:true,resizable:true})}this.editor=a;if(this.text){this.editor.setValue(this.text)}},onRender:function(a){var b=a.createChild({cls:this.itemCls});Ext.apply(this.config,{width:225});this.editor.render(b);this.el=b;this.relayEvents(this.editor.el,["keyup"]);if(Ext.isGecko){b.setStyle("overflow","auto")}if(this.tempValue!==null){this.setValue(this.tempValue)}Ext.ux.menu.ComboMenu.superclass.onRender.apply(this,arguments)},getValue:function(){if(this.editor.el){return this.editor.getValue()}else{return this.tempValue}},setValue:function(a){if(this.editor.el){this.editor.setValue(a)}else{this.tempValue=a;this.tempDisplayValue=a}},isValid:function(a){return this.editor.isValid(a)},getDisplayValue:function(){var c=new Array();var f=[];v=this.getValue();var b=this.editor.getStore();if(v.toString().match(/,/)){c=v.toString().split(",")}else{c[0]=v}for(var e=0;e<c.length;e++){if(c[e]==""){continue}var d=b.findExact("field1",parseInt(c[e]));if(d==-1){d=b.find("field1",c[e])}var a=b.getAt(d);f.push(a.get("field2"))}return f.join(", ")}});Ext.namespace("Ext.ux.menu");Ext.ux.menu.RangeMenu=function(){Ext.ux.menu.RangeMenu.superclass.constructor.apply(this,arguments);this.updateTask=new Ext.util.DelayedTask(this.fireUpdate,this);var c=this.fieldCfg;var b=this.fieldCls;var a=this.fields=Ext.applyIf(this.fields||{},{"gt":new Ext.ux.menu.EditableItem({iconCls:this.icons.gt,editor:new b(typeof c=="object"?c.gt||"":c)}),"lt":new Ext.ux.menu.EditableItem({iconCls:this.icons.lt,editor:new b(typeof c=="object"?c.lt||"":c)}),"eq":new Ext.ux.menu.EditableItem({iconCls:this.icons.eq,editor:new b(typeof c=="object"?c.gt||"":c)}),"ne":new Ext.ux.menu.EditableItem({iconCls:this.icons.ne,editor:new b(typeof c=="object"?c.gt||"":c)})});this.add(a.gt,a.lt,"-",a.eq,a.ne);for(var d in a){a[d].on("keyup",function(f,e,h,g){if(f.getKey()==f.ENTER&&g.isValid()){this.updateTask.delay(this.updateBuffer);this.hide(true);return}if(g==a.eq){a.gt.setValue(null);a.lt.setValue(null);a.ne.setValue(null)}else{if(g==a.ne){a.gt.setValue(null);a.lt.setValue(null);a.eq.setValue(null)}else{a.eq.setValue(null);a.ne.setValue(null)}}}.createDelegate(this,[a[d]],true))}this.addEvents({"update":true})};Ext.extend(Ext.ux.menu.RangeMenu,Ext.menu.Menu,{fieldCls:Ext.form.NumberField,fieldCfg:"",updateBuffer:500,icons:{gt:"ux-rangemenu-gt",lt:"ux-rangemenu-lt",eq:"ux-rangemenu-eq",ne:"ux-rangemenu-ne"},fireUpdate:function(){this.fireEvent("update",this)},setValue:function(b){for(var a in this.fields){this.fields[a].setValue(b[a]!==undefined?b[a]:"")}this.fireEvent("update",this)},getValue:function(){var a={};for(var b in this.fields){var c=this.fields[b];if(c.isValid()&&String(c.getValue()).length>0){a[b]=c.getValue()}}return a}});Ext.grid.GridView.prototype.handleHdMenuClick=function(c){var b=this.hdCtxIndex;var a=this.cm,d=this.ds;switch(c.getItemId()){case"asc":d.sort(a.getDataIndex(b),"ASC");break;case"desc":d.sort(a.getDataIndex(b),"DESC");break;default:b=a.getIndexById(c.getItemId().substr(4));if(b!=-1){if(c.checked&&a.getColumnsBy(this.isHideableColumn,this).length<=1){this.onDenyColumnHide();return false}a.setHidden(b,c.checked)}}return true};Ext.namespace("Ext.ux.grid");Ext.ux.grid.GridFilters=function(b){this.filters=new Ext.util.MixedCollection();this.filters.getKey=function(d){return d?d.dataIndex:null};for(var c=0,a=b.filters.length;c<a;c++){this.addFilter(b.filters[c])}this.deferredUpdate=new Ext.util.DelayedTask(this.reload,this);delete b.filters;Ext.apply(this,b)};Ext.extend(Ext.ux.grid.GridFilters,Ext.util.Observable,{updateBuffer:500,paramPrefix:"filter",filterCls:"ux-filtered-column",local:false,autoReload:true,stateId:undefined,showMenu:true,menuFilterText:"Filters",mode:"menu",showFilterInfo:"panel",init:function(a){if(a instanceof Ext.grid.GridPanel){this.grid=a;this.grid.originalTitle=this.grid.originalTitle?this.grid.originalTitle:a.title;this.store=this.grid.getStore();if(this.local){this.store.on("load",function(b){b.filterBy(this.getRecordFilter())},this)}else{this.store.on("beforeload",this.onBeforeLoad,this);this.store.on("load",function(){if(this.showFilterInfo){new Ext.ux.FilterInfo(this.grid,this.showFilterInfo)}},this)}this.grid.filters=this;this.grid.addEvents({"filterupdate":true});a.on("render",this.onRender,this);a.on("beforerender",this.applyState,this);if(this.applyPrivateCookie()){this.saveState(this.grid,this.applyPrivateCookie());this.grid.saveState()}a.on("beforestaterestore",this.applyState,this);a.on("beforestatesave",this.saveState,this)}else{if(a instanceof Ext.PagingToolbar){this.toolbar=a}}},applyState:function(c,f){this.suspendStateStore=true;this.clearFilters();var e;f=(e=this.applyPrivateCookie())?e:f;if(f&&f.filters){for(var b in f.filters){var d=this.filters.get(b);if(d){d.setValue(f.filters[b]);d.setActive(true)}}}this.deferredUpdate.cancel();if(this.local){this.reload()}this.suspendStateStore=false;if(this.filterby&&this.filterbyKeyword){var a=new Ext.ux.SaveSearchState(this.grid);a.restore(this.filterby,this.filterbyKeyword)}},saveState:function(a,c){var b={};this.filters.each(function(d){if(d.active){b[d.dataIndex]=d.getValue()}});return c.filters=b},applyPrivateCookie:function(){var f=this.grid.path;var e=new Ext.state.CookieProvider({});var a=e.get("search_result_cookie");if(a){var d=Ext.util.JSON.decode(a);for(key in d){var b=this.filters.get(key);if(b){if(b.type=="date"){for(k in d[key]){d[key][k]=new Date(Date.parseDate(d[key][k],"Y-m-d"))}}if(b.type=="string"){d[key]=d[key].toString().replace(/\+/g," ")}}}var c={filters:d};return c}return false},onRender:function(){if(this.mode=="header"){new Ext.ux.RePositionFilters(this.grid);return}var a;if(this.showMenu){a=this.grid.getView().hmenu;this.sep=a.addSeparator();this.menu=a.add(new Ext.menu.CheckItem({text:this.menuFilterText,menu:new Ext.menu.Menu()}));this.menu.on("checkchange",this.onCheckChange,this);this.menu.on("beforecheckchange",this.onBeforeCheck,this);a.on("beforeshow",this.onMenu,this)}this.grid.getView().on("refresh",this.onRefresh,this);this.updateColumnHeadings(this.grid.getView())},onMenu:function(b){var a=this.getMenuFilter();if(a){this.menu.menu=a.menu;this.menu.setChecked(a.active,false)}this.menu.setVisible(a!==undefined)},onCheckChange:function(a,b){this.getMenuFilter().setActive(b)},onBeforeCheck:function(a,b){return !b||this.getMenuFilter().isActivatable()},onStateChange:function(c,b){if(c=="serialize"){return}if(b==this.getMenuFilter()&&this.mode=="hmenu"){this.menu.setChecked(b.active,false)}if(this.autoReload||this.local){this.deferredUpdate.delay(this.updateBuffer)}var a=this.grid.getView();this.updateColumnHeadings(a);this.grid.saveState();this.grid.fireEvent("filterupdate",this,b)},onBeforeLoad:function(a,b){b.params=b.params||{};this.cleanParams(b.params);var c=this.buildQuery(this.getFilterData());Ext.apply(b.params,c)},onRefresh:function(a){this.updateColumnHeadings(a)},getMenuFilter:function(){var a=this.grid.getView();if(!a||a.hdCtxIndex===undefined){return null}return this.filters.get(a.cm.config[a.hdCtxIndex].dataIndex)},updateColumnHeadings:function(b){if(!b||!b.mainHd){return}if(this.mode=="header"){return}var e=b.mainHd.select("td").removeClass(this.filterCls);for(var c=0,a=b.cm.config.length;c<a;c++){var d=this.getFilter(b.cm.config[c].dataIndex);if(d&&d.active){e.item(c).addClass(this.filterCls)}}},reload:function(){if(this.local){this.grid.store.clearFilter(true);this.grid.store.filterBy(this.getRecordFilter())}else{this.deferredUpdate.cancel();var a=this.grid.store;if(this.toolbar){var b=this.toolbar.paramNames.start;if(a.lastOptions&&a.lastOptions.params&&a.lastOptions.params[b]){a.lastOptions.params[b]=0}}if(a.lastOptions&&a.lastOptions.params&&a.lastOptions.params.start){a.lastOptions.params.start=0}a.reload()}},getRecordFilter:function(){var b=[];this.filters.each(function(c){if(c.active){b.push(c)}});var a=b.length;return function(c){for(var d=0;d<a;d++){if(!b[d].validateRecord(c)){return false}}return true}},addFilter:function(a){var b=a.menu?a:new (this.getFilterClass(a.type))(a);this.filters.add(b);Ext.util.Observable.capture(b,this.onStateChange,this);return b},getFilter:function(a){return this.filters.get(a)},clearFilters:function(){this.filters.each(function(a){a.setActive(false)})},getFilterData:function(){var b=[],a=this.grid.getStore().fields;this.filters.each(function(g){if(g.active){var h=[].concat(g.serialize());for(var e=0,c=h.length;e<c;e++){b.push({field:g.dataColumn?g.dataColumn:g.dataIndex,data:h[e]})}}});return b},buildQuery:function(e){var h={};for(var d=0,a=e.length;d<a;d++){var g=e[d];var b=[this.paramPrefix,"[",d,"]"].join("");h[b+"[field]"]=g.field;var m=b+"[data]";for(var c in g.data){h[[m,"[",c,"]"].join("")]=g.data[c]}}return h},cleanParams:function(c){var b=new RegExp("^"+this.paramPrefix+"[[0-9]+]");for(var a in c){if(b.test(a)){delete c[a]}}},getFilterClass:function(a){return Ext.ux.grid.filter[a.substr(0,1).toUpperCase()+a.substr(1)+"Filter"]}});Ext.ns("Ext.ux");Ext.ux.DrillFilter=function(b,g){var r=g.getTarget();var o=b.getView().findCellIndex(r.parentNode);var h=b.getView().findRowIndex(r);var n=b.getColumnModel();var m=n.getDataIndex(o);var f=b.filters;if(!f){return}var c=f.filters.get(m);if(!c){return}if(r.className!="ux-grid-filter"){if(!c.selectable){return}}var d=b.getView().getCell(h,o).innerHTML;var q=Ext.DomQuery.selectNode(".ux-grid-filter-hidden-value",b.getView().getCell(h,o));var p=new Ext.Imm.SelectedText();p=p.toString();if(!p&&!q){return}var a=p?p:q.innerHTML;if(c.type=="numeric"){a={"eq":a}}if(c.type=="list"){a=[a]}if(c.type=="text"){c.makeChanges("and",[a]);c.execute();c.setActive(true);return}c.setValue(a);c.setActive(true)};Ext.ns("Ext.Imm");Ext.Imm.SelectedText=function(){var a=null;if(window.getSelection){a=window.getSelection()}else{if(document.getSelection){a=document.getSelection()}else{if(document.selection){a=document.selection.createRange().text}else{return}}}return a};Ext.ns("Ext.ux");Ext.ux.RePositionFilters=function(c){c.addEvents("spresize");var a=c.getColumnModel();this.grid=c;this.applyTemplate=function(){var d="";this.eachColumn(function(f){var g=this.getFilterDivId(f.id);var h=f.hidden?" style='display:none'":"";d+="<td"+h+'><div class="x-small-editor" id="'+g+'"></div></td>'});var e=new Ext.Template('<table border="0" cellspacing="0" cellpadding="0" style="{tstyle}">','<thead><tr class="x-grid3-hd-row">{cells}</tr></thead>','<tbody><tr class="filter-row-header">',d,"</tr></tbody>","</table>");return e};this.getFilterFieldDom=function(d){return d.wrap?d.wrap.dom:d.el.dom};this.eachColumn=function(d){Ext.each(this.grid.getColumnModel().config,d,this)};this.getFilterDivId=function(d){return this.grid.id+"-filter-"+d};this.resizeSp=function(e,f){if(e.sp){var d=50;if(f<d){a.setColumnWidth(a.getIndexById(e.dataIndex),d);f=d}e.sp.setWidth(f)}};this.resizeAllSp=function(){var d=this.grid.getColumnModel();this.eachColumn(function(e,f){this.resizeSp(e,d.getColumnWidth(f))})};this.renderFields=function(){this.eachColumn(function(e){var d=Ext.get(this.getFilterDivId(e.id));var f=this.getFilterField(e);this.grid.filters.menu=f;if(f){if(f.rendered){d.appendChild(this.getFilterFieldDom(f))}else{f.render(d)}}})};this.getFilterField=function(e){if(e.sp){return e.sp}if(!e.dataIndex){return}var d=this.getFilterForColumn(e);if(!d){return e.sp=new Ext.Button({width:e.width,disabled:true})}var g=this.getFilterMenuForColumn(e);var f=new Ext.SplitButton({text:this.grid.filters.menuFilterText,menu:g,width:e.width,allowDepress:true,layout:"fit",arrowTooltip:"Click for filter options",enableToggle:true,tooltip:"Click to enable/disable this filter",disabled:d?false:true});f.on("toggle",function(h,m){if(d.getValue()&&d.isActivatable()){d.setActive(m)}else{h.toggle(false)}},this);f.on("render",function(){if(d.active){f.toggle(true)}},this);d.on("activate",function(){f.toggle(true)},this);d.on("deactivate",function(){f.toggle(false)},this);e.sp=f;return f};this.getFilterMenuForColumn=function(e){if(!this.grid.filters.filters){return}var d=this.grid.filters.filters.get(e.dataIndex);if(d){return d.menu}return null};this.getFilterForColumn=function(e){if(!this.grid.filters.filters){return}var d=this.grid.filters.filters.get(e.dataIndex);return d};var b=this.grid.getView();Ext.applyIf(b,{templates:{}});b.templates.header=this.applyTemplate();b.refresh(true);this.renderFields();a.on("widthchange",function(d,e,f){this.resizeAllSp()},this);a.on("hiddenchange",function(e,f,g){var d=Ext.get(this.getFilterDivId(e.getColumnId(f)));if(d){d.parent().dom.style.display=g?"none":""}this.resizeAllSp()},this);c.on("columnresize",function(e,d){this.resizeAllSp()},this);c.on("resize",function(){this.resizeAllSp()},this);a.on("columnmoved",function(d,g,f){var e=this.grid.getView();Ext.applyIf(e,{templates:{}});e.templates.header=this.applyTemplate();e.refresh(true);this.renderFields()},this)};Ext.ns("Ext.ux");Ext.ux.SaveSearchState=function(b){var a=b.filters;if(!a){return}var c=new Ext.state.Provider();this.saveUrl=afApp.urlPrefix+"/appFlower/saveFilter";this.listUrl=afApp.urlPrefix+"/appFlower/listFilter";this.removeUrl=afApp.urlPrefix+"/appFlower/removeFilter";this.save=function(){var e=[];var d=this.list;a.filters.each(function(f){if(f.active){var g={dataIndex:f.dataIndex,value:c.encodeValue(f.getValue())};e.push(g)}});if(e.length<1){Ext.Msg.alert("Error","Filter criteria is empty.");return}Ext.Msg.prompt("Name","Please input filter name:",function(g,h){if(g=="ok"){if(h==""){Ext.Msg.alert("Error","Filter name is required.");return}var f=Ext.util.JSON.encode(e);Ext.Ajax.request({method:"POST",url:this.saveUrl,success:function(n){var m=Ext.util.JSON.decode(n.responseText);Ext.Msg.show({title:m.success?"Success":"Failed",msg:m.message,buttons:Ext.Msg.OK,icon:m.success?Ext.MessageBox.INFO:Ext.MessageBox.ERROR});if(d&&d.getStore()){d.getStore().reload()}},failure:function(m){},params:{path:b.path,name:h,state:f,title:b.name?b.name:b.path}})}},this)};this.viewSavedList=function(){var g=b.name?b.name:b.path;var d=new Ext.data.JsonStore({fields:["id","name","filter"],url:this.listUrl,root:"rows",autoLoad:true,baseParams:{path:g}});var e=new Ext.grid.GridPanel({store:d,columns:[new Ext.grid.RowNumberer(),{id:"name",header:"Name",dataIndex:"name",menuDisabled:true},{id:"action",header:"Action",dataIndex:null,width:50,menuDisabled:true,renderer:function(){return'<a href="#"><img class="remove-saved-filter-button" src="/images/famfamfam/cross.png" qtip="Remove this filter"/></a>'}}],tbar:[{text:"Save current filter",icon:"/images/famfamfam/disk.png",handler:function(){var h=b.filters;if(!h){return}var m=Ext.ux.SaveSearchState(b);m.save()}},"-",{text:"Clear current filter",icon:"/images/famfamfam/drink_empty.png",handler:function(){var h=b.filters;if(!h){return}h.clearFilters()}}],autoExpandColumn:"name",loadMask:true});this.list=e;e.on("cellclick",function(h,t,s,q){var r=q.getTarget();if(r.className=="ux-grid-filter-apply"){var o=h.getStore().getAt(t);var n=o.get("filter");var p=o.get("name");this.restore(n,p)}if(r.className=="restore-saved-filter-button"){var o=h.getStore().getAt(t);var n=o.get("filter");var p=o.get("name");this.restore(n,p)}if(r.className=="remove-saved-filter-button"){var o=h.getStore().getAt(t);var m=o.get("id");Ext.Ajax.request({method:"POST",url:this.removeUrl,success:function(w){var u=Ext.util.JSON.decode(w.responseText);if(u.success){var x=h.getView().getRow(t);Ext.get(x).fadeOut({endOpacity:0,easing:"easeOut",duration:0.5,remove:true,useDisplay:false,callback:function(){h.getStore().remove(o);h.getView().refresh()}})}},failure:function(u){},params:{id:m}})}},this);var f=new Ext.Window({width:500,height:300,layout:"fit",title:"Saved filters for "+g,items:e,closeAction:"close",maximizable:true,collapsible:true});f.show()};this.restore=function(e,d){if(!b.originalTitle){b.originalTitle=b.title}b.setTitle(b.originalTitle+": <font color=red>(Filtered by keyword: '"+d.replace(/<\S[^><]*>/g,"")+"')</font>");a.clearFilters();a.filters.each(function(g){var h=Ext.util.JSON.decode(e);for(var f=0;f<h.length;f++){if(h[f].dataIndex==g.dataIndex){var m=h[f].value;m=c.decodeValue(m);g.setActive(false);g.setValue(m);g.setActive(true)}}})};return this};Ext.ns("Ext.ux");Ext.ux.FilterInfo=function(b,h){var n=this;var r=b.getColumnModel();var g=b.filters;if(!g){return}var d=b.getGridEl();var o=Ext.DomQuery.selectNode(".ux-grid-filter-info-clear",d.dom);if(h=="panel"){var q=o?o:Ext.DomHelper.insertFirst(d,{tag:"span",html:"&nbsp;",cls:"ux-grid-filter-info-clear"})}var c=Ext.DomQuery.selectNode(".ux-grid-filter-info",d.dom);if(h=="panel"){var s=c?c:Ext.DomHelper.insertFirst(d,{tag:"div",html:"",cls:"ux-grid-filter-info"})}var m=Ext.DomHelper.createTemplate({tag:"div",cls:"ux-grid-filter-info-box",html:'{html}&nbsp;&nbsp;<a title="Remove this filter" id="{id}" href="#" onclick="Ext.ux.FilterInfo.remove(this)"></a>'});if(s){s.innerHTML=""}var e=[];var f="";var p=null;g.filters.each(function(u){var t=u.dataIndex;var y=r.getColumnHeader(r.findColumnIndex(t));if(u.active){var w="";if(u.getDisplayValue){w=u.getDisplayValue()}else{w=u.getValue()}if(w){f+="'"+w+"', ";var x=Ext.id(null,"filter-");e.push(new Ext.Button(new Ext.Action({handler:function(){u.setActive(false)},itemId:x+"-action",hidden:true})));if(h=="panel"){m.append(s,{html:"<b>"+y+":</b> "+w,id:x})}}}});if(h=="panel"){var a=new Ext.Panel({renderTo:s,items:e,id:"filter-info-action-panel"})}if(h=="title"){if(f){b.setTitle(b.originalTitle+" <font color='red'>Filtered by keyword: "+f+"</font>")}else{b.setTitle(b.originalTitle)}}};Ext.ns("Ext.ux.FilterInfo");Ext.ux.FilterInfo.remove=function(b){var a=Ext.getCmp("filter-info-action-panel");var c=a.getComponent(b.id+"-action");c.baseAction.execute()};Ext.ns("Ext.ux");Ext.ux.FilterOption=function(e,b){var a={"string":[{name:"Match any",value:"any"},{name:"Match exact",value:"exact"},{name:"Starts with",value:"starts"},{name:"Ends with",value:"ends"},{name:"Not contains",value:"nc"}],"list":[{name:"Containing any of selected",value:"or"},{name:"Containing all of selected",value:"and"}]};var d=true;for(var c in a){if(c==b){Ext.each(a[c],function(g){var f=new Ext.menu.CheckItem({text:g.name,hideOnClick:false,group:"filter-options",listeners:{checkChange:function(h,m){e.setFilterOptions(g.value);e.fireUpdate()}}});e.menu.add(f)})}}};Ext.namespace("Ext.ux.grid.filter");Ext.ux.grid.filter.Filter=function(a){Ext.apply(this,a);this.events={"activate":true,"deactivate":true,"update":true,"serialize":true};Ext.ux.grid.filter.Filter.superclass.constructor.call(this);this.menu=new Ext.menu.Menu();this.init();if(a&&a.value){this.setValue(a.value);this.setActive(a.active!==false,true);delete a.value}this.hideTask=new Ext.util.DelayedTask(this.hideMenu,this)};Ext.extend(Ext.ux.grid.filter.Filter,Ext.util.Observable,{active:false,dataIndex:null,menu:null,init:Ext.emptyFn,hideMenu:function(){this.menu.hide(true)},fireUpdate:function(){this.value=this.item.getValue();if(this.active){this.fireEvent("update",this)}this.setActive(this.value.length>0)},isActivatable:function(){return true},setActive:function(b,a){if(this.active!=b){this.active=b;if(a!==true){this.fireEvent(b?"activate":"deactivate",this)}}this.hideTask.delay(2000)},getValue:Ext.emptyFn,setValue:Ext.emptyFn,serialize:Ext.emptyFn,validateRecord:function(){return true},setFilterOptions:function(a){this.filterOptions=a},getFilterOptions:function(){return this.filterOptions}});Ext.ux.grid.filter.BooleanFilter=Ext.extend(Ext.ux.grid.filter.Filter,{defaultValue:false,yesText:"Yes",noText:"No",init:function(){var b=Ext.id();this.options=[new Ext.menu.CheckItem({text:this.yesText,group:b,checked:this.defaultValue===true}),new Ext.menu.CheckItem({text:this.noText,group:b,checked:this.defaultValue===false})];this.menu.add(this.options[0],this.options[1]);for(var a=0;a<this.options.length;a++){this.options[a].on("click",this.fireUpdate,this);this.options[a].on("checkchange",this.fireUpdate,this)}},isActivatable:function(){return true},fireUpdate:function(){this.fireEvent("update",this);this.setActive(true)},setValue:function(a){this.options[a?0:1].setChecked(true)},getValue:function(){return this.options[0].checked},serialize:function(){var a={type:"boolean",value:this.getValue()};this.fireEvent("serialize",a,this);return a},validateRecord:function(a){return a.get(this.dataIndex)==this.getValue()}});Ext.ux.grid.filter.ComboFilter=Ext.extend(Ext.ux.grid.filter.Filter,{updateBuffer:500,icon:"ux-gridfilter-text-icon",init:function(){var a=this.value=new Ext.ux.menu.ComboMenu({lovcombo:this.lovcombo,iconCls:this.icon,store:this.options});a.editor.on("select",function(){this.setActive(true);this.fireUpdate()},this);this.menu.add(a);this.updateTask=new Ext.util.DelayedTask(this.fireUpdate,this)},onKeyUp:function(a){if(a.getKey()==a.ENTER){this.menu.hide(true);return}this.updateTask.delay(this.updateBuffer)},isActivatable:function(){return this.value.getValue()?true:false},fireUpdate:function(){if(this.active){this.fireEvent("update",this)}this.setActive(this.isActivatable())},setValue:function(a){this.value.setValue(a);this.fireEvent("update",this)},getValue:function(){return this.value.getValue()?this.value.getValue().toString():null},serialize:function(){var a={type:"combo",value:this.getValue()};this.fireEvent("serialize",a,this);return a},validateRecord:function(a){var b=a.get(this.dataIndex);if(typeof b!="combo"){return this.getValue().length==0}return b.toLowerCase().indexOf(this.getValue().toLowerCase())>-1},getDisplayValue:function(){return this.value.getDisplayValue()}});Ext.ux.grid.filter.DateFilter=Ext.extend(Ext.ux.grid.filter.Filter,{dateFormat:"Y-m-d",pickerOpts:{},beforeText:"To",afterText:"From",onText:"On",init:function(){var c=Ext.apply(this.pickerOpts,{minDate:this.minDate,maxDate:this.maxDate,format:this.dateFormat});var d=this.dates={"before":new Ext.menu.CheckItem({text:this.beforeText,menu:new Ext.menu.DateMenu(c)}),"after":new Ext.menu.CheckItem({text:this.afterText,menu:new Ext.menu.DateMenu(c)}),"on":new Ext.menu.CheckItem({text:this.onText,menu:new Ext.menu.DateMenu(c)})};this.menu.add(d.after,d.before,"-",d.on);for(var b in d){var a=d[b];a.menu.on("select",function(f,g,h,e){f.setChecked(true);if(f==d.on){d.before.setChecked(false,true);d.after.setChecked(false,true)}else{d.on.setChecked(false,true);if(f==d.after&&d.before.menu.picker.value<h){d.before.setChecked(false,true)}else{if(f==d.before&&d.after.menu.picker.value>h){d.after.setChecked(false,true)}}}this.fireEvent("update",this)}.createDelegate(this,[a],0));a.on("checkchange",function(){this.setActive(this.isActivatable())},this)}},getFieldValue:function(a){return this.dates[a].menu.picker.getValue()},getPicker:function(a){return this.dates[a].menu.picker},isActivatable:function(){return this.dates.on.checked||this.dates.after.checked||this.dates.before.checked},setValue:function(b){for(var a in this.dates){if(b[a]){this.dates[a].menu.picker.setValue(b[a]);this.dates[a].setChecked(true)}else{this.dates[a].setChecked(false)}}},getValue:function(){var a={};for(var b in this.dates){if(this.dates[b].checked){a[b]=this.dates[b].menu.picker.getValue()}}return a},serialize:function(){var a=[];if(this.dates.before.checked){a=[{type:"date",comparison:"lt",value:this.getFieldValue("before").format(this.dateFormat)}]}if(this.dates.after.checked){a.push({type:"date",comparison:"gt",value:this.getFieldValue("after").format(this.dateFormat)})}if(this.dates.on.checked){a={type:"date",comparison:"eq",value:this.getFieldValue("on").format(this.dateFormat)}}this.fireEvent("serialize",a,this);return a},validateRecord:function(a){var b=a.get(this.dataIndex).clearTime(true).getTime();if(this.dates.on.checked&&b!=this.getFieldValue("on").clearTime(true).getTime()){return false}if(this.dates.before.checked&&b>=this.getFieldValue("before").clearTime(true).getTime()){return false}if(this.dates.after.checked&&b<=this.getFieldValue("after").clearTime(true).getTime()){return false}return true},getDisplayValue:function(){if(this.getValue().on){return this.getFormatedDate(this.getValue().on)}if(this.getValue().after&&this.getValue().before){return"From: "+this.getFormatedDate(this.getValue().after)+", To: "+this.getFormatedDate(this.getValue().before)}if(this.getValue().after){return"From: "+this.getFormatedDate(this.getValue().after)}if(this.getValue().before){return"To: "+this.getFormatedDate(this.getValue().before)}},getFormatedDate:function(a){return a.getFullYear()+"-"+(a.getMonth()+1)+"-"+a.getDate()}});Ext.ux.grid.filter.ListFilter=Ext.extend(Ext.ux.grid.filter.Filter,{labelField:"text",loadingText:"Loading...",loadOnShow:true,value:[],loaded:false,phpMode:false,init:function(){this.menu.add('<span class="loading-indicator">'+this.loadingText+"</span>");if(this.store){if(this.loadOnShow){this.menu.on("show",this.onMenuLoad,this)}}else{if(this.options){var b=[];for(var c=0,a=this.options.length;c<a;c++){var d=this.options[c];switch(Ext.type(d)){case"array":b.push(d);break;case"object":b.push([d.id,d[this.labelField]]);break;case"string":b.push([d,d]);break}}this.store=new Ext.data.Store({reader:new Ext.data.ArrayReader({id:0},["id",this.labelField])});this.options=b;this.menu.on("show",this.onMenuLoad,this)}}this.store.on("load",this.onLoad,this);this.bindShowAdapter()},onRender:function(){this.onMenuLoad()},bindShowAdapter:function(){var b=this.menu.show;var a=null;this.menu.show=function(){if(arguments.length==0){b.apply(this,a)}else{a=arguments;b.apply(this,arguments)}}},onMenuLoad:function(){if(!this.loaded){if(this.options){this.store.loadData(this.options)}else{this.store.load()}}},onLoad:function(c,b){var g=this.menu.isVisible();this.menu.hide(false);this.menu.removeAll();var e=this.single?Ext.id():null;for(var d=0,a=b.length;d<a;d++){var f=new Ext.menu.CheckItem({text:b[d].get(this.labelField),group:e,checked:this.value.indexOf(b[d].id.toString())>-1,hideOnClick:false});f.itemId=b[d].id;f.on("checkchange",this.checkChange,this);this.menu.add(f)}this.setActive(this.isActivatable());this.loaded=true;if(g){this.menu.show()}},checkChange:function(b,a){var c=[];this.menu.items.each(function(d){if(d.checked){c.push(d.itemId)}},this);this.value=c;this.setActive(this.isActivatable());this.fireEvent("update",this)},isActivatable:function(){return this.value.length>0},setValue:function(a){var a=this.value=[].concat(a);if(this.loaded){this.menu.items.each(function(d){d.setChecked(false,true);for(var c=0,b=a.length;c<b;c++){if(d.itemId==a[c]){d.setChecked(true,true)}}},this)}this.fireEvent("update",this)},getValue:function(){return this.value.toString()},serialize:function(){var a={type:"list",value:this.phpMode?this.value.join(","):this.value};this.fireEvent("serialize",a,this);return a},validateRecord:function(a){return this.getValue().indexOf(a.get(this.dataIndex))>-1},getDisplayValue:function(){var a=new Array();var e=[];v=this.getValue();var b=this.options;if(v.toString().match(/,/)){a=v.toString().split(",")}else{a[0]=v}for(var d=0;d<a.length;d++){for(var c in b){if(b[c][0]==a[d]){e.push(b[c][1])}}}return e.join(",")}});Ext.ux.grid.filter.NumericFilter=Ext.extend(Ext.ux.grid.filter.Filter,{init:function(){this.menu=new Ext.ux.menu.RangeMenu();this.menu.on("update",this.fireUpdate,this)},fireUpdate:function(){this.setActive(this.isActivatable());this.fireEvent("update",this)},isActivatable:function(){var a=this.menu.getValue();return a.eq!==undefined||a.gt!==undefined||a.lt!==undefined||a.ne!==undefined},setValue:function(a){this.menu.setValue(a)},getValue:function(){return this.menu.getValue()},serialize:function(){var b=[];var a=this.menu.getValue();for(var c in a){b.push({type:"numeric",comparison:c,value:a[c]})}this.fireEvent("serialize",b,this);return b},validateRecord:function(a){var c=a.get(this.dataIndex),b=this.menu.getValue();if(b.eq!=undefined&&c!=b.eq){return false}if(b.lt!=undefined&&c>=b.lt){return false}if(b.gt!=undefined&&c<=b.gt){return false}return true},getDisplayValue:function(){if(this.getValue().eq){return this.getValue().eq}if(this.getValue().ne){return"!= "+this.getValue().ne}if(this.getValue().gt&&this.getValue().lt){return this.getValue().gt+" &lt; x &lt; "+this.getValue().lt}if(this.getValue().gt){return"&gt;"+this.getValue().gt}if(this.getValue().lt){return"&lt;"+this.getValue().lt}}});Ext.ux.grid.filter.StringFilter=Ext.extend(Ext.ux.grid.filter.Filter,{updateBuffer:0,icon:"ux-gridfilter-text-icon",init:function(){var a=this.value=new Ext.ux.menu.EditableItem({iconCls:this.icon});a.on("keyup",this.onKeyUp,this);this.menu.add(a);this.options=new Ext.ux.FilterOption(this,"string");this.updateTask=new Ext.util.DelayedTask(this.fireUpdate,this)},onKeyUp:function(a){if(a.getKey()==a.ENTER){this.fireUpdate()}},isActivatable:function(){return this.value.getValue().length>0},fireUpdate:function(){if(this.active){this.fireEvent("update",this)}this.setActive(this.isActivatable())},setValue:function(a){this.value.setValue(a);this.fireEvent("update",this)},getValue:function(){return this.value.getValue()},serialize:function(){var a={type:"string",value:this.getValue(),options:this.getFilterOptions()};this.fireEvent("serialize",a,this);return a},validateRecord:function(b){var f=b.get(this.dataIndex);if(typeof f!="string"){return this.getValue().length==0}var a=[];var e=this.getValue().toLowerCase();a=e.split(";");a.push(e);var c=false;for(var d=0;d<a.length;d++){c=(f.toLowerCase().indexOf(a[d])>-1);if(c){break}}return c}});Ext.ux.grid.filter.TextFilter=Ext.extend(Ext.ux.grid.filter.StringFilter,{texts:{addnew:"Add New",and:"Containing all in result",or:"Containing any in result",not:"Not containing in result",restart:"Clear this filter and restart",removeLast:"Remove last applied filter"},filterQueue:[],init:function(){var a=this.value=new Ext.ux.menu.EditableItem({iconCls:this.icon,hidden:true});a.on("keyup",this.onKeyUp,this);this.menu.add(a);this.updateTask=new Ext.util.DelayedTask(this.fireUpdate,this);this.reconfigureMenu();this.reconfigureInputFields()},reconfigureInputFields:function(){this.menu.items.each(function(a){if(!a.hidden&&a.editor){this.menu.remove(a)}},this);this.addInputField()},addInputField:function(){var a=new Ext.ux.menu.EditableItem({iconCls:this.icon});this.menu.insert(0,a);a.editor.focus()},getInputValues:function(){var a=[];this.menu.items.each(function(b){if(!b.hidden&&b.editor){if(b.getValue()){a.push(b.getValue())}}},this);return a},reconfigureMenu:function(){var d=new Ext.menu.Item({text:this.texts.addnew,iconCls:"icon-plus",scope:this,hideOnClick:false,handler:function(){this.addInputField()}});var a=new Ext.menu.Item({text:this.texts.and,scope:this,icon:"/images/famfamfam/bullet_green.png",handler:function(){this.addToFilterQueue("and")}});var c=new Ext.menu.Item({text:this.texts.or,scope:this,icon:"/images/famfamfam/bullet_yellow.png",handler:function(){this.addToFilterQueue("or")}});var b=new Ext.menu.Item({text:this.texts.not,scope:this,icon:"/images/famfamfam/bullet_red.png",handler:function(){this.addToFilterQueue("not")}});this.resetButton=new Ext.menu.Item({text:this.texts.restart,scope:this,disabled:true,hideOnClick:false,icon:"/images/famfamfam/arrow_refresh.png",handler:function(){this.resetFilterQueue()}});this.removeLast=new Ext.menu.Item({text:this.texts.removeLast,scope:this,disabled:true,icon:"/images/famfamfam/arrow_undo.png",handler:function(){this.removeLastQueue()}});this.menu.add(d);this.menu.add(new Ext.menu.Separator());this.menu.add(a);this.menu.add(c);this.menu.add(b);this.menu.add(new Ext.menu.Separator());this.menu.add(this.resetButton);this.menu.add(this.removeLast)},makeChanges:function(a,b){if(!b){b=this.getInputValues()}this.filterQueue.push({keys:b,type:a});this.resetButton.setDisabled(false);this.removeLast.setDisabled(false);this.removeLast.setText(this.texts.removeLast+" ("+this.filterQueue.length+")")},setValue:function(a){if(!Ext.isJsonString(a)){this.filterQueue=[];this.makeChanges("and",[a])}this.value.setValue(a);this.fireEvent("update",this)},addToFilterQueue:function(a){this.makeChanges(a);this.execute()},execute:function(){this.setValue(Ext.util.JSON.encode(this.filterQueue));this.reconfigureInputFields();this.fireUpdate();this.removeLast.setText(this.texts.removeLast+" ("+this.filterQueue.length+")")},resetFilterQueue:function(){this.reconfigureInputFields();this.filterQueue=[];this.setValue("");this.resetButton.setDisabled(true)},removeLastQueue:function(){if(this.filterQueue.length){this.filterQueue.pop()}if(!this.filterQueue.length){this.removeLast.setDisabled(true)}this.execute()},serialize:function(){var a={type:"text",value:this.getValue()};this.fireEvent("serialize",a,this);return a},setActive:function(b,a){if(this.active!=b){this.active=b;if(a!==true){this.fireEvent(b?"activate":"deactivate",this)}if(!b){this.filterQueue=[]}}this.hideTask.delay(2000)},_format:function(a){return" <span style='color:#79a3d7'>"+a+"</span> "},_enclose:function(a,b){if(a.length>1){return this._format("[")+a.join(this._format(b.toUpperCase()))+this._format("]")}else{return a.join(this._format(b.toUpperCase()))}},isJsonString:function(a){var b=null;try{b=new RegExp('^("(\\\\.|[^"\\\\\\n\\r])*?"|[,:{}\\[\\]0-9.\\-+Eaeflnr-u \\n\\r\\t])+?$')}catch(c){b=/^(true|false|null|\[.*\]|\{.*\}|".*"|\d+|\d+\.\d+)$/}return b.test(a)},getDisplayValue:function(){var b=this.getValue();var a=[];if(b==null||b==""){return""}if(!Ext.isJsonString(b)){return b}b=Ext.util.JSON.decode(b);for(i in b){v=b[i];if(!v.keys&&!v.type){continue}if(v.type=="not"){var c=[];Ext.each(v.keys,function(d){c.push(this._format("NOT")+d)},this);a.push(this._enclose(c,"and"))}else{a.push(this._enclose(v.keys,v.type))}}return this._enclose(a,"and")}});Ext.namespace("Ext.ux.plugins");Ext.ux.plugins.IndexSearch=function(a){Ext.apply(this,a);Ext.ux.plugins.IndexSearch.superclass.constructor.call(this)};Ext.extend(Ext.ux.plugins.IndexSearch,Ext.util.Observable,{init:function(a){Ext.apply(a,{onRender:a.onRender.createSequence(function(c,b){Ext.DomHelper.append(a.container,{tag:"div",id:"_unique_search_panel"});this.initialCount=0;this.facetGridServer=new Ext.grid.GridPanel({listeners:{click:function(o){var w=o.getTarget();if(w.className!="x-grid3-header"){var g=o.getRelatedTarget();var q=this.view;var x=q.findCellIndex(w.parentNode);var p=q.findRowIndex(w);if(x===false||p===false){return}var s=this.getView().getCell(p,x);if(w.className=="ux-grid-filter"){var n=a.filters;var h=n.filters.get("reporter");var m=this.getView().getCell(p,x).innerHTML;var u=Ext.DomQuery.selectNode(".ux-grid-filter-hidden-value",this.getView().getCell(p,x));var f=u.innerHTML;h.setValue(f);h.setActive(true)}}}},store:new Ext.data.JsonStore({url:"/loganalysis/facetJson?by=ip",root:"rows",fields:["facet_name","facet_count","facet_id"],autoLoad:false}),colModel:new Ext.grid.ColumnModel({defaults:{width:120,sortable:true},columns:[{id:"server",header:"Server",width:200,sortable:true,sortType:"asIp",dataIndex:"facet_name"},{header:"Count",dataIndex:"facet_count",sortable:true,sortType:"asInt"}]}),height:227,autoScroll:true,sm:new Ext.grid.RowSelectionModel({singleSelect:true})});this.facetGridSev=new Ext.grid.GridPanel({listeners:{click:function(o){var w=o.getTarget();if(w.className!="x-grid3-header"){var g=o.getRelatedTarget();var q=this.view;var x=q.findCellIndex(w.parentNode);var p=q.findRowIndex(w);if(x===false||p===false){return}var s=this.getView().getCell(p,x);if(w.className=="ux-grid-filter"){var n=a.filters;var h=n.filters.get("sev");var m=this.getView().getCell(p,x).innerHTML;var u=Ext.DomQuery.selectNode(".ux-grid-filter-hidden-value",this.getView().getCell(p,x));var f=u.innerHTML;h.setValue(f);h.setActive(true)}}}},store:new Ext.data.JsonStore({url:"/loganalysis/facetJson?by=sev",root:"rows",fields:["facet_name","facet_count","facet_id"],autoLoad:false}),colModel:new Ext.grid.ColumnModel({defaults:{width:120,sortable:true},columns:[{id:"severity",header:"Severity",width:200,sortable:true,sortType:"asIp",dataIndex:"facet_name"},{header:"Count",dataIndex:"facet_count",sortable:true,sortType:"asInt"}]}),height:227,autoScroll:true,sm:new Ext.grid.RowSelectionModel({singleSelect:true})});function d(h,g,f){var m=Ext.id();e.defer(1,this,[h,m,f]);return('<div id="'+m+'"></div>')}function e(g,h,f){new Ext.Button({text:"Filter",handler:function(m,n){var o=f.get("facet_id");a.filters.getFilter("reporter").setValue("s-0-"+o);a.filters.getFilter("reporter").setActive(true)}}).render(document.body,h)}this.searchPanel=new Ext.Panel({height:270,layout:"column",autoWidth:true,collapsible:true,hidden:true,hideMode:"visibility",animCollapse:true,titleCollapse:true,headerAsText:true,frame:true,applyTo:"_unique_search_panel",items:[{title:"Grouped by server",items:this.facetGridServer,columnWidth:0.49},{html:"&nbsp",columnWidth:0.02},{title:"Grouped by severity",items:this.facetGridSev,columnWidth:0.47}]});a.getStore().on("load",function(){if(!a.getStore().getCount()){this.facetGridServer.getStore().removeAll();this.facetGridSev.getStore().removeAll();return}var f=a.getStore().lastOptions;var h=f.params.start;f.params.start=0;var g=Ext.util.JSON.encode(f.params);f.params.start=h;if(g==this.initialCount&&f.params.start){return}this.initialCount=g;this.searchPanel.show();this.facetGridServer.getStore().reload();this.facetGridServer.getEl().mask("Getting data for group by server");this.facetGridSev.getEl().mask("Getting data for group by severity")},this);this.facetGridServer.getStore().on("load",function(){this.facetGridServer.getEl().unmask();this.facetGridSev.getStore().reload()},this);this.facetGridSev.getStore().on("load",function(){this.facetGridSev.getEl().unmask()},this)})})}});if("function"!==typeof RegExp.escape){RegExp.escape=function(a){if("string"!==typeof a){return a}return a.replace(/([.*+?\^=!:${}()|\[\]\/\\])/g,"\\$1")}}Ext.ux.GridRowActions=function(a){Ext.apply(this,a);this.addEvents("beforeaction","action","beforegroupaction","groupaction");Ext.ux.GridRowActions.superclass.constructor.call(this)};Ext.extend(Ext.ux.GridRowActions,Ext.util.Observable,{actionEvent:"click",autoWidth:true,header:"",isColumn:true,keepSelection:false,menuDisabled:true,sortable:false,tplGroup:'<tpl for="actions">'+'<div class="ux-grow-action-item<tpl if="\'right\'===align"> ux-action-right</tpl> '+'{cls}" style="{style}" qtip="{qtip}">{text}</div>'+"</tpl>",tplRow:'<div class="ux-row-action">'+'<tpl for="actions">'+"{url_start}"+'<div class="ux-row-action-item {cls} <tpl if="text">'+'ux-row-action-text</tpl>" style="{hide}{style}" qtip="{qtip}">'+'<tpl if="text"><span qtip="{qtip}">{text}</span></tpl></div>'+"{url_end}"+"</tpl>"+"</div>",widthIntercept:4,widthSlope:21,init:function(g){var d=0;for(var f=0;f<this.actions.length;f++){if(this.actions[f].hidden){continue}d++}this.grid=g;var a=g.getColumnModel();var e=a.getColumnsBy(function(m){return m.dataIndex=="conditional_row_action"});if(e&&e[0]){e[0].renderer=function(m){return m?"<span style='color:green'>Yes</span>":"<span style='color:red'>No</span>"}}this.id=this.id||Ext.id();var h=g.getColumnModel().lookup;delete (h[undefined]);h[this.id]=this;if(!this.tpl){this.tpl=this.processActions(this.actions)}if(this.autoWidth){this.width=this.widthSlope*d+this.widthIntercept;this.fixed=true;if(this.width<45){this.width=45}}var c=g.getView();var b={scope:this};b[this.actionEvent]=this.onClick;g.on({render:{scope:this,fn:function(){c.mainBody.on(b)}}});if(!this.renderer){this.renderer=function(r,m,n,s,q,o){m.css+=(m.css?" ":"")+"ux-row-action-cell";var p=n.get("conditional_row_action");if(p!=false){return this.tpl.apply(this.getData(r,m,n,s,q,o))}}.createDelegate(this)}if(c.groupTextTpl&&this.groupActions){c.interceptMouse=c.interceptMouse.createInterceptor(function(m){if(m.getTarget(".ux-grow-action-item")){return false}});c.groupTextTpl='<div class="ux-grow-action-text">'+c.groupTextTpl+"</div>"+this.processActions(this.groupActions,this.tplGroup).apply()}},getData:function(e,a,b,f,d,c){return b.data||{}},processActions:function(e,c){var a=[];Ext.each(e,function(g,h){if(g.hidden){return}if(g.iconCls&&"function"===typeof(g.callback||g.cb)){this.callbacks=this.callbacks||{};this.callbacks[g.iconCls]=g.callback||g.cb}if(!g.message){g.message=g.confirmMsg}if(!g.message){g.message="Are you sure to perform this operation?"}if(g.icon){if(g.style){g.style+=";background-image:url("+g.icon+");background-repeat:no-repeat;"}else{g.style="background-image:url("+g.icon+");background-repeat:no-repeat;"}}g.load=g.load?g.load:"center";if(g.script){var f=g.urlIndex?('<tpl if="this.isUrl('+g.urlIndex+')"><a href="javascript:void(0);" onclick="'+g.script+'">'):""}else{if(g.name&&g.name.match("_expand$")){if(g.iconCls){g.iconCls+=" icon-expand-row af-expand-row"}else{g.iconCls=" icon-expand-row af-expand-row"}if(g.confirm){g.iconCls+="  af-confirm-row"}var f=g.urlIndex?('<tpl if="this.isUrl('+g.urlIndex+')"><a href="'+afApp.urlPrefix+"{"+g.urlIndex+'}" confirmmsg="'+g.confirmMsg+'">'):""}else{var f=g.urlIndex?('<tpl if="this.isUrl('+g.urlIndex+')"><a href="<tpl if="!'+g.confirm+"&&this.isLoadCenter('"+g.load+"')\">"+afApp.urlPrefix+"/"+afApp.sharpPrefix+"#</tpl>{"+g.urlIndex+'}" <tpl if="'+g.confirm+"\">onclick=\"Ext.Msg.confirm('Confirmation','"+g.message+"', function(btn){if (btn=='yes'){ afApp.load('"+afApp.urlPrefix+"{"+g.urlIndex+"}','"+g.load+"'); return false; }else{ return true;}});return false;\"</tpl>>"):""}}var n="";if(g.post&&g.name&&!g.name.match("_expand")){n="Ext.Ajax.request({"+'url: "'+afApp.urlPrefix+"{"+g.urlIndex+'}",'+'method:"post",'+"success: Ext.ux.GridRowActions.onActionSuccess,"+"failure: Ext.ux.GridRowActions.onActionFailure"+"});"+";";f=g.urlIndex?('<tpl if="this.isUrl('+g.urlIndex+')"><a href="'+afApp.urlPrefix+"{"+g.urlIndex+'}" <tpl if="!'+g.confirm+"\">onclick='"+n+"; return false;'</tpl><tpl if=\""+g.confirm+'">onclick=\'Ext.Msg.confirm("Confirmation","'+g.message+'", function(btn){if (btn=="yes"){ '+n+" }}); return false;'</tpl>>"):""}if(g.popup){g.popupSettings=escape(g.popupSettings);f=g.urlIndex?('<tpl if="this.isUrl('+g.urlIndex+')"><a href="'+afApp.urlPrefix+"{"+g.urlIndex+'}" <tpl if="!'+g.confirm+'">onclick=\'afApp.widgetPopup("{'+g.urlIndex+'}","","","'+g.popupSettings+'"); return false;\'</tpl><tpl if="'+g.confirm+'">onclick=\'Ext.Msg.confirm("Confirmation","'+g.message+'", function(btn){if (btn=="yes"){ afApp.widgetPopup("'+afApp.urlPrefix+"{"+g.urlIndex+"}\"); }}); return false;'</tpl>>"):""}var m={cls:g.iconIndex?"{"+g.iconIndex+"}":(g.iconCls?g.iconCls:""),qtip:g.qtipIndex?"{"+g.qtipIndex+"}":(g.tooltip||g.qtip?g.tooltip||g.qtip:""),text:g.textIndex?"{"+g.textIndex+"}":(g.text?g.text:""),url_start:f,url_end:g.urlIndex?("</a></tpl>"):"",hide:g.hideIndex?'<tpl if="'+g.hideIndex+'">visibility:hidden;</tpl>':(g.hide?"visibility:hidden;":""),align:g.align||"right",style:g.style?g.style:"",confirmMsg:g.confirmMsg?g.confirmMsg:""};a.push(m)},this);var b=new Ext.XTemplate(c||this.tplRow,{isUrl:function(f){if(f.length>0){return true}else{return false}}});var d=new Ext.XTemplate(b.apply({actions:a}),{isUrl:function(f){if(f.length>0){return true}else{return false}},isLoadCenter:function(f){if(f=="center"){return true}else{return false}}});return d},expandRequest:function(e){e.stopEvent();var row=e.getTarget(".x-grid3-row");var grid=this.grid;var obj=this;var url=e.getTarget().parentNode;var link=e.getTarget();var extlink=Ext.get(link);if(!this.isRowExpanded(row)){var mask=new Ext.LoadMask(Ext.getBody(),{msg:"<b>Getting data from server.....</b> <br>Please wait..",removeMask:true});mask.show();var ajax=Ext.Ajax.request({url:url,method:"POST",success:function(response){var rc=null;try{rc=new RegExp('^("(\\\\.|[^"\\\\\\n\\r])*?"|[,:{}\\[\\]0-9.\\-+Eaeflnr-u \\n\\r\\t])+?$')}catch(z){rc=/^(true|false|null|\[.*\]|\{.*\}|".*"|\d+|\d+\.\d+)$/}if(rc.test(response.responseText)){json=Ext.util.JSON.decode(response.responseText);if(!json.success){Ext.Msg.alert("Error",json.message);mask.hide();return}if(json.html){Ext.DomHelper.append(row,{tag:"div",cls:"imm-row-expand",style:"padding:5px;",html:json.html})}if(json.script){eval(json.script)}}else{Ext.DomHelper.append(row,{tag:"div",cls:"imm-row-expand",style:"padding:5px;",html:response.responseText})}extlink.removeClass("icon-expand-row");extlink.addClass("icon-collapse-row");mask.hide()},failure:function(){mask.hide();Ext.Msg.alert("Error !","Some error has occured while connecting to server. <br>Please try again.")}})}else{var div=this.getExpandedDiv(row);if(div.style.display!="none"){div.style.display="none";extlink.addClass("icon-expand-row");extlink.removeClass("icon-collapse-row")}else{div.style.display="block";extlink.removeClass("icon-expand-row");extlink.addClass("icon-collapse-row")}}},findByClassName:function(d,c){var e=d.getElementsByTagName("div");var b=new Array();for(var a=0;a<e.length;a++){if(e[a].className==c){b.push(e[a])}}return b},isRowExpanded:function(a){return this.findByClassName(a,"imm-row-expand")[0]?true:false},getExpandedDiv:function(a){return this.isRowExpanded(a)?this.findByClassName(a,"imm-row-expand")[0]:null},onClick:function(h,m){var n=this.grid.getView();var c=false;var r=h.getTarget(".x-grid3-row");if(h.getTarget(".af-expand-row")){if(h.getTarget(".af-confirm-row")){var f=this;Ext.Msg.confirm("Confirmation",h.getTarget(".af-confirm-row").parentNode.getAttribute("confirmmsg"),function(e){if(e=="yes"){f.expandRequest(h);return false}else{return true}});h.stopEvent()}else{this.expandRequest(h);return false}}var a=n.findCellIndex(m.parentNode.parentNode);var q=h.getTarget(".ux-row-action-item");if(q){c=q.className.replace(/ux-row-action-item /,"");if(c){c=c.replace(/ ux-row-action-text/,"");c=c.trim()}}if(false!==r&&false!==a&&false!==c){var g=this.grid.store.getAt(r.rowIndex);if(this.callbacks&&"function"===typeof this.callbacks[c]){this.callbacks[c](this.grid,g,c,r.rowIndex,a)}if(true!==this.eventsSuspended&&false===this.fireEvent("beforeaction",this.grid,g,c,r.rowIndex,a)){return}else{if(true!==this.eventsSuspended){this.fireEvent("action",this.grid,g,c,r.rowIndex,a)}}}q=h.getTarget(".ux-grow-action-item");if(q){var o=n.findGroup(m);var d=o?o.id.replace(/ext-gen[0-9]+-gp-/,""):null;var b;if(d){var p=new RegExp(d);b=this.grid.store.queryBy(function(e){return e._groupId.match(p)});b=b?b.items:[]}c=q.className.replace(/ux-grow-action-item (ux-action-right )*/,"");if("function"===typeof this.callbacks[c]){this.callbacks[c](this.grid,b,c,d)}if(true!==this.eventsSuspended&&false===this.fireEvent("beforegroupaction",this.grid,b,c,d)){return false}this.fireEvent("groupaction",this.grid,b,c,d)}},destroy:function(){this.purgeListeners()}});Ext.ux.GridRowActions.onActionSuccess=function(response,options){response=Ext.decode(response.responseText);if(!response.success){return Ext.ux.GridRowActions.onActionFailure(response,options)}if(response.executeAfter){eval(response.executeAfter)}if(response.message){Ext.Msg.alert("Success",response.message,function(){if(response.redirect){afApp.load(response.redirect,response.load)}})}else{if(response.redirect){afApp.load(response.redirect,response.load)}}};Ext.ux.GridRowActions.onActionFailure=function(a,b){if(a.responseText){a=Ext.decode(a.responseText)}var c=a.message||"Unable to do the operation.";Ext.Msg.alert("Failure",c,function(){if(a.redirect){afApp.load(a.redirect,a.load)}})};Ext.reg("rowactions",Ext.ux.GridRowActions);Ext.DataView.LabelEditor=function(a,b){Ext.DataView.LabelEditor.superclass.constructor.call(this,b||new Ext.form.TextField({allowBlank:false,growMin:90,growMax:240,grow:true,selectOnFocus:true}),a)};Ext.extend(Ext.DataView.LabelEditor,Ext.Editor,{alignment:"tl-tl",hideEl:false,cls:"x-small-editor",shim:false,completeOnEnter:true,cancelOnEsc:true,labelSelector:"span.x-editable",init:function(a){this.view=a;a.on("render",this.initEditor,this);this.on("complete",this.onSave,this)},initEditor:function(){this.view.getEl().on("mousedown",this.onMouseDown,this,{delegate:this.labelSelector})},onMouseDown:function(d,c){if(!d.ctrlKey&&!d.shiftKey){var b=this.view.findItemFromChild(c);d.stopEvent();var a=this.view.store.getAt(this.view.indexOf(b));this.startEdit(c,a.data[this.dataIndex]);this.activeRecord=a}else{d.preventDefault()}},onSave:function(a,b){this.activeRecord.set(this.dataIndex,b)}});Ext.DataView.DragSelector=function(g){g=g||{};var n,d,m,p;var e,o,q=new Ext.lib.Region(0,0,0,0);var b=g.dragSafe===true;this.init=function(u){n=u;n.on("render",t)};function r(){e=[];n.all.each(function(u){e[e.length]=u.getRegion()});o=n.el.getRegion()}function f(){return false}function h(u){return !b||u.target==n.el.dom}function s(u){n.on("containerclick",f,n,{single:true});if(!m){m=n.el.createChild({cls:"x-view-selector"})}else{m.setDisplayed("block")}r();n.clearSelections()}function c(D){var E=p.startXY;var I=p.getXY();var G=Math.min(E[0],I[0]);var F=Math.min(E[1],I[1]);var H=Math.abs(E[0]-I[0]);var B=Math.abs(E[1]-I[1]);q.left=G;q.top=F;q.right=G+H;q.bottom=F+B;q.constrainTo(o);m.setRegion(q);for(var A=0,C=e.length;A<C;A++){var u=e[A],z=q.intersect(u);if(z&&!u.selected){u.selected=true;n.select(A,true)}else{if(!z&&u.selected){u.selected=false;n.deselect(A)}}}}function a(u){if(m){m.setDisplayed(false)}}function t(u){p=new Ext.dd.DragTracker({onBeforeStart:h,onStart:s,onDrag:c,onEnd:a});p.initEl(u.el)}};Ext.ns("Ext.ux");Ext.ux.RobustSubmitAction=Ext.extend(Ext.form.Action.Submit,{constructor:function(b,a){Ext.ux.RobustSubmitAction.superclass.constructor.call(this,b,a)},type:"robustsubmit",handleResponse:function(a){if(this.form.errorReader){return Ext.ux.RobustSubmitAction.superclass.handleResponse.call(this,a)}try{return Ext.decode(a.responseText)}catch(b){return{success:false,message:"Invalid response: "+a.responseText}}}});Ext.form.Action.ACTION_TYPES["robustsubmit"]=Ext.ux.RobustSubmitAction;function panelHtmlCheat(b){var a=document.getElementById("center_panel");var a=a.childNodes[1];a=a.firstChild;a=a.firstChild;a=a.firstChild;if(a.childNodes[1]){a=a.childNodes[1]}else{a=a.firstChild}b.style.height=parseInt(a.style.height)-65+"px"}Ext.Comet=function(a){this.events={receive:true};Ext.apply(this,a)};Ext.extend(Ext.Comet,Ext.util.Observable,{id:"comet",_intervalId:null,request:null,interval:200,lastTextPosition:0,autoReconnect:false,reconnectIntervalOnFailure:5000,url:null,timeout:30000,start:function(){this.request=Ext.Ajax.request({url:this.url,timeout:this.timeout,callback:this.requestCallback,scope:this});this._intervalId=setInterval(this.watch.createDelegate(this),this.interval)},requestCallback:function(c,b,a){this.watch();this.stop();if(this.autoReconnect){if(b){this.start()}else{this.start.defer(this.reconnectIntervalOnFailure,this)}}},watch:function(){if(typeof(this.request.conn)!="unknown"&&typeof(this.request.conn.responseText)!="unknown"){var e=this.request.conn.responseText;if(e.length==this.lastTextPosition){return}var c=e.substring(this.lastTextPosition);this.lastTextPosition=e.length;var b=c.split("\n");var d=b.length;var a=new Array();for(i=0;i<d;i++){if(b[i]===""){continue}a.push(Ext.util.JSON.decode(b[i]))}this.fireEvent("receive",a)}},stop:function(){clearInterval(this._intervalId);this.request.conn.abort()}});Ext.ux.Updater=function(a){Ext.apply(this,a)};Ext.extend(Ext.ux.Updater,Ext.util.Observable,{url:null,interval:200,timeout:300000,width:250,errors:{noStep:null,title:null},start:function(){this.comet=new Ext.Comet({url:this.url,interval:this.interval,timeout:this.timeout});this.comet.on("receive",this.onReceive,this);this.comet.start();this.updateMsg({title:"Waiting...",msg:"Waiting for server response !",percent:"0"})},onReceive:function(a){var b=a.length;for(i=0;i<b;i++){if(!a[i].step){this.errors.noStep=this.errors.noStep||"There is an error in the Updater! No step defined !";this.createErrorMsg({msg:this.errors.noStep});continue}if(a[i].step=="start"){this.updateMsg(a[i])}else{if(a[i].step=="in"){this.updateMsg(a[i])}else{if(a[i].step=="error"){this.createErrorMsg(a[i])}else{if(a[i].step=="stop"){this.hideMsg(a[i])}}}}}},createMsg:function(b){var c=this.getPercentText(b);var a=this.getPercentValue(b);this.msg=Ext.Msg.show({title:b.title,msg:b.msg,buttons:false,progress:true,closable:false,minWidth:this.width,progressText:c});this.msg.updateProgress(a,c,b.msg)},createErrorMsg:function(a){if(this.msg){this.msg.hide();this.msg=null}if(a.msg){this.errors.title=this.errors.title||"Error";Ext.Msg.alert(this.errors.title,a.msg)}},hideMsg:function(a){this.updateMsg(a);var b=this;a.hideAfter=(a.hideAfter*1000)||2000;window.setTimeout(function(){b.msg.hide();b.msg=null;if(a.redirect){afApp.load(a.redirect)}},a.hideAfter)},updateMsg:function(b){if(!this.msg){this.createMsg(b)}else{var c=this.getPercentText(b);var a=this.getPercentValue(b);if(a==1){c+=" done"}this.msg.updateProgress(a,c,b.msg);if(b.title){this.msg.getDialog().setTitle(b.title)}}},getPercentText:function(a){return a.percent+" %"},getPercentValue:function(a){return a.percent/100}});